<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Triangular Arbitrage - ARB4ME</title>
    <style>
        body {
            background: linear-gradient(135deg, #0c0c1e 0%, #161632 100%);
            color: #b8c6db;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        .triangular-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #b8c6db;
            font-size: 0.9rem;
        }

        .form-group input {
            width: 100%;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            color: #fff;
            font-size: 0.9rem;
        }

        .toggle-switch {
            width: 50px;
            height: 25px;
            background: #ff6b6b;
            border-radius: 25px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s;
        }

        .toggle-switch.active {
            background: #00ff88;
        }

        .toggle-knob {
            width: 21px;
            height: 21px;
            background: white;
            border-radius: 50%;
            position: absolute;
            top: 2px;
            left: 2px;
            transition: all 0.3s;
        }

        .toggle-switch.active .toggle-knob {
            left: 27px;
        }

        .btn {
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #b8c6db;
        }

        #triangularTab:not(.active) {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
        }
        #triangularTab.active {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }
    </style>
</head>
<body>
    <div class="triangular-container">
        <!-- Return to Platform Button -->
        <div style="margin-bottom: 20px; text-align: center;">
            <button onclick="returnToPlatform()" class="btn" style="background: linear-gradient(45deg, #ff6b6b 0%, #ee5a24 100%); font-size: 1rem; padding: 15px 30px;">
                ‚Üê Return to ARB4ME Platform
            </button>
        </div>

        <!-- Triangular Arbitrage Management Tab -->
        <div id="triangularTab" class="tab-content active">
            <h3 style="color: #00d4ff; margin-bottom: 15px;">üî∫ Triangular Arbitrage Management</h3>

            <div style="margin-bottom: 20px; padding: 15px; background: rgba(0,255,136,0.1); border: 2px solid #00ff88; border-radius: 10px;">
                <div style="font-size: 1.2rem; color: #00ff88; margin-bottom: 15px; font-weight: bold; text-align: center;">
                    ‚úÖ TRIANGULAR TAB IS NOW WORKING!
                </div>
                <div style="color: #b8c6db; text-align: center;">
                    This page contains the VALR triangular arbitrage management interface with 32 production paths ready for trading.
                </div>
            </div>

            <div style="margin-bottom: 20px; padding: 15px; background: rgba(0,212,255,0.1); border-radius: 10px;">
                <h4 style="color: #00d4ff; margin-bottom: 10px;">üìä System Overview</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                    <div style="padding: 10px; background: rgba(255,255,255,0.1); border-radius: 8px; text-align: center;">
                        <div style="font-size: 1.5rem; color: #00ff88; font-weight: bold;">1</div>
                        <div style="font-size: 0.9rem; color: #b8c6db;">Active Exchanges</div>
                    </div>
                    <div style="padding: 10px; background: rgba(255,255,255,0.1); border-radius: 8px; text-align: center;">
                        <div style="font-size: 1.5rem; color: #ffb347; font-weight: bold;">32</div>
                        <div style="font-size: 0.9rem; color: #b8c6db;">Total Paths</div>
                    </div>
                    <div style="padding: 10px; background: rgba(255,255,255,0.1); border-radius: 8px; text-align: center;">
                        <div style="font-size: 1.5rem; color: #ff6b6b; font-weight: bold;">0</div>
                        <div style="font-size: 0.9rem; color: #b8c6db;">Profitable Today</div>
                    </div>
                    <div style="padding: 10px; background: rgba(255,255,255,0.1); border-radius: 8px; text-align: center;">
                        <div style="font-size: 1.5rem; color: #00d4ff; font-weight: bold;">R 0.00</div>
                        <div style="font-size: 0.9rem; color: #b8c6db;">Today's Profit</div>
                    </div>
                </div>
            </div>

            <div style="margin-bottom: 20px; padding: 15px; background: rgba(255,107,107,0.1); border: 2px solid #ff6b6b; border-radius: 10px;">
                <h4 style="color: #ff6b6b; margin-bottom: 10px;">üíö VALR Triangular Arbitrage</h4>
                <div style="color: #b8c6db; margin-bottom: 15px;">
                    VALR exchange integration with 32 production triangular arbitrage paths including:
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 10px;">
                    <div style="padding: 10px; background: rgba(255,255,255,0.1); border-radius: 8px;">
                        <div style="font-weight: bold; color: #00ff88;">High Volume Majors (4 paths)</div>
                        <div style="font-size: 0.85rem; color: #b8c6db;">ZAR ‚Üí LINK ‚Üí USDT ‚Üí ZAR (proven)</div>
                    </div>
                    <div style="padding: 10px; background: rgba(255,255,255,0.1); border-radius: 8px;">
                        <div style="font-weight: bold; color: #ffb347;">Popular Altcoins (4 paths)</div>
                        <div style="font-size: 0.85rem; color: #b8c6db;">ADA, DOT, MATIC, SOL paths</div>
                    </div>
                    <div style="padding: 10px; background: rgba(255,255,255,0.1); border-radius: 8px;">
                        <div style="font-weight: bold; color: #00d4ff;">Layer 1 & Ecosystem (2 paths)</div>
                        <div style="font-size: 0.85rem; color: #b8c6db;">AVAX, ATOM ecosystem tokens</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Statistics Grid for Triangular Arbitrage -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" style="color: #00ff88;" id="triangularActiveExchanges">1</div>
                <div class="stat-label">Active Exchanges</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" style="color: #ffb347;" id="triangularTotalPaths">32</div>
                <div class="stat-label">Total Paths</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" style="color: #ff6b6b;" id="triangularProfitableToday">0</div>
                <div class="stat-label">Profitable Today</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" style="color: #00d4ff;" id="triangularProfitToday">R 0.00</div>
                <div class="stat-label">Today's Profit</div>
            </div>
        </div>

        <!-- VALR Exchange Card -->
        <div style="background: rgba(0,255,136,0.1); padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 2px solid #00ff88;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="color: #00ff88; margin: 0;">üíö VALR Triangular Arbitrage</h3>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <span style="color: #b8c6db; font-size: 0.9rem;">VALR Live Trading:</span>
                    <div class="toggle-switch" id="valrTriangularEnabled">
                        <div class="toggle-knob"></div>
                    </div>
                    <span id="valrTriangularStatus" style="color: #ff6b6b; font-size: 0.9rem; margin-left: 10px;">OFF</span>
                </div>
            </div>

            <!-- VALR Settings Grid -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px;">
                <!-- Risk Management -->
                <div class="stat-card">
                    <h4 style="color: #ffb347; margin-bottom: 15px;">‚öñÔ∏è Risk Management</h4>
                    <div class="form-group">
                        <label>Max Single Trade (ZAR)</label>
                        <input type="number" id="valrMaxTrade" value="500" min="100" max="10000">
                    </div>
                    <div class="form-group">
                        <label>Portfolio % per Trade</label>
                        <input type="number" id="valrPortfolioPercent" value="10" min="1" max="50">
                    </div>
                    <div class="form-group">
                        <label>Min Profit Threshold (%)</label>
                        <input type="number" id="valrProfitThreshold" value="0.8" min="0.1" max="5" step="0.1">
                    </div>
                </div>

                <!-- Path Categories -->
                <div class="stat-card">
                    <h4 style="color: #ffb347; margin-bottom: 15px;">üìä Path Sets (Regular + Single-Asset)</h4>
                    <div style="display: grid; grid-template-columns: 1fr auto; gap: 8px; align-items: center; max-height: 200px; overflow-y: auto;">
                        <span style="color: #b8c6db; font-size: 0.85rem;">SET 1: ETH Focus</span>
                        <input type="checkbox" id="valrSet1Enabled" checked>

                        <span style="color: #b8c6db; font-size: 0.85rem;">SET 2: XRP Focus</span>
                        <input type="checkbox" id="valrSet2Enabled" checked>

                        <span style="color: #b8c6db; font-size: 0.85rem;">SET 3: SOL Focus</span>
                        <input type="checkbox" id="valrSet3Enabled" checked>

                        <span style="color: #b8c6db; font-size: 0.85rem;">SET 4: BNB Focus</span>
                        <input type="checkbox" id="valrSet4Enabled" checked>

                        <span style="color: #b8c6db; font-size: 0.85rem;">SET 5: SHIB Focus</span>
                        <input type="checkbox" id="valrSet5Enabled">

                        <span style="color: #b8c6db; font-size: 0.85rem;">SET 6: AVAX Focus</span>
                        <input type="checkbox" id="valrSet6Enabled">

                        <span style="color: #b8c6db; font-size: 0.85rem;">SET 7: DOGE Focus</span>
                        <input type="checkbox" id="valrSet7Enabled">

                        <span style="color: #b8c6db; font-size: 0.85rem;">SET 8: TRX Focus</span>
                        <input type="checkbox" id="valrSet8Enabled">

                        <span style="color: #b8c6db; font-size: 0.85rem;">SET 9: LTC Focus</span>
                        <input type="checkbox" id="valrSet9Enabled">

                        <span style="color: #b8c6db; font-size: 0.85rem;">SET 10: RLUSD Focus</span>
                        <input type="checkbox" id="valrSet10Enabled">

                        <span style="color: #b8c6db; font-size: 0.85rem;">SET 11: LINK Focus</span>
                        <input type="checkbox" id="valrSet11Enabled">

                        <span style="color: #b8c6db; font-size: 0.85rem;">SET 12: XLM Focus</span>
                        <input type="checkbox" id="valrSet12Enabled">

                        <span style="color: #ffd700; font-size: 0.85rem;">SET 13: ZAR Singles</span>
                        <input type="checkbox" id="valrSet13Enabled">

                        <span style="color: #00bfff; font-size: 0.85rem;">SET 14: USDT Singles</span>
                        <input type="checkbox" id="valrSet14Enabled">

                        <span style="color: #32cd32; font-size: 0.85rem;">SET 15: ZAR Extended</span>
                        <input type="checkbox" id="valrSet15Enabled">

                        <span style="color: #1e90ff; font-size: 0.85rem;">SET 16: ETH Extended</span>
                        <input type="checkbox" id="valrSet16Enabled">

                        <span style="color: #ff6347; font-size: 0.85rem;">SET 17: Cross-Bridge</span>
                        <input type="checkbox" id="valrSet17Enabled">

                        <span style="color: #dda0dd; font-size: 0.85rem;">SET 18: XRP Leaders</span>
                        <input type="checkbox" id="valrSet18Enabled">

                        <span style="color: #20b2aa; font-size: 0.85rem;">SET 19: SOL Tokens</span>
                        <input type="checkbox" id="valrSet19Enabled">

                        <span style="color: #ffa500; font-size: 0.85rem;">SET 20: BNB Coins</span>
                        <input type="checkbox" id="valrSet20Enabled">

                        <span style="color: #40e0d0; font-size: 0.85rem;">SET 21: ALGO Majors</span>
                        <input type="checkbox" id="valrSet21Enabled">

                        <span style="color: #ff69b4; font-size: 0.85rem;">SET 22: SAND Metaverse</span>
                        <input type="checkbox" id="valrSet22Enabled">

                        <span style="color: #9370db; font-size: 0.85rem;">SET 23: NEAR Alts</span>
                        <input type="checkbox" id="valrSet23Enabled">

                        <span style="color: #00ff7f; font-size: 0.85rem;">SET 24: ATOM Protocols</span>
                        <input type="checkbox" id="valrSet24Enabled">

                        <span style="color: #ff1493; font-size: 0.85rem;">SET 25: FTM Ecosystem</span>
                        <input type="checkbox" id="valrSet25Enabled">

                        <span style="color: #00ced1; font-size: 0.85rem;">SET 26: AAVE Lending</span>
                        <input type="checkbox" id="valrSet26Enabled">

                        <span style="color: #ffd700; font-size: 0.85rem;">SET 27: 1INCH Aggregator</span>
                        <input type="checkbox" id="valrSet27Enabled">

                        <span style="color: #8a2be2; font-size: 0.85rem;">SET 28: CRV Finance</span>
                        <input type="checkbox" id="valrSet28Enabled">

                        <span style="color: #ff4500; font-size: 0.85rem;">SET 29: COMP Protocol</span>
                        <input type="checkbox" id="valrSet29Enabled">

                        <span style="color: #32cd32; font-size: 0.85rem;">SET 30: SNX Network</span>
                        <input type="checkbox" id="valrSet30Enabled">

                        <span style="color: #87ceeb; font-size: 0.85rem;">SET 31: MKR DAO</span>
                        <input type="checkbox" id="valrSet31Enabled">

                        <span style="color: #dda0dd; font-size: 0.85rem;">SET 32: BAL Protocol</span>
                        <input type="checkbox" id="valrSet32Enabled">

                        <span style="color: #f0e68c; font-size: 0.85rem;">SET 33: ZRX Protocol</span>
                        <input type="checkbox" id="valrSet33Enabled">

                        <span style="color: #98fb98; font-size: 0.85rem;">SET 34: STORJ Network</span>
                        <input type="checkbox" id="valrSet34Enabled">

                        <span style="color: #ffb6c1; font-size: 0.85rem;">SET 35: GRT Graph</span>
                        <input type="checkbox" id="valrSet35Enabled">

                        <span style="color: #20b2aa; font-size: 0.85rem;">SET 36: ENJ Gaming</span>
                        <input type="checkbox" id="valrSet36Enabled">

                        <span style="color: #ffa07a; font-size: 0.85rem;">SET 37: BAT Attention</span>
                        <input type="checkbox" id="valrSet37Enabled">

                        <span style="color: #778899; font-size: 0.85rem;">SET 38: ZEC Privacy</span>
                        <input type="checkbox" id="valrSet38Enabled">

                        <span style="color: #b0c4de; font-size: 0.85rem;">SET 39: DASH Digital</span>
                        <input type="checkbox" id="valrSet39Enabled">
                    </div>
                    <div style="margin-top: 10px; padding: 8px; background: rgba(0,212,255,0.1); border-radius: 6px; font-size: 0.8rem; color: #b8c6db;">
                        üí° Uncheck sets to reduce server load. Sets 1-12 scan 4 paths each. Sets 13-39 scan 3-5 triangular arbitrage paths each.
                    </div>
                </div>

                <!-- Performance Stats -->
                <div class="stat-card">
                    <h4 style="color: #ffb347; margin-bottom: 15px;">üìà Performance Stats</h4>
                    <div style="display: grid; grid-template-columns: 1fr auto; gap: 10px; font-size: 0.9rem;">
                        <span style="color: #b8c6db;">Total Trades:</span>
                        <span style="color: #00ff88;" id="valrTotalTrades">0</span>

                        <span style="color: #b8c6db;">Successful Trades:</span>
                        <span style="color: #00ff88;" id="valrSuccessfulTrades">0</span>

                        <span style="color: #b8c6db;">Success Rate:</span>
                        <span style="color: #00ff88;" id="valrSuccessRate">0%</span>

                        <span style="color: #b8c6db;">Total Profit:</span>
                        <span style="color: #00ff88;" id="valrTotalProfit">R 0.00</span>

                        <span style="color: #b8c6db;">Best Path:</span>
                        <span style="color: #00ff88;" id="valrBestPath">-</span>

                        <span style="color: #b8c6db;">Last Scan:</span>
                        <span style="color: #b8c6db;" id="valrLastScan">Never</span>
                    </div>
                </div>
            </div>

            <!-- VALR Control Buttons -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                <button onclick="testValrTriangularConnection()" class="btn">
                    üîç Test Connection
                </button>
                <button onclick="scanValrTriangularPaths()" class="btn">
                    ‚ö° Manual Scan
                </button>
                <button onclick="viewValrPathDetails()" class="btn">
                    üìä View Paths
                </button>
                <button onclick="clearValrTriangularHistory()" class="btn">
                    üóëÔ∏è Clear History
                </button>
            </div>

            <!-- Recent VALR Trades -->
            <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px;">
                <h4 style="color: #ffb347; margin-bottom: 15px;">üïí Recent Triangular Trades</h4>
                <div id="valrRecentTrades" style="max-height: 200px; overflow-y: auto;">
                    <div style="text-align: center; color: #888; padding: 20px;">
                        No triangular trades yet. Enable live trading to start.
                    </div>
                </div>
            </div>
        </div>

        <!-- LUNO Exchange Card -->
        <div style="background: rgba(0,212,255,0.1); padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 2px solid #00d4ff;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="color: #00d4ff; margin: 0;">üî∑ LUNO Triangular Arbitrage</h3>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <span style="color: #b8c6db; font-size: 0.9rem;">LUNO Live Trading:</span>
                    <div class="toggle-switch" id="lunoTriangularEnabled">
                        <div class="toggle-knob"></div>
                    </div>
                    <span id="lunoTriangularStatus" style="color: #ff6b6b; font-size: 0.9rem; margin-left: 10px;">OFF</span>
                </div>
            </div>

            <!-- LUNO Settings Grid -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px;">
                <!-- Risk Management -->
                <div class="stat-card">
                    <h4 style="color: #ffb347; margin-bottom: 15px;">‚öñÔ∏è Risk Management</h4>
                    <div class="form-group">
                        <label>Max Single Trade (USDT)</label>
                        <input type="number" id="lunoMaxTrade" value="50" min="10" max="1000">
                    </div>
                    <div class="form-group">
                        <label>Portfolio % per Trade</label>
                        <input type="number" id="lunoPortfolioPercent" value="10" min="1" max="50">
                    </div>
                    <div class="form-group">
                        <label>Min Profit Threshold (%)</label>
                        <input type="number" id="lunoProfitThreshold" value="0.5" min="0.1" max="5" step="0.1">
                    </div>
                </div>

                <!-- Path Categories -->
                <div class="stat-card">
                    <h4 style="color: #ffb347; margin-bottom: 15px;">üìä Path Sets (42 Paths in 7 Sets)</h4>
                    <div style="display: grid; grid-template-columns: 1fr auto; gap: 8px; align-items: center; max-height: 200px; overflow-y: auto;">
                        <span style="color: #ffd700; font-size: 0.85rem;">SET 1: USDT Focus (7 paths)</span>
                        <input type="checkbox" id="lunoSet1Enabled" checked>

                        <span style="color: #ffb347; font-size: 0.85rem;">SET 2: XBT Focus (12 paths)</span>
                        <input type="checkbox" id="lunoSet2Enabled" checked>

                        <span style="color: #32cd32; font-size: 0.85rem;">SET 3: ZAR Focus (8 paths)</span>
                        <input type="checkbox" id="lunoSet3Enabled" checked>

                        <span style="color: #00d4ff; font-size: 0.85rem;">SET 4: ETH Focus (6 paths)</span>
                        <input type="checkbox" id="lunoSet4Enabled">

                        <span style="color: #9370db; font-size: 0.85rem;">SET 5: SOL Unique (5 paths) ‚≠ê</span>
                        <input type="checkbox" id="lunoSet5Enabled">

                        <span style="color: #00ced1; font-size: 0.85rem;">SET 6: Stablecoin Arb (4 paths)</span>
                        <input type="checkbox" id="lunoSet6Enabled">

                        <span style="color: #778899; font-size: 0.85rem;">SET 7: Extended Altcoins (0 paths)</span>
                        <input type="checkbox" id="lunoSet7Enabled">
                    </div>
                    <div style="margin-top: 10px; padding: 8px; background: rgba(0,212,255,0.1); border-radius: 6px; font-size: 0.8rem; color: #b8c6db;">
                        üí° Sets 1-3 are essential (27 paths). SET 5 includes unique SOL/ADA and SOL/XRP pairs exclusive to Luno.
                    </div>
                </div>

                <!-- Performance Stats -->
                <div class="stat-card">
                    <h4 style="color: #ffb347; margin-bottom: 15px;">üìà Performance Stats</h4>
                    <div style="display: grid; grid-template-columns: 1fr auto; gap: 10px; font-size: 0.9rem;">
                        <span style="color: #b8c6db;">Total Trades:</span>
                        <span style="color: #00d4ff;" id="lunoTotalTrades">0</span>

                        <span style="color: #b8c6db;">Successful Trades:</span>
                        <span style="color: #00d4ff;" id="lunoSuccessfulTrades">0</span>

                        <span style="color: #b8c6db;">Success Rate:</span>
                        <span style="color: #00d4ff;" id="lunoSuccessRate">0%</span>

                        <span style="color: #b8c6db;">Total Profit:</span>
                        <span style="color: #00d4ff;" id="lunoTotalProfit">$0.00</span>

                        <span style="color: #b8c6db;">Best Path:</span>
                        <span style="color: #00d4ff;" id="lunoBestPath">-</span>

                        <span style="color: #b8c6db;">Last Scan:</span>
                        <span style="color: #b8c6db;" id="lunoLastScan">Never</span>
                    </div>
                </div>
            </div>

            <!-- LUNO Control Buttons -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                <button onclick="testLunoTriangularConnection()" class="btn">
                    üîç Test Connection
                </button>
                <button onclick="scanLunoTriangularPaths()" class="btn">
                    ‚ö° Manual Scan
                </button>
                <button onclick="viewLunoPathDetails()" class="btn">
                    üìä View Paths
                </button>
                <button onclick="clearLunoTriangularHistory()" class="btn">
                    üóëÔ∏è Clear History
                </button>
            </div>

            <!-- Recent LUNO Trades -->
            <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px;">
                <h4 style="color: #ffb347; margin-bottom: 15px;">üïí Recent Triangular Trades</h4>
                <div id="lunoRecentTrades" style="max-height: 200px; overflow-y: auto;">
                    <div style="text-align: center; color: #888; padding: 20px;">
                        No triangular trades yet. Enable live trading to start.
                    </div>
                </div>
            </div>
        </div>

        <!-- CHAINEX Exchange Card -->
        <div style="background: rgba(255,152,0,0.1); padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 2px solid #ff9800;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="color: #ff9800; margin: 0;">üî∂ CHAINEX Triangular Arbitrage</h3>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <span style="color: #b8c6db; font-size: 0.9rem;">CHAINEX Live Trading:</span>
                    <div class="toggle-switch" id="chainexTriangularEnabled">
                        <div class="toggle-knob"></div>
                    </div>
                    <span id="chainexTriangularStatus" style="color: #ff6b6b; font-size: 0.9rem; margin-left: 10px;">OFF</span>
                </div>
            </div>

            <!-- CHAINEX Settings Grid -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px;">
                <!-- Risk Management -->
                <div class="stat-card">
                    <h4 style="color: #ffb347; margin-bottom: 15px;">‚öñÔ∏è Risk Management</h4>
                    <div class="form-group">
                        <label>Max Single Trade (ZAR)</label>
                        <input type="number" id="chainexMaxTrade" value="500" min="100" max="10000">
                    </div>
                    <div class="form-group">
                        <label>Portfolio % per Trade</label>
                        <input type="number" id="chainexPortfolioPercent" value="10" min="1" max="50">
                    </div>
                    <div class="form-group">
                        <label>Min Profit Threshold (%)</label>
                        <input type="number" id="chainexProfitThreshold" value="0.5" min="0.1" max="5" step="0.1">
                    </div>
                </div>

                <!-- Path Categories -->
                <div class="stat-card">
                    <h4 style="color: #ffb347; margin-bottom: 15px;">üìä Path Sets (28 Paths in 6 Sets)</h4>
                    <div style="display: grid; grid-template-columns: 1fr auto; gap: 8px; align-items: center; max-height: 200px; overflow-y: auto;">
                        <span style="color: #ffd700; font-size: 0.85rem;">SET 1: ZAR Focus (8 paths)</span>
                        <input type="checkbox" id="chainexSet1Enabled" checked>

                        <span style="color: #ff9800; font-size: 0.85rem;">SET 2: BTC Focus (7 paths)</span>
                        <input type="checkbox" id="chainexSet2Enabled" checked>

                        <span style="color: #32cd32; font-size: 0.85rem;">SET 3: USDT Focus (6 paths)</span>
                        <input type="checkbox" id="chainexSet3Enabled" checked>

                        <span style="color: #00d4ff; font-size: 0.85rem;">SET 4: ETH Focus (4 paths)</span>
                        <input type="checkbox" id="chainexSet4Enabled">

                        <span style="color: #9370db; font-size: 0.85rem;">SET 5: Cross-Currency (2 paths)</span>
                        <input type="checkbox" id="chainexSet5Enabled">

                        <span style="color: #778899; font-size: 0.85rem;">SET 6: Extended Altcoins (1 path)</span>
                        <input type="checkbox" id="chainexSet6Enabled">
                    </div>
                    <div style="margin-top: 10px; padding: 8px; background: rgba(255,152,0,0.1); border-radius: 6px; font-size: 0.8rem; color: #b8c6db;">
                        üí° Sets 1-3 are essential (21 paths). ChainEX specializes in ZAR and major crypto pairs with competitive fees.
                    </div>
                </div>

                <!-- Performance Stats -->
                <div class="stat-card">
                    <h4 style="color: #ffb347; margin-bottom: 15px;">üìà Performance Stats</h4>
                    <div style="display: grid; grid-template-columns: 1fr auto; gap: 10px; font-size: 0.9rem;">
                        <span style="color: #b8c6db;">Total Trades:</span>
                        <span style="color: #ff9800;" id="chainexTotalTrades">0</span>

                        <span style="color: #b8c6db;">Successful Trades:</span>
                        <span style="color: #ff9800;" id="chainexSuccessfulTrades">0</span>

                        <span style="color: #b8c6db;">Success Rate:</span>
                        <span style="color: #ff9800;" id="chainexSuccessRate">0%</span>

                        <span style="color: #b8c6db;">Total Profit:</span>
                        <span style="color: #ff9800;" id="chainexTotalProfit">R 0.00</span>

                        <span style="color: #b8c6db;">Best Path:</span>
                        <span style="color: #ff9800;" id="chainexBestPath">-</span>

                        <span style="color: #b8c6db;">Last Scan:</span>
                        <span style="color: #b8c6db;" id="chainexLastScan">Never</span>
                    </div>
                </div>
            </div>

            <!-- CHAINEX Control Buttons -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                <button onclick="testChainExTriangularConnection()" class="btn">
                    üîç Test Connection
                </button>
                <button onclick="scanChainExTriangularPaths()" class="btn">
                    ‚ö° Manual Scan
                </button>
                <button onclick="viewChainExPathDetails()" class="btn">
                    üìä View Paths
                </button>
                <button onclick="clearChainExTriangularHistory()" class="btn">
                    üóëÔ∏è Clear History
                </button>
            </div>

            <!-- Recent CHAINEX Trades -->
            <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px;">
                <h4 style="color: #ffb347; margin-bottom: 15px;">üïí Recent Triangular Trades</h4>
                <div id="chainexRecentTrades" style="max-height: 200px; overflow-y: auto;">
                    <div style="text-align: center; color: #888; padding: 20px;">
                        No triangular trades yet. Enable live trading to start.
                    </div>
                </div>
            </div>
        </div>

        <!-- KRAKEN Exchange Card -->
        <div style="background: rgba(153,102,255,0.1); padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 2px solid #9966ff;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="color: #9966ff; margin: 0;">üü£ KRAKEN Triangular Arbitrage</h3>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <span style="color: #b8c6db; font-size: 0.9rem;">KRAKEN Live Trading:</span>
                    <div class="toggle-switch" id="krakenTriangularEnabled">
                        <div class="toggle-knob"></div>
                    </div>
                    <span id="krakenTriangularStatus" style="color: #ff6b6b; font-size: 0.9rem; margin-left: 10px;">OFF</span>
                </div>
            </div>

            <!-- KRAKEN Settings Grid -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px;">
                <!-- Risk Management -->
                <div class="stat-card">
                    <h4 style="color: #ffb347; margin-bottom: 15px;">‚öñÔ∏è Risk Management</h4>
                    <div class="form-group">
                        <label>Max Single Trade (USDT)</label>
                        <input type="number" id="krakenMaxTrade" value="100" min="10" max="5000">
                    </div>
                    <div class="form-group">
                        <label>Portfolio % per Trade</label>
                        <input type="number" id="krakenPortfolioPercent" value="10" min="1" max="50">
                    </div>
                    <div class="form-group">
                        <label>Min Profit Threshold (%)</label>
                        <input type="number" id="krakenProfitThreshold" value="0.5" min="0.1" max="5" step="0.1">
                    </div>
                </div>

                <!-- Path Categories -->
                <div class="stat-card">
                    <h4 style="color: #ffb347; margin-bottom: 15px;">üìä Path Sets (32 Paths in 6 Sets)</h4>
                    <div style="display: grid; grid-template-columns: 1fr auto; gap: 8px; align-items: center; max-height: 200px; overflow-y: auto;">
                        <span style="color: #ffd700; font-size: 0.85rem;">SET 1: BTC Focus (8 paths)</span>
                        <input type="checkbox" id="krakenSet1Enabled" checked>

                        <span style="color: #9966ff; font-size: 0.85rem;">SET 2: ETH Focus (7 paths)</span>
                        <input type="checkbox" id="krakenSet2Enabled" checked>

                        <span style="color: #32cd32; font-size: 0.85rem;">SET 3: Reverse Majors (6 paths)</span>
                        <input type="checkbox" id="krakenSet3Enabled" checked>

                        <span style="color: #00d4ff; font-size: 0.85rem;">SET 4: Legacy Coins (5 paths)</span>
                        <input type="checkbox" id="krakenSet4Enabled">

                        <span style="color: #ff69b4; font-size: 0.85rem;">SET 5: Cross-Bridge (4 paths)</span>
                        <input type="checkbox" id="krakenSet5Enabled">

                        <span style="color: #778899; font-size: 0.85rem;">SET 6: Meme & Gaming (2 paths)</span>
                        <input type="checkbox" id="krakenSet6Enabled">
                    </div>
                    <div style="margin-top: 10px; padding: 8px; background: rgba(153,102,255,0.1); border-radius: 6px; font-size: 0.8rem; color: #b8c6db;">
                        üí° Sets 1-3 are essential (21 paths). Kraken has excellent cross-crypto pair coverage for triangular arbitrage.
                    </div>
                </div>

                <!-- Performance Stats -->
                <div class="stat-card">
                    <h4 style="color: #ffb347; margin-bottom: 15px;">üìà Performance Stats</h4>
                    <div style="display: grid; grid-template-columns: 1fr auto; gap: 10px; font-size: 0.9rem;">
                        <span style="color: #b8c6db;">Total Trades:</span>
                        <span style="color: #9966ff;" id="krakenTotalTrades">0</span>

                        <span style="color: #b8c6db;">Successful Trades:</span>
                        <span style="color: #9966ff;" id="krakenSuccessfulTrades">0</span>

                        <span style="color: #b8c6db;">Success Rate:</span>
                        <span style="color: #9966ff;" id="krakenSuccessRate">0%</span>

                        <span style="color: #b8c6db;">Total Profit:</span>
                        <span style="color: #9966ff;" id="krakenTotalProfit">$0.00</span>

                        <span style="color: #b8c6db;">Best Path:</span>
                        <span style="color: #9966ff;" id="krakenBestPath">-</span>

                        <span style="color: #b8c6db;">Last Scan:</span>
                        <span style="color: #b8c6db;" id="krakenLastScan">Never</span>
                    </div>
                </div>
            </div>

            <!-- KRAKEN Control Buttons -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                <button onclick="testKrakenTriangularConnection()" class="btn">
                    üîç Test Connection
                </button>
                <button onclick="scanKrakenTriangularPaths()" class="btn">
                    ‚ö° Manual Scan
                </button>
                <button onclick="viewKrakenPathDetails()" class="btn">
                    üìä View Paths
                </button>
                <button onclick="clearKrakenTriangularHistory()" class="btn">
                    üóëÔ∏è Clear History
                </button>
            </div>

            <!-- Recent KRAKEN Trades -->
            <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px;">
                <h4 style="color: #ffb347; margin-bottom: 15px;">üïí Recent Triangular Trades</h4>
                <div id="krakenRecentTrades" style="max-height: 200px; overflow-y: auto;">
                    <div style="text-align: center; color: #888; padding: 20px;">
                        No triangular trades yet. Enable live trading to start.
                    </div>
                </div>
            </div>
        </div>

        <!-- BYBIT Exchange Card -->
        <div style="background: rgba(255,165,0,0.1); padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 2px solid #FFA500;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="color: #FFA500; margin: 0;">üü° BYBIT Triangular Arbitrage</h3>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <span style="color: #b8c6db; font-size: 0.9rem;">BYBIT Live Trading:</span>
                    <div class="toggle-switch" id="bybitTriangularEnabled">
                        <div class="toggle-knob"></div>
                    </div>
                    <span id="bybitTriangularStatus" style="color: #ff6b6b; font-size: 0.9rem; margin-left: 10px;">OFF</span>
                </div>
            </div>

            <!-- BYBIT Settings Grid -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px;">
                <!-- Risk Management -->
                <div class="stat-card">
                    <h4 style="color: #ffb347; margin-bottom: 15px;">‚öñÔ∏è Risk Management</h4>
                    <div class="form-group">
                        <label>Max Single Trade (USDT)</label>
                        <input type="number" id="bybitMaxTrade" value="100" min="10" max="5000">
                    </div>
                    <div class="form-group">
                        <label>Portfolio % per Trade</label>
                        <input type="number" id="bybitPortfolioPercent" value="10" min="1" max="50">
                    </div>
                    <div class="form-group">
                        <label>Min Profit Threshold (%)</label>
                        <input type="number" id="bybitProfitThreshold" value="0.5" min="0.1" max="5" step="0.1">
                    </div>
                </div>

                <!-- Path Categories -->
                <div class="stat-card">
                    <h4 style="color: #ffb347; margin-bottom: 15px;">üìä Path Sets (30 Paths in 5 Sets)</h4>
                    <div style="display: grid; grid-template-columns: 1fr auto; gap: 8px; align-items: center; max-height: 200px; overflow-y: auto;">
                        <span style="color: #ffd700; font-size: 0.85rem;">SET 1: Major Coins (8 paths)</span>
                        <input type="checkbox" id="bybitSet1Enabled" checked>

                        <span style="color: #32cd32; font-size: 0.85rem;">SET 2: Mid-Cap (7 paths)</span>
                        <input type="checkbox" id="bybitSet2Enabled" checked>

                        <span style="color: #00d4ff; font-size: 0.85rem;">SET 3: DeFi/Gaming (6 paths)</span>
                        <input type="checkbox" id="bybitSet3Enabled">

                        <span style="color: #ff69b4; font-size: 0.85rem;">SET 4: High Volatility (5 paths)</span>
                        <input type="checkbox" id="bybitSet4Enabled">

                        <span style="color: #778899; font-size: 0.85rem;">SET 5: Extended Multi-Leg (4 paths)</span>
                        <input type="checkbox" id="bybitSet5Enabled">
                    </div>
                    <div style="margin-top: 10px; padding: 8px; background: rgba(255,165,0,0.1); border-radius: 6px; font-size: 0.8rem; color: #b8c6db;">
                        üí° Sets 1-2 are essential (15 paths). ByBit uses BTC as bridge for all triangular paths.
                    </div>
                </div>

                <!-- Performance Stats -->
                <div class="stat-card">
                    <h4 style="color: #ffb347; margin-bottom: 15px;">üìà Performance Stats</h4>
                    <div style="display: grid; grid-template-columns: 1fr auto; gap: 10px; font-size: 0.9rem;">
                        <span style="color: #b8c6db;">Total Trades:</span>
                        <span style="color: #FFA500;" id="bybitTotalTrades">0</span>

                        <span style="color: #b8c6db;">Successful Trades:</span>
                        <span style="color: #FFA500;" id="bybitSuccessfulTrades">0</span>

                        <span style="color: #b8c6db;">Success Rate:</span>
                        <span style="color: #FFA500;" id="bybitSuccessRate">0%</span>

                        <span style="color: #b8c6db;">Total Profit:</span>
                        <span style="color: #FFA500;" id="bybitTotalProfit">$0.00</span>

                        <span style="color: #b8c6db;">Best Path:</span>
                        <span style="color: #FFA500;" id="bybitBestPath">-</span>

                        <span style="color: #b8c6db;">Last Scan:</span>
                        <span style="color: #b8c6db;" id="bybitLastScan">Never</span>
                    </div>
                </div>
            </div>

            <!-- BYBIT Control Buttons -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                <button onclick="testByBitTriangularConnection()" class="btn">
                    üîç Test Connection
                </button>
                <button onclick="scanByBitTriangularPaths()" class="btn">
                    ‚ö° Manual Scan
                </button>
                <button onclick="viewByBitPathDetails()" class="btn">
                    üìä View Paths
                </button>
                <button onclick="clearByBitTriangularHistory()" class="btn">
                    üóëÔ∏è Clear History
                </button>
            </div>

            <!-- Recent BYBIT Trades -->
            <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px;">
                <h4 style="color: #ffb347; margin-bottom: 15px;">üïí Recent Triangular Trades</h4>
                <div id="bybitRecentTrades" style="max-height: 200px; overflow-y: auto;">
                    <div style="text-align: center; color: #888; padding: 20px;">
                        No triangular trades yet. Enable live trading to start.
                    </div>
                </div>
            </div>
        </div>

        <!-- Future Exchanges Placeholder -->
        <div style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 15px; border: 2px dashed #666;">
            <div style="text-align: center; color: #888;">
                <h3 style="color: #666; margin-bottom: 15px;">üîÆ Future Exchanges</h3>
                <p style="margin-bottom: 15px;">Additional exchanges will be added here as they're implemented:</p>
                <div style="display: flex; justify-content: center; gap: 20px; flex-wrap: wrap;">
                    <span style="color: #666; padding: 8px 16px; border: 1px solid #555; border-radius: 20px;">Binance</span>
                    <span style="color: #666; padding: 8px 16px; border: 1px solid #555; border-radius: 20px;">OKX</span>
                    <span style="color: #666; padding: 8px 16px; border: 1px solid #555; border-radius: 20px;">+ 12 more</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Return to Platform Function
        function returnToPlatform() {
            // Set triangular toggle state to OFF
            localStorage.setItem('triangularPageActive', 'false');

            // Navigate back to main platform
            window.location.href = '/';
        }

        // Triangular Arbitrage JavaScript Functions

        // Toggle for VALR Triangular trading
        document.getElementById('valrTriangularEnabled').addEventListener('click', function() {
            console.log('üîÑ [VALR] Toggle clicked');
            this.classList.toggle('active');
            const status = document.getElementById('valrTriangularStatus');

            if (this.classList.contains('active')) {
                console.log('‚úÖ [VALR] Live trading enabled');
                status.textContent = 'ON';
                status.style.color = '#00ff88';
                // Save state to localStorage
                localStorage.setItem('valrTriangularEnabled', 'true');
            } else {
                console.log('‚ùå [VALR] Live trading disabled');
                status.textContent = 'OFF';
                status.style.color = '#ff6b6b';
                localStorage.setItem('valrTriangularEnabled', 'false');
            }
        });

        // Load saved toggle state
        document.addEventListener('DOMContentLoaded', function() {
            const valrEnabled = localStorage.getItem('valrTriangularEnabled') === 'true';
            const toggle = document.getElementById('valrTriangularEnabled');
            const status = document.getElementById('valrTriangularStatus');

            if (valrEnabled) {
                toggle.classList.add('active');
                status.textContent = 'ON';
                status.style.color = '#00ff88';
            }
        });

        // Placeholder functions for triangular arbitrage functionality
        function testValrTriangularConnection() {
            console.log('üîç [VALR] Testing connection...');
            alert('Testing VALR Triangular connection...');
        }

        function scanValrTriangularPaths() {
            console.log('üîç [VALR] Scanning paths...');
            alert('Scanning VALR Triangular paths...');
        }

        function viewValrPathDetails() {
            console.log('üîç [VALR] Viewing path details...');
            alert('Viewing VALR path details...');
        }

        function clearValrTriangularHistory() {
            console.log('üîç [VALR] Clear history requested');
            if (confirm('Clear all triangular trade history?')) {
                console.log('‚úÖ [VALR] History cleared');
                alert('History cleared!');
            } else {
                console.log('‚ùå [VALR] Clear history cancelled');
            }
        }

        // Save form values to localStorage
        function saveTriangularSettings() {
            console.log('üíæ [VALR] Saving settings to localStorage...');
            const settings = {
                maxTrade: document.getElementById('valrMaxTrade').value,
                portfolioPercent: document.getElementById('valrPortfolioPercent').value,
                profitThreshold: document.getElementById('valrProfitThreshold').value
            };

            // Save path set states
            for (let i = 1; i <= 39; i++) {
                const checkbox = document.getElementById(`valrSet${i}Enabled`);
                if (checkbox) {
                    settings[`set${i}Enabled`] = checkbox.checked;
                }
            }

            localStorage.setItem('triangularSettings', JSON.stringify(settings));
            console.log('‚úÖ [VALR] Settings saved:', settings);
        }

        // Load form values from localStorage
        function loadTriangularSettings() {
            console.log('üíæ [VALR] Loading settings from localStorage...');
            const savedSettings = localStorage.getItem('triangularSettings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                console.log('‚úÖ [VALR] Settings loaded:', settings);

                if (settings.maxTrade) document.getElementById('valrMaxTrade').value = settings.maxTrade;
                if (settings.portfolioPercent) document.getElementById('valrPortfolioPercent').value = settings.portfolioPercent;
                if (settings.profitThreshold) document.getElementById('valrProfitThreshold').value = settings.profitThreshold;

                // Load path set states
                for (let i = 1; i <= 39; i++) {
                    const checkbox = document.getElementById(`valrSet${i}Enabled`);
                    if (checkbox && settings[`set${i}Enabled`] !== undefined) {
                        checkbox.checked = settings[`set${i}Enabled`];
                    }
                }
            } else {
                console.log('‚ÑπÔ∏è [VALR] No saved settings found, using defaults');
            }
        }

        // Auto-save settings when changed
        document.addEventListener('DOMContentLoaded', function() {
            loadTriangularSettings();

            // Add event listeners for auto-save
            const inputs = document.querySelectorAll('#valrMaxTrade, #valrPortfolioPercent, #valrProfitThreshold');
            inputs.forEach(input => {
                input.addEventListener('change', saveTriangularSettings);
            });

            // Add event listeners for checkboxes
            for (let i = 1; i <= 39; i++) {
                const checkbox = document.getElementById(`valrSet${i}Enabled`);
                if (checkbox) {
                    checkbox.addEventListener('change', saveTriangularSettings);
                }
            }
        });

        // ============================================================================
        // LUNO TRIANGULAR ARBITRAGE JAVASCRIPT
        // ============================================================================

        // Toggle for Luno Triangular trading
        document.getElementById('lunoTriangularEnabled').addEventListener('click', function() {
            console.log('üîÑ [LUNO] Toggle clicked');
            this.classList.toggle('active');
            const status = document.getElementById('lunoTriangularStatus');

            if (this.classList.contains('active')) {
                console.log('‚úÖ [LUNO] Live trading enabled');
                status.textContent = 'ON';
                status.style.color = '#00d4ff';
                localStorage.setItem('lunoTriangularEnabled', 'true');
            } else {
                console.log('‚ùå [LUNO] Live trading disabled');
                status.textContent = 'OFF';
                status.style.color = '#ff6b6b';
                localStorage.setItem('lunoTriangularEnabled', 'false');
            }
        });

        // Load saved Luno toggle state on page load
        document.addEventListener('DOMContentLoaded', function() {
            const lunoEnabled = localStorage.getItem('lunoTriangularEnabled') === 'true';
            const toggle = document.getElementById('lunoTriangularEnabled');
            const status = document.getElementById('lunoTriangularStatus');

            if (lunoEnabled) {
                toggle.classList.add('active');
                status.textContent = 'ON';
                status.style.color = '#00d4ff';
            }

            // Load Luno settings
            loadLunoTriangularSettings();
        });

        // Test Luno Triangular Connection
        async function testLunoTriangularConnection() {
            console.log('üîç [LUNO] Testing connection...');
            try {
                // Get credentials from localStorage (saved from strategy-api-setup.html)
                const apiKey = localStorage.getItem('luno_triangular_api');
                const apiSecret = localStorage.getItem('luno_triangular_secret');
                console.log('üîë [LUNO] API credentials retrieved from localStorage');

                if (!apiKey || !apiSecret) {
                    console.warn('‚ö†Ô∏è [LUNO] Missing API credentials');
                    alert('‚ùå Please set up your Luno API credentials first in the Strategy API Setup page.');
                    return;
                }

                // Show loading message
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = '‚è≥ Testing...';
                btn.disabled = true;

                // Call backend test-connection route
                console.log('üì° [LUNO] Sending test connection request to backend...');
                const response = await fetch('/api/v1/trading/luno/triangular/test-connection', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        apiKey: apiKey,
                        apiSecret: apiSecret
                    })
                });

                const result = await response.json();
                console.log('‚úÖ [LUNO] Test connection response received:', result);

                btn.textContent = originalText;
                btn.disabled = false;

                if (result.success) {
                    console.log('‚úÖ [LUNO] Connection successful!', result.data);
                    alert(`‚úÖ Luno Connection Successful!\n\n` +
                          `‚Ä¢ Balance Access: ${result.data.balanceAccess ? 'Yes' : 'No'}\n` +
                          `‚Ä¢ Triangular Pairs Available: ${result.data.triangularPairsAvailable ? 'Yes' : 'No'}\n` +
                          `‚Ä¢ Total Pairs: ${result.data.totalPairs}\n` +
                          `‚Ä¢ Required Pairs Found: ${result.data.requiredPairsFound.length}/6`);
                } else {
                    console.error('‚ùå [LUNO] Connection failed:', result.message);
                    alert(`‚ùå Connection Failed: ${result.message || 'Unknown error'}`);
                }
            } catch (error) {
                console.error('‚ùå [LUNO] Connection error:', error);
                alert(`‚ùå Connection Error: ${error.message}`);
            }
        }

        // Scan Luno Triangular Paths
        async function scanLunoTriangularPaths() {
            console.log('üîç [LUNO] Starting path scan...');
            try {
                const apiKey = localStorage.getItem('luno_triangular_api');
                const apiSecret = localStorage.getItem('luno_triangular_secret');

                if (!apiKey || !apiSecret) {
                    console.warn('‚ö†Ô∏è [LUNO] Missing API credentials');
                    alert('‚ùå Please set up your Luno API credentials first.');
                    return;
                }

                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = '‚è≥ Scanning...';
                btn.disabled = true;

                // Get enabled path sets
                const enabledSets = [];
                for (let i = 1; i <= 7; i++) {
                    const checkbox = document.getElementById(`lunoSet${i}Enabled`);
                    if (checkbox && checkbox.checked) {
                        enabledSets.push(i);
                    }
                }
                console.log('üìä [LUNO] Enabled path sets:', enabledSets);

                console.log('üì° [LUNO] Sending scan request to backend...');
                const response = await fetch('/api/v1/trading/luno/triangular/scan', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        apiKey: apiKey,
                        apiSecret: apiSecret,
                        paths: enabledSets.length > 0 ? enabledSets : 'all'
                    })
                });

                const result = await response.json();
                console.log('‚úÖ [LUNO] Scan response received:', result);

                btn.textContent = originalText;
                btn.disabled = false;

                if (result.success) {
                    document.getElementById('lunoLastScan').textContent = new Date().toLocaleTimeString();
                    console.log(`‚úÖ [LUNO] Scan successful! Found ${result.data.opportunities.length} opportunities`);
                    alert(`‚úÖ Scan Complete!\n\n` +
                          `‚Ä¢ Path Sets Scanned: ${result.data.pathSetsScanned}\n` +
                          `‚Ä¢ Total Paths: ${result.data.totalPathsScanned}\n` +
                          `‚Ä¢ Opportunities Found: ${result.data.opportunities.length}\n\n` +
                          `${result.data.message || 'Full implementation coming soon!'}`);
                } else {
                    console.error('‚ùå [LUNO] Scan failed:', result.message);
                    alert(`‚ùå Scan Failed: ${result.message || 'Unknown error'}`);
                }
            } catch (error) {
                console.error('‚ùå [LUNO] Scan error:', error);
                alert(`‚ùå Scan Error: ${error.message}`);
            }
        }

        // View Luno Path Details
        async function viewLunoPathDetails() {
            console.log('üîç [LUNO] Viewing path details...');
            try {
                console.log('üì° [LUNO] Fetching path details from backend...');
                const response = await fetch('/api/v1/trading/luno/triangular/paths', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const result = await response.json();
                console.log('‚úÖ [LUNO] Path details received:', result);

                if (result.success) {
                    let message = 'üìä Luno Triangular Paths\n\n';
                    message += `Total Paths: ${result.data.totalPaths}\n\n`;

                    for (const [key, value] of Object.entries(result.data.pathSets)) {
                        message += `${value.name}: ${value.pathCount} paths\n`;
                        message += `${value.description}\n\n`;
                    }

                    console.log('‚úÖ [LUNO] Displaying path details to user');
                    alert(message);
                } else {
                    console.error('‚ùå [LUNO] Failed to fetch paths:', result.message);
                    alert(`‚ùå Failed to fetch paths: ${result.message || 'Unknown error'}`);
                }
            } catch (error) {
                console.error('‚ùå [LUNO] Path details error:', error);
                alert(`‚ùå Error: ${error.message}`);
            }
        }

        // Clear Luno Triangular History
        async function clearLunoTriangularHistory() {
            console.log('üóëÔ∏è [LUNO] Clear history requested');
            if (!confirm('‚ö†Ô∏è Clear all Luno triangular trade history?\n\nThis action cannot be undone.')) {
                console.log('‚ùå [LUNO] Clear history cancelled by user');
                return;
            }

            try {
                console.log('üì° [LUNO] Sending delete request to backend...');
                const response = await fetch('/api/v1/trading/luno/triangular/history', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const result = await response.json();
                console.log('‚úÖ [LUNO] Delete response received:', result);

                if (result.success) {
                    console.log('‚úÖ [LUNO] History cleared, resetting UI stats...');
                    // Reset stats display
                    document.getElementById('lunoTotalTrades').textContent = '0';
                    document.getElementById('lunoSuccessfulTrades').textContent = '0';
                    document.getElementById('lunoSuccessRate').textContent = '0%';
                    document.getElementById('lunoTotalProfit').textContent = '$0.00';
                    document.getElementById('lunoBestPath').textContent = '-';
                    document.getElementById('lunoLastScan').textContent = 'Never';

                    // Clear recent trades display
                    document.getElementById('lunoRecentTrades').innerHTML =
                        '<div style="text-align: center; color: #888; padding: 20px;">No triangular trades yet. Enable live trading to start.</div>';

                    alert('‚úÖ History cleared successfully!');
                } else {
                    console.error('‚ùå [LUNO] Failed to clear history:', result.message);
                    alert(`‚ùå Failed to clear history: ${result.message || 'Unknown error'}`);
                }
            } catch (error) {
                console.error('‚ùå [LUNO] Clear history error:', error);
                alert(`‚ùå Error: ${error.message}`);
            }
        }

        // Save Luno settings to localStorage
        function saveLunoTriangularSettings() {
            console.log('üíæ [LUNO] Saving settings to localStorage...');
            const settings = {
                maxTrade: document.getElementById('lunoMaxTrade').value,
                portfolioPercent: document.getElementById('lunoPortfolioPercent').value,
                profitThreshold: document.getElementById('lunoProfitThreshold').value
            };

            // Save path set states (7 sets for Luno)
            for (let i = 1; i <= 7; i++) {
                const checkbox = document.getElementById(`lunoSet${i}Enabled`);
                if (checkbox) {
                    settings[`set${i}Enabled`] = checkbox.checked;
                }
            }

            localStorage.setItem('lunoTriangularSettings', JSON.stringify(settings));
            console.log('‚úÖ [LUNO] Settings saved:', settings);
        }

        // Load Luno settings from localStorage
        function loadLunoTriangularSettings() {
            console.log('üíæ [LUNO] Loading settings from localStorage...');
            const savedSettings = localStorage.getItem('lunoTriangularSettings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                console.log('‚úÖ [LUNO] Settings loaded:', settings);

                if (settings.maxTrade) document.getElementById('lunoMaxTrade').value = settings.maxTrade;
                if (settings.portfolioPercent) document.getElementById('lunoPortfolioPercent').value = settings.portfolioPercent;
                if (settings.profitThreshold) document.getElementById('lunoProfitThreshold').value = settings.profitThreshold;

                // Load path set states (7 sets)
                for (let i = 1; i <= 7; i++) {
                    const checkbox = document.getElementById(`lunoSet${i}Enabled`);
                    if (checkbox && settings[`set${i}Enabled`] !== undefined) {
                        checkbox.checked = settings[`set${i}Enabled`];
                    }
                }
            } else {
                console.log('‚ÑπÔ∏è [LUNO] No saved settings found, using defaults');
            }
        }

        // Auto-save Luno settings when changed
        document.addEventListener('DOMContentLoaded', function() {
            // Add event listeners for Luno settings auto-save
            const lunoInputs = document.querySelectorAll('#lunoMaxTrade, #lunoPortfolioPercent, #lunoProfitThreshold');
            lunoInputs.forEach(input => {
                input.addEventListener('change', saveLunoTriangularSettings);
            });

            // Add event listeners for Luno checkboxes (7 sets)
            for (let i = 1; i <= 7; i++) {
                const checkbox = document.getElementById(`lunoSet${i}Enabled`);
                if (checkbox) {
                    checkbox.addEventListener('change', saveLunoTriangularSettings);
                }
            }
        });

        // ============================================================================
        // CHAINEX TRIANGULAR ARBITRAGE JAVASCRIPT
        // ============================================================================

        // Toggle for ChainEX Triangular trading
        document.getElementById('chainexTriangularEnabled').addEventListener('click', function() {
            console.log('üîÑ [CHAINEX] Toggle clicked');
            this.classList.toggle('active');
            const status = document.getElementById('chainexTriangularStatus');

            if (this.classList.contains('active')) {
                console.log('‚úÖ [CHAINEX] Live trading enabled');
                status.textContent = 'ON';
                status.style.color = '#ff9800';
                localStorage.setItem('chainexTriangularEnabled', 'true');
            } else {
                console.log('‚ùå [CHAINEX] Live trading disabled');
                status.textContent = 'OFF';
                status.style.color = '#ff6b6b';
                localStorage.setItem('chainexTriangularEnabled', 'false');
            }
        });

        // Load saved ChainEX toggle state on page load
        document.addEventListener('DOMContentLoaded', function() {
            const chainexEnabled = localStorage.getItem('chainexTriangularEnabled') === 'true';
            const toggle = document.getElementById('chainexTriangularEnabled');
            const status = document.getElementById('chainexTriangularStatus');

            if (chainexEnabled) {
                toggle.classList.add('active');
                status.textContent = 'ON';
                status.style.color = '#ff9800';
            }

            // Load ChainEX settings
            loadChainExTriangularSettings();
        });

        // Test ChainEX Triangular Connection
        async function testChainExTriangularConnection() {
            console.log('üîç [CHAINEX] Testing connection...');
            try {
                // Get credentials from localStorage (saved from strategy-api-setup.html)
                const apiKey = localStorage.getItem('chainex_triangular_api');
                const apiSecret = localStorage.getItem('chainex_triangular_secret');
                console.log('üîë [CHAINEX] API credentials retrieved from localStorage');

                if (!apiKey || !apiSecret) {
                    console.warn('‚ö†Ô∏è [CHAINEX] Missing API credentials');
                    alert('‚ùå Please set up your ChainEX API credentials first in the Strategy API Setup page.');
                    return;
                }

                // Show loading message
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = '‚è≥ Testing...';
                btn.disabled = true;

                // Call backend test-connection route
                console.log('üì° [CHAINEX] Sending test connection request to backend...');
                const response = await fetch('/api/v1/trading/chainex/triangular/test-connection', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        apiKey: apiKey,
                        apiSecret: apiSecret
                    })
                });

                const result = await response.json();
                console.log('‚úÖ [CHAINEX] Test connection response received:', result);

                btn.textContent = originalText;
                btn.disabled = false;

                if (result.success) {
                    console.log('‚úÖ [CHAINEX] Connection successful!', result.data);
                    alert(`‚úÖ ChainEX Connection Successful!\n\n` +
                          `‚Ä¢ Authenticated: ${result.data.authenticated ? 'Yes' : 'No'}\n` +
                          `‚Ä¢ Available Pairs: ${result.data.availablePairs}\n` +
                          `‚Ä¢ Required Pairs: ${result.data.requiredPairs}\n` +
                          `‚Ä¢ Missing Pairs: ${result.data.missingPairs.length}\n` +
                          `‚Ä¢ Triangular Ready: ${result.data.triangularReady ? 'Yes' : 'No'}`);
                } else {
                    console.error('‚ùå [CHAINEX] Connection failed:', result.message);
                    alert(`‚ùå Connection Failed: ${result.message || 'Unknown error'}`);
                }
            } catch (error) {
                console.error('‚ùå [CHAINEX] Connection error:', error);
                alert(`‚ùå Connection Error: ${error.message}`);
            }
        }

        // Scan ChainEX Triangular Paths
        async function scanChainExTriangularPaths() {
            console.log('üîç [CHAINEX] Starting path scan...');
            try {
                const apiKey = localStorage.getItem('chainex_triangular_api');
                const apiSecret = localStorage.getItem('chainex_triangular_secret');

                if (!apiKey || !apiSecret) {
                    console.warn('‚ö†Ô∏è [CHAINEX] Missing API credentials');
                    alert('‚ùå Please set up your ChainEX API credentials first.');
                    return;
                }

                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = '‚è≥ Scanning...';
                btn.disabled = true;

                // Get enabled path sets
                const enabledSets = [];
                for (let i = 1; i <= 6; i++) {
                    const checkbox = document.getElementById(`chainexSet${i}Enabled`);
                    if (checkbox && checkbox.checked) {
                        enabledSets.push(i);
                    }
                }
                console.log('üìä [CHAINEX] Enabled path sets:', enabledSets);

                console.log('üì° [CHAINEX] Sending scan request to backend...');
                const response = await fetch('/api/v1/trading/chainex/triangular/scan', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        apiKey: apiKey,
                        apiSecret: apiSecret,
                        paths: enabledSets.length > 0 ? enabledSets : 'all'
                    })
                });

                const result = await response.json();
                console.log('‚úÖ [CHAINEX] Scan response received:', result);

                btn.textContent = originalText;
                btn.disabled = false;

                if (result.success) {
                    document.getElementById('chainexLastScan').textContent = new Date().toLocaleTimeString();
                    console.log(`‚úÖ [CHAINEX] Scan successful! Found ${result.data.opportunities.length} opportunities`);

                    let message = `‚úÖ Scan Complete!\n\n`;
                    message += `‚Ä¢ Paths Scanned: ${result.data.scannedPaths}\n`;
                    message += `‚Ä¢ Opportunities Found: ${result.data.opportunities.length}\n\n`;

                    if (result.data.opportunities.length > 0) {
                        message += `Top 3 Opportunities:\n`;
                        result.data.opportunities.slice(0, 3).forEach((opp, i) => {
                            message += `${i + 1}. ${opp.sequence}\n`;
                            message += `   Profit: ${opp.profitPercent.toFixed(2)}% (R ${opp.profitZar.toFixed(2)})\n`;
                        });
                    } else {
                        message += `No profitable opportunities found at this time.`;
                    }

                    alert(message);
                } else {
                    console.error('‚ùå [CHAINEX] Scan failed:', result.message);
                    alert(`‚ùå Scan Failed: ${result.message || 'Unknown error'}`);
                }
            } catch (error) {
                console.error('‚ùå [CHAINEX] Scan error:', error);
                alert(`‚ùå Scan Error: ${error.message}`);
            }
        }

        // View ChainEX Path Details
        async function viewChainExPathDetails() {
            console.log('üîç [CHAINEX] Viewing path details...');
            try {
                console.log('üì° [CHAINEX] Fetching path details from backend...');
                const response = await fetch('/api/v1/trading/chainex/triangular/paths', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const result = await response.json();
                console.log('‚úÖ [CHAINEX] Path details received:', result);

                if (result.success) {
                    let message = 'üìä ChainEX Triangular Paths\n\n';
                    message += `Total Paths: ${result.data.totalPaths}\n\n`;

                    for (const [key, value] of Object.entries(result.data.pathSets)) {
                        const setNumber = key.replace('SET_', '').split('_')[0];
                        message += `SET ${setNumber}: ${value.description}\n`;
                        message += `  Paths: ${value.count} | Enabled: ${value.enabled ? 'Yes' : 'No'}\n\n`;
                    }

                    console.log('‚úÖ [CHAINEX] Displaying path details to user');
                    alert(message);
                } else {
                    console.error('‚ùå [CHAINEX] Failed to fetch paths:', result.message);
                    alert(`‚ùå Failed to fetch paths: ${result.message || 'Unknown error'}`);
                }
            } catch (error) {
                console.error('‚ùå [CHAINEX] Path details error:', error);
                alert(`‚ùå Error: ${error.message}`);
            }
        }

        // Clear ChainEX Triangular History
        async function clearChainExTriangularHistory() {
            console.log('üóëÔ∏è [CHAINEX] Clear history requested');
            if (!confirm('‚ö†Ô∏è Clear all ChainEX triangular trade history?\n\nThis action cannot be undone.')) {
                console.log('‚ùå [CHAINEX] Clear history cancelled by user');
                return;
            }

            try {
                console.log('üì° [CHAINEX] Sending delete request to backend...');
                const response = await fetch('/api/v1/trading/chainex/triangular/history', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const result = await response.json();
                console.log('‚úÖ [CHAINEX] Delete response received:', result);

                if (result.success) {
                    console.log('‚úÖ [CHAINEX] History cleared, resetting UI stats...');
                    // Reset stats display
                    document.getElementById('chainexTotalTrades').textContent = '0';
                    document.getElementById('chainexSuccessfulTrades').textContent = '0';
                    document.getElementById('chainexSuccessRate').textContent = '0%';
                    document.getElementById('chainexTotalProfit').textContent = 'R 0.00';
                    document.getElementById('chainexBestPath').textContent = '-';
                    document.getElementById('chainexLastScan').textContent = 'Never';

                    // Clear recent trades display
                    document.getElementById('chainexRecentTrades').innerHTML =
                        '<div style="text-align: center; color: #888; padding: 20px;">No triangular trades yet. Enable live trading to start.</div>';

                    alert(`‚úÖ History cleared successfully!\n\nDeleted ${result.data.deletedCount} records.`);
                } else {
                    console.error('‚ùå [CHAINEX] Failed to clear history:', result.message);
                    alert(`‚ùå Failed to clear history: ${result.message || 'Unknown error'}`);
                }
            } catch (error) {
                console.error('‚ùå [CHAINEX] Clear history error:', error);
                alert(`‚ùå Error: ${error.message}`);
            }
        }

        // Save ChainEX settings to localStorage
        function saveChainExTriangularSettings() {
            console.log('üíæ [CHAINEX] Saving settings to localStorage...');
            const settings = {
                maxTrade: document.getElementById('chainexMaxTrade').value,
                portfolioPercent: document.getElementById('chainexPortfolioPercent').value,
                profitThreshold: document.getElementById('chainexProfitThreshold').value
            };

            // Save path set states (6 sets for ChainEX)
            for (let i = 1; i <= 6; i++) {
                const checkbox = document.getElementById(`chainexSet${i}Enabled`);
                if (checkbox) {
                    settings[`set${i}Enabled`] = checkbox.checked;
                }
            }

            localStorage.setItem('chainexTriangularSettings', JSON.stringify(settings));
            console.log('‚úÖ [CHAINEX] Settings saved:', settings);
        }

        // Load ChainEX settings from localStorage
        function loadChainExTriangularSettings() {
            console.log('üíæ [CHAINEX] Loading settings from localStorage...');
            const savedSettings = localStorage.getItem('chainexTriangularSettings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                console.log('‚úÖ [CHAINEX] Settings loaded:', settings);

                if (settings.maxTrade) document.getElementById('chainexMaxTrade').value = settings.maxTrade;
                if (settings.portfolioPercent) document.getElementById('chainexPortfolioPercent').value = settings.portfolioPercent;
                if (settings.profitThreshold) document.getElementById('chainexProfitThreshold').value = settings.profitThreshold;

                // Load path set states (6 sets)
                for (let i = 1; i <= 6; i++) {
                    const checkbox = document.getElementById(`chainexSet${i}Enabled`);
                    if (checkbox && settings[`set${i}Enabled`] !== undefined) {
                        checkbox.checked = settings[`set${i}Enabled`];
                    }
                }
            } else {
                console.log('‚ÑπÔ∏è [CHAINEX] No saved settings found, using defaults');
            }
        }

        // Auto-save ChainEX settings when changed
        document.addEventListener('DOMContentLoaded', function() {
            // Add event listeners for ChainEX settings auto-save
            const chainexInputs = document.querySelectorAll('#chainexMaxTrade, #chainexPortfolioPercent, #chainexProfitThreshold');
            chainexInputs.forEach(input => {
                input.addEventListener('change', saveChainExTriangularSettings);
            });

            // Add event listeners for ChainEX checkboxes (6 sets)
            for (let i = 1; i <= 6; i++) {
                const checkbox = document.getElementById(`chainexSet${i}Enabled`);
                if (checkbox) {
                    checkbox.addEventListener('change', saveChainExTriangularSettings);
                }
            }
        });

        // ============================================================================
        // KRAKEN TRIANGULAR ARBITRAGE JAVASCRIPT
        // ============================================================================

        // Toggle for Kraken Triangular trading
        document.getElementById('krakenTriangularEnabled').addEventListener('click', function() {
            console.log('üîÑ [KRAKEN] Toggle clicked');
            this.classList.toggle('active');
            const status = document.getElementById('krakenTriangularStatus');

            if (this.classList.contains('active')) {
                console.log('‚úÖ [KRAKEN] Live trading enabled');
                status.textContent = 'ON';
                status.style.color = '#9966ff';
                localStorage.setItem('krakenTriangularEnabled', 'true');
            } else {
                console.log('‚ùå [KRAKEN] Live trading disabled');
                status.textContent = 'OFF';
                status.style.color = '#ff6b6b';
                localStorage.setItem('krakenTriangularEnabled', 'false');
            }
        });

        // Load saved Kraken toggle state on page load
        document.addEventListener('DOMContentLoaded', function() {
            const krakenEnabled = localStorage.getItem('krakenTriangularEnabled') === 'true';
            const toggle = document.getElementById('krakenTriangularEnabled');
            const status = document.getElementById('krakenTriangularStatus');

            if (krakenEnabled) {
                toggle.classList.add('active');
                status.textContent = 'ON';
                status.style.color = '#9966ff';
            }

            // Load Kraken settings
            loadKrakenTriangularSettings();
        });

        // Test Kraken Triangular Connection
        async function testKrakenTriangularConnection() {
            console.log('üîç [KRAKEN] Testing connection...');
            try {
                // Get credentials from localStorage (saved from strategy-api-setup.html)
                const apiKey = localStorage.getItem('kraken_triangular_api');
                const apiSecret = localStorage.getItem('kraken_triangular_secret');
                console.log('üîë [KRAKEN] API credentials retrieved from localStorage');

                if (!apiKey || !apiSecret) {
                    console.warn('‚ö†Ô∏è [KRAKEN] Missing API credentials');
                    alert('‚ùå Please set up your Kraken API credentials first in the Strategy API Setup page.');
                    return;
                }

                // Show loading message
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = '‚è≥ Testing...';
                btn.disabled = true;

                // Call backend test-connection route
                console.log('üì° [KRAKEN] Sending test connection request to backend...');
                const response = await fetch('/api/v1/trading/kraken/triangular/test-connection', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        apiKey: apiKey,
                        apiSecret: apiSecret
                    })
                });

                const result = await response.json();
                console.log('‚úÖ [KRAKEN] Test connection response received:', result);

                btn.textContent = originalText;
                btn.disabled = false;

                if (result.success) {
                    console.log('‚úÖ [KRAKEN] Connection successful!', result.data);
                    alert(`‚úÖ Kraken Connection Successful!\n\n` +
                          `‚Ä¢ Authenticated: ${result.data.authenticated ? 'Yes' : 'No'}\n` +
                          `‚Ä¢ Balance Access: ${result.data.balanceAccess ? 'Yes' : 'No'}\n` +
                          `‚Ä¢ Available Pairs: ${result.data.availablePairs}\n` +
                          `‚Ä¢ Required Pairs: ${result.data.requiredPairs}\n` +
                          `‚Ä¢ Triangular Ready: ${result.data.triangularReady ? 'Yes' : 'No'}`);
                } else {
                    console.error('‚ùå [KRAKEN] Connection failed:', result.message);
                    alert(`‚ùå Connection Failed: ${result.message || 'Unknown error'}`);
                }
            } catch (error) {
                console.error('‚ùå [KRAKEN] Connection error:', error);
                alert(`‚ùå Connection Error: ${error.message}`);
            }
        }

        // Scan Kraken Triangular Paths
        async function scanKrakenTriangularPaths() {
            console.log('üîç [KRAKEN] Starting path scan...');
            try {
                const apiKey = localStorage.getItem('kraken_triangular_api');
                const apiSecret = localStorage.getItem('kraken_triangular_secret');

                if (!apiKey || !apiSecret) {
                    console.warn('‚ö†Ô∏è [KRAKEN] Missing API credentials');
                    alert('‚ùå Please set up your Kraken API credentials first.');
                    return;
                }

                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = '‚è≥ Scanning...';
                btn.disabled = true;

                // Get enabled path sets
                const enabledSets = [];
                for (let i = 1; i <= 6; i++) {
                    const checkbox = document.getElementById(`krakenSet${i}Enabled`);
                    if (checkbox && checkbox.checked) {
                        enabledSets.push(i);
                    }
                }
                console.log('üìä [KRAKEN] Enabled path sets:', enabledSets);

                console.log('üì° [KRAKEN] Sending scan request to backend...');
                const response = await fetch('/api/v1/trading/kraken/triangular/scan', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        apiKey: apiKey,
                        apiSecret: apiSecret,
                        paths: enabledSets.length > 0 ? enabledSets : 'all'
                    })
                });

                const result = await response.json();
                console.log('‚úÖ [KRAKEN] Scan response received:', result);

                btn.textContent = originalText;
                btn.disabled = false;

                if (result.success) {
                    document.getElementById('krakenLastScan').textContent = new Date().toLocaleTimeString();
                    console.log(`‚úÖ [KRAKEN] Scan successful! Found ${result.data.opportunities.length} opportunities`);

                    let message = `‚úÖ Scan Complete!\n\n`;
                    message += `‚Ä¢ Paths Scanned: ${result.data.scannedPaths}\n`;
                    message += `‚Ä¢ Path Sets: ${result.data.pathSetsScanned}\n`;
                    message += `‚Ä¢ Opportunities Found: ${result.data.opportunities.length}\n\n`;
                    message += `${result.data.message || 'Full scanning implementation coming soon!'}`;

                    alert(message);
                } else {
                    console.error('‚ùå [KRAKEN] Scan failed:', result.message);
                    alert(`‚ùå Scan Failed: ${result.message || 'Unknown error'}`);
                }
            } catch (error) {
                console.error('‚ùå [KRAKEN] Scan error:', error);
                alert(`‚ùå Scan Error: ${error.message}`);
            }
        }

        // View Kraken Path Details
        async function viewKrakenPathDetails() {
            console.log('üîç [KRAKEN] Viewing path details...');
            try {
                console.log('üì° [KRAKEN] Fetching path details from backend...');
                const response = await fetch('/api/v1/trading/kraken/triangular/paths', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const result = await response.json();
                console.log('‚úÖ [KRAKEN] Path details received:', result);

                if (result.success) {
                    let message = 'üìä Kraken Triangular Paths\n\n';
                    message += `Total Paths: ${result.data.totalPaths}\n\n`;

                    for (const [key, value] of Object.entries(result.data.pathSets)) {
                        const setNumber = key.replace('SET_', '').split('_')[0];
                        message += `SET ${setNumber}: ${value.description}\n`;
                        message += `  Paths: ${value.count} | Enabled: ${value.enabled ? 'Yes' : 'No'}\n\n`;
                    }

                    console.log('‚úÖ [KRAKEN] Displaying path details to user');
                    alert(message);
                } else {
                    console.error('‚ùå [KRAKEN] Failed to fetch paths:', result.message);
                    alert(`‚ùå Failed to fetch paths: ${result.message || 'Unknown error'}`);
                }
            } catch (error) {
                console.error('‚ùå [KRAKEN] Path details error:', error);
                alert(`‚ùå Error: ${error.message}`);
            }
        }

        // Clear Kraken Triangular History
        async function clearKrakenTriangularHistory() {
            console.log('üóëÔ∏è [KRAKEN] Clear history requested');
            if (!confirm('‚ö†Ô∏è Clear all Kraken triangular trade history?\n\nThis action cannot be undone.')) {
                console.log('‚ùå [KRAKEN] Clear history cancelled by user');
                return;
            }

            try {
                console.log('üì° [KRAKEN] Sending delete request to backend...');
                const response = await fetch('/api/v1/trading/kraken/triangular/history', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const result = await response.json();
                console.log('‚úÖ [KRAKEN] Delete response received:', result);

                if (result.success) {
                    console.log('‚úÖ [KRAKEN] History cleared, resetting UI stats...');
                    // Reset stats display
                    document.getElementById('krakenTotalTrades').textContent = '0';
                    document.getElementById('krakenSuccessfulTrades').textContent = '0';
                    document.getElementById('krakenSuccessRate').textContent = '0%';
                    document.getElementById('krakenTotalProfit').textContent = '$0.00';
                    document.getElementById('krakenBestPath').textContent = '-';
                    document.getElementById('krakenLastScan').textContent = 'Never';

                    // Clear recent trades display
                    document.getElementById('krakenRecentTrades').innerHTML =
                        '<div style="text-align: center; color: #888; padding: 20px;">No triangular trades yet. Enable live trading to start.</div>';

                    alert(`‚úÖ History cleared successfully!\n\nDeleted ${result.data.deletedCount} records.`);
                } else {
                    console.error('‚ùå [KRAKEN] Failed to clear history:', result.message);
                    alert(`‚ùå Failed to clear history: ${result.message || 'Unknown error'}`);
                }
            } catch (error) {
                console.error('‚ùå [KRAKEN] Clear history error:', error);
                alert(`‚ùå Error: ${error.message}`);
            }
        }

        // Save Kraken settings to localStorage
        function saveKrakenTriangularSettings() {
            console.log('üíæ [KRAKEN] Saving settings to localStorage...');
            const settings = {
                maxTrade: document.getElementById('krakenMaxTrade').value,
                portfolioPercent: document.getElementById('krakenPortfolioPercent').value,
                profitThreshold: document.getElementById('krakenProfitThreshold').value
            };

            // Save path set states (6 sets for Kraken)
            for (let i = 1; i <= 6; i++) {
                const checkbox = document.getElementById(`krakenSet${i}Enabled`);
                if (checkbox) {
                    settings[`set${i}Enabled`] = checkbox.checked;
                }
            }

            localStorage.setItem('krakenTriangularSettings', JSON.stringify(settings));
            console.log('‚úÖ [KRAKEN] Settings saved:', settings);
        }

        // Load Kraken settings from localStorage
        function loadKrakenTriangularSettings() {
            console.log('üíæ [KRAKEN] Loading settings from localStorage...');
            const savedSettings = localStorage.getItem('krakenTriangularSettings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                console.log('‚úÖ [KRAKEN] Settings loaded:', settings);

                if (settings.maxTrade) document.getElementById('krakenMaxTrade').value = settings.maxTrade;
                if (settings.portfolioPercent) document.getElementById('krakenPortfolioPercent').value = settings.portfolioPercent;
                if (settings.profitThreshold) document.getElementById('krakenProfitThreshold').value = settings.profitThreshold;

                // Load path set states (6 sets)
                for (let i = 1; i <= 6; i++) {
                    const checkbox = document.getElementById(`krakenSet${i}Enabled`);
                    if (checkbox && settings[`set${i}Enabled`] !== undefined) {
                        checkbox.checked = settings[`set${i}Enabled`];
                    }
                }
            } else {
                console.log('‚ÑπÔ∏è [KRAKEN] No saved settings found, using defaults');
            }
        }

        // Auto-save Kraken settings when changed
        document.addEventListener('DOMContentLoaded', function() {
            // Add event listeners for Kraken settings auto-save
            const krakenInputs = document.querySelectorAll('#krakenMaxTrade, #krakenPortfolioPercent, #krakenProfitThreshold');
            krakenInputs.forEach(input => {
                input.addEventListener('change', saveKrakenTriangularSettings);
            });

            // Add event listeners for Kraken checkboxes (6 sets)
            for (let i = 1; i <= 6; i++) {
                const checkbox = document.getElementById(`krakenSet${i}Enabled`);
                if (checkbox) {
                    checkbox.addEventListener('change', saveKrakenTriangularSettings);
                }
            }
        });

        // ============================================================================
        // BYBIT TRIANGULAR ARBITRAGE JAVASCRIPT
        // ============================================================================

        // Toggle for ByBit Triangular trading
        document.getElementById('bybitTriangularEnabled').addEventListener('click', function() {
            console.log('üîÑ [BYBIT] Toggle clicked');
            this.classList.toggle('active');
            const status = document.getElementById('bybitTriangularStatus');

            if (this.classList.contains('active')) {
                console.log('‚úÖ [BYBIT] Live trading enabled');
                status.textContent = 'ON';
                status.style.color = '#FFA500';
                localStorage.setItem('bybitTriangularEnabled', 'true');
            } else {
                console.log('‚ùå [BYBIT] Live trading disabled');
                status.textContent = 'OFF';
                status.style.color = '#ff6b6b';
                localStorage.setItem('bybitTriangularEnabled', 'false');
            }
        });

        // Load saved ByBit toggle state on page load
        document.addEventListener('DOMContentLoaded', function() {
            const bybitEnabled = localStorage.getItem('bybitTriangularEnabled') === 'true';
            const toggle = document.getElementById('bybitTriangularEnabled');
            const status = document.getElementById('bybitTriangularStatus');

            if (bybitEnabled) {
                toggle.classList.add('active');
                status.textContent = 'ON';
                status.style.color = '#FFA500';
            }

            // Load ByBit settings
            loadByBitTriangularSettings();
        });

        // Test ByBit Triangular Connection
        async function testByBitTriangularConnection() {
            console.log('üîç [BYBIT] Testing connection...');
            try {
                // Get credentials from localStorage (saved from strategy-api-setup.html)
                const apiKey = localStorage.getItem('bybit_triangular_api');
                const apiSecret = localStorage.getItem('bybit_triangular_secret');
                console.log('üîë [BYBIT] API credentials retrieved from localStorage');

                if (!apiKey || !apiSecret) {
                    console.warn('‚ö†Ô∏è [BYBIT] Missing API credentials');
                    alert('‚ùå Please set up your ByBit API credentials first in the Strategy API Setup page.');
                    return;
                }

                // Show loading message
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = '‚è≥ Testing...';
                btn.disabled = true;

                // Call backend test-connection route
                console.log('üì° [BYBIT] Sending test connection request to backend...');
                const response = await fetch('/api/v1/trading/bybit/triangular/test-connection', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        apiKey: apiKey,
                        apiSecret: apiSecret
                    })
                });

                const result = await response.json();
                console.log('‚úÖ [BYBIT] Test connection response received:', result);

                btn.textContent = originalText;
                btn.disabled = false;

                if (result.success) {
                    console.log('‚úÖ [BYBIT] Connection successful!', result.data);
                    alert(`‚úÖ ByBit Connection Successful!\n\n` +
                          `‚Ä¢ Authenticated: ${result.data.authenticated ? 'Yes' : 'No'}\n` +
                          `‚Ä¢ Balance Access: ${result.data.balanceAccess ? 'Yes' : 'No'}\n` +
                          `‚Ä¢ Available Pairs: ${result.data.availablePairs}\n` +
                          `‚Ä¢ Required Pairs: ${result.data.requiredPairs}\n` +
                          `‚Ä¢ Triangular Ready: ${result.data.triangularReady ? 'Yes' : 'No'}`);
                } else {
                    console.error('‚ùå [BYBIT] Connection failed:', result.message);
                    alert(`‚ùå Connection Failed: ${result.message || 'Unknown error'}`);
                }
            } catch (error) {
                console.error('‚ùå [BYBIT] Connection error:', error);
                alert(`‚ùå Connection Error: ${error.message}`);
            }
        }

        // Scan ByBit Triangular Paths
        async function scanByBitTriangularPaths() {
            console.log('üîç [BYBIT] Starting path scan...');
            try {
                const apiKey = localStorage.getItem('bybit_triangular_api');
                const apiSecret = localStorage.getItem('bybit_triangular_secret');

                if (!apiKey || !apiSecret) {
                    console.warn('‚ö†Ô∏è [BYBIT] Missing API credentials');
                    alert('‚ùå Please set up your ByBit API credentials first.');
                    return;
                }

                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = '‚è≥ Scanning...';
                btn.disabled = true;

                // Get enabled path sets
                const enabledSets = [];
                for (let i = 1; i <= 5; i++) {
                    const checkbox = document.getElementById(`bybitSet${i}Enabled`);
                    if (checkbox && checkbox.checked) {
                        enabledSets.push(i);
                    }
                }
                console.log('üìä [BYBIT] Enabled path sets:', enabledSets);

                console.log('üì° [BYBIT] Sending scan request to backend...');
                const response = await fetch('/api/v1/trading/bybit/triangular/scan', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        apiKey: apiKey,
                        apiSecret: apiSecret,
                        paths: enabledSets.length > 0 ? enabledSets : 'all'
                    })
                });

                const result = await response.json();
                console.log('‚úÖ [BYBIT] Scan response received:', result);

                btn.textContent = originalText;
                btn.disabled = false;

                if (result.success) {
                    document.getElementById('bybitLastScan').textContent = new Date().toLocaleTimeString();
                    console.log(`‚úÖ [BYBIT] Scan successful! Found ${result.data.opportunities.length} opportunities`);

                    let message = `‚úÖ Scan Complete!\n\n`;
                    message += `‚Ä¢ Paths Scanned: ${result.data.scannedPaths}\n`;
                    message += `‚Ä¢ Path Sets: ${result.data.pathSetsScanned}\n`;
                    message += `‚Ä¢ Opportunities Found: ${result.data.opportunities.length}\n\n`;
                    message += `${result.data.message || 'Full scanning implementation coming soon!'}`;

                    alert(message);
                } else {
                    console.error('‚ùå [BYBIT] Scan failed:', result.message);
                    alert(`‚ùå Scan Failed: ${result.message || 'Unknown error'}`);
                }
            } catch (error) {
                console.error('‚ùå [BYBIT] Scan error:', error);
                alert(`‚ùå Scan Error: ${error.message}`);
            }
        }

        // View ByBit Path Details
        async function viewByBitPathDetails() {
            console.log('üîç [BYBIT] Viewing path details...');
            try {
                console.log('üì° [BYBIT] Fetching path details from backend...');
                const response = await fetch('/api/v1/trading/bybit/triangular/paths', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const result = await response.json();
                console.log('‚úÖ [BYBIT] Path details received:', result);

                if (result.success) {
                    let message = 'üìä ByBit Triangular Paths\n\n';
                    message += `Total Paths: ${result.data.totalPaths}\n\n`;

                    for (const [key, value] of Object.entries(result.data.pathSets)) {
                        const setNumber = key.replace('SET_', '').split('_')[0];
                        message += `SET ${setNumber}: ${value.description}\n`;
                        message += `  Paths: ${value.count} | Enabled: ${value.enabled ? 'Yes' : 'No'}\n\n`;
                    }

                    console.log('‚úÖ [BYBIT] Displaying path details to user');
                    alert(message);
                } else {
                    console.error('‚ùå [BYBIT] Failed to fetch paths:', result.message);
                    alert(`‚ùå Failed to fetch paths: ${result.message || 'Unknown error'}`);
                }
            } catch (error) {
                console.error('‚ùå [BYBIT] Path details error:', error);
                alert(`‚ùå Error: ${error.message}`);
            }
        }

        // Clear ByBit Triangular History
        async function clearByBitTriangularHistory() {
            console.log('üóëÔ∏è [BYBIT] Clear history requested');
            if (!confirm('‚ö†Ô∏è Clear all ByBit triangular trade history?\n\nThis action cannot be undone.')) {
                console.log('‚ùå [BYBIT] Clear history cancelled by user');
                return;
            }

            try {
                console.log('üì° [BYBIT] Sending delete request to backend...');
                const response = await fetch('/api/v1/trading/bybit/triangular/history', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const result = await response.json();
                console.log('‚úÖ [BYBIT] Delete response received:', result);

                if (result.success) {
                    console.log('‚úÖ [BYBIT] History cleared, resetting UI stats...');
                    // Reset stats display
                    document.getElementById('bybitTotalTrades').textContent = '0';
                    document.getElementById('bybitSuccessfulTrades').textContent = '0';
                    document.getElementById('bybitSuccessRate').textContent = '0%';
                    document.getElementById('bybitTotalProfit').textContent = '$0.00';
                    document.getElementById('bybitBestPath').textContent = '-';
                    document.getElementById('bybitLastScan').textContent = 'Never';

                    // Clear recent trades display
                    document.getElementById('bybitRecentTrades').innerHTML =
                        '<div style="text-align: center; color: #888; padding: 20px;">No triangular trades yet. Enable live trading to start.</div>';

                    alert(`‚úÖ History cleared successfully!\n\nDeleted ${result.data.deletedCount} records.`);
                } else {
                    console.error('‚ùå [BYBIT] Failed to clear history:', result.message);
                    alert(`‚ùå Failed to clear history: ${result.message || 'Unknown error'}`);
                }
            } catch (error) {
                console.error('‚ùå [BYBIT] Clear history error:', error);
                alert(`‚ùå Error: ${error.message}`);
            }
        }

        // Save ByBit settings to localStorage
        function saveByBitTriangularSettings() {
            console.log('üíæ [BYBIT] Saving settings to localStorage...');
            const settings = {
                maxTrade: document.getElementById('bybitMaxTrade').value,
                portfolioPercent: document.getElementById('bybitPortfolioPercent').value,
                profitThreshold: document.getElementById('bybitProfitThreshold').value
            };

            // Save path set states (5 sets for ByBit)
            for (let i = 1; i <= 5; i++) {
                const checkbox = document.getElementById(`bybitSet${i}Enabled`);
                if (checkbox) {
                    settings[`set${i}Enabled`] = checkbox.checked;
                }
            }

            localStorage.setItem('bybitTriangularSettings', JSON.stringify(settings));
            console.log('‚úÖ [BYBIT] Settings saved:', settings);
        }

        // Load ByBit settings from localStorage
        function loadByBitTriangularSettings() {
            console.log('üíæ [BYBIT] Loading settings from localStorage...');
            const savedSettings = localStorage.getItem('bybitTriangularSettings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                console.log('‚úÖ [BYBIT] Settings loaded:', settings);

                if (settings.maxTrade) document.getElementById('bybitMaxTrade').value = settings.maxTrade;
                if (settings.portfolioPercent) document.getElementById('bybitPortfolioPercent').value = settings.portfolioPercent;
                if (settings.profitThreshold) document.getElementById('bybitProfitThreshold').value = settings.profitThreshold;

                // Load path set states (5 sets)
                for (let i = 1; i <= 5; i++) {
                    const checkbox = document.getElementById(`bybitSet${i}Enabled`);
                    if (checkbox && settings[`set${i}Enabled`] !== undefined) {
                        checkbox.checked = settings[`set${i}Enabled`];
                    }
                }
            } else {
                console.log('‚ÑπÔ∏è [BYBIT] No saved settings found, using defaults');
            }
        }

        // Auto-save ByBit settings when changed
        document.addEventListener('DOMContentLoaded', function() {
            // Add event listeners for ByBit settings auto-save
            const bybitInputs = document.querySelectorAll('#bybitMaxTrade, #bybitPortfolioPercent, #bybitProfitThreshold');
            bybitInputs.forEach(input => {
                input.addEventListener('change', saveByBitTriangularSettings);
            });

            // Add event listeners for ByBit checkboxes (5 sets)
            for (let i = 1; i <= 5; i++) {
                const checkbox = document.getElementById(`bybitSet${i}Enabled`);
                if (checkbox) {
                    checkbox.addEventListener('change', saveByBitTriangularSettings);
                }
            }
        });
    </script>
</body>
</html>