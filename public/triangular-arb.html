<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Triangular Arbitrage - ARB4ME</title>
    <style>
        body {
            background: linear-gradient(135deg, #0c0c1e 0%, #161632 100%);
            color: #b8c6db;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        .triangular-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #b8c6db;
            font-size: 0.9rem;
        }

        .form-group input {
            width: 100%;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            color: #fff;
            font-size: 0.9rem;
        }

        .toggle-switch {
            width: 50px;
            height: 25px;
            background: #ff6b6b;
            border-radius: 25px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s;
        }

        .toggle-switch.active {
            background: #00ff88;
        }

        .toggle-knob {
            width: 21px;
            height: 21px;
            background: white;
            border-radius: 50%;
            position: absolute;
            top: 2px;
            left: 2px;
            transition: all 0.3s;
        }

        .toggle-switch.active .toggle-knob {
            left: 27px;
        }

        .btn {
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #b8c6db;
        }

        #triangularTab:not(.active) {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
        }
        #triangularTab.active {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }

        /* Notification animations */
        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <div class="triangular-container">
        <!-- Return to Platform Button -->
        <div style="margin-bottom: 20px; text-align: center;">
            <button onclick="returnToPlatform()" class="btn" style="background: linear-gradient(45deg, #ff6b6b 0%, #ee5a24 100%); font-size: 1rem; padding: 15px 30px;">
                ‚Üê Return to ARB4ME Platform
            </button>
        </div>

        <!-- Triangular Arbitrage Management Tab -->
        <div id="triangularTab" class="tab-content active">
            <h3 style="color: #00d4ff; margin-bottom: 15px;">üî∫ Triangular Arbitrage Management</h3>

            <!-- Statistics Grid for Triangular Arbitrage -->
            <div class="stats-grid" style="margin-bottom: 30px;">
                <div class="stat-card">
                    <div class="stat-value" style="color: #00ff88;" id="triangularActiveExchanges">21</div>
                    <div class="stat-label">Active Exchanges</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" style="color: #ffb347;" id="triangularTotalPaths">600+</div>
                    <div class="stat-label">Total Paths</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" style="color: #ff6b6b;" id="triangularProfitableToday">0</div>
                    <div class="stat-label">Profitable Today</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" style="color: #00d4ff;" id="triangularProfitToday">$0.00</div>
                    <div class="stat-label">Today's Profit</div>
                </div>
            </div>
        </div>

        <!-- VALR Exchange Card -->
        <div style="background: rgba(0,255,136,0.1); padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 2px solid #00ff88;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="color: #00ff88; margin: 0;">üíö VALR Triangular Arbitrage</h3>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <span style="color: #b8c6db; font-size: 0.9rem;">VALR Live Trading:</span>
                    <div class="toggle-switch" id="valrTriangularEnabled">
                        <div class="toggle-knob"></div>
                    </div>
                    <span id="valrTriangularStatus" style="color: #ff6b6b; font-size: 0.9rem; margin-left: 10px;">OFF</span>
                </div>
            </div>

            <!-- VALR Settings Grid -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px;">
                <!-- Risk Management -->
                <div class="stat-card">
                    <h4 style="color: #ffb347; margin-bottom: 15px;">‚öñÔ∏è Risk Management</h4>
                    <div class="form-group">
                        <label>Max Single Trade (ZAR)</label>
                        <input type="number" id="valrMaxTrade" value="500" min="100" max="10000">
                    </div>
                    <div class="form-group">
                        <label>Portfolio % per Trade</label>
                        <input type="number" id="valrPortfolioPercent" value="10" min="1" max="50">
                    </div>
                    <div class="form-group">
                        <label>Min Profit Threshold (%)</label>
                        <input type="number" id="valrProfitThreshold" value="0.8" min="0.1" max="5" step="0.1">
                    </div>
                </div>

                <!-- Path Categories -->
                <div class="stat-card">
                    <h4 style="color: #ffb347; margin-bottom: 15px;">üìä Path Sets (ZAR ‚Üí Crypto ‚Üí USDT)</h4>
                    <div style="display: grid; grid-template-columns: 1fr auto; gap: 8px; align-items: center; max-height: 200px; overflow-y: auto;">
                        <span style="color: #b8c6db; font-size: 0.85rem;">SET 1: ETH (4 paths)</span>
                        <input type="checkbox" id="valrSet1Enabled" checked>

                        <span style="color: #b8c6db; font-size: 0.85rem;">SET 2: XRP (4 paths)</span>
                        <input type="checkbox" id="valrSet2Enabled" checked>

                        <span style="color: #b8c6db; font-size: 0.85rem;">SET 3: SOL (4 paths)</span>
                        <input type="checkbox" id="valrSet3Enabled" checked>

                        <span style="color: #b8c6db; font-size: 0.85rem;">SET 4: BNB (4 paths)</span>
                        <input type="checkbox" id="valrSet4Enabled" checked>

                        <span style="color: #b8c6db; font-size: 0.85rem;">SET 5: SHIB (4 paths)</span>
                        <input type="checkbox" id="valrSet5Enabled">

                        <span style="color: #b8c6db; font-size: 0.85rem;">SET 6: AVAX (4 paths)</span>
                        <input type="checkbox" id="valrSet6Enabled">

                        <span style="color: #b8c6db; font-size: 0.85rem;">SET 7: DOGE (4 paths)</span>
                        <input type="checkbox" id="valrSet7Enabled">

                        <span style="color: #b8c6db; font-size: 0.85rem;">SET 8: TRX (4 paths)</span>
                        <input type="checkbox" id="valrSet8Enabled">

                        <span style="color: #b8c6db; font-size: 0.85rem;">SET 9: LTC (4 paths)</span>
                        <input type="checkbox" id="valrSet9Enabled">

                        <span style="color: #b8c6db; font-size: 0.85rem;">SET 10: RLUSD (4 paths)</span>
                        <input type="checkbox" id="valrSet10Enabled">

                        <span style="color: #b8c6db; font-size: 0.85rem;">SET 11: LINK (4 paths)</span>
                        <input type="checkbox" id="valrSet11Enabled">

                        <span style="color: #b8c6db; font-size: 0.85rem;">SET 12: XLM (4 paths)</span>
                        <input type="checkbox" id="valrSet12Enabled">
                    </div>
                    <div style="margin-top: 10px; padding: 8px; background: rgba(0,212,255,0.1); border-radius: 6px; font-size: 0.8rem; color: #b8c6db;">
                        üí° All 12 sets support ZAR ‚Üí Crypto ‚Üí USDT ‚Üí ZAR triangular arbitrage. Each set has 4 paths (48 total paths).
                    </div>
                </div>

                <!-- Performance Stats -->
                <div class="stat-card">
                    <h4 style="color: #ffb347; margin-bottom: 15px;">üìà Performance Stats</h4>
                    <div style="display: grid; grid-template-columns: 1fr auto; gap: 10px; font-size: 0.9rem;">
                        <span style="color: #b8c6db;">Total Trades:</span>
                        <span style="color: #00ff88;" id="valrTotalTrades">0</span>

                        <span style="color: #b8c6db;">Successful Trades:</span>
                        <span style="color: #00ff88;" id="valrSuccessfulTrades">0</span>

                        <span style="color: #b8c6db;">Success Rate:</span>
                        <span style="color: #00ff88;" id="valrSuccessRate">0%</span>

                        <span style="color: #b8c6db;">Total Profit:</span>
                        <span style="color: #00ff88;" id="valrTotalProfit">R 0.00</span>

                        <span style="color: #b8c6db;">Best Path:</span>
                        <span style="color: #00ff88;" id="valrBestPath">-</span>

                        <span style="color: #b8c6db;">Last Scan:</span>
                        <span style="color: #b8c6db;" id="valrLastScan">Never</span>
                    </div>
                </div>
            </div>

            <!-- FUNDING REQUIREMENTS Info Banner -->
            <div style="background: rgba(0,255,136,0.15); border: 2px solid #00ff88; border-radius: 10px; padding: 20px; margin-bottom: 20px;">
                <div style="display: flex; align-items: flex-start; gap: 15px;">
                    <div style="font-size: 2.5rem; flex-shrink: 0;">üí∞</div>
                    <div>
                        <h4 style="color: #00ff88; margin: 0 0 10px 0; font-size: 1.2rem;">Funding Requirements for Maximum Coverage</h4>
                        <p style="color: #b8e0ff; margin: 0 0 15px 0;">
                            VALR supports <strong>48 triangular arbitrage paths</strong> across 2 fundable currencies.
                        </p>
                        <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px;">
                            <div style="display: grid; gap: 12px;">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <span style="color: #00ff88; font-size: 1.3rem;">‚úì</span>
                                    <div>
                                        <strong style="color: #00ff88;">ZAR</strong> (South African Rand - Fiat)
                                        <span style="color: #888; font-size: 0.85rem;">‚Üí 24 paths available</span>
                                        <div style="color: #888; font-size: 0.85rem;">Deposit via: Bank transfer, EFT, Instant EFT</div>
                                    </div>
                                </div>
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <span style="color: #00ff88; font-size: 1.3rem;">‚úì</span>
                                    <div>
                                        <strong style="color: #00ff88;">USDT</strong> (Tether - Stablecoin)
                                        <span style="color: #888; font-size: 0.85rem;">‚Üí 24 paths available</span>
                                        <div style="color: #888; font-size: 0.85rem;">Deposit via: Transfer from another exchange, Crypto wallet</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div style="background: rgba(255,152,0,0.15); padding: 12px; border-radius: 6px; margin-top: 12px;">
                            <p style="margin: 0; color: #ffc266; font-size: 0.9rem;">
                                <strong>üí° Important:</strong> Each path is a complete cycle (e.g., ZAR ‚Üí ETH ‚Üí USDT ‚Üí ZAR).
                                <br>‚Ä¢ Fund <strong>ONLY ZAR</strong> = 24 paths (12 sets √ó 2 ZAR paths per set)
                                <br>‚Ä¢ Fund <strong>ONLY USDT</strong> = 24 paths (12 sets √ó 2 USDT paths per set)
                                <br>‚Ä¢ Fund <strong>BOTH ZAR + USDT</strong> = <strong>48 paths</strong> (12 sets √ó 4 paths per set)
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VALR Control Buttons -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                <button onclick="testValrTriangularConnection()" class="btn" disabled style="opacity: 0.4; cursor: not-allowed;" title="Disabled: Automated worker handles connections">
                    üîç Test Connection
                </button>
                <button onclick="scanValrTriangularPaths()" class="btn" disabled style="opacity: 0.4; cursor: not-allowed;" title="Disabled: Automated worker scans continuously">
                    üîç Scan Opportunities
                </button>
                <button onclick="viewValrPathDetails()" class="btn">
                    üìä View Paths
                </button>
                <button onclick="clearValrTriangularHistory()" class="btn" disabled style="opacity: 0.4; cursor: not-allowed;" title="Disabled: Backend integration pending">
                    üóëÔ∏è Clear History
                </button>
            </div>

            <!-- Tabbed Section: Recent Trades | Balance Tracker | Alerts -->
            <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px;">
                <!-- Tab Headers -->
                <div style="display: flex; gap: 5px; margin-bottom: 15px; background: rgba(0,0,0,0.4); padding: 5px; border-radius: 8px;">
                    <button class="valr-tab-btn active" data-tab="trades" style="flex: 1; padding: 12px 10px; background: rgba(0,255,136,0.15); border: 1px solid #00ff88; border-radius: 6px; color: #00ff88; cursor: pointer; font-weight: bold; font-size: 0.95rem; transition: all 0.3s ease;">
                        üìú Recent Trades
                    </button>
                    <button class="valr-tab-btn" data-tab="balance" style="flex: 1; padding: 12px 10px; background: rgba(255,255,255,0.03); border: 1px solid transparent; border-radius: 6px; color: #888; cursor: pointer; font-weight: bold; font-size: 0.95rem; transition: all 0.3s ease;">
                        üí∞ Balance Tracker
                    </button>
                    <button class="valr-tab-btn" data-tab="alerts" style="flex: 1; padding: 12px 10px; background: rgba(255,255,255,0.03); border: 1px solid transparent; border-radius: 6px; color: #888; cursor: pointer; font-weight: bold; font-size: 0.95rem; transition: all 0.3s ease;">
                        ‚ö†Ô∏è Alerts <span id="valrAlertBadge" style="display: none; background: #ff4444; color: white; padding: 2px 6px; border-radius: 10px; font-size: 0.75rem; margin-left: 5px;">0</span>
                    </button>
                </div>

                <!-- Tab Content Panels -->

                <!-- Tab 1: Recent Trades (existing code preserved) -->
                <div id="valrTabTrades" class="valr-tab-content" style="display: block;">
                    <div id="valrRecentTrades" style="max-height: 200px; overflow-y: auto;">
                        <div style="text-align: center; color: #888; padding: 20px;">
                            No triangular trades yet. Enable live trading to start.
                        </div>
                    </div>
                </div>

                <!-- Tab 2: Balance Tracker (NEW) -->
                <div id="valrTabBalance" class="valr-tab-content" style="display: none;">
                    <div style="margin-bottom: 20px;">
                        <h5 style="color: #00ff88; margin-bottom: 10px;">üíµ ZAR Balance</h5>
                        <div style="background: rgba(0,255,136,0.1); padding: 15px; border-radius: 8px; border-left: 4px solid #00ff88;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; font-size: 0.9rem;">
                                <div>
                                    <div style="color: #888; margin-bottom: 5px;">Starting</div>
                                    <div style="color: #00ff88; font-weight: bold; font-size: 1.1rem;" id="valrStartingZAR">R 0.00</div>
                                </div>
                                <div>
                                    <div style="color: #888; margin-bottom: 5px;">Current</div>
                                    <div style="color: #00ff88; font-weight: bold; font-size: 1.1rem;" id="valrCurrentZAR">R 0.00</div>
                                </div>
                                <div>
                                    <div style="color: #888; margin-bottom: 5px;">Change</div>
                                    <div style="font-weight: bold; font-size: 1.1rem;" id="valrChangeZAR">+R 0.00 (+0%)</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <h5 style="color: #00ff88; margin-bottom: 10px;">üíµ USDT Balance</h5>
                        <div style="background: rgba(0,255,136,0.1); padding: 15px; border-radius: 8px; border-left: 4px solid #00ff88;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; font-size: 0.9rem;">
                                <div>
                                    <div style="color: #888; margin-bottom: 5px;">Starting</div>
                                    <div style="color: #00ff88; font-weight: bold; font-size: 1.1rem;" id="valrStartingUSDT">$0.00</div>
                                </div>
                                <div>
                                    <div style="color: #888; margin-bottom: 5px;">Current</div>
                                    <div style="color: #00ff88; font-weight: bold; font-size: 1.1rem;" id="valrCurrentUSDT">$0.00</div>
                                </div>
                                <div>
                                    <div style="color: #888; margin-bottom: 5px;">Change</div>
                                    <div style="font-weight: bold; font-size: 1.1rem;" id="valrChangeUSDT">+$0.00 (+0%)</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div style="display: flex; gap: 10px; justify-content: space-between; align-items: center; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.1);">
                        <div style="color: #888; font-size: 0.85rem;">
                            Last Updated: <span id="valrBalanceLastUpdate">Never</span>
                        </div>
                        <button onclick="resetValrStartingBalance()" style="padding: 6px 12px; background: rgba(255,255,255,0.1); color: #00ff88; border: 1px solid #00ff88; border-radius: 5px; cursor: pointer; font-size: 0.85rem;">
                            üîÑ Reset Starting Balance
                        </button>
                    </div>
                </div>

                <!-- Tab 3: Alerts (NEW) -->
                <div id="valrTabAlerts" class="valr-tab-content" style="display: none;">
                    <div id="valrAlertsList" style="max-height: 200px; overflow-y: auto;">
                        <div style="text-align: center; color: #888; padding: 20px;">
                            No alerts. Worker running smoothly. ‚úÖ
                        </div>
                    </div>
                    <div style="padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.1); text-align: right;">
                        <button onclick="clearValrAlerts()" style="padding: 6px 12px; background: rgba(255,255,255,0.1); color: #888; border: 1px solid #555; border-radius: 5px; cursor: pointer; font-size: 0.85rem;">
                            Clear All Alerts
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- LUNO Exchange Card -->
        <div style="background: rgba(0,212,255,0.1); padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 2px solid #00d4ff;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="color: #00d4ff; margin: 0;">üî∑ LUNO Triangular Arbitrage</h3>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <span style="color: #b8c6db; font-size: 0.9rem;">LUNO Live Trading:</span>
                    <div class="toggle-switch" id="lunoTriangularEnabled">
                        <div class="toggle-knob"></div>
                    </div>
                    <span id="lunoTriangularStatus" style="color: #ff6b6b; font-size: 0.9rem; margin-left: 10px;">OFF</span>
                </div>
            </div>

            <!-- LUNO Settings Grid -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px;">
                <!-- Risk Management -->
                <div class="stat-card">
                    <h4 style="color: #ffb347; margin-bottom: 15px;">‚öñÔ∏è Risk Management</h4>
                    <div class="form-group">
                        <label>Max Single Trade (USDT)</label>
                        <input type="number" id="lunoMaxTrade" value="50" min="10" max="1000">
                    </div>
                    <div class="form-group">
                        <label>Portfolio % per Trade</label>
                        <input type="number" id="lunoPortfolioPercent" value="10" min="1" max="50">
                    </div>
                    <div class="form-group">
                        <label>Min Profit Threshold (%)</label>
                        <input type="number" id="lunoProfitThreshold" value="0.5" min="0.1" max="5" step="0.1">
                    </div>
                </div>

                <!-- Path Categories -->
                <div class="stat-card">
                    <h4 style="color: #ffb347; margin-bottom: 15px;">üìä Path Sets (24 Paths in 6 Sets)</h4>
                    <div style="display: grid; grid-template-columns: 1fr auto; gap: 8px; align-items: center; max-height: 200px; overflow-y: auto;">
                        <span style="color: #ffd700; font-size: 0.85rem;">SET 1: ETH Focus (4 paths)</span>
                        <input type="checkbox" id="lunoSet1Enabled" checked>

                        <span style="color: #ffb347; font-size: 0.85rem;">SET 2: SOL Focus (4 paths)</span>
                        <input type="checkbox" id="lunoSet2Enabled" checked>

                        <span style="color: #32cd32; font-size: 0.85rem;">SET 3: XRP Focus (4 paths)</span>
                        <input type="checkbox" id="lunoSet3Enabled" checked>

                        <span style="color: #00d4ff; font-size: 0.85rem;">SET 4: USDT Bridge (4 paths)</span>
                        <input type="checkbox" id="lunoSet4Enabled" checked>

                        <span style="color: #9370db; font-size: 0.85rem;">SET 5: Altcoins 1 - ADA/DOT (4 paths)</span>
                        <input type="checkbox" id="lunoSet5Enabled" checked>

                        <span style="color: #ff69b4; font-size: 0.85rem;">SET 6: Altcoins 2 - AVAX/LTC (4 paths)</span>
                        <input type="checkbox" id="lunoSet6Enabled" checked>
                    </div>
                    <div style="margin-top: 10px; padding: 8px; background: rgba(0,212,255,0.1); border-radius: 6px; font-size: 0.8rem; color: #b8c6db;">
                        üí° Simple 4-paths-per-set structure matching VALR. All paths use ZAR or USDT (fundable currencies).
                    </div>
                </div>

                <!-- Performance Stats -->
                <div class="stat-card">
                    <h4 style="color: #ffb347; margin-bottom: 15px;">üìà Performance Stats</h4>
                    <div style="display: grid; grid-template-columns: 1fr auto; gap: 10px; font-size: 0.9rem;">
                        <span style="color: #b8c6db;">Total Trades:</span>
                        <span style="color: #00d4ff;" id="lunoTotalTrades">0</span>

                        <span style="color: #b8c6db;">Successful Trades:</span>
                        <span style="color: #00d4ff;" id="lunoSuccessfulTrades">0</span>

                        <span style="color: #b8c6db;">Success Rate:</span>
                        <span style="color: #00d4ff;" id="lunoSuccessRate">0%</span>

                        <span style="color: #b8c6db;">Total Profit:</span>
                        <span style="color: #00d4ff;" id="lunoTotalProfit">$0.00</span>

                        <span style="color: #b8c6db;">Best Path:</span>
                        <span style="color: #00d4ff;" id="lunoBestPath">-</span>

                        <span style="color: #b8c6db;">Last Scan:</span>
                        <span style="color: #b8c6db;" id="lunoLastScan">Never</span>
                    </div>
                </div>
            </div>

            <!-- FUNDING REQUIREMENTS Info Banner -->
            <div style="background: rgba(0,212,255,0.15); border: 2px solid #00d4ff; border-radius: 10px; padding: 20px; margin-bottom: 20px;">
                <div style="display: flex; align-items: flex-start; gap: 15px;">
                    <div style="font-size: 2.5rem; flex-shrink: 0;">üí∞</div>
                    <div>
                        <h4 style="color: #00d4ff; margin: 0 0 10px 0; font-size: 1.2rem;">Funding Requirements for Maximum Coverage</h4>
                        <p style="color: #b8e0ff; margin: 0 0 15px 0;">
                            Luno supports <strong>24 triangular arbitrage paths</strong> across 2 fundable currencies.
                        </p>
                        <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px;">
                            <div style="display: grid; gap: 12px;">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <span style="color: #00d4ff; font-size: 1.3rem;">‚úì</span>
                                    <div>
                                        <strong style="color: #00d4ff;">ZAR</strong> (South African Rand - Fiat)
                                        <span style="color: #888; font-size: 0.85rem;">‚Üí 12 paths available</span>
                                        <div style="color: #888; font-size: 0.85rem;">Deposit via: Bank transfer, EFT, Instant EFT</div>
                                    </div>
                                </div>
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <span style="color: #00d4ff; font-size: 1.3rem;">‚úì</span>
                                    <div>
                                        <strong style="color: #00d4ff;">USDT</strong> (Tether - Stablecoin)
                                        <span style="color: #888; font-size: 0.85rem;">‚Üí 12 paths available</span>
                                        <div style="color: #888; font-size: 0.85rem;">Deposit via: Transfer from another exchange, Crypto wallet</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div style="background: rgba(255,152,0,0.15); padding: 12px; border-radius: 6px; margin-top: 12px;">
                            <p style="margin: 0; color: #ffc266; font-size: 0.9rem;">
                                <strong>üí° Important:</strong> Each path is a complete cycle (e.g., ZAR ‚Üí XBT ‚Üí ETH ‚Üí ZAR).
                                <br>‚Ä¢ Fund <strong>ONLY ZAR</strong> = 12 paths (6 sets √ó 2 ZAR paths per set)
                                <br>‚Ä¢ Fund <strong>ONLY USDT</strong> = 12 paths (6 sets √ó 2 USDT paths per set)
                                <br>‚Ä¢ Fund <strong>BOTH ZAR + USDT</strong> = <strong>24 paths</strong> (6 sets √ó 4 paths per set)
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- LUNO Control Buttons -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                <button onclick="testLunoTriangularConnection()" class="btn" disabled style="opacity: 0.4; cursor: not-allowed;" title="Disabled: Automated worker handles connections">
                    üîç Test Connection
                </button>
                <button onclick="scanLunoTriangularPaths()" class="btn" disabled style="opacity: 0.4; cursor: not-allowed;" title="Disabled: Automated worker scans continuously">
                    üîç Scan Opportunities
                </button>
                <button onclick="viewLunoPathDetails()" class="btn">
                    üìä View Paths
                </button>
                <button onclick="clearLunoTriangularHistory()" class="btn" disabled style="opacity: 0.4; cursor: not-allowed;" title="Disabled: Backend integration pending">
                    üóëÔ∏è Clear History
                </button>
            </div>

            <!-- Tabbed Section: Recent Trades | Balance Tracker | Alerts -->
            <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px;">
                <!-- Tab Headers -->
                <div style="display: flex; gap: 5px; margin-bottom: 15px; background: rgba(0,0,0,0.4); padding: 5px; border-radius: 8px;">
                    <button class="luno-tab-btn active" data-tab="trades" onclick="switchLunoTab('trades')" style="flex: 1; padding: 12px 10px; background: rgba(0,212,255,0.15); border: 1px solid #00d4ff; border-radius: 6px; color: #00d4ff; cursor: pointer; font-weight: bold; font-size: 0.95rem; transition: all 0.3s ease;">
                        üìú Recent Trades
                    </button>
                    <button class="luno-tab-btn" data-tab="balance" onclick="switchLunoTab('balance')" style="flex: 1; padding: 12px 10px; background: rgba(255,255,255,0.03); border: 1px solid transparent; border-radius: 6px; color: #888; cursor: pointer; font-weight: bold; font-size: 0.95rem; transition: all 0.3s ease;">
                        üí∞ Balance Tracker
                    </button>
                    <button class="luno-tab-btn" data-tab="alerts" onclick="switchLunoTab('alerts')" style="flex: 1; padding: 12px 10px; background: rgba(255,255,255,0.03); border: 1px solid transparent; border-radius: 6px; color: #888; cursor: pointer; font-weight: bold; font-size: 0.95rem; transition: all 0.3s ease;">
                        ‚ö†Ô∏è Alerts <span id="lunoAlertBadge" style="display: none; background: #ff4444; color: white; padding: 2px 6px; border-radius: 10px; font-size: 0.75rem; margin-left: 5px;">0</span>
                    </button>
                </div>

                <!-- Tab 1: Recent Trades (preserve existing) -->
                <div id="lunoTabTrades" class="luno-tab-content" style="display: block;">
                    <div id="lunoRecentTrades" style="max-height: 200px; overflow-y: auto;">
                        <div style="text-align: center; color: #888; padding: 20px;">
                            No triangular trades yet. Enable live trading to start.
                        </div>
                    </div>
                </div>

                <!-- Tab 2: Balance Tracker (NEW) -->
                <div id="lunoTabBalance" class="luno-tab-content" style="display: none;">
                    <!-- ZAR Balance -->
                    <div style="background: rgba(0,212,255,0.05); padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 3px solid #00d4ff;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <h5 style="color: #00d4ff; margin: 0;">üáøüá¶ ZAR Balance</h5>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; font-size: 0.9rem;">
                            <div>
                                <div style="color: #888; font-size: 0.8rem; margin-bottom: 5px;">Starting</div>
                                <div id="lunoStartingZAR" style="color: #b8c6db; font-weight: bold; font-family: monospace;">R 0.00</div>
                            </div>
                            <div>
                                <div style="color: #888; font-size: 0.8rem; margin-bottom: 5px;">Current</div>
                                <div id="lunoCurrentZAR" style="color: #00d4ff; font-weight: bold; font-family: monospace;">R 0.00</div>
                            </div>
                            <div>
                                <div style="color: #888; font-size: 0.8rem; margin-bottom: 5px;">Change</div>
                                <div id="lunoChangeZAR" style="font-weight: bold; font-family: monospace;">+R 0.00 (+0%)</div>
                            </div>
                        </div>
                    </div>

                    <!-- USDT Balance -->
                    <div style="background: rgba(0,212,255,0.05); padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 3px solid #00d4ff;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <h5 style="color: #00d4ff; margin: 0;">üíµ USDT Balance</h5>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; font-size: 0.9rem;">
                            <div>
                                <div style="color: #888; font-size: 0.8rem; margin-bottom: 5px;">Starting</div>
                                <div id="lunoStartingUSDT" style="color: #b8c6db; font-weight: bold; font-family: monospace;">$0.00</div>
                            </div>
                            <div>
                                <div style="color: #888; font-size: 0.8rem; margin-bottom: 5px;">Current</div>
                                <div id="lunoCurrentUSDT" style="color: #00d4ff; font-weight: bold; font-family: monospace;">$0.00</div>
                            </div>
                            <div>
                                <div style="color: #888; font-size: 0.8rem; margin-bottom: 5px;">Change</div>
                                <div id="lunoChangeUSDT" style="font-weight: bold; font-family: monospace;">+$0.00 (+0%)</div>
                            </div>
                        </div>
                    </div>

                    <!-- Last Updated & Reset Button -->
                    <div style="display: flex; justify-content: space-between; align-items: center; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.1);">
                        <div style="color: #888; font-size: 0.85rem;">
                            Last Updated: <span id="lunoBalanceLastUpdate">Never</span>
                        </div>
                        <button onclick="resetLunoStartingBalance()" style="background: rgba(0,212,255,0.1); border: 1px solid #00d4ff; color: #00d4ff; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 0.85rem;">
                            üîÑ Reset Starting Balance
                        </button>
                    </div>
                </div>

                <!-- Tab 3: Alerts (NEW) -->
                <div id="lunoTabAlerts" class="luno-tab-content" style="display: none;">
                    <div id="lunoAlertsList" style="max-height: 200px; overflow-y: auto;">
                        <div style="text-align: center; color: #888; padding: 20px;">
                            No alerts yet. Alerts will appear here when errors occur.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- CHAINEX Exchange Card -->
        <div style="background: rgba(255,152,0,0.1); padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 2px solid #ff9800; opacity: 0.5; position: relative;">
            <!-- NOT SUPPORTED Overlay Badge -->
            <div style="position: absolute; top: 10px; right: 10px; background: rgba(255,68,68,0.9); color: white; padding: 8px 16px; border-radius: 20px; font-weight: bold; font-size: 0.9rem; box-shadow: 0 4px 12px rgba(255,68,68,0.4); z-index: 1;">
                ‚õî NOT SUPPORTED
            </div>

            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="color: #ff9800; margin: 0;">üî∂ CHAINEX Triangular Arbitrage</h3>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <span style="color: #b8c6db; font-size: 0.9rem;">CHAINEX Live Trading:</span>
                    <div class="toggle-switch" id="chainexTriangularEnabled" style="pointer-events: none; opacity: 0.5;">
                        <div class="toggle-knob"></div>
                    </div>
                    <span id="chainexTriangularStatus" style="color: #ff6b6b; font-size: 0.9rem; margin-left: 10px;">DISABLED</span>
                </div>
            </div>

            <!-- NOT SUPPORTED Warning Banner -->
            <div style="background: rgba(255,68,68,0.15); border: 2px solid #ff4444; border-radius: 10px; padding: 20px; margin-bottom: 20px;">
                <div style="display: flex; align-items: flex-start; gap: 15px;">
                    <div style="font-size: 2.5rem; flex-shrink: 0;">‚ö†Ô∏è</div>
                    <div>
                        <h4 style="color: #ff4444; margin: 0 0 10px 0; font-size: 1.2rem;">Triangular Arbitrage Not Supported on ChainEX</h4>
                        <p style="color: #ffa8a8; margin: 0; line-height: 1.6; font-size: 0.95rem;">
                            ChainEX does <strong>not support crypto-to-crypto trading pairs</strong> (e.g., BTC/ETH, ETH/XRP).
                            <br><br>
                            <strong>Why this matters:</strong> Triangular arbitrage requires 3 different pairs like:<br>
                            &nbsp;&nbsp;&nbsp;‚Ä¢ ZAR ‚Üí BTC (requires <code style="background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 4px;">BTC/ZAR</code>)<br>
                            &nbsp;&nbsp;&nbsp;‚Ä¢ BTC ‚Üí ETH (requires <code style="background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 4px;">ETH/BTC</code> ‚ùå not available)<br>
                            &nbsp;&nbsp;&nbsp;‚Ä¢ ETH ‚Üí ZAR (requires <code style="background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 4px;">ETH/ZAR</code>)
                            <br><br>
                            ChainEX only offers <strong>ZAR pairs</strong> (BTC/ZAR, ETH/ZAR, etc.) and <strong>USDT pairs</strong> (BTC/USDT, ETH/USDT, etc.).
                            <br><br>
                            <strong style="color: #00ff88;">‚úÖ Alternative:</strong> Use ChainEX for <strong>Cross-Exchange Arbitrage</strong> instead (buy on ChainEX, sell on another exchange).
                        </p>
                    </div>
                </div>
            </div>

            <!-- CHAINEX Settings Grid (Greyed Out) -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px;">
                <!-- Risk Management -->
                <div class="stat-card">
                    <h4 style="color: #ffb347; margin-bottom: 15px;">‚öñÔ∏è Risk Management</h4>
                    <div class="form-group">
                        <label>Max Single Trade (ZAR)</label>
                        <input type="number" id="chainexMaxTrade" value="500" min="100" max="10000">
                    </div>
                    <div class="form-group">
                        <label>Portfolio % per Trade</label>
                        <input type="number" id="chainexPortfolioPercent" value="10" min="1" max="50">
                    </div>
                    <div class="form-group">
                        <label>Min Profit Threshold (%)</label>
                        <input type="number" id="chainexProfitThreshold" value="0.5" min="0.1" max="5" step="0.1">
                    </div>
                </div>

                <!-- Path Categories -->
                <div class="stat-card">
                    <h4 style="color: #ffb347; margin-bottom: 15px;">üìä Path Sets (28 Paths in 6 Sets)</h4>
                    <div style="display: grid; grid-template-columns: 1fr auto; gap: 8px; align-items: center; max-height: 200px; overflow-y: auto;">
                        <span style="color: #ffd700; font-size: 0.85rem;">SET 1: ZAR Focus (8 paths)</span>
                        <input type="checkbox" id="chainexSet1Enabled" checked>

                        <span style="color: #ff9800; font-size: 0.85rem;">SET 2: BTC Focus (7 paths)</span>
                        <input type="checkbox" id="chainexSet2Enabled" checked>

                        <span style="color: #32cd32; font-size: 0.85rem;">SET 3: USDT Focus (6 paths)</span>
                        <input type="checkbox" id="chainexSet3Enabled" checked>

                        <span style="color: #00d4ff; font-size: 0.85rem;">SET 4: ETH Focus (4 paths)</span>
                        <input type="checkbox" id="chainexSet4Enabled">

                        <span style="color: #9370db; font-size: 0.85rem;">SET 5: Cross-Currency (2 paths)</span>
                        <input type="checkbox" id="chainexSet5Enabled">

                        <span style="color: #778899; font-size: 0.85rem;">SET 6: Extended Altcoins (1 path)</span>
                        <input type="checkbox" id="chainexSet6Enabled">
                    </div>
                    <div style="margin-top: 10px; padding: 8px; background: rgba(255,152,0,0.1); border-radius: 6px; font-size: 0.8rem; color: #b8c6db;">
                        üí° Sets 1-3 are essential (21 paths). ChainEX specializes in ZAR and major crypto pairs with competitive fees.
                    </div>
                </div>

                <!-- Performance Stats -->
                <div class="stat-card">
                    <h4 style="color: #ffb347; margin-bottom: 15px;">üìà Performance Stats</h4>
                    <div style="display: grid; grid-template-columns: 1fr auto; gap: 10px; font-size: 0.9rem;">
                        <span style="color: #b8c6db;">Total Trades:</span>
                        <span style="color: #ff9800;" id="chainexTotalTrades">0</span>

                        <span style="color: #b8c6db;">Successful Trades:</span>
                        <span style="color: #ff9800;" id="chainexSuccessfulTrades">0</span>

                        <span style="color: #b8c6db;">Success Rate:</span>
                        <span style="color: #ff9800;" id="chainexSuccessRate">0%</span>

                        <span style="color: #b8c6db;">Total Profit:</span>
                        <span style="color: #ff9800;" id="chainexTotalProfit">R 0.00</span>

                        <span style="color: #b8c6db;">Best Path:</span>
                        <span style="color: #ff9800;" id="chainexBestPath">-</span>

                        <span style="color: #b8c6db;">Last Scan:</span>
                        <span style="color: #b8c6db;" id="chainexLastScan">Never</span>
                    </div>
                </div>
            </div>

            <!-- CHAINEX Control Buttons -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                <button onclick="testChainExTriangularConnection()" class="btn">
                    üîç Test Connection
                </button>
                <button onclick="scanChainExTriangularPaths()" class="btn">
                    üîç Scan Opportunities
                </button>
                <button onclick="viewChainExPathDetails()" class="btn">
                    üìä View Paths
                </button>
                <button onclick="clearChainExTriangularHistory()" class="btn">
                    üóëÔ∏è Clear History
                </button>
            </div>

            <!-- 3-Tab Interface -->
            <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px;">
                <!-- Tab Headers -->
                <div style="display: flex; gap: 5px; margin-bottom: 15px; background: rgba(0,0,0,0.4); padding: 5px; border-radius: 8px;">
                    <button class="chainex-tab-btn active" data-tab="trades" onclick="switchChainExTab('trades')" style="flex: 1; padding: 12px 10px; background: rgba(255,152,0,0.15); border: 1px solid #ff9800; border-radius: 6px; color: #ff9800; cursor: pointer; font-weight: bold; font-size: 0.95rem; transition: all 0.3s ease;">
                        üìú Recent Trades
                    </button>
                    <button class="chainex-tab-btn" data-tab="balance" onclick="switchChainExTab('balance')" style="flex: 1; padding: 12px 10px; background: rgba(255,255,255,0.03); border: 1px solid transparent; border-radius: 6px; color: #888; cursor: pointer; font-weight: bold; font-size: 0.95rem; transition: all 0.3s ease;">
                        üí∞ Balance Tracker
                    </button>
                    <button class="chainex-tab-btn" data-tab="alerts" onclick="switchChainExTab('alerts')" style="flex: 1; padding: 12px 10px; background: rgba(255,255,255,0.03); border: 1px solid transparent; border-radius: 6px; color: #888; cursor: pointer; font-weight: bold; font-size: 0.95rem; transition: all 0.3s ease;">
                        ‚ö†Ô∏è Alerts <span id="chainexAlertBadge" style="display: none; background: #ff4444; color: white; padding: 2px 6px; border-radius: 10px; font-size: 0.75rem; margin-left: 5px;">0</span>
                    </button>
                </div>

                <!-- Tab Content Panels -->

                <!-- Tab 1: Recent Trades -->
                <div id="chainexTabTrades" class="chainex-tab-content" style="display: block;">
                    <div id="chainexRecentTrades" style="max-height: 200px; overflow-y: auto;">
                        <div style="text-align: center; color: #888; padding: 20px;">
                            No triangular trades yet. Enable live trading to start.
                        </div>
                    </div>
                </div>

                <!-- Tab 2: Balance Tracker -->
                <div id="chainexTabBalance" class="chainex-tab-content" style="display: none;">
                    <div style="margin-bottom: 20px;">
                        <h5 style="color: #ff9800; margin-bottom: 10px;">üíµ ZAR Balance</h5>
                        <div style="background: rgba(255,152,0,0.1); padding: 15px; border-radius: 8px; border-left: 4px solid #ff9800;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; font-size: 0.9rem;">
                                <div>
                                    <div style="color: #888; margin-bottom: 5px;">Starting</div>
                                    <div style="color: #ff9800; font-weight: bold; font-size: 1.1rem;" id="chainexStartingZAR">R 0.00</div>
                                </div>
                                <div>
                                    <div style="color: #888; margin-bottom: 5px;">Current</div>
                                    <div style="color: #ff9800; font-weight: bold; font-size: 1.1rem;" id="chainexCurrentZAR">R 0.00</div>
                                </div>
                                <div>
                                    <div style="color: #888; margin-bottom: 5px;">Change</div>
                                    <div style="font-weight: bold; font-size: 1.1rem;" id="chainexChangeZAR">+R 0.00 (+0%)</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <h5 style="color: #ff9800; margin-bottom: 10px;">üíµ USDT Balance</h5>
                        <div style="background: rgba(255,152,0,0.1); padding: 15px; border-radius: 8px; border-left: 4px solid #ff9800;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; font-size: 0.9rem;">
                                <div>
                                    <div style="color: #888; margin-bottom: 5px;">Starting</div>
                                    <div style="color: #ff9800; font-weight: bold; font-size: 1.1rem;" id="chainexStartingUSDT">$0.00</div>
                                </div>
                                <div>
                                    <div style="color: #888; margin-bottom: 5px;">Current</div>
                                    <div style="color: #ff9800; font-weight: bold; font-size: 1.1rem;" id="chainexCurrentUSDT">$0.00</div>
                                </div>
                                <div>
                                    <div style="color: #888; margin-bottom: 5px;">Change</div>
                                    <div style="font-weight: bold; font-size: 1.1rem;" id="chainexChangeUSDT">+$0.00 (+0%)</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div style="display: flex; gap: 10px; justify-content: space-between; align-items: center; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.1);">
                        <div style="color: #888; font-size: 0.85rem;">
                            Last Updated: <span id="chainexBalanceLastUpdate">Never</span>
                        </div>
                        <button onclick="resetChainExStartingBalance()" style="padding: 6px 12px; background: rgba(255,255,255,0.1); color: #ff9800; border: 1px solid #ff9800; border-radius: 5px; cursor: pointer; font-size: 0.85rem;">
                            üîÑ Reset Starting Balance
                        </button>
                    </div>
                </div>

                <!-- Tab 3: Alerts -->
                <div id="chainexTabAlerts" class="chainex-tab-content" style="display: none;">
                    <div id="chainexAlertsList" style="max-height: 200px; overflow-y: auto;">
                        <div style="text-align: center; color: #888; padding: 20px;">
                            No alerts. Worker running smoothly. ‚úÖ
                        </div>
                    </div>
                    <div style="padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.1); text-align: right;">
                        <button onclick="clearChainExAlerts()" style="padding: 6px 12px; background: rgba(255,255,255,0.1); color: #888; border: 1px solid #555; border-radius: 5px; cursor: pointer; font-size: 0.85rem;">
                            Clear All Alerts
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- KRAKEN Exchange Card -->
        <div style="background: rgba(153,102,255,0.1); padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 2px solid #9966ff;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="color: #9966ff; margin: 0;">üü£ KRAKEN Triangular Arbitrage</h3>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <span style="color: #b8c6db; font-size: 0.9rem;">KRAKEN Live Trading:</span>
                    <div class="toggle-switch" id="krakenTriangularEnabled">
                        <div class="toggle-knob"></div>
                    </div>
                    <span id="krakenTriangularStatus" style="color: #ff6b6b; font-size: 0.9rem; margin-left: 10px;">OFF</span>
                </div>
            </div>

            <!-- FUNDING REQUIREMENTS Info Banner -->
            <div style="background: rgba(0,212,255,0.15); border: 2px solid #00d4ff; border-radius: 10px; padding: 20px; margin-bottom: 20px;">
                <div style="display: flex; align-items: flex-start; gap: 15px;">
                    <div style="font-size: 2.5rem; flex-shrink: 0;">üí∞</div>
                    <div>
                        <h4 style="color: #00d4ff; margin: 0 0 10px 0; font-size: 1.2rem;">Funding Requirements for Maximum Coverage</h4>
                        <p style="color: #b8e0ff; margin: 0 0 15px 0; line-height: 1.6; font-size: 0.95rem;">
                            Kraken supports <strong>114 triangular arbitrage paths</strong> across 3 stablecoin currencies.
                            Fund your account with the following to maximize opportunities:
                        </p>

                        <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <div style="display: grid; gap: 12px;">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <span style="color: #00ff88; font-size: 1.3rem;">‚úì</span>
                                    <div>
                                        <strong style="color: #00d4ff;">USD</strong> (US Dollar - Fiat)
                                        <span style="color: #888; font-size: 0.85rem; margin-left: 10px;">‚Üí 38 paths available</span>
                                        <div style="color: #888; font-size: 0.85rem; margin-top: 3px;">Deposit via: Bank wire, ACH transfer</div>
                                    </div>
                                </div>

                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <span style="color: #00ff88; font-size: 1.3rem;">‚úì</span>
                                    <div>
                                        <strong style="color: #00d4ff;">USDT</strong> (Tether - Stablecoin)
                                        <span style="color: #888; font-size: 0.85rem; margin-left: 10px;">‚Üí 38 paths available</span>
                                        <div style="color: #888; font-size: 0.85rem; margin-top: 3px;">Deposit via: Transfer from another exchange/wallet</div>
                                    </div>
                                </div>

                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <span style="color: #00ff88; font-size: 1.3rem;">‚úì</span>
                                    <div>
                                        <strong style="color: #00d4ff;">USDC</strong> (USD Coin - Stablecoin)
                                        <span style="color: #888; font-size: 0.85rem; margin-left: 10px;">‚Üí 38 paths available</span>
                                        <div style="color: #888; font-size: 0.85rem; margin-top: 3px;">Deposit via: Transfer from another exchange/wallet</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div style="background: rgba(255,152,0,0.15); padding: 12px; border-radius: 6px; border-left: 4px solid #ff9800;">
                            <p style="margin: 0; color: #ffc266; font-size: 0.9rem; line-height: 1.5;">
                                <strong>üí° Important:</strong> Each path is a complete cycle (e.g., USD ‚Üí BTC ‚Üí ETH ‚Üí USD).
                                <br>
                                ‚Ä¢ Fund <strong>ONLY USD</strong> = 38 paths | Fund <strong>ONLY USDT</strong> = 38 paths | Fund <strong>ONLY USDC</strong> = 38 paths
                                <br>
                                ‚Ä¢ Fund <strong>ALL 3 currencies</strong> = <strong>114 paths</strong> (maximum opportunity coverage!)
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- KRAKEN Settings Grid -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px;">
                <!-- Risk Management -->
                <div class="stat-card">
                    <h4 style="color: #ffb347; margin-bottom: 15px;">‚öñÔ∏è Risk Management</h4>
                    <div class="form-group">
                        <label>Max Single Trade (USDT)</label>
                        <input type="number" id="krakenMaxTrade" value="100" min="10" max="5000">
                    </div>
                    <div class="form-group">
                        <label>Portfolio % per Trade</label>
                        <input type="number" id="krakenPortfolioPercent" value="10" min="1" max="50">
                    </div>
                    <div class="form-group">
                        <label>Min Profit Threshold (%)</label>
                        <input type="number" id="krakenProfitThreshold" value="0.5" min="0.1" max="5" step="0.1">
                    </div>
                </div>

                <!-- Path Categories -->
                <div class="stat-card">
                    <h4 style="color: #ffb347; margin-bottom: 15px;">üìä Path Sets (114 Paths in 10 Sets)</h4>
                    <div style="display: grid; grid-template-columns: 1fr auto; gap: 8px; align-items: center; max-height: 200px; overflow-y: auto;">
                        <span style="color: #ffd700; font-size: 0.85rem;">SET 1: ETH Focus (6 paths)</span>
                        <input type="checkbox" id="krakenSet1Enabled" checked>

                        <span style="color: #9966ff; font-size: 0.85rem;">SET 2: XRP Focus (12 paths)</span>
                        <input type="checkbox" id="krakenSet2Enabled" checked>

                        <span style="color: #32cd32; font-size: 0.85rem;">SET 3: SOL Focus (12 paths)</span>
                        <input type="checkbox" id="krakenSet3Enabled" checked>

                        <span style="color: #00d4ff; font-size: 0.85rem;">SET 4: ADA Focus (12 paths)</span>
                        <input type="checkbox" id="krakenSet4Enabled">

                        <span style="color: #ff69b4; font-size: 0.85rem;">SET 5: DOT Focus (12 paths)</span>
                        <input type="checkbox" id="krakenSet5Enabled">

                        <span style="color: #ff9800; font-size: 0.85rem;">SET 6: MATIC Focus (12 paths)</span>
                        <input type="checkbox" id="krakenSet6Enabled">

                        <span style="color: #00ff88; font-size: 0.85rem;">SET 7: LINK Focus (12 paths)</span>
                        <input type="checkbox" id="krakenSet7Enabled">

                        <span style="color: #ffa500; font-size: 0.85rem;">SET 8: LTC Focus (12 paths)</span>
                        <input type="checkbox" id="krakenSet8Enabled">

                        <span style="color: #8a2be2; font-size: 0.85rem;">SET 9: ATOM Focus (12 paths)</span>
                        <input type="checkbox" id="krakenSet9Enabled">

                        <span style="color: #e74c3c; font-size: 0.85rem;">SET 10: AVAX Focus (12 paths)</span>
                        <input type="checkbox" id="krakenSet10Enabled">
                    </div>
                    <div style="margin-top: 10px; padding: 8px; background: rgba(153,102,255,0.1); border-radius: 6px; font-size: 0.8rem; color: #b8c6db;">
                        üí° Sets 1-3 (30 paths) cover major liquidity. All 10 sets provide comprehensive USD/USDT/USDC coverage with BTC/ETH bridges.
                    </div>
                </div>

                <!-- Performance Stats -->
                <div class="stat-card">
                    <h4 style="color: #ffb347; margin-bottom: 15px;">üìà Performance Stats</h4>
                    <div style="display: grid; grid-template-columns: 1fr auto; gap: 10px; font-size: 0.9rem;">
                        <span style="color: #b8c6db;">Total Trades:</span>
                        <span style="color: #9966ff;" id="krakenTotalTrades">0</span>

                        <span style="color: #b8c6db;">Successful Trades:</span>
                        <span style="color: #9966ff;" id="krakenSuccessfulTrades">0</span>

                        <span style="color: #b8c6db;">Success Rate:</span>
                        <span style="color: #9966ff;" id="krakenSuccessRate">0%</span>

                        <span style="color: #b8c6db;">Total Profit:</span>
                        <span style="color: #9966ff;" id="krakenTotalProfit">$0.00</span>

                        <span style="color: #b8c6db;">Best Path:</span>
                        <span style="color: #9966ff;" id="krakenBestPath">-</span>

                        <span style="color: #b8c6db;">Last Scan:</span>
                        <span style="color: #b8c6db;" id="krakenLastScan">Never</span>
                    </div>
                </div>
            </div>

            <!-- KRAKEN Control Buttons -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                <button disabled class="btn" style="opacity: 0.5; cursor: not-allowed; background: rgba(255,255,255,0.05);">
                    üîç Test Connection
                </button>
                <button disabled class="btn" style="opacity: 0.5; cursor: not-allowed; background: rgba(255,255,255,0.05);">
                    üîç Scan Opportunities
                </button>
                <button onclick="viewKrakenPathDetails()" class="btn">
                    üìä View Paths
                </button>
                <button disabled class="btn" style="opacity: 0.5; cursor: not-allowed; background: rgba(255,255,255,0.05);">
                    üóëÔ∏è Clear History
                </button>
            </div>

            <!-- 3-Tab Interface -->
            <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px;">
                <!-- Tab Headers -->
                <div style="display: flex; gap: 5px; margin-bottom: 15px; background: rgba(0,0,0,0.4); padding: 5px; border-radius: 8px;">
                    <button class="kraken-tab-btn active" data-tab="trades" onclick="switchKrakenTab('trades')" style="flex: 1; padding: 12px 10px; background: rgba(153,102,255,0.15); border: 1px solid #9966ff; border-radius: 6px; color: #9966ff; cursor: pointer; font-weight: bold; font-size: 0.95rem; transition: all 0.3s ease;">
                        üìú Recent Trades
                    </button>
                    <button class="kraken-tab-btn" data-tab="balance" onclick="switchKrakenTab('balance')" style="flex: 1; padding: 12px 10px; background: rgba(255,255,255,0.03); border: 1px solid transparent; border-radius: 6px; color: #888; cursor: pointer; font-weight: bold; font-size: 0.95rem; transition: all 0.3s ease;">
                        üí∞ Balance Tracker
                    </button>
                    <button class="kraken-tab-btn" data-tab="alerts" onclick="switchKrakenTab('alerts')" style="flex: 1; padding: 12px 10px; background: rgba(255,255,255,0.03); border: 1px solid transparent; border-radius: 6px; color: #888; cursor: pointer; font-weight: bold; font-size: 0.95rem; transition: all 0.3s ease;">
                        ‚ö†Ô∏è Alerts <span id="krakenAlertBadge" style="display: none; background: #ff4444; color: white; padding: 2px 6px; border-radius: 10px; font-size: 0.75rem; margin-left: 5px;">0</span>
                    </button>
                </div>

                <!-- Tab Content Panels -->

                <!-- Tab 1: Recent Trades -->
                <div id="krakenTabTrades" class="kraken-tab-content" style="display: block;">
                    <div id="krakenRecentTrades" style="max-height: 200px; overflow-y: auto;">
                        <div style="text-align: center; color: #888; padding: 20px;">
                            No triangular trades yet. Enable live trading to start.
                        </div>
                    </div>
                </div>

                <!-- Tab 2: Balance Tracker -->
                <div id="krakenTabBalance" class="kraken-tab-content" style="display: none;">
                    <div style="margin-bottom: 20px;">
                        <h5 style="color: #9966ff; margin-bottom: 10px;">üíµ USD Balance</h5>
                        <div style="background: rgba(153,102,255,0.1); padding: 15px; border-radius: 8px; border-left: 4px solid #9966ff;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; font-size: 0.9rem;">
                                <div>
                                    <div style="color: #888; margin-bottom: 5px;">Starting</div>
                                    <div style="color: #9966ff; font-weight: bold; font-size: 1.1rem;" id="krakenStartingUSD">$0.00</div>
                                </div>
                                <div>
                                    <div style="color: #888; margin-bottom: 5px;">Current</div>
                                    <div style="color: #9966ff; font-weight: bold; font-size: 1.1rem;" id="krakenCurrentUSD">$0.00</div>
                                </div>
                                <div>
                                    <div style="color: #888; margin-bottom: 5px;">Change</div>
                                    <div style="font-weight: bold; font-size: 1.1rem;" id="krakenChangeUSD">+$0.00 (+0%)</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <h5 style="color: #9966ff; margin-bottom: 10px;">üíµ USDT Balance</h5>
                        <div style="background: rgba(153,102,255,0.1); padding: 15px; border-radius: 8px; border-left: 4px solid #9966ff;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; font-size: 0.9rem;">
                                <div>
                                    <div style="color: #888; margin-bottom: 5px;">Starting</div>
                                    <div style="color: #9966ff; font-weight: bold; font-size: 1.1rem;" id="krakenStartingUSDT">$0.00</div>
                                </div>
                                <div>
                                    <div style="color: #888; margin-bottom: 5px;">Current</div>
                                    <div style="color: #9966ff; font-weight: bold; font-size: 1.1rem;" id="krakenCurrentUSDT">$0.00</div>
                                </div>
                                <div>
                                    <div style="color: #888; margin-bottom: 5px;">Change</div>
                                    <div style="font-weight: bold; font-size: 1.1rem;" id="krakenChangeUSDT">+$0.00 (+0%)</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <h5 style="color: #9966ff; margin-bottom: 10px;">üíµ USDC Balance</h5>
                        <div style="background: rgba(153,102,255,0.1); padding: 15px; border-radius: 8px; border-left: 4px solid #9966ff;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; font-size: 0.9rem;">
                                <div>
                                    <div style="color: #888; margin-bottom: 5px;">Starting</div>
                                    <div style="color: #9966ff; font-weight: bold; font-size: 1.1rem;" id="krakenStartingUSDC">$0.00</div>
                                </div>
                                <div>
                                    <div style="color: #888; margin-bottom: 5px;">Current</div>
                                    <div style="color: #9966ff; font-weight: bold; font-size: 1.1rem;" id="krakenCurrentUSDC">$0.00</div>
                                </div>
                                <div>
                                    <div style="color: #888; margin-bottom: 5px;">Change</div>
                                    <div style="font-weight: bold; font-size: 1.1rem;" id="krakenChangeUSDC">+$0.00 (+0%)</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div style="display: flex; gap: 10px; justify-content: space-between; align-items: center; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.1);">
                        <div style="color: #888; font-size: 0.85rem;">
                            Last Updated: <span id="krakenBalanceLastUpdate">Never</span>
                        </div>
                        <button onclick="resetKrakenStartingBalance()" style="padding: 6px 12px; background: rgba(255,255,255,0.1); color: #9966ff; border: 1px solid #9966ff; border-radius: 5px; cursor: pointer; font-size: 0.85rem;">
                            üîÑ Reset Starting Balance
                        </button>
                    </div>
                </div>

                <!-- Tab 3: Alerts -->
                <div id="krakenTabAlerts" class="kraken-tab-content" style="display: none;">
                    <div id="krakenAlertsList" style="max-height: 200px; overflow-y: auto;">
                        <div style="text-align: center; color: #888; padding: 20px;">
                            No alerts. Worker running smoothly. ‚úÖ
                        </div>
                    </div>
                    <div style="padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.1); text-align: right;">
                        <button onclick="clearKrakenAlerts()" style="padding: 6px 12px; background: rgba(255,255,255,0.1); color: #888; border: 1px solid #555; border-radius: 5px; cursor: pointer; font-size: 0.85rem;">
                            Clear All Alerts
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- BYBIT Exchange Card -->
        <div style="background: rgba(255,165,0,0.1); padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 2px solid #FFA500;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="color: #FFA500; margin: 0;">üü° BYBIT Triangular Arbitrage</h3>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <span style="color: #b8c6db; font-size: 0.9rem;">BYBIT Live Trading:</span>
                    <div class="toggle-switch" id="bybitTriangularEnabled">
                        <div class="toggle-knob"></div>
                    </div>
                    <span id="bybitTriangularStatus" style="color: #ff6b6b; font-size: 0.9rem; margin-left: 10px;">OFF</span>
                </div>
            </div>

            <!-- FUNDING REQUIREMENTS Info Banner -->
            <div style="background: rgba(255,165,0,0.15); border: 2px solid #FFA500; border-radius: 10px; padding: 20px; margin-bottom: 20px;">
                <div style="text-align: center;">
                    <h4 style="color: #FFA500; margin: 0 0 10px 0; font-size: 1.2rem;">Funding Requirements for Maximum Coverage</h4>
                    <p style="color: #b8c6db; margin: 0 0 15px 0; font-size: 0.95rem;">
                        ByBit supports <strong style="color: #FFA500;">40 triangular arbitrage paths</strong> across <strong>1 fundable currency</strong>.
                    </p>
                </div>

                <div style="display: grid; grid-template-columns: 1fr; gap: 15px; margin-top: 15px;">
                    <!-- USDT Currency -->
                    <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px; border-left: 4px solid #FFA500;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <h5 style="color: #FFA500; margin: 0; font-size: 1.1rem;">üí∞ USDT (Tether)</h5>
                            <span style="color: #FFA500; font-weight: bold; font-size: 1.1rem;">40 Paths</span>
                        </div>
                        <p style="color: #b8c6db; margin: 0 0 10px 0; font-size: 0.9rem;">
                            <strong>How to fund:</strong> Transfer from exchange ‚Ä¢ Crypto wallet ‚Ä¢ Convert fiat to USDT
                        </p>
                        <p style="color: #888; margin: 0; font-size: 0.85rem; font-style: italic;">
                            All paths use USDT as the base currency for pure 3-leg triangular trading cycles
                        </p>
                    </div>
                </div>

                <div style="margin-top: 15px; padding: 12px; background: rgba(0,0,0,0.2); border-radius: 8px; text-align: center;">
                    <p style="color: #FFA500; margin: 0; font-size: 0.9rem; font-weight: 500;">
                        üí° <strong>Pro Tip:</strong> Fund with USDT = Access to all 40 triangular arbitrage paths (5 sets √ó 8 paths per set)
                    </p>
                </div>

                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,165,0,0.3);">
                    <p style="color: #888; margin: 0; font-size: 0.85rem; text-align: center;">
                        <strong>Multi-User Platform:</strong> This information helps all users optimize their ByBit triangular trading setup
                    </p>
                </div>
            </div>

            <!-- BYBIT Settings Grid -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px;">
                <!-- Risk Management -->
                <div class="stat-card">
                    <h4 style="color: #ffb347; margin-bottom: 15px;">‚öñÔ∏è Risk Management</h4>
                    <div class="form-group">
                        <label>Max Single Trade (USDT)</label>
                        <input type="number" id="bybitMaxTrade" value="100" min="10" max="5000">
                    </div>
                    <div class="form-group">
                        <label>Portfolio % per Trade</label>
                        <input type="number" id="bybitPortfolioPercent" value="10" min="1" max="50">
                    </div>
                    <div class="form-group">
                        <label>Min Profit Threshold (%)</label>
                        <input type="number" id="bybitProfitThreshold" value="0.5" min="0.1" max="5" step="0.1">
                    </div>
                </div>

                <!-- Path Categories -->
                <div class="stat-card">
                    <h4 style="color: #ffb347; margin-bottom: 15px;">üìä Path Sets (40 Paths in 5 Sets)</h4>
                    <div style="display: grid; grid-template-columns: 1fr auto; gap: 8px; align-items: center; max-height: 200px; overflow-y: auto;">
                        <span style="color: #ffd700; font-size: 0.85rem;">SET 1: Major BTC Bridge (8 paths)</span>
                        <input type="checkbox" id="bybitSet1Enabled" checked>

                        <span style="color: #32cd32; font-size: 0.85rem;">SET 2: Altcoins BTC Bridge (8 paths)</span>
                        <input type="checkbox" id="bybitSet2Enabled" checked>

                        <span style="color: #00d4ff; font-size: 0.85rem;">SET 3: DeFi BTC Bridge (8 paths)</span>
                        <input type="checkbox" id="bybitSet3Enabled">

                        <span style="color: #ff69b4; font-size: 0.85rem;">SET 4: ETH Bridge (8 paths)</span>
                        <input type="checkbox" id="bybitSet4Enabled">

                        <span style="color: #778899; font-size: 0.85rem;">SET 5: Extended BTC (8 paths)</span>
                        <input type="checkbox" id="bybitSet5Enabled">
                    </div>
                    <div style="margin-top: 10px; padding: 8px; background: rgba(255,165,0,0.1); border-radius: 6px; font-size: 0.8rem; color: #b8c6db;">
                        üí° Sets 1-2 are essential (16 paths). All paths are 3-leg pure triangular arbitrage.
                    </div>
                </div>

                <!-- Performance Stats -->
                <div class="stat-card">
                    <h4 style="color: #ffb347; margin-bottom: 15px;">üìà Performance Stats</h4>
                    <div style="display: grid; grid-template-columns: 1fr auto; gap: 10px; font-size: 0.9rem;">
                        <span style="color: #b8c6db;">Total Trades:</span>
                        <span style="color: #FFA500;" id="bybitTotalTrades">0</span>

                        <span style="color: #b8c6db;">Successful Trades:</span>
                        <span style="color: #FFA500;" id="bybitSuccessfulTrades">0</span>

                        <span style="color: #b8c6db;">Success Rate:</span>
                        <span style="color: #FFA500;" id="bybitSuccessRate">0%</span>

                        <span style="color: #b8c6db;">Total Profit:</span>
                        <span style="color: #FFA500;" id="bybitTotalProfit">$0.00</span>

                        <span style="color: #b8c6db;">Best Path:</span>
                        <span style="color: #FFA500;" id="bybitBestPath">-</span>

                        <span style="color: #b8c6db;">Last Scan:</span>
                        <span style="color: #b8c6db;" id="bybitLastScan">Never</span>
                    </div>
                </div>
            </div>

            <!-- BYBIT Control Buttons -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                <button onclick="testByBitTriangularConnection()" class="btn" disabled style="opacity: 0.4; cursor: not-allowed;">
                    üîç Test Connection
                </button>
                <button onclick="scanByBitTriangularPaths()" class="btn" disabled style="opacity: 0.4; cursor: not-allowed;">
                    üîç Scan Opportunities
                </button>
                <button onclick="viewByBitPathDetails()" class="btn">
                    üìä View Paths
                </button>
                <button onclick="clearByBitTriangularHistory()" class="btn" disabled style="opacity: 0.4; cursor: not-allowed;">
                    üóëÔ∏è Clear History
                </button>
            </div>

            <!-- Tabbed Interface: Balance Tracker & Recent Trades -->
            <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px;">
                <!-- Tab Headers -->
                <div style="display: flex; gap: 10px; margin-bottom: 15px; border-bottom: 2px solid rgba(255,165,0,0.3);">
                    <button id="bybitBalanceTab" onclick="switchBybitTab('balance')" style="flex: 1; padding: 10px; background: rgba(255,165,0,0.3); border: none; border-radius: 8px 8px 0 0; color: #FFA500; font-weight: bold; cursor: pointer; transition: all 0.3s;">
                        üí∞ Balance Tracker
                    </button>
                    <button id="bybitTradesTab" onclick="switchBybitTab('trades')" style="flex: 1; padding: 10px; background: rgba(255,255,255,0.05); border: none; border-radius: 8px 8px 0 0; color: #b8c6db; cursor: pointer; transition: all 0.3s;">
                        üïí Recent Trades
                    </button>
                </div>

                <!-- Balance Tracker Tab Content -->
                <div id="bybitBalanceContent" style="display: block;">
                    <h4 style="color: #ffb347; margin-bottom: 15px;">üí∞ USDT Balance Tracking</h4>
                    <div style="display: grid; grid-template-columns: 1fr; gap: 12px;">
                        <!-- USDT Balance -->
                        <div style="background: rgba(255,165,0,0.1); padding: 12px; border-radius: 8px; border-left: 4px solid #FFA500;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; font-size: 0.9rem;">
                                <div>
                                    <div style="color: #888; font-size: 0.8rem; margin-bottom: 5px;">Starting</div>
                                    <div style="color: #FFA500; font-weight: bold;" id="bybitStartingUSDT">$0.00</div>
                                </div>
                                <div>
                                    <div style="color: #888; font-size: 0.8rem; margin-bottom: 5px;">Current</div>
                                    <div style="color: #FFA500; font-weight: bold;" id="bybitCurrentUSDT">$0.00</div>
                                </div>
                                <div>
                                    <div style="color: #888; font-size: 0.8rem; margin-bottom: 5px;">Change</div>
                                    <div style="color: #b8c6db; font-weight: bold;" id="bybitChangeUSDT">$0.00 (0.0%)</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div style="margin-top: 10px; padding: 8px; background: rgba(255,165,0,0.1); border-radius: 6px; font-size: 0.8rem; color: #888; text-align: center;">
                        üí° Balance updates automatically when the worker is running
                    </div>
                </div>

                <!-- Recent Trades Tab Content -->
                <div id="bybitTradesContent" style="display: none;">
                    <h4 style="color: #ffb347; margin-bottom: 15px;">üïí Recent Triangular Trades</h4>
                    <div id="bybitRecentTrades" style="max-height: 200px; overflow-y: auto;">
                        <div style="text-align: center; color: #888; padding: 20px;">
                            No triangular trades yet. Enable live trading to start.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Binance Exchange -->
        <div style="background: rgba(240,185,11,0.1); padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 2px solid #F0B90B;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="color: #F0B90B; margin: 0;">üü° BINANCE Triangular Arbitrage</h3>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <span style="color: #b8c6db; font-size: 0.9rem;">BINANCE Live Trading:</span>
                    <div class="toggle-switch" id="binanceTriangularEnabled">
                        <div class="toggle-knob"></div>
                    </div>
                    <span id="binanceTriangularStatus" style="color: #ff6b6b; font-size: 0.9rem; margin-left: 10px;">OFF</span>
                </div>
            </div>

            <!-- FUNDING REQUIREMENTS Info Banner -->
            <div style="background: rgba(240,185,11,0.15); border: 2px solid #F0B90B; border-radius: 10px; padding: 20px; margin-bottom: 20px;">
                <div style="text-align: center;">
                    <h4 style="color: #F0B90B; margin: 0 0 10px 0; font-size: 1.2rem;">üí∞ Funding Requirements for Maximum Coverage</h4>
                    <p style="color: #b8c6db; margin: 0 0 15px 0; font-size: 0.95rem;">
                        Binance supports <strong style="color: #F0B90B;">24+ triangular arbitrage paths</strong> across <strong>1 fundable currency</strong>.
                    </p>
                </div>

                <div style="display: grid; grid-template-columns: 1fr; gap: 15px; margin-top: 15px;">
                    <!-- USDT Currency -->
                    <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px; border-left: 4px solid #F0B90B;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <h5 style="color: #F0B90B; margin: 0; font-size: 1.1rem;">üí∞ USDT (Tether)</h5>
                            <span style="color: #F0B90B; font-weight: bold; font-size: 1.1rem;">24+ Paths</span>
                        </div>
                        <p style="color: #b8c6db; margin: 0 0 10px 0; font-size: 0.9rem;">
                            <strong>How to fund:</strong> Transfer from wallet ‚Ä¢ Bank transfer to USDT ‚Ä¢ Convert crypto to USDT
                        </p>
                        <p style="color: #888; margin: 0; font-size: 0.85rem; font-style: italic;">
                            All paths use USDT as the base currency for pure 3-leg triangular trading cycles with BTC, ETH, and BNB bridges
                        </p>
                    </div>
                </div>

                <div style="margin-top: 15px; padding: 12px; background: rgba(0,0,0,0.2); border-radius: 8px; text-align: center;">
                    <p style="color: #F0B90B; margin: 0; font-size: 0.9rem; font-weight: 500;">
                        üí° <strong>Pro Tip:</strong> Fund with USDT = Access to all triangular arbitrage paths across major coins
                    </p>
                </div>

                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(240,185,11,0.3);">
                    <p style="color: #888; margin: 0; font-size: 0.85rem; text-align: center;">
                        <strong>Multi-User Platform:</strong> This information helps all users optimize their Binance triangular trading setup
                    </p>
                </div>
            </div>

            <!-- Risk Management Section -->
            <div class="stat-card">
                <h4 style="color: #F0B90B; margin-bottom: 15px;">‚öñÔ∏è Risk Management</h4>
                <div class="form-group">
                    <label>Max Single Trade (USDT)</label>
                    <input type="number" id="binanceMaxTrade" value="100" min="10" max="10000">
                </div>
                <div class="form-group">
                    <label>Portfolio % per Trade</label>
                    <input type="number" id="binancePortfolioPercent" value="10" min="1" max="50">
                </div>
                <div class="form-group">
                    <label>Min Profit Threshold (%)</label>
                    <input type="number" id="binanceProfitThreshold" value="0.5" min="0.1" max="5" step="0.1">
                </div>
            </div>

            <!-- Path Sets Section -->
            <div class="stat-card">
                <h4 style="color: #F0B90B; margin-bottom: 15px;">üìä Path Sets (24 Paths in 5 Sets)</h4>
                <div style="display: grid; grid-template-columns: 1fr auto; gap: 8px; align-items: center;">
                    <span style="color: #ffd700; font-size: 0.85rem;">SET 1: Major BTC Bridge (8 paths)</span>
                    <input type="checkbox" id="binanceSet1Enabled" checked>

                    <span style="color: #32cd32; font-size: 0.85rem;">SET 2: Altcoins BTC Bridge (8 paths)</span>
                    <input type="checkbox" id="binanceSet2Enabled" checked>

                    <span style="color: #00d4ff; font-size: 0.85rem;">SET 3: DeFi BTC Bridge (6 paths)</span>
                    <input type="checkbox" id="binanceSet3Enabled">

                    <span style="color: #ff69b4; font-size: 0.85rem;">SET 4: ETH/BNB Bridge (varies)</span>
                    <input type="checkbox" id="binanceSet4Enabled">

                    <span style="color: #ff8c00; font-size: 0.85rem;">SET 5: Multi-Bridge (varies)</span>
                    <input type="checkbox" id="binanceSet5Enabled">
                </div>
            </div>

            <!-- Statistics Section -->
            <div class="stat-card">
                <h4 style="color: #F0B90B; margin-bottom: 15px;">üìà Today's Statistics</h4>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;">
                    <div>
                        <div style="color: #888; font-size: 0.75rem;">Scans</div>
                        <div style="color: #F0B90B; font-size: 1.3rem; font-weight: bold;">0</div>
                    </div>
                    <div>
                        <div style="color: #888; font-size: 0.75rem;">Opportunities</div>
                        <div style="color: #32cd32; font-size: 1.3rem; font-weight: bold;">0</div>
                    </div>
                    <div>
                        <div style="color: #888; font-size: 0.75rem;">Profit (ZAR)</div>
                        <div style="color: #F0B90B; font-size: 1.3rem; font-weight: bold;">R 0.00</div>
                    </div>
                </div>
            </div>

            <!-- Control Buttons -->
            <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 20px;">
                <button disabled class="btn" style="background: #555; opacity: 0.5; cursor: not-allowed;">üîç Test Connection (Disabled)</button>
                <button disabled class="btn" style="background: #555; opacity: 0.5; cursor: not-allowed;">üîç Scan Opportunities (Disabled)</button>
                <button onclick="viewBinancePathDetails()" class="btn" style="background: linear-gradient(135deg, #00bfff, #87ceeb);">üìä View Paths</button>
                <button disabled class="btn" style="background: #555; opacity: 0.5; cursor: not-allowed;">üóëÔ∏è Clear History (Disabled)</button>
            </div>

            <!-- Tabbed Interface: Balance Tracker & Recent Trades -->
            <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px;">
                <!-- Tab Headers -->
                <div style="display: flex; gap: 10px; margin-bottom: 15px; border-bottom: 2px solid rgba(240,185,11,0.3);">
                    <button id="binanceBalanceTab" onclick="switchBinanceTab('balance')" style="flex: 1; padding: 10px; background: rgba(240,185,11,0.3); border: none; border-radius: 8px 8px 0 0; color: #F0B90B; font-weight: bold; cursor: pointer; transition: all 0.3s;">
                        üí∞ Balance Tracker
                    </button>
                    <button id="binanceTradesTab" onclick="switchBinanceTab('trades')" style="flex: 1; padding: 10px; background: rgba(255,255,255,0.05); border: none; border-radius: 8px 8px 0 0; color: #b8c6db; cursor: pointer; transition: all 0.3s;">
                        üïí Recent Trades
                    </button>
                </div>

                <!-- Balance Tracker Tab Content -->
                <div id="binanceBalanceContent" style="display: block;">
                    <h4 style="color: #F0B90B; margin-bottom: 15px;">üí∞ USDT Balance Tracking</h4>
                    <div style="display: grid; grid-template-columns: 1fr; gap: 12px;">
                        <!-- USDT Balance -->
                        <div style="background: rgba(240,185,11,0.1); padding: 12px; border-radius: 8px; border-left: 4px solid #F0B90B;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; font-size: 0.9rem;">
                                <div>
                                    <div style="color: #888; font-size: 0.8rem; margin-bottom: 5px;">Starting</div>
                                    <div style="color: #F0B90B; font-weight: bold;" id="binanceStartingUSDT">$0.00</div>
                                </div>
                                <div>
                                    <div style="color: #888; font-size: 0.8rem; margin-bottom: 5px;">Current</div>
                                    <div style="color: #F0B90B; font-weight: bold;" id="binanceCurrentUSDT">$0.00</div>
                                </div>
                                <div>
                                    <div style="color: #888; font-size: 0.8rem; margin-bottom: 5px;">Change</div>
                                    <div style="color: #b8c6db; font-weight: bold;" id="binanceChangeUSDT">$0.00 (0.0%)</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div style="margin-top: 10px; padding: 8px; background: rgba(240,185,11,0.1); border-radius: 6px; font-size: 0.8rem; color: #888; text-align: center;">
                        üí° Balance updates automatically when the worker is running
                    </div>
                </div>

                <!-- Recent Trades Tab Content -->
                <div id="binanceTradesContent" style="display: none;">
                    <h4 style="color: #F0B90B; margin-bottom: 15px;">üïí Recent Triangular Trades</h4>
                    <div id="binanceRecentTrades" style="max-height: 200px; overflow-y: auto;">
                        <div style="text-align: center; color: #888; padding: 20px;">
                            No triangular trades yet. Enable live trading to start.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- OKX Exchange -->
        <div style="background: rgba(0,166,255,0.1); padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 2px solid #00A6FF;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="color: #00A6FF; margin: 0;">üîµ OKX Triangular Arbitrage</h3>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <span style="color: #b8c6db; font-size: 0.9rem;">OKX Live Trading:</span>
                    <div class="toggle-switch" id="okxTriangularEnabled">
                        <div class="toggle-knob"></div>
                    </div>
                    <span id="okxTriangularStatus" style="color: #ff6b6b; font-size: 0.9rem; margin-left: 10px;">OFF</span>
                </div>
            </div>

            <!-- FUNDING REQUIREMENTS Info Banner -->
            <div style="background: rgba(0,166,255,0.15); border: 2px solid #00A6FF; border-radius: 10px; padding: 20px; margin-bottom: 20px;">
                <div style="text-align: center;">
                    <h4 style="color: #00A6FF; margin: 0 0 10px 0; font-size: 1.2rem;">üí∞ Funding Requirements for Maximum Coverage</h4>
                    <p style="color: #b8c6db; margin: 0 0 15px 0; font-size: 0.95rem;">
                        OKX supports <strong style="color: #00A6FF;">32 triangular arbitrage paths</strong> across <strong>1 fundable currency</strong>.
                    </p>
                </div>

                <div style="display: grid; grid-template-columns: 1fr; gap: 15px; margin-top: 15px;">
                    <!-- USDT Currency -->
                    <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px; border-left: 4px solid #00A6FF;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <h5 style="color: #00A6FF; margin: 0; font-size: 1.1rem;">üí∞ USDT (Tether)</h5>
                            <span style="color: #00A6FF; font-weight: bold; font-size: 1.1rem;">32 Paths</span>
                        </div>
                        <p style="color: #b8c6db; margin: 0 0 10px 0; font-size: 0.9rem;">
                            <strong>How to fund:</strong> Transfer from exchange ‚Ä¢ Crypto wallet ‚Ä¢ Convert fiat to USDT
                        </p>
                        <p style="color: #888; margin: 0; font-size: 0.85rem; font-style: italic;">
                            All paths use USDT as the base currency including unique OKB (native token) arbitrage opportunities
                        </p>
                    </div>
                </div>

                <div style="margin-top: 15px; padding: 12px; background: rgba(0,0,0,0.2); border-radius: 8px; text-align: center;">
                    <p style="color: #00A6FF; margin: 0; font-size: 0.9rem; font-weight: 500;">
                        üí° <strong>Pro Tip:</strong> Fund with USDT = Access to all 32 paths (includes 6 OKB native token paths + 1 four-leg extended path)
                    </p>
                </div>

                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(0,166,255,0.3);">
                    <p style="color: #888; margin: 0; font-size: 0.85rem; text-align: center;">
                        <strong>Multi-User Platform:</strong> This information helps all users optimize their OKX triangular trading setup
                    </p>
                </div>
            </div>

            <!-- Risk Management Section -->
            <div class="stat-card">
                <h4 style="color: #00A6FF; margin-bottom: 15px;">‚öñÔ∏è Risk Management</h4>
                <div class="form-group">
                    <label>Max Single Trade (USDT)</label>
                    <input type="number" id="okxMaxTrade" value="100" min="10" max="10000">
                </div>
                <div class="form-group">
                    <label>Portfolio % per Trade</label>
                    <input type="number" id="okxPortfolioPercent" value="10" min="1" max="50">
                </div>
                <div class="form-group">
                    <label>Min Profit Threshold (%)</label>
                    <input type="number" id="okxProfitThreshold" value="0.5" min="0.1" max="5" step="0.1">
                </div>
            </div>

            <!-- Path Sets Section -->
            <div class="stat-card">
                <h4 style="color: #00A6FF; margin-bottom: 15px;">üìä Path Sets (32 Paths in 5 Sets)</h4>
                <div style="display: grid; grid-template-columns: 1fr auto; gap: 8px; align-items: center;">
                    <span style="color: #ffd700; font-size: 0.85rem;">SET 1: Major ETH Bridge (7 paths)</span>
                    <input type="checkbox" id="okxSet1Enabled" checked>

                    <span style="color: #32cd32; font-size: 0.85rem;">SET 2: Mid-Cap BTC Bridge (7 paths)</span>
                    <input type="checkbox" id="okxSet2Enabled" checked>

                    <span style="color: #00d4ff; font-size: 0.85rem;">SET 3: OKB Native Bridge (6 paths)</span>
                    <input type="checkbox" id="okxSet3Enabled">

                    <span style="color: #ff69b4; font-size: 0.85rem;">SET 4: High Volatility (6 paths)</span>
                    <input type="checkbox" id="okxSet4Enabled">

                    <span style="color: #ff8c00; font-size: 0.85rem;">SET 5: Extended Multi-Bridge (6 paths)</span>
                    <input type="checkbox" id="okxSet5Enabled">
                </div>
            </div>

            <!-- Statistics Section -->
            <div class="stat-card">
                <h4 style="color: #00A6FF; margin-bottom: 15px;">üìà Today's Statistics</h4>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;">
                    <div>
                        <div style="color: #888; font-size: 0.75rem;">Scans</div>
                        <div style="color: #00A6FF; font-size: 1.3rem; font-weight: bold;">0</div>
                    </div>
                    <div>
                        <div style="color: #888; font-size: 0.75rem;">Opportunities</div>
                        <div style="color: #32cd32; font-size: 1.3rem; font-weight: bold;">0</div>
                    </div>
                    <div>
                        <div style="color: #888; font-size: 0.75rem;">Profit (ZAR)</div>
                        <div style="color: #00A6FF; font-size: 1.3rem; font-weight: bold;">R 0.00</div>
                    </div>
                </div>
            </div>

            <!-- Control Buttons -->
            <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 20px;">
                <button disabled class="btn" style="background: #555; opacity: 0.5; cursor: not-allowed;">üîç Test Connection (Disabled)</button>
                <button disabled class="btn" style="background: #555; opacity: 0.5; cursor: not-allowed;">üîç Scan Opportunities (Disabled)</button>
                <button onclick="viewOKXPathDetails()" class="btn" style="background: linear-gradient(135deg, #00bfff, #87ceeb);">üìä View Paths</button>
                <button disabled class="btn" style="background: #555; opacity: 0.5; cursor: not-allowed;">üóëÔ∏è Clear History (Disabled)</button>
            </div>

            <!-- Tabbed Interface: Balance Tracker & Recent Trades -->
            <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px;">
                <!-- Tab Headers -->
                <div style="display: flex; gap: 10px; margin-bottom: 15px; border-bottom: 2px solid rgba(0,166,255,0.3);">
                    <button id="okxBalanceTab" onclick="switchOKXTab('balance')" style="flex: 1; padding: 10px; background: rgba(0,166,255,0.3); border: none; border-radius: 8px 8px 0 0; color: #00A6FF; font-weight: bold; cursor: pointer; transition: all 0.3s;">
                        üí∞ Balance Tracker
                    </button>
                    <button id="okxTradesTab" onclick="switchOKXTab('trades')" style="flex: 1; padding: 10px; background: rgba(255,255,255,0.05); border: none; border-radius: 8px 8px 0 0; color: #b8c6db; cursor: pointer; transition: all 0.3s;">
                        üïí Recent Trades
                    </button>
                </div>

                <!-- Balance Tracker Tab Content -->
                <div id="okxBalanceContent" style="display: block;">
                    <h4 style="color: #00A6FF; margin-bottom: 15px;">üí∞ USDT Balance Tracking</h4>
                    <div style="display: grid; grid-template-columns: 1fr; gap: 12px;">
                        <!-- USDT Balance -->
                        <div style="background: rgba(0,166,255,0.1); padding: 12px; border-radius: 8px; border-left: 4px solid #00A6FF;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; font-size: 0.9rem;">
                                <div>
                                    <div style="color: #888; font-size: 0.8rem; margin-bottom: 5px;">Starting</div>
                                    <div style="color: #00A6FF; font-weight: bold;" id="okxStartingUSDT">$0.00</div>
                                </div>
                                <div>
                                    <div style="color: #888; font-size: 0.8rem; margin-bottom: 5px;">Current</div>
                                    <div style="color: #00A6FF; font-weight: bold;" id="okxCurrentUSDT">$0.00</div>
                                </div>
                                <div>
                                    <div style="color: #888; font-size: 0.8rem; margin-bottom: 5px;">Change</div>
                                    <div style="color: #b8c6db; font-weight: bold;" id="okxChangeUSDT">$0.00 (0.0%)</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div style="margin-top: 10px; padding: 8px; background: rgba(0,166,255,0.1); border-radius: 6px; font-size: 0.8rem; color: #888; text-align: center;">
                        üí° Balance updates automatically when the worker is running
                    </div>
                </div>

                <!-- Recent Trades Tab Content -->
                <div id="okxTradesContent" style="display: none;">
                    <h4 style="color: #00A6FF; margin-bottom: 15px;">üïí Recent Triangular Trades</h4>
                    <div id="okxRecentTrades" style="max-height: 200px; overflow-y: auto;">
                        <div style="text-align: center; color: #888; padding: 20px;">
                            No triangular trades yet. Enable live trading to start.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- KuCoin Exchange -->
        <div style="background: rgba(0,208,146,0.1); padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 2px solid #00D092;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="color: #00D092; margin: 0;">üü¢ KUCOIN Triangular Arbitrage</h3>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div class="toggle-switch" id="kucoinTriangularEnabled" onclick="toggleKuCoinTriangular()">
                        <div class="toggle-knob"></div>
                    </div>
                    <span id="kucoinTriangularStatus" style="color: #ff6b6b; font-weight: 600;">OFF</span>
                </div>
            </div>

            <div class="stat-grid">
                <!-- Risk Management -->
                <div class="stat-card">
                    <h4 style="color: #00D092; margin-bottom: 15px;">‚öñÔ∏è Risk Management</h4>
                    <div class="form-group" style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 500;">Max Trade (USDT)</label>
                        <input type="number" id="kucoinMaxTrade" value="100" min="10" max="10000" step="10"
                               style="width: 100%; padding: 8px; border: 1px solid #00D092; border-radius: 5px; background: rgba(0,208,146,0.05);">
                    </div>
                    <div class="form-group" style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 500;">Portfolio % per Trade</label>
                        <input type="number" id="kucoinPortfolioPercent" value="10" min="1" max="50" step="1"
                               style="width: 100%; padding: 8px; border: 1px solid #00D092; border-radius: 5px; background: rgba(0,208,146,0.05);">
                    </div>
                    <div class="form-group">
                        <label style="display: block; margin-bottom: 5px; font-weight: 500;">Min Profit % Threshold</label>
                        <input type="number" id="kucoinProfitThreshold" value="0.5" min="0.1" max="5" step="0.1"
                               style="width: 100%; padding: 8px; border: 1px solid #00D092; border-radius: 5px; background: rgba(0,208,146,0.05);">
                    </div>
                </div>

                <!-- Path Sets Configuration -->
                <div class="stat-card">
                    <h4 style="color: #00D092; margin-bottom: 15px;">üéØ Triangular Path Sets (32 Paths)</h4>
                    <div style="display: flex; flex-direction: column; gap: 10px;">
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="checkbox" id="kucoinSet1Enabled" checked style="margin-right: 10px; width: 18px; height: 18px;">
                            <span><strong>SET 1:</strong> Essential ETH Bridge (7 paths) - BTC, SOL, XRP, ADA, DOT, MATIC, LINK</span>
                        </label>
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="checkbox" id="kucoinSet2Enabled" checked style="margin-right: 10px; width: 18px; height: 18px;">
                            <span><strong>SET 2:</strong> Mid-Cap BTC Bridge (7 paths) - ETH, SOL, AVAX, ATOM, LTC, UNI, FIL</span>
                        </label>
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="checkbox" id="kucoinSet3Enabled" style="margin-right: 10px; width: 18px; height: 18px;">
                            <span><strong>SET 3:</strong> KCS Native Bridge (6 paths) - Using KuCoin's KCS token</span>
                        </label>
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="checkbox" id="kucoinSet4Enabled" style="margin-right: 10px; width: 18px; height: 18px;">
                            <span><strong>SET 4:</strong> High Volatility (6 paths) - DOGE, SHIB, PEPE, NEAR, APT, FTM</span>
                        </label>
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="checkbox" id="kucoinSet5Enabled" style="margin-right: 10px; width: 18px; height: 18px;">
                            <span><strong>SET 5:</strong> Extended Multi-Bridge (6 paths) - BNB, TRX, ALGO, VET, HBAR + 4-leg path</span>
                        </label>
                    </div>
                </div>

                <!-- Actions -->
                <div class="stat-card">
                    <h4 style="color: #00D092; margin-bottom: 15px;">üîß Actions</h4>
                    <button onclick="testKuCoinTriangularConnection()" class="btn" style="background: #00D092; width: 100%; margin-bottom: 10px;">
                        üîå Test Connection
                    </button>
                    <button onclick="scanKuCoinTriangularPaths()" class="btn" style="background: #00D092; width: 100%; margin-bottom: 10px;">
                        üîç Scan Opportunities
                    </button>
                    <button onclick="viewKuCoinPathDetails()" class="btn" style="background: #666; width: 100%; margin-bottom: 10px;">
                        üìã View All Paths
                    </button>
                    <button onclick="clearKuCoinTriangularHistory()" class="btn" style="background: #ff6b6b; width: 100%; margin-bottom: 10px;">
                        üóëÔ∏è Clear History
                    </button>
                    <button onclick="saveKuCoinTriangularSettings()" class="btn" style="background: #4CAF50; width: 100%;">
                        üíæ Save Settings
                    </button>
                </div>

                <!-- Current Opportunities -->
                <div class="stat-card" style="grid-column: span 2;">
                    <h4 style="color: #00D092; margin-bottom: 15px;">üí∞ Current Opportunities</h4>
                    <div id="kucoinOpportunities" style="max-height: 400px; overflow-y: auto;">
                        <p style="color: #888; text-align: center; padding: 20px;">
                            Click "Scan Opportunities" to find triangular arbitrage paths
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Huobi (HTX) Exchange -->
        <div style="background: rgba(45,108,248,0.1); padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 2px solid #2D6CF8;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="color: #2D6CF8; margin: 0;">üî∑ HUOBI (HTX) Triangular Arbitrage</h3>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div class="toggle-switch" id="huobiTriangularEnabled" onclick="toggleHuobiTriangular()">
                        <div class="toggle-knob"></div>
                    </div>
                    <span id="huobiTriangularStatus" style="color: #ff6b6b; font-weight: 600;">OFF</span>
                </div>
            </div>

            <div class="stat-grid">
                <!-- Risk Management -->
                <div class="stat-card">
                    <h4 style="color: #2D6CF8; margin-bottom: 15px;">‚öñÔ∏è Risk Management</h4>
                    <div class="form-group" style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 500;">Max Trade (USDT)</label>
                        <input type="number" id="huobiMaxTrade" value="100" min="10" max="10000" step="10"
                               style="width: 100%; padding: 8px; border: 1px solid #2D6CF8; border-radius: 5px; background: rgba(45,108,248,0.05);">
                    </div>
                    <div class="form-group" style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 500;">Portfolio % per Trade</label>
                        <input type="number" id="huobiPortfolioPercent" value="10" min="1" max="50" step="1"
                               style="width: 100%; padding: 8px; border: 1px solid #2D6CF8; border-radius: 5px; background: rgba(45,108,248,0.05);">
                    </div>
                    <div class="form-group">
                        <label style="display: block; margin-bottom: 5px; font-weight: 500;">Min Profit % Threshold</label>
                        <input type="number" id="huobiProfitThreshold" value="0.5" min="0.1" max="5" step="0.1"
                               style="width: 100%; padding: 8px; border: 1px solid #2D6CF8; border-radius: 5px; background: rgba(45,108,248,0.05);">
                    </div>
                </div>

                <!-- Path Sets Configuration -->
                <div class="stat-card">
                    <h4 style="color: #2D6CF8; margin-bottom: 15px;">üéØ Triangular Path Sets (32 Paths)</h4>
                    <div style="display: flex; flex-direction: column; gap: 10px;">
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="checkbox" id="huobiSet1Enabled" checked style="margin-right: 10px; width: 18px; height: 18px;">
                            <span><strong>SET 1:</strong> Essential ETH Bridge (7 paths) - BTC, SOL, XRP, TRX, DOT, MATIC, LINK</span>
                        </label>
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="checkbox" id="huobiSet2Enabled" checked style="margin-right: 10px; width: 18px; height: 18px;">
                            <span><strong>SET 2:</strong> Mid-Cap BTC Bridge (7 paths) - ETH, XRP, LTC, BCH, ADA, AVAX, UNI</span>
                        </label>
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="checkbox" id="huobiSet3Enabled" style="margin-right: 10px; width: 18px; height: 18px;">
                            <span><strong>SET 3:</strong> HT Native Bridge (6 paths) - Using Huobi Token (HT)</span>
                        </label>
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="checkbox" id="huobiSet4Enabled" style="margin-right: 10px; width: 18px; height: 18px;">
                            <span><strong>SET 4:</strong> High Volatility (6 paths) - DOGE, SHIB, APE, NEAR, APT, FTM</span>
                        </label>
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="checkbox" id="huobiSet5Enabled" style="margin-right: 10px; width: 18px; height: 18px;">
                            <span><strong>SET 5:</strong> Extended Multi-Bridge (6 paths) - FIL, ATOM, ICP, ALGO, ETC + 4-leg path</span>
                        </label>
                    </div>
                </div>

                <!-- Actions -->
                <div class="stat-card">
                    <h4 style="color: #2D6CF8; margin-bottom: 15px;">üîß Actions</h4>
                    <button onclick="testHuobiTriangularConnection()" class="btn" style="background: #2D6CF8; width: 100%; margin-bottom: 10px;">
                        üîå Test Connection
                    </button>
                    <button onclick="scanHuobiTriangularPaths()" class="btn" style="background: #2D6CF8; width: 100%; margin-bottom: 10px;">
                        üîç Scan Opportunities
                    </button>
                    <button onclick="viewHuobiPathDetails()" class="btn" style="background: #666; width: 100%; margin-bottom: 10px;">
                        üìã View All Paths
                    </button>
                    <button onclick="clearHuobiTriangularHistory()" class="btn" style="background: #ff6b6b; width: 100%; margin-bottom: 10px;">
                        üóëÔ∏è Clear History
                    </button>
                    <button onclick="saveHuobiTriangularSettings()" class="btn" style="background: #4CAF50; width: 100%;">
                        üíæ Save Settings
                    </button>
                </div>

                <!-- Current Opportunities -->
                <div class="stat-card" style="grid-column: span 2;">
                    <h4 style="color: #2D6CF8; margin-bottom: 15px;">üí∞ Current Opportunities</h4>
                    <div id="huobiOpportunities" style="max-height: 400px; overflow-y: auto;">
                        <p style="color: #888; text-align: center; padding: 20px;">
                            Click "Scan Opportunities" to find triangular arbitrage paths
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gate.io Exchange -->
        <div style="background: rgba(23,199,132,0.1); padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 2px solid #17C784;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <h3 style="color: #17C784; margin: 0;">üåø GATE.IO Triangular Arbitrage</h3>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <span style="color: #b8c6db; font-size: 0.9rem;">Live Trading:</span>
                    <div class="toggle-switch" id="gateioTriangularEnabled">
                        <div class="toggle-knob"></div>
                    </div>
                    <span id="gateioTriangularStatus" style="color: #ff6b6b; font-weight: 600; font-size: 0.9rem;">OFF</span>
                </div>
            </div>
            <p style="color: #888; margin: 0 0 10px 0; font-size: 14px;">
                3,800+ trading pairs | USDT bridge | GT native token | HMAC-SHA512 authentication
            </p>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">
                <!-- Status Card -->
                <div class="stat-card">
                    <h4 style="color: #17C784; margin-bottom: 15px;">üìä Status</h4>
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                        <div id="gateioStatusIndicator" style="width: 12px; height: 12px; border-radius: 50%; background: #666;"></div>
                        <span id="gateioStatusText" style="color: #888;">Not Connected</span>
                    </div>
                    <div style="margin-top: 15px; display: flex; gap: 10px;">
                        <button onclick="testGateioTriangularConnection()" style="flex: 1; padding: 10px; background: #17C784; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            Test Connection
                        </button>
                        <button onclick="viewGateioPathDetails()" style="flex: 1; padding: 10px; background: rgba(23,199,132,0.2); color: #17C784; border: 1px solid #17C784; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            View Paths
                        </button>
                    </div>
                </div>

                <!-- Risk Management -->
                <div class="stat-card">
                    <h4 style="color: #17C784; margin-bottom: 15px;">‚öñÔ∏è Risk Management</h4>
                    <label style="display: block; color: #888; margin-bottom: 5px; font-size: 14px;">Max Trade Amount (USDT)</label>
                    <input type="number" id="gateioMaxTrade" value="100" min="10" max="10000" step="10" style="width: 100%; padding: 10px; background: rgba(255,255,255,0.05); border: 1px solid #444; border-radius: 8px; color: white; margin-bottom: 15px;">

                    <label style="display: block; color: #888; margin-bottom: 5px; font-size: 14px;">Portfolio % Risk</label>
                    <input type="number" id="gateioPortfolioPercent" value="5" min="1" max="20" step="1" style="width: 100%; padding: 10px; background: rgba(255,255,255,0.05); border: 1px solid #444; border-radius: 8px; color: white; margin-bottom: 15px;">

                    <label style="display: block; color: #888; margin-bottom: 5px; font-size: 14px;">Min Profit Threshold (%)</label>
                    <input type="number" id="gateioProfitThreshold" value="0.3" min="0.1" max="5" step="0.1" style="width: 100%; padding: 10px; background: rgba(255,255,255,0.05); border: 1px solid #444; border-radius: 8px; color: white;">
                </div>

                <!-- Path Sets -->
                <div class="stat-card">
                    <h4 style="color: #17C784; margin-bottom: 15px;">üîÄ Path Selection (32 Total)</h4>
                    <div style="display: flex; flex-direction: column; gap: 10px;">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="gateioSet1Enabled" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #ddd;">‚úÖ SET 1: Essential ETH Bridge (7 paths)</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="gateioSet2Enabled" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #ddd;">‚úÖ SET 2: Mid-Cap BTC Bridge (7 paths)</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="gateioSet3Enabled" style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #ddd;">üåø SET 3: GT Native Bridge (6 paths)</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="gateioSet4Enabled" style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #ddd;">‚ö° SET 4: High Volatility (6 paths)</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="gateioSet5Enabled" style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #ddd;">üîÅ SET 5: Extended Multi-Bridge (6 paths)</span>
                        </label>
                    </div>
                </div>

                <!-- Scanner Controls -->
                <div class="stat-card">
                    <h4 style="color: #17C784; margin-bottom: 15px;">üîç Scanner</h4>
                    <button onclick="scanGateioTriangularPaths()" style="width: 100%; padding: 12px; background: #17C784; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 16px; margin-bottom: 15px;">
                        üîç Scan Opportunities
                    </button>
                    <div id="gateioScanStatus" style="color: #888; font-size: 14px; text-align: center; min-height: 20px;"></div>
                </div>

                <!-- Opportunities Display -->
                <div class="stat-card" style="grid-column: 1 / -1;">
                    <h4 style="color: #17C784; margin-bottom: 15px;">üíé Active Opportunities</h4>
                    <div id="gateioOpportunities" style="color: #888; font-size: 14px;">
                        No scan results yet. Click "Scan Opportunities" to begin.
                    </div>
                </div>

                <!-- Trade History -->
                <div class="stat-card" style="grid-column: 1 / -1;">
                    <h4 style="color: #17C784; margin-bottom: 15px;">üìú Recent Trades</h4>
                    <div id="gateioTradeHistory" style="color: #888; font-size: 14px;">
                        No trade history available.
                    </div>
                </div>
            </div>
        </div>

        <!-- Crypto.com Exchange -->
        <div style="background: rgba(0,45,116,0.1); padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 2px solid #002D74;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <h3 style="color: #0066FF; margin: 0;">üíé CRYPTO.COM Triangular Arbitrage</h3>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <span style="color: #b8c6db; font-size: 0.9rem;">Live Trading:</span>
                    <div class="toggle-switch" id="cryptocomTriangularEnabled">
                        <div class="toggle-knob"></div>
                    </div>
                    <span id="cryptocomTriangularStatus" style="color: #ff6b6b; font-weight: 600; font-size: 0.9rem;">OFF</span>
                </div>
            </div>
            <p style="color: #888; margin: 0 0 10px 0; font-size: 14px;">
                250+ digital assets | USDT bridge | CRO native token | HMAC-SHA256 authentication
            </p>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">
                <!-- Status Card -->
                <div class="stat-card">
                    <h4 style="color: #0066FF; margin-bottom: 15px;">üìä Status</h4>
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                        <div id="cryptocomStatusIndicator" style="width: 12px; height: 12px; border-radius: 50%; background: #666;"></div>
                        <span id="cryptocomStatusText" style="color: #888;">Not Connected</span>
                    </div>
                    <div style="margin-top: 15px; display: flex; gap: 10px;">
                        <button onclick="testCryptocomTriangularConnection()" style="flex: 1; padding: 10px; background: #0066FF; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            Test Connection
                        </button>
                        <button onclick="viewCryptocomPathDetails()" style="flex: 1; padding: 10px; background: rgba(0,102,255,0.2); color: #0066FF; border: 1px solid #0066FF; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            View Paths
                        </button>
                    </div>
                </div>

                <!-- Risk Management -->
                <div class="stat-card">
                    <h4 style="color: #0066FF; margin-bottom: 15px;">‚öñÔ∏è Risk Management</h4>
                    <label style="display: block; color: #888; margin-bottom: 5px; font-size: 14px;">Max Trade Amount (USDT)</label>
                    <input type="number" id="cryptocomMaxTrade" value="100" min="10" max="10000" step="10" style="width: 100%; padding: 10px; background: rgba(255,255,255,0.05); border: 1px solid #444; border-radius: 8px; color: white; margin-bottom: 15px;">

                    <label style="display: block; color: #888; margin-bottom: 5px; font-size: 14px;">Portfolio % Risk</label>
                    <input type="number" id="cryptocomPortfolioPercent" value="5" min="1" max="20" step="1" style="width: 100%; padding: 10px; background: rgba(255,255,255,0.05); border: 1px solid #444; border-radius: 8px; color: white; margin-bottom: 15px;">

                    <label style="display: block; color: #888; margin-bottom: 5px; font-size: 14px;">Min Profit Threshold (%)</label>
                    <input type="number" id="cryptocomProfitThreshold" value="0.3" min="0.1" max="5" step="0.1" style="width: 100%; padding: 10px; background: rgba(255,255,255,0.05); border: 1px solid #444; border-radius: 8px; color: white;">
                </div>

                <!-- Path Sets -->
                <div class="stat-card">
                    <h4 style="color: #0066FF; margin-bottom: 15px;">üîÄ Path Selection (32 Total)</h4>
                    <div style="display: flex; flex-direction: column; gap: 10px;">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="cryptocomSet1Enabled" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #ddd;">‚úÖ SET 1: Essential ETH Bridge (7 paths)</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="cryptocomSet2Enabled" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #ddd;">‚úÖ SET 2: Mid-Cap BTC Bridge (7 paths)</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="cryptocomSet3Enabled" style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #ddd;">üíé SET 3: CRO Native Bridge (6 paths)</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="cryptocomSet4Enabled" style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #ddd;">‚ö° SET 4: High Volatility (6 paths)</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="cryptocomSet5Enabled" style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #ddd;">üîÅ SET 5: Extended Multi-Bridge (6 paths)</span>
                        </label>
                    </div>
                </div>

                <!-- Scanner Controls -->
                <div class="stat-card">
                    <h4 style="color: #0066FF; margin-bottom: 15px;">üîç Scanner</h4>
                    <button onclick="scanCryptocomTriangularPaths()" style="width: 100%; padding: 12px; background: #0066FF; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 16px; margin-bottom: 15px;">
                        üîç Scan Opportunities
                    </button>
                    <div id="cryptocomScanStatus" style="color: #888; font-size: 14px; text-align: center; min-height: 20px;"></div>
                </div>

                <!-- Opportunities Display -->
                <div class="stat-card" style="grid-column: 1 / -1;">
                    <h4 style="color: #0066FF; margin-bottom: 15px;">üíé Active Opportunities</h4>
                    <div id="cryptocomOpportunities" style="color: #888; font-size: 14px;">
                        No scan results yet. Click "Scan Opportunities" to begin.
                    </div>
                </div>

                <!-- Trade History -->
                <div class="stat-card" style="grid-column: 1 / -1;">
                    <h4 style="color: #0066FF; margin-bottom: 15px;">üìú Recent Trades</h4>
                    <div id="cryptocomTradeHistory" style="color: #888; font-size: 14px;">
                        No trade history available.
                    </div>
                </div>
            </div>
        </div>

        <!-- MEXC Exchange -->
        <div style="background: rgba(255,165,0,0.1); padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 2px solid #FFA500;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <h3 style="color: #FFA500; margin: 0;">üü† MEXC Triangular Arbitrage</h3>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <span style="color: #b8c6db; font-size: 0.9rem;">Live Trading:</span>
                    <div class="toggle-switch" id="mexcTriangularEnabled">
                        <div class="toggle-knob"></div>
                    </div>
                    <span id="mexcTriangularStatus" style="color: #ff6b6b; font-weight: 600; font-size: 0.9rem;">OFF</span>
                </div>
            </div>
            <p style="color: #888; margin: 0 0 10px 0; font-size: 14px;">
                2,908+ USDT pairs | MX native token | 0% trading fees | HMAC-SHA256 authentication
            </p>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">
                <!-- Status Card -->
                <div class="stat-card">
                    <h4 style="color: #FFA500; margin-bottom: 15px;">üìä Status</h4>
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                        <div id="mexcStatusIndicator" style="width: 12px; height: 12px; border-radius: 50%; background: #666;"></div>
                        <span id="mexcStatusText" style="color: #888;">Not Connected</span>
                    </div>
                    <div style="margin-top: 15px; display: flex; gap: 10px;">
                        <button onclick="testMexcTriangularConnection()" style="flex: 1; padding: 10px; background: #FFA500; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            Test Connection
                        </button>
                        <button onclick="viewMexcPathDetails()" style="flex: 1; padding: 10px; background: rgba(255,165,0,0.2); color: #FFA500; border: 1px solid #FFA500; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            View Paths
                        </button>
                    </div>
                </div>

                <!-- Risk Management -->
                <div class="stat-card">
                    <h4 style="color: #FFA500; margin-bottom: 15px;">‚öñÔ∏è Risk Management</h4>
                    <label style="display: block; color: #888; margin-bottom: 5px; font-size: 14px;">Max Trade Amount (USDT)</label>
                    <input type="number" id="mexcMaxTrade" value="100" min="10" max="10000" step="10" style="width: 100%; padding: 10px; background: rgba(255,255,255,0.05); border: 1px solid #444; border-radius: 8px; color: white; margin-bottom: 15px;">

                    <label style="display: block; color: #888; margin-bottom: 5px; font-size: 14px;">Portfolio % Risk</label>
                    <input type="number" id="mexcPortfolioPercent" value="5" min="1" max="20" step="1" style="width: 100%; padding: 10px; background: rgba(255,255,255,0.05); border: 1px solid #444; border-radius: 8px; color: white; margin-bottom: 15px;">

                    <label style="display: block; color: #888; margin-bottom: 5px; font-size: 14px;">Min Profit Threshold (%)</label>
                    <input type="number" id="mexcProfitThreshold" value="0.3" min="0.1" max="5" step="0.1" style="width: 100%; padding: 10px; background: rgba(255,255,255,0.05); border: 1px solid #444; border-radius: 8px; color: white;">
                </div>

                <!-- Path Sets -->
                <div class="stat-card">
                    <h4 style="color: #FFA500; margin-bottom: 15px;">üîÄ Path Selection (32 Total)</h4>
                    <div style="display: flex; flex-direction: column; gap: 10px;">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="mexcSet1Enabled" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #ddd;">‚úÖ SET 1: Essential ETH Bridge (7 paths)</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="mexcSet2Enabled" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #ddd;">‚úÖ SET 2: Mid-Cap BTC Bridge (7 paths)</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="mexcSet3Enabled" style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #ddd;">üü† SET 3: MX Native Bridge (6 paths)</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="mexcSet4Enabled" style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #ddd;">‚ö° SET 4: High Volatility (6 paths)</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="mexcSet5Enabled" style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #ddd;">üîÅ SET 5: Extended Multi-Bridge (6 paths)</span>
                        </label>
                    </div>
                </div>

                <!-- Scanner Controls -->
                <div class="stat-card">
                    <h4 style="color: #FFA500; margin-bottom: 15px;">üîç Scanner</h4>
                    <button onclick="scanMexcTriangularPaths()" style="width: 100%; padding: 12px; background: #FFA500; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 16px; margin-bottom: 15px;">
                        üîç Scan Opportunities
                    </button>
                    <div id="mexcScanStatus" style="color: #888; font-size: 14px; text-align: center; min-height: 20px;"></div>
                </div>

                <!-- Opportunities Display -->
                <div class="stat-card" style="grid-column: 1 / -1;">
                    <h4 style="color: #FFA500; margin-bottom: 15px;">üíé Active Opportunities</h4>
                    <div id="mexcOpportunities" style="color: #888; font-size: 14px;">
                        No scan results yet. Click "Scan Opportunities" to begin.
                    </div>
                </div>

                <!-- Trade History -->
                <div class="stat-card" style="grid-column: 1 / -1;">
                    <h4 style="color: #FFA500; margin-bottom: 15px;">üìú Recent Trades</h4>
                    <div id="mexcTradeHistory" style="color: #888; font-size: 14px;">
                        No trade history available.
                    </div>
                </div>
            </div>
        </div>

        <!-- XT Exchange -->
        <div style="background: rgba(0,150,255,0.1); padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 2px solid #0096FF;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <h3 style="color: #0096FF; margin: 0;">üöÄ XT.COM Triangular Arbitrage</h3>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <span style="color: #b8c6db; font-size: 0.9rem;">Live Trading:</span>
                    <div class="toggle-switch" id="xtTriangularEnabled">
                        <div class="toggle-knob"></div>
                    </div>
                    <span id="xtTriangularStatus" style="color: #ff6b6b; font-weight: 600; font-size: 0.9rem;">OFF</span>
                </div>
            </div>
            <p style="color: #888; margin: 0 0 10px 0; font-size: 14px;">
                1,000+ USDT pairs | XT native token | HMAC-SHA256 authentication | 7.8M users
            </p>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">
                <!-- Status Card -->
                <div class="stat-card">
                    <h4 style="color: #0096FF; margin-bottom: 15px;">üìä Status</h4>
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                        <div id="xtStatusIndicator" style="width: 12px; height: 12px; border-radius: 50%; background: #666;"></div>
                        <span id="xtStatusText" style="color: #888;">Not Connected</span>
                    </div>
                    <div style="margin-top: 15px; display: flex; gap: 10px;">
                        <button onclick="testXtTriangularConnection()" style="flex: 1; padding: 10px; background: #0096FF; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            Test Connection
                        </button>
                        <button onclick="viewXtPathDetails()" style="flex: 1; padding: 10px; background: rgba(0,150,255,0.2); color: #0096FF; border: 1px solid #0096FF; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            View Paths
                        </button>
                    </div>
                </div>

                <!-- Risk Management -->
                <div class="stat-card">
                    <h4 style="color: #0096FF; margin-bottom: 15px;">‚öñÔ∏è Risk Management</h4>
                    <label style="display: block; color: #888; margin-bottom: 5px; font-size: 14px;">Max Trade Amount (USDT)</label>
                    <input type="number" id="xtMaxTrade" value="100" min="10" max="10000" step="10" style="width: 100%; padding: 10px; background: rgba(255,255,255,0.05); border: 1px solid #444; border-radius: 8px; color: white; margin-bottom: 15px;">

                    <label style="display: block; color: #888; margin-bottom: 5px; font-size: 14px;">Portfolio % Risk</label>
                    <input type="number" id="xtPortfolioPercent" value="5" min="1" max="20" step="1" style="width: 100%; padding: 10px; background: rgba(255,255,255,0.05); border: 1px solid #444; border-radius: 8px; color: white; margin-bottom: 15px;">

                    <label style="display: block; color: #888; margin-bottom: 5px; font-size: 14px;">Min Profit Threshold (%)</label>
                    <input type="number" id="xtProfitThreshold" value="0.3" min="0.1" max="5" step="0.1" style="width: 100%; padding: 10px; background: rgba(255,255,255,0.05); border: 1px solid #444; border-radius: 8px; color: white;">
                </div>

                <!-- Path Sets -->
                <div class="stat-card">
                    <h4 style="color: #0096FF; margin-bottom: 15px;">üîÄ Path Selection (32 Total)</h4>
                    <div style="display: flex; flex-direction: column; gap: 10px;">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="xtSet1Enabled" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #ddd;">‚úÖ SET 1: Essential ETH Bridge (7 paths)</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="xtSet2Enabled" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #ddd;">‚úÖ SET 2: Mid-Cap BTC Bridge (7 paths)</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="xtSet3Enabled" style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #ddd;">üöÄ SET 3: XT Native Bridge (6 paths)</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="xtSet4Enabled" style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #ddd;">‚ö° SET 4: High Volatility (6 paths)</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="xtSet5Enabled" style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #ddd;">üîÅ SET 5: Extended Multi-Bridge (6 paths)</span>
                        </label>
                    </div>
                </div>

                <!-- Scanner Controls -->
                <div class="stat-card">
                    <h4 style="color: #0096FF; margin-bottom: 15px;">üîç Scanner</h4>
                    <button onclick="scanXtTriangularPaths()" style="width: 100%; padding: 12px; background: #0096FF; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 16px; margin-bottom: 15px;">
                        üîç Scan Opportunities
                    </button>
                    <div id="xtScanStatus" style="color: #888; font-size: 14px; text-align: center; min-height: 20px;"></div>
                </div>

                <!-- Opportunities Display -->
                <div class="stat-card" style="grid-column: 1 / -1;">
                    <h4 style="color: #0096FF; margin-bottom: 15px;">üíé Active Opportunities</h4>
                    <div id="xtOpportunities" style="color: #888; font-size: 14px;">
                        No scan results yet. Click "Scan Opportunities" to begin.
                    </div>
                </div>

                <!-- Trade History -->
                <div class="stat-card" style="grid-column: 1 / -1;">
                    <h4 style="color: #0096FF; margin-bottom: 15px;">üìú Recent Trades</h4>
                    <div id="xtTradeHistory" style="color: #888; font-size: 14px;">
                        No trade history available.
                    </div>
                </div>
            </div>
        </div>

        <!-- AscendEX Exchange -->
        <div style="background: rgba(138,43,226,0.1); padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 2px solid #8A2BE2;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <h3 style="color: #8A2BE2; margin: 0;">üíé AscendEX Triangular Arbitrage</h3>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <span style="color: #b8c6db; font-size: 0.9rem;">Live Trading:</span>
                    <div class="toggle-switch" id="ascendexTriangularEnabled">
                        <div class="toggle-knob"></div>
                    </div>
                    <span id="ascendexTriangularStatus" style="color: #ff6b6b; font-weight: 600; font-size: 0.9rem;">OFF</span>
                </div>
            </div>
            <p style="color: #888; margin: 0 0 10px 0; font-size: 14px;">
                450+ USDT pairs | ASD native token | HMAC-SHA256 | Account-group routing
            </p>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">
                <!-- Status Card -->
                <div class="stat-card">
                    <h4 style="color: #8A2BE2; margin-bottom: 15px;">üìä Status</h4>
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                        <div id="ascendexStatusIndicator" style="width: 12px; height: 12px; border-radius: 50%; background: #666;"></div>
                        <span id="ascendexStatusText" style="color: #888;">Not Connected</span>
                    </div>
                    <div style="margin-top: 15px; display: flex; gap: 10px;">
                        <button onclick="testAscendexTriangularConnection()" style="flex: 1; padding: 10px; background: #8A2BE2; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            Test Connection
                        </button>
                        <button onclick="viewAscendexPathDetails()" style="flex: 1; padding: 10px; background: rgba(138,43,226,0.2); color: #8A2BE2; border: 1px solid #8A2BE2; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            View Paths
                        </button>
                    </div>
                </div>

                <!-- Risk Management -->
                <div class="stat-card">
                    <h4 style="color: #8A2BE2; margin-bottom: 15px;">‚öñÔ∏è Risk Management</h4>
                    <label style="display: block; color: #888; margin-bottom: 5px; font-size: 14px;">Max Trade Amount (USDT)</label>
                    <input type="number" id="ascendexMaxTrade" value="100" min="10" max="10000" step="10" style="width: 100%; padding: 10px; background: rgba(255,255,255,0.05); border: 1px solid #444; border-radius: 8px; color: white; margin-bottom: 15px;">

                    <label style="display: block; color: #888; margin-bottom: 5px; font-size: 14px;">Portfolio % Risk</label>
                    <input type="number" id="ascendexPortfolioPercent" value="5" min="1" max="20" step="1" style="width: 100%; padding: 10px; background: rgba(255,255,255,0.05); border: 1px solid #444; border-radius: 8px; color: white; margin-bottom: 15px;">

                    <label style="display: block; color: #888; margin-bottom: 5px; font-size: 14px;">Min Profit Threshold (%)</label>
                    <input type="number" id="ascendexProfitThreshold" value="0.3" min="0.1" max="5" step="0.1" style="width: 100%; padding: 10px; background: rgba(255,255,255,0.05); border: 1px solid #444; border-radius: 8px; color: white;">
                </div>

                <!-- Path Sets -->
                <div class="stat-card">
                    <h4 style="color: #8A2BE2; margin-bottom: 15px;">üîÄ Path Selection (32 Total)</h4>
                    <div style="display: flex; flex-direction: column; gap: 10px;">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="ascendexSet1Enabled" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #ddd;">‚úÖ SET 1: Essential ETH Bridge (7 paths)</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="ascendexSet2Enabled" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #ddd;">‚úÖ SET 2: Mid-Cap BTC Bridge (7 paths)</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="ascendexSet3Enabled" style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #ddd;">üíé SET 3: ASD Native Bridge (6 paths)</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="ascendexSet4Enabled" style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #ddd;">‚ö° SET 4: High Volatility (6 paths)</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="ascendexSet5Enabled" style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #ddd;">üîÅ SET 5: Extended Multi-Bridge (6 paths)</span>
                        </label>
                    </div>
                </div>

                <!-- Scanner Controls -->
                <div class="stat-card">
                    <h4 style="color: #8A2BE2; margin-bottom: 15px;">üîç Scanner</h4>
                    <button onclick="scanAscendexTriangularPaths()" style="width: 100%; padding: 12px; background: #8A2BE2; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 16px; margin-bottom: 15px;">
                        üîç Scan Opportunities
                    </button>
                    <div id="ascendexScanStatus" style="color: #888; font-size: 14px; text-align: center; min-height: 20px;"></div>
                </div>

                <!-- Opportunities Display -->
                <div class="stat-card" style="grid-column: 1 / -1;">
                    <h4 style="color: #8A2BE2; margin-bottom: 15px;">üíé Active Opportunities</h4>
                    <div id="ascendexOpportunities" style="color: #888; font-size: 14px;">
                        No scan results yet. Click "Scan Opportunities" to begin.
                    </div>
                </div>

                <!-- Trade History -->
                <div class="stat-card" style="grid-column: 1 / -1;">
                    <h4 style="color: #8A2BE2; margin-bottom: 15px;">üìú Recent Trades</h4>
                    <div id="ascendexTradeHistory" style="color: #888; font-size: 14px;">
                        No trade history available.
                    </div>
                </div>
            </div>
        </div>

        <!-- BingX Exchange -->
        <div style="background: rgba(0,191,255,0.1); padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 2px solid #00BFFF;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <h3 style="color: #00BFFF; margin: 0;">üåä BingX Triangular Arbitrage</h3>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <span style="color: #b8c6db; font-size: 0.9rem;">Live Trading:</span>
                    <div class="toggle-switch" id="bingxTriangularEnabled">
                        <div class="toggle-knob"></div>
                    </div>
                    <span id="bingxTriangularStatus" style="color: #ff6b6b; font-weight: 600; font-size: 0.9rem;">OFF</span>
                </div>
            </div>
            <p style="color: #888; margin: 0 0 10px 0; font-size: 14px;">
                700+ USDT pairs | No native token | SOL high-liquidity bridge | 0.10% fees | HMAC-SHA256
            </p>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">
                <!-- Status Card -->
                <div class="stat-card">
                    <h4 style="color: #00BFFF; margin-bottom: 15px;">üìä Status</h4>
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                        <div id="bingxStatusIndicator" style="width: 12px; height: 12px; border-radius: 50%; background: #666;"></div>
                        <span id="bingxStatusText" style="color: #888;">Not Connected</span>
                    </div>
                    <div style="margin-top: 15px; display: flex; gap: 10px;">
                        <button onclick="testBingXTriangularConnection()" style="flex: 1; padding: 10px; background: #00BFFF; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            Test Connection
                        </button>
                        <button onclick="viewBingXPathDetails()" style="flex: 1; padding: 10px; background: rgba(0,191,255,0.2); color: #00BFFF; border: 1px solid #00BFFF; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            View Paths
                        </button>
                    </div>
                </div>

                <!-- Risk Management -->
                <div class="stat-card">
                    <h4 style="color: #00BFFF; margin-bottom: 15px;">‚öñÔ∏è Risk Management</h4>
                    <label style="display: block; color: #888; margin-bottom: 5px; font-size: 14px;">Max Trade Amount (USDT)</label>
                    <input type="number" id="bingxMaxTrade" value="100" min="10" max="10000" step="10" style="width: 100%; padding: 10px; background: rgba(255,255,255,0.05); border: 1px solid #444; border-radius: 8px; color: white; margin-bottom: 15px;">

                    <label style="display: block; color: #888; margin-bottom: 5px; font-size: 14px;">Portfolio % Risk</label>
                    <input type="number" id="bingxPortfolioPercent" value="5" min="1" max="20" step="1" style="width: 100%; padding: 10px; background: rgba(255,255,255,0.05); border: 1px solid #444; border-radius: 8px; color: white; margin-bottom: 15px;">

                    <label style="display: block; color: #888; margin-bottom: 5px; font-size: 14px;">Min Profit Threshold (%)</label>
                    <input type="number" id="bingxProfitThreshold" value="0.3" min="0.1" max="5" step="0.1" style="width: 100%; padding: 10px; background: rgba(255,255,255,0.05); border: 1px solid #444; border-radius: 8px; color: white;">
                </div>

                <!-- Path Sets -->
                <div class="stat-card">
                    <h4 style="color: #00BFFF; margin-bottom: 15px;">üîÄ Path Selection (32 Total)</h4>
                    <div style="display: flex; flex-direction: column; gap: 10px;">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="bingxSet1Enabled" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #ddd;">‚úÖ SET 1: Essential ETH Bridge (7 paths)</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="bingxSet2Enabled" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #ddd;">‚úÖ SET 2: Mid-Cap BTC Bridge (7 paths)</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="bingxSet3Enabled" style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #ddd;">üíé SET 3: SOL High-Liquidity (6 paths)</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="bingxSet4Enabled" style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #ddd;">‚ö° SET 4: High Volatility (6 paths)</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="bingxSet5Enabled" style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #ddd;">üîÅ SET 5: Extended Multi-Bridge (6 paths)</span>
                        </label>
                    </div>
                </div>

                <!-- Scanner Controls -->
                <div class="stat-card">
                    <h4 style="color: #00BFFF; margin-bottom: 15px;">üîç Scanner</h4>
                    <button onclick="scanBingXTriangularPaths()" style="width: 100%; padding: 12px; background: #00BFFF; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 16px; margin-bottom: 15px;">
                        üîç Scan Opportunities
                    </button>
                    <div id="bingxScanStatus" style="color: #888; font-size: 14px; text-align: center; min-height: 20px;"></div>
                </div>

                <!-- Opportunities Display -->
                <div class="stat-card" style="grid-column: 1 / -1;">
                    <h4 style="color: #00BFFF; margin-bottom: 15px;">üíé Active Opportunities</h4>
                    <div id="bingxOpportunities" style="color: #888; font-size: 14px;">
                        No scan results yet. Click "Scan Opportunities" to begin.
                    </div>
                </div>

                <!-- Trade History -->
                <div class="stat-card" style="grid-column: 1 / -1;">
                    <h4 style="color: #00BFFF; margin-bottom: 15px;">üìú Recent Trades</h4>
                    <div id="bingxTradeHistory" style="color: #888; font-size: 14px;">
                        No trade history available.
                    </div>
                </div>
            </div>
        </div>

        <!-- Bitget Exchange -->
        <div style="background: rgba(138,43,226,0.1); padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 2px solid #8A2BE2;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <h3 style="color: #8A2BE2; margin: 0;">üíú Bitget Triangular Arbitrage</h3>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <span style="color: #b8c6db; font-size: 0.9rem;">Live Trading:</span>
                    <div class="toggle-switch" id="bitgetTriangularEnabled">
                        <div class="toggle-knob"></div>
                    </div>
                    <span id="bitgetTriangularStatus" style="color: #ff6b6b; font-weight: 600; font-size: 0.9rem;">OFF</span>
                </div>
            </div>
            <p style="color: #888; margin: 0 0 10px 0; font-size: 14px;">
                700+ USDT pairs | BGB native token | 0.10% fees | Passphrase required | HMAC-SHA256 Base64
            </p>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">
                <!-- Status Card -->
                <div class="stat-card">
                    <h4 style="color: #8A2BE2; margin-bottom: 15px;">üìä Status</h4>
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                        <div id="bitgetStatusIndicator" style="width: 12px; height: 12px; border-radius: 50%; background: #666;"></div>
                        <span id="bitgetStatusText" style="color: #888;">Not Connected</span>
                    </div>
                    <div style="margin-top: 15px; display: flex; gap: 10px;">
                        <button onclick="testBitgetTriangularConnection()" style="flex: 1; padding: 10px; background: #8A2BE2; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            Test Connection
                        </button>
                        <button onclick="viewBitgetPathDetails()" style="flex: 1; padding: 10px; background: rgba(138,43,226,0.2); color: #8A2BE2; border: 1px solid #8A2BE2; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            View Paths
                        </button>
                    </div>
                </div>

                <!-- Risk Management -->
                <div class="stat-card">
                    <h4 style="color: #8A2BE2; margin-bottom: 15px;">‚öñÔ∏è Risk Management</h4>
                    <label style="display: block; color: #888; margin-bottom: 5px; font-size: 14px;">Max Trade Amount (USDT)</label>
                    <input type="number" id="bitgetMaxTrade" value="100" min="10" max="10000" step="10" style="width: 100%; padding: 10px; background: rgba(255,255,255,0.05); border: 1px solid #444; border-radius: 8px; color: white; margin-bottom: 15px;">

                    <label style="display: block; color: #888; margin-bottom: 5px; font-size: 14px;">Portfolio % Risk</label>
                    <input type="number" id="bitgetPortfolioPercent" value="5" min="1" max="20" step="1" style="width: 100%; padding: 10px; background: rgba(255,255,255,0.05); border: 1px solid #444; border-radius: 8px; color: white; margin-bottom: 15px;">

                    <label style="display: block; color: #888; margin-bottom: 5px; font-size: 14px;">Min Profit Threshold (%)</label>
                    <input type="number" id="bitgetProfitThreshold" value="0.3" min="0.1" max="5" step="0.1" style="width: 100%; padding: 10px; background: rgba(255,255,255,0.05); border: 1px solid #444; border-radius: 8px; color: white;">
                </div>

                <!-- Path Sets -->
                <div class="stat-card">
                    <h4 style="color: #8A2BE2; margin-bottom: 15px;">üîÄ Path Selection (32 Total)</h4>
                    <div style="display: flex; flex-direction: column; gap: 10px;">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="bitgetSet1Enabled" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #ddd;">‚úÖ SET 1: Essential ETH Bridge (7 paths)</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="bitgetSet2Enabled" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #ddd;">‚úÖ SET 2: Mid-Cap BTC Bridge (7 paths)</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="bitgetSet3Enabled" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #ddd;">üíú SET 3: BGB Native Token (6 paths)</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="bitgetSet4Enabled" style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #ddd;">‚ö° SET 4: High Volatility (6 paths)</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="bitgetSet5Enabled" style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #ddd;">üîÅ SET 5: Extended Multi-Bridge (6 paths)</span>
                        </label>
                    </div>
                </div>

                <!-- Scanner Controls -->
                <div class="stat-card">
                    <h4 style="color: #8A2BE2; margin-bottom: 15px;">üîç Scanner</h4>
                    <button onclick="scanBitgetTriangularPaths()" style="width: 100%; padding: 12px; background: #8A2BE2; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 16px; margin-bottom: 15px;">
                        üîç Scan Opportunities
                    </button>
                    <div id="bitgetScanStatus" style="color: #888; font-size: 14px; text-align: center; min-height: 20px;"></div>
                </div>

                <!-- Opportunities Display -->
                <div class="stat-card" style="grid-column: 1 / -1;">
                    <h4 style="color: #8A2BE2; margin-bottom: 15px;">üíé Active Opportunities</h4>
                    <div id="bitgetOpportunities" style="color: #888; font-size: 14px;">
                        No scan results yet. Click "Scan Opportunities" to begin.
                    </div>
                </div>

                <!-- Trade History -->
                <div class="stat-card" style="grid-column: 1 / -1;">
                    <h4 style="color: #8A2BE2; margin-bottom: 15px;">üìú Recent Trades</h4>
                    <div id="bitgetTradeHistory" style="color: #888; font-size: 14px;">
                        No trade history available.
                    </div>
                </div>
            </div>
        </div>

        <!-- Bitmart Exchange -->
        <div style="background: rgba(255,140,0,0.1); padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 2px solid #FF8C00;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <h3 style="color: #FF8C00; margin: 0;">üß° Bitmart Triangular Arbitrage</h3>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <span style="color: #b8c6db; font-size: 0.9rem;">Live Trading:</span>
                    <div class="toggle-switch" id="bitmartTriangularEnabled">
                        <div class="toggle-knob"></div>
                    </div>
                    <span id="bitmartTriangularStatus" style="color: #ff6b6b; font-weight: 600; font-size: 0.9rem;">OFF</span>
                </div>
            </div>
            <p style="color: #888; margin: 0 0 10px 0; font-size: 14px;">
                1,400+ cryptocurrencies | BMX native token | 0.25% fees (0.1% with BMX) | Memo required | HMAC-SHA256
            </p>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">
                <!-- Status Card -->
                <div class="stat-card">
                    <h4 style="color: #FF8C00; margin-bottom: 15px;">üìä Status</h4>
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                        <div id="bitmartStatusIndicator" style="width: 12px; height: 12px; border-radius: 50%; background: #666;"></div>
                        <span id="bitmartStatusText" style="color: #888;">Not Connected</span>
                    </div>
                    <div style="margin-top: 15px; display: flex; gap: 10px;">
                        <button onclick="testBitmartTriangularConnection()" style="flex: 1; padding: 10px; background: #FF8C00; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            Test Connection
                        </button>
                        <button onclick="viewBitmartPathDetails()" style="flex: 1; padding: 10px; background: rgba(255,140,0,0.2); color: #FF8C00; border: 1px solid #FF8C00; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            View Paths
                        </button>
                    </div>
                </div>

                <!-- Risk Management -->
                <div class="stat-card">
                    <h4 style="color: #FF8C00; margin-bottom: 15px;">‚öñÔ∏è Risk Management</h4>
                    <label style="display: block; color: #888; margin-bottom: 5px; font-size: 14px;">Max Trade Amount (USDT)</label>
                    <input type="number" id="bitmartMaxTrade" value="100" min="10" max="10000" step="10" style="width: 100%; padding: 10px; background: rgba(255,255,255,0.05); border: 1px solid #444; border-radius: 8px; color: white; margin-bottom: 15px;">

                    <label style="display: block; color: #888; margin-bottom: 5px; font-size: 14px;">Portfolio % Risk</label>
                    <input type="number" id="bitmartPortfolioPercent" value="5" min="1" max="20" step="1" style="width: 100%; padding: 10px; background: rgba(255,255,255,0.05); border: 1px solid #444; border-radius: 8px; color: white; margin-bottom: 15px;">

                    <label style="display: block; color: #888; margin-bottom: 5px; font-size: 14px;">Min Profit Threshold (%)</label>
                    <input type="number" id="bitmartProfitThreshold" value="0.3" min="0.1" max="5" step="0.1" style="width: 100%; padding: 10px; background: rgba(255,255,255,0.05); border: 1px solid #444; border-radius: 8px; color: white;">
                </div>

                <!-- Path Sets -->
                <div class="stat-card">
                    <h4 style="color: #FF8C00; margin-bottom: 15px;">üîÄ Path Selection (32 Total)</h4>
                    <div style="display: flex; flex-direction: column; gap: 10px;">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="bitmartSet1Enabled" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #ddd;">‚úÖ SET 1: Essential ETH Bridge (7 paths)</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="bitmartSet2Enabled" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #ddd;">‚úÖ SET 2: Mid-Cap BTC Bridge (7 paths)</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="bitmartSet3Enabled" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #ddd;">üß° SET 3: BMX Native Token (6 paths)</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="bitmartSet4Enabled" style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #ddd;">‚ö° SET 4: High Volatility (6 paths)</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="bitmartSet5Enabled" style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #ddd;">üîÅ SET 5: Extended Multi-Bridge (6 paths)</span>
                        </label>
                    </div>
                </div>

                <!-- Scanner Controls -->
                <div class="stat-card">
                    <h4 style="color: #FF8C00; margin-bottom: 15px;">üîç Scanner</h4>
                    <button onclick="scanBitmartTriangularPaths()" style="width: 100%; padding: 12px; background: #FF8C00; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 16px; margin-bottom: 15px;">
                        üîç Scan Opportunities
                    </button>
                    <div id="bitmartScanStatus" style="color: #888; font-size: 14px; text-align: center; min-height: 20px;"></div>
                </div>

                <!-- Opportunities Display -->
                <div class="stat-card" style="grid-column: 1 / -1;">
                    <h4 style="color: #FF8C00; margin-bottom: 15px;">üíé Active Opportunities</h4>
                    <div id="bitmartOpportunities" style="color: #888; font-size: 14px;">
                        No scan results yet. Click "Scan Opportunities" to begin.
                    </div>
                </div>

                <!-- Trade History -->
                <div class="stat-card" style="grid-column: 1 / -1;">
                    <h4 style="color: #FF8C00; margin-bottom: 15px;">üìú Recent Trades</h4>
                    <div id="bitmartTradeHistory" style="color: #888; font-size: 14px;">
                        No trade history available.
                    </div>
                </div>
            </div>
        </div>

        <!-- Bitrue Exchange -->
        <div style="background: rgba(34,197,94,0.1); padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 2px solid #22C55E;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <h3 style="color: #22C55E; margin: 0;">üíö Bitrue Triangular Arbitrage</h3>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <span style="color: #b8c6db; font-size: 0.9rem;">Live Trading:</span>
                    <div class="toggle-switch" id="bitrueTriangularEnabled">
                        <div class="toggle-knob"></div>
                    </div>
                    <span id="bitrueTriangularStatus" style="color: #ff6b6b; font-weight: 600; font-size: 0.9rem;">OFF</span>
                </div>
            </div>
            <p style="color: #888; margin: 0 0 10px 0; font-size: 14px;">
                700+ altcoins | 1,100+ pairs | BTR native token | 30% fee discount with BTR | Binance-compatible API
            </p>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">
                <!-- Status Card -->
                <div class="stat-card">
                    <h4 style="color: #22C55E; margin-bottom: 15px;">üìä Status</h4>
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                        <div id="bitrueStatusIndicator" style="width: 12px; height: 12px; border-radius: 50%; background: #666;"></div>
                        <span id="bitrueStatusText" style="color: #888;">Not Connected</span>
                    </div>
                    <div style="margin-top: 15px; display: flex; gap: 10px;">
                        <button onclick="testBitrueTriangularConnection()" style="flex: 1; padding: 10px; background: #22C55E; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            Test Connection
                        </button>
                        <button onclick="viewBitruePathDetails()" style="flex: 1; padding: 10px; background: rgba(34,197,94,0.2); color: #22C55E; border: 1px solid #22C55E; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            View Paths
                        </button>
                    </div>
                </div>

                <!-- Risk Management -->
                <div class="stat-card">
                    <h4 style="color: #22C55E; margin-bottom: 15px;">‚öñÔ∏è Risk Management</h4>
                    <label style="display: block; color: #888; margin-bottom: 5px; font-size: 14px;">Max Trade Amount (USDT)</label>
                    <input type="number" id="bitrueMaxTrade" value="100" min="10" max="10000" step="10" style="width: 100%; padding: 10px; background: rgba(255,255,255,0.05); border: 1px solid #444; border-radius: 8px; color: white; margin-bottom: 15px;">

                    <label style="display: block; color: #888; margin-bottom: 5px; font-size: 14px;">Portfolio % Risk</label>
                    <input type="number" id="bitruePortfolioPercent" value="5" min="1" max="20" step="1" style="width: 100%; padding: 10px; background: rgba(255,255,255,0.05); border: 1px solid #444; border-radius: 8px; color: white; margin-bottom: 15px;">

                    <label style="display: block; color: #888; margin-bottom: 5px; font-size: 14px;">Min Profit Threshold (%)</label>
                    <input type="number" id="bitrueProfitThreshold" value="0.3" min="0.1" max="5" step="0.1" style="width: 100%; padding: 10px; background: rgba(255,255,255,0.05); border: 1px solid #444; border-radius: 8px; color: white;">
                </div>

                <!-- Path Sets -->
                <div class="stat-card">
                    <h4 style="color: #22C55E; margin-bottom: 15px;">üîÄ Path Selection (32 Total)</h4>
                    <div style="display: flex; flex-direction: column; gap: 10px;">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="bitrueSet1Enabled" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #ddd;">‚úÖ SET 1: Essential ETH Bridge (7 paths)</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="bitrueSet2Enabled" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #ddd;">‚úÖ SET 2: Mid-Cap BTC Bridge (7 paths)</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="bitrueSet3Enabled" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #ddd;">üíö SET 3: BTR Native Token (6 paths)</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="bitrueSet4Enabled" style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #ddd;">‚ö° SET 4: High Volatility (6 paths)</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="bitrueSet5Enabled" style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #ddd;">üîÅ SET 5: Extended Multi-Bridge (6 paths)</span>
                        </label>
                    </div>
                </div>

                <!-- Scanner Controls -->
                <div class="stat-card">
                    <h4 style="color: #22C55E; margin-bottom: 15px;">üîç Scanner</h4>
                    <button onclick="scanBitrueTriangularPaths()" style="width: 100%; padding: 12px; background: #22C55E; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 16px; margin-bottom: 15px;">
                        üîç Scan Opportunities
                    </button>
                    <div id="bitrueScanStatus" style="color: #888; font-size: 14px; text-align: center; min-height: 20px;"></div>
                </div>

                <!-- Opportunities Display -->
                <div class="stat-card" style="grid-column: 1 / -1;">
                    <h4 style="color: #22C55E; margin-bottom: 15px;">üíé Active Opportunities</h4>
                    <div id="bitrueOpportunities" style="color: #888; font-size: 14px;">
                        No scan results yet. Click "Scan Opportunities" to begin.
                    </div>
                </div>

                <!-- Trade History -->
                <div class="stat-card" style="grid-column: 1 / -1;">
                    <h4 style="color: #22C55E; margin-bottom: 15px;">üìú Recent Trades</h4>
                    <div id="bitrueTradeHistory" style="color: #888; font-size: 14px;">
                        No trade history available.
                    </div>
                </div>
            </div>
        </div>

        <!-- Gemini Exchange -->
        <div style="background: rgba(0,170,221,0.1); padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 2px solid #00AADD;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <h3 style="color: #00AADD; margin: 0;">üíé Gemini Triangular Arbitrage</h3>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <span style="color: #b8c6db; font-size: 0.9rem;">Live Trading:</span>
                    <div class="toggle-switch" id="geminiTriangularEnabled">
                        <div class="toggle-knob"></div>
                    </div>
                    <span id="geminiTriangularStatus" style="color: #ff6b6b; font-weight: 600; font-size: 0.9rem;">OFF</span>
                </div>
            </div>
            <p style="color: #888; margin: 0 0 10px 0; font-size: 14px;">
                Regulated US exchange | Limited USDT pairs | 10 paths available | HMAC-SHA384 | Winklevoss-founded | Secure custody
            </p>

            <div style="margin-top: 20px; display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                <!-- Status Card -->
                <div class="stat-card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <h4 style="color: #00AADD; margin: 0;">üìä Status</h4>
                        <button onclick="testGeminiTriangularConnection()" style="padding: 6px 12px; background: #00AADD; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 12px;">
                            Test Connection
                        </button>
                    </div>
                    <div id="geminiStatus" style="color: #888; font-size: 14px;">Not connected</div>
                    <div id="geminiBalance" style="color: #888; font-size: 14px; margin-top: 5px;"></div>
                </div>

                <!-- Risk Management -->
                <div class="stat-card">
                    <h4 style="color: #00AADD; margin-bottom: 10px;">‚öôÔ∏è Risk Settings</h4>
                    <div style="margin-bottom: 10px;">
                        <label style="color: #888; font-size: 12px; display: block; margin-bottom: 5px;">Min Profit %</label>
                        <input type="number" id="geminiMinProfit" value="0.5" step="0.1" style="width: 100%; padding: 8px; background: rgba(255,255,255,0.05); border: 1px solid #555; border-radius: 5px; color: white; font-size: 14px;">
                    </div>
                    <div>
                        <label style="color: #888; font-size: 12px; display: block; margin-bottom: 5px;">Max Investment ($)</label>
                        <input type="number" id="geminiMaxInvestment" value="1000" step="100" style="width: 100%; padding: 8px; background: rgba(255,255,255,0.05); border: 1px solid #555; border-radius: 5px; color: white; font-size: 14px;">
                    </div>
                </div>

                <!-- Path Selection -->
                <div class="stat-card" style="grid-column: 1 / -1;">
                    <h4 style="color: #00AADD; margin-bottom: 15px;">üõ§Ô∏è Path Selection (10 paths available)</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                        <label style="display: flex; align-items: center; color: #888; cursor: pointer;">
                            <input type="checkbox" id="gemini_SET_1" checked style="margin-right: 8px; width: 16px; height: 16px;">
                            <span>SET 1: BTC-ETH Direct (2 paths)</span>
                        </label>
                        <label style="display: flex; align-items: center; color: #888; cursor: pointer;">
                            <input type="checkbox" id="gemini_SET_2" checked style="margin-right: 8px; width: 16px; height: 16px;">
                            <span>SET 2: DOGE Bridge (2 paths)</span>
                        </label>
                        <label style="display: flex; align-items: center; color: #888; cursor: pointer;">
                            <input type="checkbox" id="gemini_SET_3" checked style="margin-right: 8px; width: 16px; height: 16px;">
                            <span>SET 3: LINK Bridge (2 paths)</span>
                        </label>
                        <label style="display: flex; align-items: center; color: #888; cursor: pointer;">
                            <input type="checkbox" id="gemini_SET_4" checked style="margin-right: 8px; width: 16px; height: 16px;">
                            <span>SET 4: LTC Bridge (2 paths)</span>
                        </label>
                        <label style="display: flex; align-items: center; color: #888; cursor: pointer;">
                            <input type="checkbox" id="gemini_SET_5" checked style="margin-right: 8px; width: 16px; height: 16px;">
                            <span>SET 5: SOL Bridge (2 paths)</span>
                        </label>
                    </div>
                    <div style="margin-top: 15px; display: flex; gap: 10px;">
                        <button onclick="saveGeminiSettings()" style="flex: 1; padding: 10px; background: rgba(0,170,221,0.2); color: #00AADD; border: 1px solid #00AADD; border-radius: 5px; cursor: pointer;">
                            üíæ Save Settings
                        </button>
                        <button onclick="loadGeminiSettings()" style="flex: 1; padding: 10px; background: rgba(0,170,221,0.2); color: #00AADD; border: 1px solid #00AADD; border-radius: 5px; cursor: pointer;">
                            üì• Load Settings
                        </button>
                        <button onclick="viewGeminiPathDetails()" style="flex: 1; padding: 10px; background: rgba(0,170,221,0.2); color: #00AADD; border: 1px solid #00AADD; border-radius: 5px; cursor: pointer;">
                            üìä View Paths
                        </button>
                    </div>
                </div>

                <!-- Scanner -->
                <div class="stat-card" style="grid-column: 1 / -1;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h4 style="color: #00AADD; margin: 0;">üîç Opportunity Scanner</h4>
                        <button onclick="scanGeminiTriangular()" style="padding: 10px 20px; background: #00AADD; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;">
                            üîç Scan Opportunities
                        </button>
                    </div>
                    <div id="geminiScanResults" style="color: #888; font-size: 14px;">
                        Click "Scan Opportunities" to find profitable triangular arbitrage paths.
                    </div>
                </div>

                <!-- Opportunities Display -->
                <div class="stat-card" style="grid-column: 1 / -1;">
                    <h4 style="color: #00AADD; margin-bottom: 15px;">üí∞ Live Opportunities</h4>
                    <div id="geminiOpportunities" style="max-height: 400px; overflow-y: auto;">
                        <div style="color: #888; font-size: 14px; text-align: center; padding: 20px;">
                            No opportunities found yet. Run a scan to discover profitable paths.
                        </div>
                    </div>
                </div>

                <!-- Trade History -->
                <div class="stat-card" style="grid-column: 1 / -1;">
                    <h4 style="color: #00AADD; margin-bottom: 15px;">üìú Recent Trades</h4>
                    <div id="geminiTradeHistory" style="color: #888; font-size: 14px;">
                        No trade history available.
                    </div>
                </div>
            </div>
        </div>

        <!-- Coincatch Exchange (FINAL EXCHANGE - 21/21) -->
        <div style="background: rgba(255,87,34,0.1); padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 2px solid #FF5722;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <h3 style="color: #FF5722; margin: 0;">üéØ Coincatch Triangular Arbitrage</h3>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <span style="color: #b8c6db; font-size: 0.9rem;">Live Trading:</span>
                    <div class="toggle-switch" id="coincatchTriangularEnabled">
                        <div class="toggle-knob"></div>
                    </div>
                    <span id="coincatchTriangularStatus" style="color: #ff6b6b; font-weight: 600; font-size: 0.9rem;">OFF</span>
                </div>
            </div>
            <p style="color: #888; margin: 0 0 10px 0; font-size: 14px;">
                129 spot pairs | Limited cross pairs | 32 paths (mixed 3-leg & 4-leg) | HMAC-SHA256 + Passphrase | 0.1% fees
            </p>

            <div style="margin-top: 20px; display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                <!-- Status Card -->
                <div class="stat-card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <h4 style="color: #FF5722; margin: 0;">üìä Status</h4>
                        <button onclick="testCoincatchTriangularConnection()" style="padding: 6px 12px; background: #FF5722; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 12px;">
                            Test Connection
                        </button>
                    </div>
                    <div id="coincatchStatus" style="color: #888; font-size: 14px;">Not connected</div>
                    <div id="coincatchBalance" style="color: #888; font-size: 14px; margin-top: 5px;"></div>
                </div>

                <!-- Risk Management -->
                <div class="stat-card">
                    <h4 style="color: #FF5722; margin-bottom: 10px;">‚öôÔ∏è Risk Settings</h4>
                    <div style="margin-bottom: 10px;">
                        <label style="color: #888; font-size: 12px; display: block; margin-bottom: 5px;">Min Profit %</label>
                        <input type="number" id="coincatchMinProfit" value="0.5" step="0.1" style="width: 100%; padding: 8px; background: rgba(255,255,255,0.05); border: 1px solid #555; border-radius: 5px; color: white; font-size: 14px;">
                    </div>
                    <div>
                        <label style="color: #888; font-size: 12px; display: block; margin-bottom: 5px;">Max Investment ($)</label>
                        <input type="number" id="coincatchMaxInvestment" value="1000" step="100" style="width: 100%; padding: 8px; background: rgba(255,255,255,0.05); border: 1px solid #555; border-radius: 5px; color: white; font-size: 14px;">
                    </div>
                </div>

                <!-- Path Selection -->
                <div class="stat-card" style="grid-column: 1 / -1;">
                    <h4 style="color: #FF5722; margin-bottom: 15px;">üõ§Ô∏è Path Selection (32 paths - mixed 3-leg & 4-leg)</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                        <label style="display: flex; align-items: center; color: #888; cursor: pointer;">
                            <input type="checkbox" id="coincatch_SET_1" checked style="margin-right: 8px; width: 16px; height: 16px;">
                            <span>SET 1: BTC-ETH Direct (2 paths)</span>
                        </label>
                        <label style="display: flex; align-items: center; color: #888; cursor: pointer;">
                            <input type="checkbox" id="coincatch_SET_2" checked style="margin-right: 8px; width: 16px; height: 16px;">
                            <span>SET 2: GMT-BTC Bridge (2 paths)</span>
                        </label>
                        <label style="display: flex; align-items: center; color: #888; cursor: pointer;">
                            <input type="checkbox" id="coincatch_SET_3" checked style="margin-right: 8px; width: 16px; height: 16px;">
                            <span>SET 3: Major 4-Leg (8 paths)</span>
                        </label>
                        <label style="display: flex; align-items: center; color: #888; cursor: pointer;">
                            <input type="checkbox" id="coincatch_SET_4" checked style="margin-right: 8px; width: 16px; height: 16px;">
                            <span>SET 4: Altcoin 4-Leg (10 paths)</span>
                        </label>
                        <label style="display: flex; align-items: center; color: #888; cursor: pointer;">
                            <input type="checkbox" id="coincatch_SET_5" checked style="margin-right: 8px; width: 16px; height: 16px;">
                            <span>SET 5: Extended 4-Leg (10 paths)</span>
                        </label>
                    </div>
                    <div style="margin-top: 15px; display: flex; gap: 10px;">
                        <button onclick="saveCoincatchSettings()" style="flex: 1; padding: 10px; background: rgba(255,87,34,0.2); color: #FF5722; border: 1px solid #FF5722; border-radius: 5px; cursor: pointer;">
                            üíæ Save Settings
                        </button>
                        <button onclick="loadCoincatchSettings()" style="flex: 1; padding: 10px; background: rgba(255,87,34,0.2); color: #FF5722; border: 1px solid #FF5722; border-radius: 5px; cursor: pointer;">
                            üì• Load Settings
                        </button>
                        <button onclick="viewCoincatchPathDetails()" style="flex: 1; padding: 10px; background: rgba(255,87,34,0.2); color: #FF5722; border: 1px solid #FF5722; border-radius: 5px; cursor: pointer;">
                            üìä View Paths
                        </button>
                    </div>
                </div>

                <!-- Scanner -->
                <div class="stat-card" style="grid-column: 1 / -1;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h4 style="color: #FF5722; margin: 0;">üîç Opportunity Scanner</h4>
                        <button onclick="scanCoincatchTriangular()" style="padding: 10px 20px; background: #FF5722; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;">
                            üîç Scan Opportunities
                        </button>
                    </div>
                    <div id="coincatchScanResults" style="color: #888; font-size: 14px;">
                        Click "Scan Opportunities" to find profitable triangular arbitrage paths.
                    </div>
                </div>

                <!-- Opportunities Display -->
                <div class="stat-card" style="grid-column: 1 / -1;">
                    <h4 style="color: #FF5722; margin-bottom: 15px;">üí∞ Live Opportunities</h4>
                    <div id="coincatchOpportunities" style="max-height: 400px; overflow-y: auto;">
                        <div style="color: #888; font-size: 14px; text-align: center; padding: 20px;">
                            No opportunities found yet. Run a scan to discover profitable paths.
                        </div>
                    </div>
                </div>

                <!-- Trade History -->
                <div class="stat-card" style="grid-column: 1 / -1;">
                    <h4 style="color: #FF5722; margin-bottom: 15px;">üìú Recent Trades</h4>
                    <div id="coincatchTradeHistory" style="color: #888; font-size: 14px;">
                        No trade history available.
                    </div>
                </div>
            </div>
        </div>

        <!-- Coinbase Exchange -->
        <div style="background: rgba(0,82,255,0.1); padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 2px solid #0052FF; position: relative; opacity: 0.5; pointer-events: none;">
            <!-- Coming Soon Overlay -->
            <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.7); border-radius: 15px; display: flex; align-items: center; justify-content: center; z-index: 10; pointer-events: none;">
                <div style="text-align: center; color: white;">
                    <h2 style="font-size: 2.5rem; margin: 0 0 10px 0; color: #FFD700;">üöß COMING SOON üöß</h2>
                    <p style="font-size: 1.2rem; margin: 0; color: #b8c6db;">Coinbase integration in development</p>
                </div>
            </div>

            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="color: #0052FF; margin: 0;">üîµ COINBASE Triangular Arbitrage (USDC)</h3>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div class="toggle-switch" id="coinbaseTriangularEnabled" onclick="toggleCoinbaseTriangular()">
                        <div class="toggle-knob"></div>
                    </div>
                    <span id="coinbaseTriangularStatus" style="color: #ff6b6b; font-weight: 600;">OFF</span>
                </div>
            </div>

            <div class="stat-grid">
                <!-- Risk Management -->
                <div class="stat-card">
                    <h4 style="color: #0052FF; margin-bottom: 15px;">‚öñÔ∏è Risk Management</h4>
                    <div class="form-group" style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 500;">Max Trade (USDC)</label>
                        <input type="number" id="coinbaseMaxTrade" value="100" min="10" max="10000" step="10"
                               style="width: 100%; padding: 8px; border: 1px solid #0052FF; border-radius: 5px; background: rgba(0,82,255,0.05);">
                    </div>
                    <div class="form-group" style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 500;">Portfolio % per Trade</label>
                        <input type="number" id="coinbasePortfolioPercent" value="10" min="1" max="50" step="1"
                               style="width: 100%; padding: 8px; border: 1px solid #0052FF; border-radius: 5px; background: rgba(0,82,255,0.05);">
                    </div>
                    <div class="form-group">
                        <label style="display: block; margin-bottom: 5px; font-weight: 500;">Min Profit % Threshold</label>
                        <input type="number" id="coinbaseProfitThreshold" value="0.5" min="0.1" max="5" step="0.1"
                               style="width: 100%; padding: 8px; border: 1px solid #0052FF; border-radius: 5px; background: rgba(0,82,255,0.05);">
                    </div>
                </div>

                <!-- Path Sets Configuration -->
                <div class="stat-card">
                    <h4 style="color: #0052FF; margin-bottom: 15px;">üéØ Triangular Path Sets (32 Paths)</h4>
                    <div style="display: flex; flex-direction: column; gap: 10px;">
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="checkbox" id="coinbaseSet1Enabled" checked style="margin-right: 10px; width: 18px; height: 18px;">
                            <span><strong>SET 1:</strong> Essential ETH Bridge (7 paths) - BTC, SOL, XRP, ADA, DOT, MATIC, LINK</span>
                        </label>
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="checkbox" id="coinbaseSet2Enabled" checked style="margin-right: 10px; width: 18px; height: 18px;">
                            <span><strong>SET 2:</strong> Mid-Cap BTC Bridge (7 paths) - ETH, SOL, AVAX, ATOM, LTC, UNI, ALGO</span>
                        </label>
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="checkbox" id="coinbaseSet3Enabled" style="margin-right: 10px; width: 18px; height: 18px;">
                            <span><strong>SET 3:</strong> DeFi Native (6 paths) - AAVE, COMP, MKR, SNX, CRV, SUSHI</span>
                        </label>
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="checkbox" id="coinbaseSet4Enabled" style="margin-right: 10px; width: 18px; height: 18px;">
                            <span><strong>SET 4:</strong> High Volatility (6 paths) - DOGE, SHIB, APE, GALA, SAND, MANA</span>
                        </label>
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="checkbox" id="coinbaseSet5Enabled" style="margin-right: 10px; width: 18px; height: 18px;">
                            <span><strong>SET 5:</strong> Extended Multi-Bridge (6 paths) - FIL, GRT, ICP, CHZ, ENJ + 4-leg path</span>
                        </label>
                    </div>
                </div>

                <!-- Actions -->
                <div class="stat-card">
                    <h4 style="color: #0052FF; margin-bottom: 15px;">üîß Actions</h4>
                    <button onclick="testCoinbaseTriangularConnection()" class="btn" style="background: #0052FF; width: 100%; margin-bottom: 10px;">
                        üîå Test Connection
                    </button>
                    <button onclick="scanCoinbaseTriangularPaths()" class="btn" style="background: #0052FF; width: 100%; margin-bottom: 10px;">
                        üîç Scan Opportunities
                    </button>
                    <button onclick="viewCoinbasePathDetails()" class="btn" style="background: #666; width: 100%; margin-bottom: 10px;">
                        üìã View All Paths
                    </button>
                    <button onclick="clearCoinbaseTriangularHistory()" class="btn" style="background: #ff6b6b; width: 100%; margin-bottom: 10px;">
                        üóëÔ∏è Clear History
                    </button>
                    <button onclick="saveCoinbaseTriangularSettings()" class="btn" style="background: #4CAF50; width: 100%;">
                        üíæ Save Settings
                    </button>
                </div>

                <!-- Current Opportunities -->
                <div class="stat-card" style="grid-column: span 2;">
                    <h4 style="color: #0052FF; margin-bottom: 15px;">üí∞ Current Opportunities</h4>
                    <div id="coinbaseOpportunities" style="max-height: 400px; overflow-y: auto;">
                        <p style="color: #888; text-align: center; padding: 20px;">
                            Click "Scan Opportunities" to find triangular arbitrage paths
                        </p>
                    </div>
                </div>
            </div>
        </div>


        <!-- All 21 Exchanges Complete! -->
        <div style="background: linear-gradient(135deg, rgba(0,255,0,0.1) 0%, rgba(0,170,255,0.1) 100%); padding: 30px; border-radius: 15px; border: 2px solid #00FF00; text-align: center;">
            <h2 style="color: #00FF00; margin: 0 0 15px 0;">üéâ All 21 Exchanges Implemented!</h2>
            <p style="color: #888; margin: 0 0 20px 0; font-size: 16px;">
                Triangular arbitrage functionality is now available across all supported exchanges.
            </p>
            <div style="display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; margin-top: 20px;">
                <span style="background: rgba(0,255,0,0.1); color: #00FF00; padding: 10px 20px; border: 1px solid #00FF00; border-radius: 20px; font-weight: bold;">‚úÖ 21/21 Complete</span>
                <span style="background: rgba(0,170,255,0.1); color: #00AAFF; padding: 10px 20px; border: 1px solid #00AAFF; border-radius: 20px;">600+ Triangular Paths</span>
                <span style="background: rgba(255,170,0,0.1); color: #FFAA00; padding: 10px 20px; border: 1px solid #FFAA00; border-radius: 20px;">Real-time Scanning</span>
            </div>
        </div>
    </div>

    <script>
        // API Base URL Configuration
        const API_BASE = '/api/v1';

        // Return to Platform Function
        function returnToPlatform() {
            // Set triangular toggle state to OFF
            localStorage.setItem('triangularPageActive', 'false');

            // Navigate back to main platform
            window.location.href = '/';
        }

        // Notification Utility Function
        function showNotification(message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 25px;
                border-radius: 8px;
                color: white;
                font-weight: bold;
                z-index: 10000;
                animation: slideIn 0.3s ease-out;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            `;

            // Set background color based on type
            const colors = {
                success: '#00FF00',
                error: '#FF0000',
                warning: '#FFA500',
                info: '#00AADD'
            };
            notification.style.background = colors[type] || colors.info;
            notification.textContent = message;

            // Add to page
            document.body.appendChild(notification);

            // Remove after 3 seconds
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-in';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // Triangular Arbitrage JavaScript Functions

        // ============================================================================
        // VALR AUTOMATED WORKER
        // ============================================================================

        // Map SET_1, SET_2, etc. to backend set names (Only 12 valid ZAR-USDT triangular sets)
        const setNameMapping = {
            'SET_1': 'SET_1_ETH_FOCUS',
            'SET_2': 'SET_2_XRP_FOCUS',
            'SET_3': 'SET_3_SOL_FOCUS',
            'SET_4': 'SET_4_BNB_FOCUS',
            'SET_5': 'SET_5_SHIB_FOCUS',
            'SET_6': 'SET_6_AVAX_FOCUS',
            'SET_7': 'SET_7_DOGE_FOCUS',
            'SET_8': 'SET_8_TRX_FOCUS',
            'SET_9': 'SET_9_LTC_FOCUS',
            'SET_10': 'SET_10_RLUSD_FOCUS',
            'SET_11': 'SET_11_LINK_FOCUS',
            'SET_12': 'SET_12_XLM_FOCUS'
        };

        let valrWorkerInterval = null;
        let valrWorkerStats = {
            totalScans: 0,
            totalOpportunities: 0,
            totalTrades: 0,
            successfulTrades: 0,
            totalProfit: 0,
            bestPath: null,
            bestProfit: 0
        };

        // Balance tracking
        let valrBalanceTracking = {
            startingZAR: null,
            startingUSDT: null,
            currentZAR: 0,
            currentUSDT: 0
        };

        // Alerts tracking
        let valrAlerts = [];
        const MAX_ALERTS = 20; // Keep last 20 alerts

        // ========== TAB SWITCHING ==========
        // Handle tab switching
        document.addEventListener('DOMContentLoaded', function() {
            const tabButtons = document.querySelectorAll('.valr-tab-btn');
            tabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    switchValrTab(tabName);
                });
            });
        });

        function switchValrTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.valr-tab-content').forEach(content => {
                content.style.display = 'none';
            });

            // Remove active class from all buttons and reset styling
            document.querySelectorAll('.valr-tab-btn').forEach(btn => {
                btn.style.background = 'rgba(255,255,255,0.03)';
                btn.style.borderColor = 'transparent';
                btn.style.color = '#888';
                btn.classList.remove('active');
            });

            // Show selected tab content
            if (tabName === 'trades') {
                document.getElementById('valrTabTrades').style.display = 'block';
            } else if (tabName === 'balance') {
                document.getElementById('valrTabBalance').style.display = 'block';
            } else if (tabName === 'alerts') {
                document.getElementById('valrTabAlerts').style.display = 'block';
            }

            // Highlight active button with enhanced styling
            const activeButton = document.querySelector(`.valr-tab-btn[data-tab="${tabName}"]`);
            if (activeButton) {
                activeButton.style.background = 'rgba(0,255,136,0.15)';
                activeButton.style.borderColor = '#00ff88';
                activeButton.style.color = '#00ff88';
                activeButton.classList.add('active');
            }
        }

        // ========== BALANCE TRACKING ==========
        async function initializeValrBalance(apiKey, apiSecret) {
            try {
                // Fetch current balance from VALR (same endpoint as Strategy API Setup page)
                const response = await fetch(`${API_BASE}/trading/valr/balance`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ apiKey, apiSecret })
                });

                const result = await response.json();
                console.log('üí∞ [VALR Balance] API Response:', result);

                // Handle different response formats
                let balances = null;
                if (result.success && result.data) {
                    balances = result.data.balances || result.data;
                } else if (result.success && result.balances) {
                    balances = result.balances;
                } else if (result.balances) {
                    balances = result.balances;
                }

                console.log('üí∞ [VALR Balance] Parsed balances:', balances);

                if (balances) {
                    // Balances is an object like { ZAR: "5000.50", USDT: "123.45", ... }
                    const currentZAR = balances.ZAR ? parseFloat(balances.ZAR) : 0;
                    const currentUSDT = balances.USDT ? parseFloat(balances.USDT) : 0;

                    // Check if starting balance is already set (from localStorage)
                    const stored = localStorage.getItem('valrStartingBalance');
                    if (stored) {
                        const parsed = JSON.parse(stored);
                        valrBalanceTracking.startingZAR = parsed.zar;
                        valrBalanceTracking.startingUSDT = parsed.usdt;
                    } else {
                        // First time - set current as starting
                        valrBalanceTracking.startingZAR = currentZAR;
                        valrBalanceTracking.startingUSDT = currentUSDT;
                        localStorage.setItem('valrStartingBalance', JSON.stringify({
                            zar: currentZAR,
                            usdt: currentUSDT
                        }));
                    }

                    valrBalanceTracking.currentZAR = currentZAR;
                    valrBalanceTracking.currentUSDT = currentUSDT;

                    updateValrBalanceDisplay();
                    console.log('‚úÖ [VALR Balance] Initialized:', valrBalanceTracking);
                }
            } catch (error) {
                console.error('‚ùå [VALR Balance] Failed to initialize:', error);
            }
        }

        async function updateValrBalance(apiKey, apiSecret) {
            try {
                const response = await fetch(`${API_BASE}/trading/valr/balance`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ apiKey, apiSecret })
                });

                const result = await response.json();

                // Handle different response formats
                let balances = null;
                if (result.success && result.data) {
                    balances = result.data.balances || result.data;
                } else if (result.success && result.balances) {
                    balances = result.balances;
                } else if (result.balances) {
                    balances = result.balances;
                }

                if (balances) {
                    valrBalanceTracking.currentZAR = balances.ZAR ? parseFloat(balances.ZAR) : 0;
                    valrBalanceTracking.currentUSDT = balances.USDT ? parseFloat(balances.USDT) : 0;

                    updateValrBalanceDisplay();
                }
            } catch (error) {
                console.error('‚ùå [VALR Balance] Update failed:', error);
            }
        }

        function updateValrBalanceDisplay() {
            // Update starting balances
            document.getElementById('valrStartingZAR').textContent = `R ${valrBalanceTracking.startingZAR?.toFixed(2) || '0.00'}`;
            document.getElementById('valrStartingUSDT').textContent = `$${valrBalanceTracking.startingUSDT?.toFixed(2) || '0.00'}`;

            // Update current balances
            document.getElementById('valrCurrentZAR').textContent = `R ${valrBalanceTracking.currentZAR.toFixed(2)}`;
            document.getElementById('valrCurrentUSDT').textContent = `$${valrBalanceTracking.currentUSDT.toFixed(2)}`;

            // Calculate and display changes
            if (valrBalanceTracking.startingZAR) {
                const zarChange = valrBalanceTracking.currentZAR - valrBalanceTracking.startingZAR;
                const zarChangePercent = (zarChange / valrBalanceTracking.startingZAR * 100).toFixed(2);
                const zarColor = zarChange >= 0 ? '#00ff00' : '#ff4444';
                const zarSign = zarChange >= 0 ? '+' : '';
                document.getElementById('valrChangeZAR').innerHTML = `<span style="color: ${zarColor}">${zarSign}R ${zarChange.toFixed(2)} (${zarSign}${zarChangePercent}%)</span>`;
            }

            if (valrBalanceTracking.startingUSDT) {
                const usdtChange = valrBalanceTracking.currentUSDT - valrBalanceTracking.startingUSDT;
                const usdtChangePercent = (usdtChange / valrBalanceTracking.startingUSDT * 100).toFixed(2);
                const usdtColor = usdtChange >= 0 ? '#00ff00' : '#ff4444';
                const usdtSign = usdtChange >= 0 ? '+' : '';
                document.getElementById('valrChangeUSDT').innerHTML = `<span style="color: ${usdtColor}">${usdtSign}$${usdtChange.toFixed(2)} (${usdtSign}${usdtChangePercent}%)</span>`;
            }

            // Update last updated time
            document.getElementById('valrBalanceLastUpdate').textContent = new Date().toLocaleTimeString();
        }

        function resetValrStartingBalance() {
            if (confirm('Reset starting balance to current balance? This will set your profit/loss tracking to zero.')) {
                valrBalanceTracking.startingZAR = valrBalanceTracking.currentZAR;
                valrBalanceTracking.startingUSDT = valrBalanceTracking.currentUSDT;
                localStorage.setItem('valrStartingBalance', JSON.stringify({
                    zar: valrBalanceTracking.startingZAR,
                    usdt: valrBalanceTracking.startingUSDT
                }));
                updateValrBalanceDisplay();
                showNotification('‚úÖ Starting balance reset successfully', 'success');
            }
        }

        // ========== ALERTS MANAGEMENT ==========
        function addValrAlert(type, message, details = {}) {
            const alert = {
                id: Date.now(),
                type: type, // 'balance', 'slippage', 'execution', 'other'
                message: message,
                details: details,
                timestamp: new Date()
            };

            valrAlerts.unshift(alert); // Add to beginning

            // Keep only last MAX_ALERTS
            if (valrAlerts.length > MAX_ALERTS) {
                valrAlerts = valrAlerts.slice(0, MAX_ALERTS);
            }

            updateValrAlertsDisplay();
        }

        function updateValrAlertsDisplay() {
            const alertsList = document.getElementById('valrAlertsList');
            const badge = document.getElementById('valrAlertBadge');

            // Update badge count
            if (valrAlerts.length > 0) {
                badge.textContent = valrAlerts.length;
                badge.style.display = 'inline-block';
            } else {
                badge.style.display = 'none';
            }

            // Display alerts
            if (valrAlerts.length === 0) {
                alertsList.innerHTML = '<div style="text-align: center; color: #888; padding: 20px;">No alerts. Worker running smoothly. ‚úÖ</div>';
                return;
            }

            let html = '';
            valrAlerts.forEach(alert => {
                const icon = alert.type === 'balance' ? '‚ö†Ô∏è' :
                            alert.type === 'slippage' ? 'üìä' :
                            alert.type === 'execution' ? '‚ùå' : '‚ö°';
                const color = alert.type === 'balance' ? '#ff9800' : '#ff4444';

                html += `
                    <div style="background: rgba(255,255,255,0.05); padding: 12px; border-radius: 8px; border-left: 4px solid ${color}; margin-bottom: 10px;">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px;">
                            <div style="color: ${color}; font-weight: bold; font-size: 0.9rem;">
                                ${icon} ${alert.message}
                            </div>
                            <button onclick="dismissValrAlert(${alert.id})" style="background: none; border: none; color: #888; cursor: pointer; font-size: 1.2rem; padding: 0; line-height: 1;">√ó</button>
                        </div>
                        <div style="color: #888; font-size: 0.85rem; margin-bottom: 5px;">
                            ${alert.timestamp.toLocaleTimeString()}
                        </div>
                        ${alert.details.path ? `<div style="color: #00ff88; font-size: 0.85rem;">Path: ${alert.details.path}</div>` : ''}
                        ${alert.details.required ? `<div style="color: #888; font-size: 0.85rem;">Required: ${alert.details.required} | Available: ${alert.details.available}</div>` : ''}
                        ${alert.details.shortfall ? `<div style="color: #ff4444; font-size: 0.85rem;">Shortfall: ${alert.details.shortfall}</div>` : ''}
                        ${alert.details.suggestion ? `<div style="color: #888; font-size: 0.85rem; margin-top: 5px;">üí° ${alert.details.suggestion}</div>` : ''}
                    </div>
                `;
            });

            alertsList.innerHTML = html;
        }

        function dismissValrAlert(alertId) {
            valrAlerts = valrAlerts.filter(a => a.id !== alertId);
            updateValrAlertsDisplay();
        }

        function clearValrAlerts() {
            if (valrAlerts.length === 0) return;
            if (confirm('Clear all alerts?')) {
                valrAlerts = [];
                updateValrAlertsDisplay();
            }
        }

        // ========== ERROR CATEGORIZATION ==========
        function categorizeValrError(errorMessage) {
            if (!errorMessage) return 'other';

            const msg = errorMessage.toLowerCase();

            if (msg.includes('insufficient') && (msg.includes('balance') || msg.includes('zar') || msg.includes('usdt'))) {
                return 'balance';
            } else if (msg.includes('slippage')) {
                return 'slippage';
            } else if (msg.includes('execution') || msg.includes('order') || msg.includes('trade')) {
                return 'execution';
            } else {
                return 'other';
            }
        }

        function handleValrExecutionError(error, opportunity) {
            const errorType = categorizeValrError(error.message);

            console.error(`‚ùå [VALR Worker] Execution failed (${errorType}):`, error.message);

            if (errorType === 'balance') {
                // Parse balance info from error message
                const match = error.message.match(/need [R$]([\d,.]+).*have [R$]([\d,.]+)/i);
                const currency = error.message.includes('ZAR') ? 'ZAR' : 'USDT';

                let required = 'Unknown';
                let available = 'Unknown';
                let shortfall = 'Unknown';

                if (match) {
                    required = currency === 'ZAR' ? `R ${match[1]}` : `$${match[1]}`;
                    available = currency === 'ZAR' ? `R ${match[2]}` : `$${match[2]}`;
                    const reqNum = parseFloat(match[1].replace(',', ''));
                    const availNum = parseFloat(match[2].replace(',', ''));
                    const shortfallNum = reqNum - availNum;
                    shortfall = currency === 'ZAR' ? `R ${shortfallNum.toFixed(2)}` : `$${shortfallNum.toFixed(2)}`;
                }

                addValrAlert(
                    'balance',
                    `Insufficient ${currency} Balance`,
                    {
                        path: opportunity.pathId,
                        profitPercent: opportunity.netProfitPercent?.toFixed(2) + '%',
                        required: required,
                        available: available,
                        shortfall: shortfall,
                        suggestion: `Top up ${currency} balance or reduce "Max Single Trade" amount`
                    }
                );

                showNotification(
                    `‚ö†Ô∏è Insufficient ${currency} - Opportunity skipped\nShortfall: ${shortfall}\nWorker continues scanning...`,
                    'warning',
                    8000
                );

            } else if (errorType === 'slippage') {
                addValrAlert(
                    'slippage',
                    'High Slippage Detected',
                    {
                        path: opportunity.pathId,
                        suggestion: 'Market moved too quickly. Worker continues scanning...'
                    }
                );

                showNotification(
                    'üìä Slippage too high - Opportunity skipped\nWorker continues scanning...',
                    'warning',
                    5000
                );

            } else {
                addValrAlert(
                    'execution',
                    'Execution Failed',
                    {
                        path: opportunity.pathId,
                        error: error.message,
                        suggestion: 'Check exchange API status or reduce trade size'
                    }
                );

                showNotification(
                    `‚ùå Trade execution failed\n${error.message}\nWorker continues scanning...`,
                    'error',
                    8000
                );
            }
        }

        async function startValrWorker() {
            console.log('üöÄ [VALR Worker] Starting automated trading (sequential mode)...');

            // Read settings from card
            const apiKey = localStorage.getItem('valr_triangular_api');
            const apiSecret = localStorage.getItem('valr_triangular_secret');
            const profitThreshold = parseFloat(document.getElementById('valrProfitThreshold')?.value) || 0.8;
            const maxTradeAmount = parseFloat(document.getElementById('valrMaxTrade')?.value) || 500;

            // Get selected path sets (only 12 valid sets)
            const selectedSets = [];
            for (let i = 1; i <= 12; i++) {
                const checkbox = document.getElementById(`valrSet${i}Enabled`);
                if (checkbox && checkbox.checked) {
                    selectedSets.push(`SET_${i}`);
                }
            }

            if (selectedSets.length === 0) {
                console.error('‚ùå [VALR Worker] No sets selected!');
                return;
            }

            console.log(`üìä [VALR Worker] Configuration:`, {
                profitThreshold: `${profitThreshold}%`,
                maxTradeAmount: `R ${maxTradeAmount}`,
                selectedSets: selectedSets.length,
                scanMode: 'Sequential (one set at a time)'
            });

            // Initialize balance tracking
            await initializeValrBalance(apiKey, apiSecret);

            let currentSetIndex = 0;

            // Sequential scan-and-execute function (one set per call)
            async function scanAndExecuteSequential() {
                try {
                    // Get current set to scan
                    const currentSet = selectedSets[currentSetIndex];
                    const backendSetName = setNameMapping[currentSet] || currentSet;
                    valrWorkerStats.totalScans++;

                    console.log(`\nüîç [VALR Worker] Scan #${valrWorkerStats.totalScans}: ${currentSet} (${currentSetIndex + 1}/${selectedSets.length})`);

                    // Get risk settings from UI
                    const portfolioPercent = parseFloat(document.getElementById('valrPortfolioPercent')?.value || 10);
                    const profitThresholdUI = parseFloat(document.getElementById('valrProfitThreshold')?.value || 0.5);

                    // Get current balances (from balance tracking)
                    const currentBalanceUSDT = valrBalanceTracking.currentUSDT || 0;
                    const currentBalanceZAR = valrBalanceTracking.currentZAR || 0;

                    // 1. Scan ONE set only
                    const scanResponse = await fetch(`${API_BASE}/trading/valr/triangular/scan`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            apiKey,
                            apiSecret,
                            scanSet: backendSetName,  // Backend expects scanSet with full name
                            amount: maxTradeAmount,
                            maxTradeAmount: maxTradeAmount,
                            profitThreshold: profitThresholdUI,
                            portfolioPercent: portfolioPercent,
                            currentBalanceUSDT: currentBalanceUSDT,
                            currentBalanceZAR: currentBalanceZAR
                        })
                    });

                    const scanResult = await scanResponse.json();

                    if (scanResult.success && scanResult.data && scanResult.data.opportunities) {
                        const paths = scanResult.data.opportunities;
                        console.log(`‚úÖ [VALR Worker] ${currentSet}: Analyzed ${paths.length} paths`);

                        // Log detailed profit for each path
                        paths.forEach((path, index) => {
                            const profitSign = path.netProfitPercent >= 0 ? '+' : '';
                            const profitColor = path.netProfitPercent >= profitThreshold ? 'üíö' :
                                              path.netProfitPercent >= 0 ? 'üíõ' : '‚ùå';
                            const status = path.netProfitPercent >= profitThreshold ? 'OPPORTUNITY' :
                                         path.netProfitPercent >= 0 ? 'below threshold' : 'unprofitable';
                            console.log(`   ${profitColor} Path ${index + 1}: ${profitSign}${path.netProfitPercent.toFixed(2)}% (${status})`);
                        });

                        // 2. Filter by profit threshold
                        const profitable = paths.filter(
                            opp => opp.netProfitPercent >= profitThreshold
                        );

                        valrWorkerStats.totalOpportunities += profitable.length;

                        if (profitable.length > 0) {
                            console.log(`üí∞ [VALR Worker] ${currentSet}: ${profitable.length} OPPORTUNITIES above ${profitThreshold}% threshold`);

                            // 3. Execute each profitable opportunity immediately
                            for (const opportunity of profitable) {
                                console.log(`‚ö° [VALR Worker] Executing: ${opportunity.pathId} (${opportunity.netProfitPercent.toFixed(2)}% profit)`);

                                try {
                                    const execResponse = await fetch(`${API_BASE}/trading/valr/triangular/execute`, {
                                        method: 'POST',
                                        headers: { 'Content-Type': 'application/json' },
                                        body: JSON.stringify({
                                            apiKey,
                                            apiSecret,
                                            pathId: opportunity.pathId,
                                            amount: maxTradeAmount,
                                            simulate: false  // LIVE TRADING
                                        })
                                    });

                                    const execResult = await execResponse.json();

                                    if (execResult.success && execResult.data) {
                                        valrWorkerStats.totalTrades++;
                                        valrWorkerStats.successfulTrades++;

                                        const profit = execResult.data.execution?.netProfit || 0;
                                        valrWorkerStats.totalProfit += profit;

                                        // Track best path
                                        if (profit > valrWorkerStats.bestProfit) {
                                            valrWorkerStats.bestProfit = profit;
                                            valrWorkerStats.bestPath = opportunity.pathId;
                                        }

                                        console.log(`‚úÖ [VALR Worker] Trade executed successfully! Profit: R ${profit.toFixed(2)}`);

                                        // Add to recent trades display
                                        addValrTradeToHistory({
                                            pathId: opportunity.pathId,
                                            profit: profit,
                                            profitPercent: opportunity.netProfitPercent,
                                            timestamp: new Date(),
                                            success: true
                                        });
                                    } else {
                                        // Execution failed - use new error handler
                                        valrWorkerStats.totalTrades++;
                                        handleValrExecutionError({ message: execResult.message || 'Unknown error' }, opportunity);

                                        // Log failed trade
                                        addValrTradeToHistory({
                                            pathId: opportunity.pathId,
                                            profit: 0,
                                            profitPercent: 0,
                                            timestamp: new Date(),
                                            success: false,
                                            error: execResult.message
                                        });
                                    }
                                } catch (execError) {
                                    valrWorkerStats.totalTrades++;
                                    handleValrExecutionError(execError, opportunity);
                                }

                                // Brief delay between executions (respect rate limits)
                                await new Promise(resolve => setTimeout(resolve, 300));
                            }
                        } else {
                            console.log(`‚ÑπÔ∏è [VALR Worker] ${currentSet}: No opportunities (all ${paths.length} paths below ${profitThreshold}% threshold)`);
                        }
                    } else {
                        console.log(`‚ÑπÔ∏è [VALR Worker] ${currentSet}: No paths found`);
                    }

                    // Update displays
                    updateValrStatsDisplay();
                    await updateValrBalance(apiKey, apiSecret);

                    // Move to next set (rotate through all selected sets)
                    currentSetIndex = (currentSetIndex + 1) % selectedSets.length;

                    if (currentSetIndex === 0) {
                        console.log(`üîÑ [VALR Worker] Completed full cycle of ${selectedSets.length} sets. Restarting...`);
                    }

                } catch (error) {
                    console.error('‚ùå [VALR Worker] Scan error:', error);
                    // Still move to next set even on error
                    currentSetIndex = (currentSetIndex + 1) % selectedSets.length;
                }
            }

            // Run immediately, then every 8 seconds
            await scanAndExecuteSequential();
            valrWorkerInterval = setInterval(scanAndExecuteSequential, 8000);

            console.log('‚úÖ [VALR Worker] Automated trading started (8s between sets, sequential scanning)');
        }

        function stopValrWorker() {
            if (valrWorkerInterval) {
                clearInterval(valrWorkerInterval);
                valrWorkerInterval = null;
                console.log('‚èπÔ∏è [VALR Worker] Automated trading stopped');
                console.log('üìä [VALR Worker] Final stats:', valrWorkerStats);
            }
        }

        function updateValrStatsDisplay() {
            // Update Performance Stats
            document.getElementById('valrTotalTrades').textContent = valrWorkerStats.totalTrades;
            document.getElementById('valrSuccessfulTrades').textContent = valrWorkerStats.successfulTrades;

            const successRate = valrWorkerStats.totalTrades > 0
                ? ((valrWorkerStats.successfulTrades / valrWorkerStats.totalTrades) * 100).toFixed(1)
                : '0';
            document.getElementById('valrSuccessRate').textContent = `${successRate}%`;

            document.getElementById('valrTotalProfit').textContent = `R ${valrWorkerStats.totalProfit.toFixed(2)}`;
            document.getElementById('valrBestPath').textContent = valrWorkerStats.bestPath || '-';
            document.getElementById('valrLastScan').textContent = new Date().toLocaleTimeString();
        }

        function addValrTradeToHistory(trade) {
            const tradesDiv = document.getElementById('valrRecentTrades');

            // Remove "no trades" message if it exists
            if (tradesDiv.querySelector('[style*="text-align: center"]')) {
                tradesDiv.innerHTML = '';
            }

            const borderColor = trade.success ? '#00ff88' : '#ff6b6b';
            const bgColor = trade.success ? 'rgba(0,255,136,0.05)' : 'rgba(255,107,107,0.05)';
            const profitColor = trade.success ? '#00ff88' : '#ff6b6b';

            const tradeDiv = document.createElement('div');
            tradeDiv.style.cssText = `padding: 10px; margin-bottom: 8px; background: ${bgColor}; border-left: 3px solid ${borderColor}; border-radius: 5px; font-size: 0.85rem;`;

            let content = `
                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                    <span style="color: ${profitColor}; font-weight: bold;">${trade.pathId}</span>
                    <span style="color: ${profitColor};">${trade.success ? '‚úÖ' : '‚ùå FAILED'}</span>
                </div>
            `;

            if (trade.success) {
                content += `
                    <div style="display: flex; justify-content: space-between; color: #b8c6db;">
                        <span>Profit: <strong style="color: ${profitColor};">R ${trade.profit.toFixed(2)}</strong> (${trade.profitPercent.toFixed(2)}%)</span>
                        <span>${trade.timestamp.toLocaleTimeString()}</span>
                    </div>
                `;
            } else {
                content += `
                    <div style="display: flex; justify-content: space-between; color: #b8c6db;">
                        <span style="color: #ff6b6b;">Execution failed - Rolled back</span>
                        <span>${trade.timestamp.toLocaleTimeString()}</span>
                    </div>
                    ${trade.error ? `<div style="color: #888; font-size: 0.75rem; margin-top: 5px;">Error: ${trade.error}</div>` : ''}
                `;
            }

            tradeDiv.innerHTML = content;

            // Add at the top
            tradesDiv.insertBefore(tradeDiv, tradesDiv.firstChild);

            // Keep only last 10 trades
            while (tradesDiv.children.length > 10) {
                tradesDiv.removeChild(tradesDiv.lastChild);
            }
        }

        // Toggle for VALR Triangular trading
        document.getElementById('valrTriangularEnabled').addEventListener('click', async function() {
            console.log('üîÑ [VALR] Toggle clicked');

            const willBeActive = !this.classList.contains('active');
            const status = document.getElementById('valrTriangularStatus');

            if (willBeActive) {
                // Check if credentials are configured before enabling
                const apiKey = localStorage.getItem('valr_triangular_api') || '';
                const apiSecret = localStorage.getItem('valr_triangular_secret') || '';

                if (!apiKey || !apiSecret) {
                    showNotification('‚ö†Ô∏è Please configure VALR API credentials in Strategic API Configuration first!', 'warning');
                    return; // Don't toggle
                }

                // Check if at least one path set is selected (only 12 valid sets)
                let hasSelectedPaths = false;
                for (let i = 1; i <= 12; i++) {
                    const checkbox = document.getElementById(`valrSet${i}Enabled`);
                    if (checkbox && checkbox.checked) {
                        hasSelectedPaths = true;
                        break;
                    }
                }

                if (!hasSelectedPaths) {
                    showNotification('‚ö†Ô∏è Please select at least one path set before enabling live trading!', 'warning');
                    return; // Don't toggle
                }

                console.log('‚úÖ [VALR] Live trading enabled');
                this.classList.add('active');
                status.textContent = 'ON';
                status.style.color = '#00ff88';
                localStorage.setItem('valrTriangularEnabled', 'true');

                // Start automated worker
                await startValrWorker();

                showNotification('‚úÖ VALR automated trading started! Worker scanning every 20 seconds.', 'success');
            } else {
                console.log('‚ùå [VALR] Live trading disabled');

                // Stop automated worker
                stopValrWorker();

                this.classList.remove('active');
                status.textContent = 'OFF';
                status.style.color = '#ff6b6b';
                localStorage.setItem('valrTriangularEnabled', 'false');
                showNotification('VALR automated trading stopped', 'info');
            }
        });

        // Load saved toggle state and auto-start worker if enabled
        document.addEventListener('DOMContentLoaded', async function() {
            const valrEnabled = localStorage.getItem('valrTriangularEnabled') === 'true';
            const toggle = document.getElementById('valrTriangularEnabled');
            const status = document.getElementById('valrTriangularStatus');

            // Initialize balance display if credentials exist (regardless of worker state)
            const apiKey = localStorage.getItem('valr_triangular_api');
            const apiSecret = localStorage.getItem('valr_triangular_secret');

            if (apiKey && apiSecret) {
                console.log('üí∞ [VALR Balance] Fetching balance on page load...');
                await initializeValrBalance(apiKey, apiSecret);
            }

            if (valrEnabled) {
                toggle.classList.add('active');
                status.textContent = 'ON';
                status.style.color = '#00ff88';

                // Auto-start worker if toggle was left ON
                if (apiKey && apiSecret) {
                    console.log('üîÑ [VALR] Auto-starting worker from saved state...');
                    await startValrWorker();
                }
            }
        });

        // ============================================================================
        // VALR TRIANGULAR ARBITRAGE FUNCTIONS (FULL IMPLEMENTATION)
        // ============================================================================

        // Test VALR Connection
        async function testValrTriangularConnection() {
            const apiKey = localStorage.getItem('valr_triangular_api') || '';
            const apiSecret = localStorage.getItem('valr_triangular_secret') || '';

            if (!apiKey || !apiSecret) {
                showNotification('Please set up VALR API credentials in Settings first', 'error');
                return;
            }

            document.getElementById('valrTriangularStatus').innerHTML = '<span style="color: #FFA500;">‚è≥ Testing connection...</span>';

            try {
                const response = await fetch(`${API_BASE}/trading/valr/triangular/test-connection`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    body: JSON.stringify({ apiKey, apiSecret })
                });

                const data = await response.json();

                if (data.success) {
                    document.getElementById('valrTriangularStatus').innerHTML = '<span style="color: #00FF00;">‚úÖ Connected</span>';
                    const balanceDiv = document.getElementById('valrTriangularBalance');
                    if (balanceDiv) {
                        balanceDiv.innerHTML = `USDT Balance: $${data.balance.available.toFixed(2)} / $${data.balance.total.toFixed(2)}`;
                    }
                    showNotification('VALR connection successful!', 'success');

                    // Auto-load trade history
                    await loadValrTradeHistory();
                } else {
                    document.getElementById('valrTriangularStatus').innerHTML = '<span style="color: #FF0000;">‚ùå Connection failed</span>';
                    showNotification(data.message || 'VALR connection failed', 'error');
                }
            } catch (error) {
                console.error('VALR connection error:', error);
                document.getElementById('valrTriangularStatus').innerHTML = '<span style="color: #FF0000;">‚ùå Error</span>';
                showNotification('Network error during connection test', 'error');
            }
        }

        // Scan for VALR Opportunities
        async function scanValrTriangularPaths() {
            const apiKey = localStorage.getItem('valr_triangular_api') || '';
            const apiSecret = localStorage.getItem('valr_triangular_secret') || '';

            if (!apiKey || !apiSecret) {
                showNotification('Please set up VALR API credentials and test connection first', 'error');
                return;
            }

            // Get selected sets
            const selectedSets = [];
            for (let i = 1; i <= 5; i++) {
                const checkbox = document.getElementById(`valrSet${i}Enabled`);
                if (checkbox && checkbox.checked) {
                    selectedSets.push(`SET_${i}`);
                }
            }

            if (selectedSets.length === 0) {
                showNotification('Please select at least one path set', 'error');
                return;
            }

            const scanResults = document.getElementById('valrScanResults');
            const oppDiv = document.getElementById('valrOpportunities');

            if (scanResults) scanResults.innerHTML = '<span style="color: #FFA500;">‚è≥ Scanning for opportunities...</span>';
            if (oppDiv) oppDiv.innerHTML = '<div style="color: #888; text-align: center; padding: 20px;">Scanning...</div>';

            try {
                const response = await fetch(`${API_BASE}/trading/valr/triangular/scan`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    body: JSON.stringify({
                        apiKey,
                        apiSecret,
                        selectedSets
                    })
                });

                const data = await response.json();

                if (data.success) {
                    const minProfit = parseFloat(document.getElementById('valrProfitThreshold')?.value) || 0.5;
                    const filteredOpps = data.opportunities.filter(opp => opp.profitPercentage >= minProfit);

                    if (scanResults) {
                        scanResults.innerHTML =
                            `<span style="color: #00FF00;">‚úÖ Scan complete: ${filteredOpps.length} opportunities found (${data.scannedPaths} paths scanned)</span>`;
                    }

                    if (filteredOpps.length === 0) {
                        if (oppDiv) {
                            oppDiv.innerHTML =
                                '<div style="color: #888; text-align: center; padding: 20px;">No profitable opportunities found above minimum profit threshold.</div>';
                        }
                        return;
                    }

                    // Display opportunities
                    let html = '';
                    filteredOpps.forEach((opp, index) => {
                        html += `
                            <div style="background: rgba(0,255,136,0.1); padding: 15px; border-radius: 10px; margin-bottom: 15px; border: 1px solid #00ff88;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                    <div>
                                        <span style="color: #00ff88; font-weight: bold;">${opp.pathId}</span>
                                        <span style="color: #888; margin-left: 10px; font-size: 12px;">${opp.description}</span>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="color: ${opp.profitPercentage >= 1 ? '#00FF00' : '#FFA500'}; font-weight: bold; font-size: 18px;">
                                            +${opp.profitPercentage.toFixed(2)}%
                                        </div>
                                        <div style="color: #888; font-size: 12px;">
                                            ~$${opp.estimatedProfit.toFixed(2)} profit
                                        </div>
                                    </div>
                                </div>
                                <div style="color: #888; font-size: 13px; margin-bottom: 10px;">
                                    Path: ${opp.path.join(' ‚Üí ')}
                                </div>
                                <div style="color: #666; font-size: 12px; margin-bottom: 10px;">
                                    Pairs: ${opp.pairs.join(', ')}
                                </div>
                                <button onclick='executeValrTriangular(${JSON.stringify(opp)})'
                                        style="width: 100%; padding: 10px; background: #00ff88; color: black; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;">
                                    ‚ö° Execute Trade
                                </button>
                            </div>
                        `;
                    });

                    if (oppDiv) oppDiv.innerHTML = html;
                    showNotification(`Found ${filteredOpps.length} opportunities!`, 'success');

                } else {
                    if (scanResults) {
                        scanResults.innerHTML = '<span style="color: #FF0000;">‚ùå Scan failed</span>';
                    }
                    if (oppDiv) {
                        oppDiv.innerHTML = '<div style="color: #888; text-align: center; padding: 20px;">Scan failed. Please try again.</div>';
                    }
                    showNotification(data.message || 'Scan failed', 'error');
                }

            } catch (error) {
                console.error('VALR scan error:', error);
                if (scanResults) scanResults.innerHTML = '<span style="color: #FF0000;">‚ùå Error</span>';
                showNotification('Network error during scan', 'error');
            }
        }

        // Execute VALR Triangular Trade
        async function executeValrTriangular(opportunity) {
            const apiKey = localStorage.getItem('valr_triangular_api') || '';
            const apiSecret = localStorage.getItem('valr_triangular_secret') || '';
            const maxInvestment = parseFloat(document.getElementById('valrMaxTrade')?.value) || 1000;

            if (!confirm(`Execute triangular arbitrage on VALR?\n\nPath: ${opportunity.pathId}\nExpected Profit: ${opportunity.profitPercentage.toFixed(2)}%\nInvestment: $${maxInvestment}`)) {
                return;
            }

            showNotification('Executing VALR triangular arbitrage...', 'info');

            try {
                const response = await fetch(`${API_BASE}/trading/valr/triangular/execute`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    body: JSON.stringify({
                        apiKey,
                        apiSecret,
                        opportunity,
                        investmentAmount: maxInvestment
                    })
                });

                const data = await response.json();

                if (data.success) {
                    showNotification(`Trade executed! Profit: $${data.profit.toFixed(2)} (${data.profitPercentage}%)`, 'success');

                    // Refresh opportunities and history
                    await scanValrTriangularPaths();
                    await loadValrTradeHistory();
                } else {
                    showNotification(data.message || 'Trade execution failed', 'error');
                }

            } catch (error) {
                console.error('VALR execution error:', error);
                showNotification('Network error during trade execution', 'error');
            }
        }

        // Load VALR Trade History
        async function loadValrTradeHistory() {
            try {
                const response = await fetch(`${API_BASE}/trading/valr/triangular/history`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });

                const data = await response.json();
                const historyDiv = document.getElementById('valrTradeHistory');

                if (!historyDiv) return;

                if (data.success && data.trades && data.trades.length > 0) {
                    let html = '<div style="overflow-x: auto;"><table style="width: 100%; border-collapse: collapse; font-size: 13px;">';
                    html += '<thead><tr style="background: rgba(0,255,136,0.2);">';
                    html += '<th style="padding: 8px; text-align: left; color: #00ff88;">Date</th>';
                    html += '<th style="padding: 8px; text-align: left; color: #00ff88;">Path</th>';
                    html += '<th style="padding: 8px; text-align: right; color: #00ff88;">Investment</th>';
                    html += '<th style="padding: 8px; text-align: right; color: #00ff88;">Final</th>';
                    html += '<th style="padding: 8px; text-align: right; color: #00ff88;">Profit</th>';
                    html += '<th style="padding: 8px; text-align: center; color: #00ff88;">Status</th>';
                    html += '</tr></thead><tbody>';

                    data.trades.forEach(trade => {
                        const profit = parseFloat(trade.profit);
                        const profitPercent = ((profit / parseFloat(trade.investment_amount)) * 100).toFixed(2);
                        const profitColor = profit >= 0 ? '#00FF00' : '#FF0000';

                        html += `<tr style="border-bottom: 1px solid #333;">
                            <td style="padding: 8px; color: #888;">${new Date(trade.created_at).toLocaleString()}</td>
                            <td style="padding: 8px; color: #00ff88;">${trade.path_id}</td>
                            <td style="padding: 8px; text-align: right; color: #888;">$${parseFloat(trade.investment_amount).toFixed(2)}</td>
                            <td style="padding: 8px; text-align: right; color: #888;">$${parseFloat(trade.final_amount).toFixed(2)}</td>
                            <td style="padding: 8px; text-align: right; color: ${profitColor};">$${profit.toFixed(2)} (${profitPercent}%)</td>
                            <td style="padding: 8px; text-align: center;">
                                <span style="background: rgba(0,255,136,0.2); color: #00ff88; padding: 4px 8px; border-radius: 4px; font-size: 11px;">
                                    ${trade.status}
                                </span>
                            </td>
                        </tr>`;
                    });

                    html += '</tbody></table></div>';
                    historyDiv.innerHTML = html;
                } else {
                    historyDiv.innerHTML = '<div style="color: #888; font-size: 14px;">No trade history available.</div>';
                }

            } catch (error) {
                console.error('VALR history error:', error);
            }
        }

        // View Path Details - Create custom modal to show all paths
        function viewValrPathDetails() {
            // Create modal overlay
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
                backdrop-filter: blur(5px);
            `;

            // Create modal content
            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
                border: 2px solid #00ff88;
                border-radius: 15px;
                padding: 30px;
                max-width: 800px;
                max-height: 85vh;
                overflow-y: auto;
                box-shadow: 0 10px 50px rgba(0, 255, 136, 0.3);
                color: #fff;
                font-family: 'Courier New', monospace;
            `;

            modalContent.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid #00ff88; padding-bottom: 15px;">
                    <h2 style="margin: 0; color: #00ff88; font-size: 24px;">üìã VALR Triangular Arbitrage Paths</h2>
                    <button id="closeModal" style="background: #ff4444; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 18px;">‚úï</button>
                </div>

                <div style="line-height: 1.8; font-size: 14px;">
                    <div style="background: rgba(0, 255, 136, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <strong style="color: #00ff88;">üìä SET 1: ETH Focus (4 paths) ‚úÖ DEFAULT</strong><br>
                        1. ZAR ‚Üí ETH ‚Üí USDT ‚Üí ZAR<br>
                        2. ZAR ‚Üí USDT ‚Üí ETH ‚Üí ZAR<br>
                        3. USDT ‚Üí ETH ‚Üí ZAR ‚Üí USDT<br>
                        4. USDT ‚Üí ZAR ‚Üí ETH ‚Üí USDT
                    </div>

                    <div style="background: rgba(0, 255, 136, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <strong style="color: #00ff88;">üìä SET 2: XRP Focus (4 paths) ‚úÖ DEFAULT</strong><br>
                        1. ZAR ‚Üí XRP ‚Üí USDT ‚Üí ZAR<br>
                        2. ZAR ‚Üí USDT ‚Üí XRP ‚Üí ZAR<br>
                        3. USDT ‚Üí XRP ‚Üí ZAR ‚Üí USDT<br>
                        4. USDT ‚Üí ZAR ‚Üí XRP ‚Üí USDT
                    </div>

                    <div style="background: rgba(0, 255, 136, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <strong style="color: #00ff88;">üìä SET 3: SOL Focus (4 paths)</strong><br>
                        1. ZAR ‚Üí SOL ‚Üí USDT ‚Üí ZAR<br>
                        2. ZAR ‚Üí USDT ‚Üí SOL ‚Üí ZAR<br>
                        3. USDT ‚Üí SOL ‚Üí ZAR ‚Üí USDT<br>
                        4. USDT ‚Üí ZAR ‚Üí SOL ‚Üí USDT
                    </div>

                    <div style="background: rgba(0, 255, 136, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <strong style="color: #00ff88;">üìä SET 4: BNB Focus (4 paths)</strong><br>
                        1. ZAR ‚Üí BNB ‚Üí USDT ‚Üí ZAR<br>
                        2. ZAR ‚Üí USDT ‚Üí BNB ‚Üí ZAR<br>
                        3. USDT ‚Üí BNB ‚Üí ZAR ‚Üí USDT<br>
                        4. USDT ‚Üí ZAR ‚Üí BNB ‚Üí USDT
                    </div>

                    <div style="background: rgba(0, 255, 136, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <strong style="color: #00ff88;">üìä SET 5: SHIB Focus (4 paths)</strong><br>
                        1. ZAR ‚Üí SHIB ‚Üí USDT ‚Üí ZAR<br>
                        2. ZAR ‚Üí USDT ‚Üí SHIB ‚Üí ZAR<br>
                        3. USDT ‚Üí SHIB ‚Üí ZAR ‚Üí USDT<br>
                        4. USDT ‚Üí ZAR ‚Üí SHIB ‚Üí USDT
                    </div>

                    <div style="background: rgba(0, 255, 136, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <strong style="color: #00ff88;">üìä SET 6: AVAX Focus (4 paths)</strong><br>
                        1. ZAR ‚Üí AVAX ‚Üí USDT ‚Üí ZAR<br>
                        2. ZAR ‚Üí USDT ‚Üí AVAX ‚Üí ZAR<br>
                        3. USDT ‚Üí AVAX ‚Üí ZAR ‚Üí USDT<br>
                        4. USDT ‚Üí ZAR ‚Üí AVAX ‚Üí USDT
                    </div>

                    <div style="background: rgba(0, 255, 136, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <strong style="color: #00ff88;">üìä SET 7: DOGE Focus (4 paths)</strong><br>
                        1. ZAR ‚Üí DOGE ‚Üí USDT ‚Üí ZAR<br>
                        2. ZAR ‚Üí USDT ‚Üí DOGE ‚Üí ZAR<br>
                        3. USDT ‚Üí DOGE ‚Üí ZAR ‚Üí USDT<br>
                        4. USDT ‚Üí ZAR ‚Üí DOGE ‚Üí USDT
                    </div>

                    <div style="background: rgba(0, 255, 136, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <strong style="color: #00ff88;">üìä SET 8: TRX Focus (4 paths)</strong><br>
                        1. ZAR ‚Üí TRX ‚Üí USDT ‚Üí ZAR<br>
                        2. ZAR ‚Üí USDT ‚Üí TRX ‚Üí ZAR<br>
                        3. USDT ‚Üí TRX ‚Üí ZAR ‚Üí USDT<br>
                        4. USDT ‚Üí ZAR ‚Üí TRX ‚Üí USDT
                    </div>

                    <div style="background: rgba(0, 255, 136, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <strong style="color: #00ff88;">üìä SET 9: LTC Focus (4 paths)</strong><br>
                        1. ZAR ‚Üí LTC ‚Üí USDT ‚Üí ZAR<br>
                        2. ZAR ‚Üí USDT ‚Üí LTC ‚Üí ZAR<br>
                        3. USDT ‚Üí LTC ‚Üí ZAR ‚Üí USDT<br>
                        4. USDT ‚Üí ZAR ‚Üí LTC ‚Üí USDT
                    </div>

                    <div style="background: rgba(0, 255, 136, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <strong style="color: #00ff88;">üìä SET 10: RLUSD Focus (4 paths)</strong><br>
                        1. ZAR ‚Üí RLUSD ‚Üí USDT ‚Üí ZAR<br>
                        2. ZAR ‚Üí USDT ‚Üí RLUSD ‚Üí ZAR<br>
                        3. USDT ‚Üí RLUSD ‚Üí ZAR ‚Üí USDT<br>
                        4. USDT ‚Üí ZAR ‚Üí RLUSD ‚Üí USDT
                    </div>

                    <div style="background: rgba(0, 255, 136, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <strong style="color: #00ff88;">üìä SET 11: LINK Focus (4 paths)</strong><br>
                        1. ZAR ‚Üí LINK ‚Üí USDT ‚Üí ZAR<br>
                        2. ZAR ‚Üí USDT ‚Üí LINK ‚Üí ZAR<br>
                        3. USDT ‚Üí LINK ‚Üí ZAR ‚Üí USDT<br>
                        4. USDT ‚Üí ZAR ‚Üí LINK ‚Üí USDT
                    </div>

                    <div style="background: rgba(0, 255, 136, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <strong style="color: #00ff88;">üìä SET 12: XLM Focus (4 paths)</strong><br>
                        1. ZAR ‚Üí XLM ‚Üí USDT ‚Üí ZAR<br>
                        2. ZAR ‚Üí USDT ‚Üí XLM ‚Üí ZAR<br>
                        3. USDT ‚Üí XLM ‚Üí ZAR ‚Üí USDT<br>
                        4. USDT ‚Üí ZAR ‚Üí XLM ‚Üí USDT
                    </div>

                    <div style="background: rgba(0, 136, 255, 0.1); padding: 20px; border-radius: 8px; border-left: 4px solid #0088ff; margin-top: 20px;">
                        <strong style="color: #0088ff;">üìå Summary</strong><br>
                        üí° TOTAL: 48 paths (12 sets √ó 4 paths each)<br>
                        üåâ BRIDGE: USDT (Tether)<br>
                        üîÑ PATTERN: All paths use ZAR ‚Üî CRYPTO ‚Üî USDT triangular arbitrage<br>
                        üáøüá¶ REGIONAL: Optimized for South African market (VALR exchange)<br>
                        ‚úÖ VERIFIED: Only coins with both ZAR and USDT pairs on VALR<br>
                        üîê AUTH: API Key + Secret
                    </div>
                </div>
            `;

            modal.appendChild(modalContent);
            document.body.appendChild(modal);

            // Close modal on click outside or close button
            const closeBtn = document.getElementById('closeModal');
            closeBtn.onclick = () => modal.remove();
            modal.onclick = (e) => {
                if (e.target === modal) modal.remove();
            };

            // Close on ESC key
            document.addEventListener('keydown', function escClose(e) {
                if (e.key === 'Escape') {
                    modal.remove();
                    document.removeEventListener('keydown', escClose);
                }
            });
        }

        // Clear VALR History
        async function clearValrTriangularHistory() {
            if (!confirm('Are you sure you want to clear all VALR triangular trade history? This cannot be undone.')) {
                return;
            }

            try {
                // Call backend to clear history
                showNotification('Clearing VALR trade history...', 'info');

                // For now, just refresh the display
                const historyDiv = document.getElementById('valrTradeHistory');
                if (historyDiv) {
                    historyDiv.innerHTML = '<div style="color: #888; font-size: 14px;">Trade history cleared.</div>';
                }

                showNotification('VALR trade history cleared successfully', 'success');
            } catch (error) {
                console.error('Clear history error:', error);
                showNotification('Failed to clear trade history', 'error');
            }
        }

        // Save form values to localStorage
        function saveTriangularSettings() {
            console.log('üíæ [VALR] Saving settings to localStorage...');
            const settings = {
                maxTrade: document.getElementById('valrMaxTrade').value,
                portfolioPercent: document.getElementById('valrPortfolioPercent').value,
                profitThreshold: document.getElementById('valrProfitThreshold').value
            };

            // Save path set states
            for (let i = 1; i <= 39; i++) {
                const checkbox = document.getElementById(`valrSet${i}Enabled`);
                if (checkbox) {
                    settings[`set${i}Enabled`] = checkbox.checked;
                }
            }

            localStorage.setItem('triangularSettings', JSON.stringify(settings));
            console.log('‚úÖ [VALR] Settings saved:', settings);
        }

        // Load form values from localStorage
        function loadTriangularSettings() {
            console.log('üíæ [VALR] Loading settings from localStorage...');
            const savedSettings = localStorage.getItem('triangularSettings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                console.log('‚úÖ [VALR] Settings loaded:', settings);

                if (settings.maxTrade) document.getElementById('valrMaxTrade').value = settings.maxTrade;
                if (settings.portfolioPercent) document.getElementById('valrPortfolioPercent').value = settings.portfolioPercent;
                if (settings.profitThreshold) document.getElementById('valrProfitThreshold').value = settings.profitThreshold;

                // Load path set states
                for (let i = 1; i <= 39; i++) {
                    const checkbox = document.getElementById(`valrSet${i}Enabled`);
                    if (checkbox && settings[`set${i}Enabled`] !== undefined) {
                        checkbox.checked = settings[`set${i}Enabled`];
                    }
                }
            } else {
                console.log('‚ÑπÔ∏è [VALR] No saved settings found, using defaults');
            }
        }

        // Auto-save settings when changed
        document.addEventListener('DOMContentLoaded', function() {
            loadTriangularSettings();

            // Add event listeners for auto-save
            const inputs = document.querySelectorAll('#valrMaxTrade, #valrPortfolioPercent, #valrProfitThreshold');
            inputs.forEach(input => {
                input.addEventListener('change', saveTriangularSettings);
            });

            // Add event listeners for checkboxes
            for (let i = 1; i <= 39; i++) {
                const checkbox = document.getElementById(`valrSet${i}Enabled`);
                if (checkbox) {
                    checkbox.addEventListener('change', saveTriangularSettings);
                }
            }
        });

        // ============================================================================
        // LUNO TRIANGULAR ARBITRAGE JAVASCRIPT
        // ============================================================================

        // ========== LUNO AUTOMATED WORKER ==========
        let lunoWorkerRunning = false;
        let lunoWorkerStats = {
            totalScans: 0,
            totalTrades: 0,
            successfulTrades: 0,
            totalProfit: 0
        };

        async function startLunoWorker() {
            console.log('üöÄ [LUNO Worker] Starting automated trading (sequential mode)...');

            // Read settings from card
            const apiKey = localStorage.getItem('luno_triangular_api');
            const apiSecret = localStorage.getItem('luno_triangular_secret');
            const profitThreshold = parseFloat(document.getElementById('lunoProfitThreshold')?.value) || 0.5;
            const maxTradeAmount = parseFloat(document.getElementById('lunoMaxTrade')?.value) || 500;

            // Get selected path sets (7 sets available)
            const selectedSets = [];
            for (let i = 1; i <= 7; i++) {
                const checkbox = document.getElementById(`lunoSet${i}Enabled`);
                if (checkbox && checkbox.checked) {
                    selectedSets.push(i);
                }
            }

            if (selectedSets.length === 0) {
                alert('‚ö†Ô∏è Please select at least one path set to scan');
                return;
            }

            console.log(`üìä [LUNO Worker] Settings: Threshold=${profitThreshold}%, Max Trade=R${maxTradeAmount}, Sets=${selectedSets.join(',')}`);

            // Initialize balance tracking
            await initializeLunoBalance(apiKey, apiSecret);

            lunoWorkerRunning = true;
            let currentSetIndex = 0;

            async function scanAndExecuteSequential() {
                if (!lunoWorkerRunning) {
                    console.log('üõë [LUNO Worker] Stopped');
                    return;
                }

                try {
                    const currentSet = selectedSets[currentSetIndex];
                    lunoWorkerStats.totalScans++;
                    console.log(`\nüîç [LUNO Worker] Scan #${lunoWorkerStats.totalScans}: SET ${currentSet} (${currentSetIndex + 1}/${selectedSets.length})`);

                    // Get risk settings from UI
                    const maxTradeAmount = parseFloat(document.getElementById('lunoMaxTrade')?.value || 100);
                    const portfolioPercent = parseFloat(document.getElementById('lunoPortfolioPercent')?.value || 10);

                    // Get current balances (from balance tracking)
                    const currentBalanceUSDT = lunoBalanceTracking.currentUSDT || 0;
                    const currentBalanceZAR = lunoBalanceTracking.currentZAR || 0;

                    // Scan current set
                    const scanResponse = await fetch(`${API_BASE}/trading/luno/triangular/scan`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${localStorage.getItem('token')}`
                        },
                        body: JSON.stringify({
                            apiKey,
                            apiSecret,
                            paths: [currentSet],
                            profitThreshold,
                            maxTradeAmount: maxTradeAmount,
                            portfolioPercent: portfolioPercent,
                            currentBalanceUSDT: currentBalanceUSDT,
                            currentBalanceZAR: currentBalanceZAR
                        })
                    });

                    const scanResult = await scanResponse.json();

                    if (scanResult.success && scanResult.data && scanResult.data.opportunities) {
                        const paths = scanResult.data.opportunities;
                        console.log(`‚úÖ [LUNO Worker] SET ${currentSet}: Analyzed ${paths.length} paths`);

                        // Log detailed profit for each path
                        paths.forEach((path, index) => {
                            const profitSign = path.profitPercentage >= 0 ? '+' : '';
                            const profitColor = path.profitPercentage >= profitThreshold ? 'üíö' :
                                              path.profitPercentage >= 0 ? 'üíõ' : '‚ùå';
                            const status = path.profitPercentage >= profitThreshold ? 'OPPORTUNITY' :
                                         path.profitPercentage >= 0 ? 'below threshold' : 'unprofitable';
                            console.log(`   ${profitColor} Path ${index + 1}: ${profitSign}${path.profitPercentage.toFixed(2)}% (${status})`);
                        });

                        // Filter by profit threshold
                        const opportunities = paths.filter(opp => opp.profitPercentage >= profitThreshold);

                        if (opportunities.length > 0) {
                            console.log(`üí∞ [LUNO Worker] SET ${currentSet}: ${opportunities.length} OPPORTUNITIES above ${profitThreshold}% threshold`);

                            // Execute best opportunity
                            const bestOpp = opportunities[0];
                            console.log(`‚ö° [LUNO Worker] Executing: ${bestOpp.pathId} (${bestOpp.profitPercentage.toFixed(2)}% profit)`);

                            const execResponse = await fetch(`${API_BASE}/trading/luno/triangular/execute`, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'Authorization': `Bearer ${localStorage.getItem('token')}`
                                },
                                body: JSON.stringify({
                                    apiKey,
                                    apiSecret,
                                    pathId: bestOpp.pathId,
                                    maxInvestment: maxTradeAmount
                                })
                            });

                            const execResult = await execResponse.json();

                            if (execResult.success && execResult.data) {
                                lunoWorkerStats.totalTrades++;
                                lunoWorkerStats.successfulTrades++;

                                const profit = execResult.data.actualProfit || 0;
                                lunoWorkerStats.totalProfit += profit;

                                console.log(`‚úÖ [LUNO Worker] Trade executed successfully! Profit: R ${profit.toFixed(2)}`);
                                showNotification(`‚úÖ LUNO Trade: ${bestOpp.pathId} +R${profit.toFixed(2)}`, 'success', 5000);
                            } else {
                                // Use error handler
                                lunoWorkerStats.totalTrades++;
                                handleLunoExecutionError({ message: execResult.message || 'Unknown error' }, bestOpp);
                            }
                        } else {
                            console.log(`üìä [LUNO Worker] SET ${currentSet}: All paths below ${profitThreshold}% threshold`);
                        }
                    } else {
                        console.log(`üìä [LUNO Worker] SET ${currentSet}: No paths returned from backend`);
                    }

                    // Update displays
                    updateLunoStatsDisplay();
                    await updateLunoBalance(apiKey, apiSecret);
                    document.getElementById('lunoLastScan').textContent = new Date().toLocaleTimeString();

                    // Move to next set (sequential)
                    currentSetIndex = (currentSetIndex + 1) % selectedSets.length;

                    // Continue scanning after delay
                    setTimeout(scanAndExecuteSequential, 8000); // 8 second delay

                } catch (error) {
                    console.error('‚ùå [LUNO Worker] Error:', error);
                    // Continue even on error
                    setTimeout(scanAndExecuteSequential, 8000);
                }
            }

            // Start the scanning loop
            scanAndExecuteSequential();
        }

        function stopLunoWorker() {
            console.log('üõë [LUNO Worker] Stopping...');
            lunoWorkerRunning = false;
        }

        function updateLunoStatsDisplay() {
            document.getElementById('lunoTotalTrades').textContent = lunoWorkerStats.totalTrades;
            document.getElementById('lunoSuccessfulTrades').textContent = lunoWorkerStats.successfulTrades;

            const successRate = lunoWorkerStats.totalTrades > 0
                ? ((lunoWorkerStats.successfulTrades / lunoWorkerStats.totalTrades) * 100).toFixed(1)
                : 0;
            document.getElementById('lunoSuccessRate').textContent = `${successRate}%`;

            document.getElementById('lunoTotalProfit').textContent = `R ${lunoWorkerStats.totalProfit.toFixed(2)}`;
        }

        // Toggle for Luno Triangular trading
        document.getElementById('lunoTriangularEnabled').addEventListener('click', async function() {
            console.log('üîÑ [LUNO] Toggle clicked');

            const willBeActive = !this.classList.contains('active');
            const status = document.getElementById('lunoTriangularStatus');

            if (willBeActive) {
                // Check if credentials are configured before enabling
                const apiKey = localStorage.getItem('luno_triangular_api') || '';
                const apiSecret = localStorage.getItem('luno_triangular_secret') || '';

                if (!apiKey || !apiSecret) {
                    showNotification('‚ö†Ô∏è Please configure LUNO API credentials in Strategic API Configuration first!', 'warning');
                    return; // Don't toggle
                }

                this.classList.add('active');
                status.textContent = 'ON';
                status.style.color = '#00d4ff';
                localStorage.setItem('lunoTriangularEnabled', 'true');

                // Start automated worker
                await startLunoWorker();

                showNotification('‚úÖ LUNO automated trading started! Worker scanning every 8 seconds.', 'success');
            } else {
                this.classList.remove('active');
                status.textContent = 'OFF';
                status.style.color = '#ff6b6b';
                localStorage.setItem('lunoTriangularEnabled', 'false');

                // Stop worker
                stopLunoWorker();

                showNotification('LUNO automated trading stopped', 'info');
            }
        });

        // Load saved Luno toggle state on page load
        document.addEventListener('DOMContentLoaded', async function() {
            const lunoEnabled = localStorage.getItem('lunoTriangularEnabled') === 'true';
            const toggle = document.getElementById('lunoTriangularEnabled');
            const status = document.getElementById('lunoTriangularStatus');

            // Initialize balance display if credentials exist (regardless of worker state)
            const apiKey = localStorage.getItem('luno_triangular_api');
            const apiSecret = localStorage.getItem('luno_triangular_secret');

            if (apiKey && apiSecret) {
                console.log('üí∞ [LUNO Balance] Fetching balance on page load...');
                await initializeLunoBalance(apiKey, apiSecret);
            }

            if (lunoEnabled) {
                toggle.classList.add('active');
                status.textContent = 'ON';
                status.style.color = '#00d4ff';
            }

            // Load Luno settings
            loadLunoTriangularSettings();
        });

        // ========== LUNO TAB SWITCHING ==========
        function switchLunoTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.luno-tab-content').forEach(content => {
                content.style.display = 'none';
            });

            // Remove active class from all buttons and reset styling
            document.querySelectorAll('.luno-tab-btn').forEach(btn => {
                btn.style.background = 'rgba(255,255,255,0.03)';
                btn.style.borderColor = 'transparent';
                btn.style.color = '#888';
                btn.classList.remove('active');
            });

            // Show selected tab content
            if (tabName === 'trades') {
                document.getElementById('lunoTabTrades').style.display = 'block';
            } else if (tabName === 'balance') {
                document.getElementById('lunoTabBalance').style.display = 'block';
            } else if (tabName === 'alerts') {
                document.getElementById('lunoTabAlerts').style.display = 'block';
            }

            // Highlight active button with enhanced styling
            const activeButton = document.querySelector(`.luno-tab-btn[data-tab="${tabName}"]`);
            if (activeButton) {
                activeButton.style.background = 'rgba(0,212,255,0.15)';
                activeButton.style.borderColor = '#00d4ff';
                activeButton.style.color = '#00d4ff';
                activeButton.classList.add('active');
            }
        }

        // ========== LUNO BALANCE TRACKING ==========
        // Balance tracking variables
        let lunoBalanceTracking = {
            startingZAR: null,
            startingUSDT: null,
            currentZAR: 0,
            currentUSDT: 0
        };

        // Alerts tracking
        let lunoAlerts = [];
        const MAX_LUNO_ALERTS = 20;

        // Initialize LUNO balance on page load
        async function initializeLunoBalance(apiKey, apiSecret) {
            try {
                console.log('üí∞ [LUNO Balance] Initializing balance...');

                // Fetch current balance from LUNO (same endpoint as Strategy API Setup page)
                const response = await fetch(`${API_BASE}/trading/luno/balance`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    body: JSON.stringify({ apiKey, apiSecret })
                });

                const result = await response.json();
                console.log('üí∞ [LUNO Balance] API Response:', result);

                // Handle different response formats
                let balances = null;
                if (result.success && result.data) {
                    balances = result.data.balances || result.data;
                } else if (result.success && result.balances) {
                    balances = result.balances;
                } else if (result.balances) {
                    balances = result.balances;
                }

                console.log('üí∞ [LUNO Balance] Parsed balances:', balances);

                if (balances) {
                    // Balances is an object like { ZAR: "5000.50", XBT: "0.05", ... }
                    const currentZAR = balances.ZAR ? parseFloat(balances.ZAR) : 0;
                    const currentUSDT = balances.USDT ? parseFloat(balances.USDT) : 0;

                    // Check if starting balance is already set (from localStorage)
                    const stored = localStorage.getItem('lunoStartingBalance');
                    if (stored) {
                        const parsed = JSON.parse(stored);
                        lunoBalanceTracking.startingZAR = parsed.zar;
                        lunoBalanceTracking.startingUSDT = parsed.usdt;
                    } else {
                        // First time - set current as starting
                        lunoBalanceTracking.startingZAR = currentZAR;
                        lunoBalanceTracking.startingUSDT = currentUSDT;
                        localStorage.setItem('lunoStartingBalance', JSON.stringify({
                            zar: currentZAR,
                            usdt: currentUSDT
                        }));
                    }

                    lunoBalanceTracking.currentZAR = currentZAR;
                    lunoBalanceTracking.currentUSDT = currentUSDT;

                    updateLunoBalanceDisplay();
                    console.log('‚úÖ [LUNO Balance] Initialized:', lunoBalanceTracking);
                }
            } catch (error) {
                console.error('‚ùå [LUNO Balance] Failed to initialize:', error);
            }
        }

        // Update LUNO balance (called during worker scanning)
        async function updateLunoBalance(apiKey, apiSecret) {
            try {
                const response = await fetch(`${API_BASE}/trading/luno/balance`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    body: JSON.stringify({ apiKey, apiSecret })
                });

                const result = await response.json();

                // Handle different response formats
                let balances = null;
                if (result.success && result.data) {
                    balances = result.data.balances || result.data;
                } else if (result.success && result.balances) {
                    balances = result.balances;
                } else if (result.balances) {
                    balances = result.balances;
                }

                if (balances) {
                    lunoBalanceTracking.currentZAR = balances.ZAR ? parseFloat(balances.ZAR) : 0;
                    lunoBalanceTracking.currentUSDT = balances.USDT ? parseFloat(balances.USDT) : 0;

                    updateLunoBalanceDisplay();
                }
            } catch (error) {
                console.error('‚ùå [LUNO Balance] Update failed:', error);
            }
        }

        // Update balance display
        function updateLunoBalanceDisplay() {
            // Update starting balances
            document.getElementById('lunoStartingZAR').textContent = `R ${lunoBalanceTracking.startingZAR?.toFixed(2) || '0.00'}`;
            document.getElementById('lunoStartingUSDT').textContent = `$${lunoBalanceTracking.startingUSDT?.toFixed(2) || '0.00'}`;

            // Update current balances
            document.getElementById('lunoCurrentZAR').textContent = `R ${lunoBalanceTracking.currentZAR.toFixed(2)}`;
            document.getElementById('lunoCurrentUSDT').textContent = `$${lunoBalanceTracking.currentUSDT.toFixed(2)}`;

            // Calculate and display changes with color coding
            if (lunoBalanceTracking.startingZAR) {
                const zarChange = lunoBalanceTracking.currentZAR - lunoBalanceTracking.startingZAR;
                const zarChangePercent = (zarChange / lunoBalanceTracking.startingZAR * 100).toFixed(2);
                const zarColor = zarChange >= 0 ? '#00ff00' : '#ff4444';
                const zarSign = zarChange >= 0 ? '+' : '';
                document.getElementById('lunoChangeZAR').innerHTML = `<span style="color: ${zarColor}">${zarSign}R ${zarChange.toFixed(2)} (${zarSign}${zarChangePercent}%)</span>`;
            }

            if (lunoBalanceTracking.startingUSDT) {
                const usdtChange = lunoBalanceTracking.currentUSDT - lunoBalanceTracking.startingUSDT;
                const usdtChangePercent = (usdtChange / lunoBalanceTracking.startingUSDT * 100).toFixed(2);
                const usdtColor = usdtChange >= 0 ? '#00ff00' : '#ff4444';
                const usdtSign = usdtChange >= 0 ? '+' : '';
                document.getElementById('lunoChangeUSDT').innerHTML = `<span style="color: ${usdtColor}">${usdtSign}$${usdtChange.toFixed(2)} (${usdtSign}${usdtChangePercent}%)</span>`;
            }

            // Update last updated time
            document.getElementById('lunoBalanceLastUpdate').textContent = new Date().toLocaleTimeString();
        }

        // Reset starting balance
        function resetLunoStartingBalance() {
            lunoBalanceTracking.startingZAR = lunoBalanceTracking.currentZAR;
            lunoBalanceTracking.startingUSDT = lunoBalanceTracking.currentUSDT;

            localStorage.setItem('lunoStartingBalance', JSON.stringify({
                zar: lunoBalanceTracking.startingZAR,
                usdt: lunoBalanceTracking.startingUSDT
            }));

            updateLunoBalanceDisplay();
            alert('‚úÖ Starting balance reset to current values');
            console.log('üîÑ [LUNO Balance] Reset starting balance:', lunoBalanceTracking);
        }

        // ========== LUNO ERROR HANDLING & ALERTS ==========

        // Categorize error type
        function categorizeLunoError(errorMessage) {
            if (!errorMessage) return 'other';
            const msg = errorMessage.toLowerCase();

            if (msg.includes('insufficient') && (msg.includes('balance') || msg.includes('zar') || msg.includes('usdt') || msg.includes('xbt'))) {
                return 'balance';
            } else if (msg.includes('slippage')) {
                return 'slippage';
            } else if (msg.includes('execution') || msg.includes('order') || msg.includes('trade')) {
                return 'execution';
            } else {
                return 'other';
            }
        }

        // Handle execution errors
        function handleLunoExecutionError(error, opportunity) {
            const errorType = categorizeLunoError(error.message);

            if (errorType === 'balance') {
                // Parse balance info from error message
                const match = error.message.match(/need [R$]([\d,.]+).*have [R$]([\d,.]+)/i);
                const currency = error.message.includes('ZAR') ? 'ZAR' :
                                error.message.includes('XBT') ? 'XBT' : 'USDT';

                let required = 0, available = 0, shortfall = 0;
                if (match) {
                    required = parseFloat(match[1].replace(/,/g, ''));
                    available = parseFloat(match[2].replace(/,/g, ''));
                    shortfall = required - available;
                }

                addLunoAlert('balance', `Insufficient ${currency} Balance`, {
                    path: opportunity.pathId,
                    required: required,
                    available: available,
                    shortfall: shortfall,
                    suggestion: `Top up ${currency} balance or reduce "Max Single Trade" amount`
                });

                showNotification(`‚ö†Ô∏è Insufficient ${currency} - Opportunity skipped`, 'warning', 8000);

            } else if (errorType === 'slippage') {
                addLunoAlert('slippage', 'Price Slippage Detected', {
                    path: opportunity.pathId,
                    error: error.message,
                    suggestion: 'Market moved too quickly. Increase slippage tolerance or reduce trade size.'
                });

                showNotification('‚ö†Ô∏è Slippage - Opportunity skipped', 'warning', 6000);

            } else if (errorType === 'execution') {
                addLunoAlert('execution', 'Trade Execution Failed', {
                    path: opportunity.pathId,
                    error: error.message,
                    suggestion: 'Check API permissions and exchange status'
                });

                showNotification('‚ö†Ô∏è Execution failed - Check alerts', 'error', 6000);

            } else {
                addLunoAlert('other', 'Unknown Error', {
                    path: opportunity.pathId,
                    error: error.message,
                    suggestion: 'Check console logs for details'
                });

                showNotification('‚ö†Ô∏è Error occurred - Check alerts', 'error', 6000);
            }
        }

        // Add alert to alerts tab
        function addLunoAlert(type, title, details) {
            const alert = {
                type: type,
                title: title,
                details: details,
                timestamp: new Date().toISOString()
            };

            lunoAlerts.unshift(alert); // Add to beginning

            if (lunoAlerts.length > MAX_LUNO_ALERTS) {
                lunoAlerts.pop(); // Remove oldest
            }

            updateLunoAlertsDisplay();
            updateLunoAlertBadge();
        }

        // Update alerts display
        function updateLunoAlertsDisplay() {
            const alertsList = document.getElementById('lunoAlertsList');

            if (lunoAlerts.length === 0) {
                alertsList.innerHTML = '<div style="text-align: center; color: #888; padding: 20px;">No alerts yet. Alerts will appear here when errors occur.</div>';
                return;
            }

            alertsList.innerHTML = lunoAlerts.map(alert => {
                const icon = alert.type === 'balance' ? 'üí∞' :
                            alert.type === 'slippage' ? 'üìâ' :
                            alert.type === 'execution' ? '‚ö†Ô∏è' : '‚ùå';
                const color = alert.type === 'balance' ? '#ffa500' :
                             alert.type === 'slippage' ? '#ff6b6b' :
                             alert.type === 'execution' ? '#ff4444' : '#888';
                const time = new Date(alert.timestamp).toLocaleTimeString();

                let detailsHtml = '';
                if (alert.details) {
                    if (alert.details.path) {
                        detailsHtml += `<div style="color: #888; font-size: 0.85rem; margin-top: 5px;">Path: ${alert.details.path}</div>`;
                    }
                    if (alert.details.required) {
                        detailsHtml += `<div style="color: #888; font-size: 0.85rem;">Required: R ${alert.details.required.toFixed(2)} | Available: R ${alert.details.available.toFixed(2)} | Shortfall: R ${alert.details.shortfall.toFixed(2)}</div>`;
                    }
                    if (alert.details.suggestion) {
                        detailsHtml += `<div style="color: #00d4ff; font-size: 0.85rem; margin-top: 5px;">üí° ${alert.details.suggestion}</div>`;
                    }
                }

                return `
                    <div style="background: rgba(0,0,0,0.2); padding: 12px; border-radius: 8px; margin-bottom: 10px; border-left: 3px solid ${color};">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <div style="color: ${color}; font-weight: bold;">${icon} ${alert.title}</div>
                            <div style="color: #888; font-size: 0.85rem;">${time}</div>
                        </div>
                        ${detailsHtml}
                    </div>
                `;
            }).join('');
        }

        // Update alert badge counter
        function updateLunoAlertBadge() {
            const badge = document.getElementById('lunoAlertBadge');
            if (lunoAlerts.length > 0) {
                badge.textContent = lunoAlerts.length;
                badge.style.display = 'inline';
            } else {
                badge.style.display = 'none';
            }
        }

        // Test Luno Triangular Connection
        async function testLunoTriangularConnection() {
            console.log('üîç [LUNO] Testing connection...');
            try {
                // Get credentials from localStorage (saved from strategy-api-setup.html)
                const apiKey = localStorage.getItem('luno_triangular_api');
                const apiSecret = localStorage.getItem('luno_triangular_secret');
                console.log('üîë [LUNO] API credentials retrieved from localStorage');

                if (!apiKey || !apiSecret) {
                    console.warn('‚ö†Ô∏è [LUNO] Missing API credentials');
                    alert('‚ùå Please set up your Luno API credentials first in the Strategy API Setup page.');
                    return;
                }

                // Show loading message
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = '‚è≥ Testing...';
                btn.disabled = true;

                // Call backend test-connection route
                console.log('üì° [LUNO] Sending test connection request to backend...');
                const response = await fetch('/api/v1/trading/luno/triangular/test-connection', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        apiKey: apiKey,
                        apiSecret: apiSecret
                    })
                });

                const result = await response.json();
                console.log('‚úÖ [LUNO] Test connection response received:', result);

                btn.textContent = originalText;
                btn.disabled = false;

                if (result.success) {
                    console.log('‚úÖ [LUNO] Connection successful!', result.data);
                    alert(`‚úÖ Luno Connection Successful!\n\n` +
                          `‚Ä¢ Balance Access: ${result.data.balanceAccess ? 'Yes' : 'No'}\n` +
                          `‚Ä¢ Triangular Pairs Available: ${result.data.triangularPairsAvailable ? 'Yes' : 'No'}\n` +
                          `‚Ä¢ Total Pairs: ${result.data.totalPairs}\n` +
                          `‚Ä¢ Required Pairs Found: ${result.data.requiredPairsFound.length}/6`);
                } else {
                    console.error('‚ùå [LUNO] Connection failed:', result.message);
                    alert(`‚ùå Connection Failed: ${result.message || 'Unknown error'}`);
                }
            } catch (error) {
                console.error('‚ùå [LUNO] Connection error:', error);
                alert(`‚ùå Connection Error: ${error.message}`);
            }
        }

        // Scan Luno Triangular Paths
        async function scanLunoTriangularPaths() {
            console.log('üîç [LUNO] Starting path scan...');
            try {
                const apiKey = localStorage.getItem('luno_triangular_api');
                const apiSecret = localStorage.getItem('luno_triangular_secret');

                if (!apiKey || !apiSecret) {
                    console.warn('‚ö†Ô∏è [LUNO] Missing API credentials');
                    alert('‚ùå Please set up your Luno API credentials first.');
                    return;
                }

                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = '‚è≥ Scanning...';
                btn.disabled = true;

                // Get enabled path sets
                const enabledSets = [];
                for (let i = 1; i <= 6; i++) {
                    const checkbox = document.getElementById(`lunoSet${i}Enabled`);
                    if (checkbox && checkbox.checked) {
                        enabledSets.push(i);
                    }
                }
                console.log('üìä [LUNO] Enabled path sets:', enabledSets);

                console.log('üì° [LUNO] Sending scan request to backend...');
                const response = await fetch('/api/v1/trading/luno/triangular/scan', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        apiKey: apiKey,
                        apiSecret: apiSecret,
                        paths: enabledSets.length > 0 ? enabledSets : 'all'
                    })
                });

                const result = await response.json();
                console.log('‚úÖ [LUNO] Scan response received:', result);

                btn.textContent = originalText;
                btn.disabled = false;

                if (result.success) {
                    document.getElementById('lunoLastScan').textContent = new Date().toLocaleTimeString();
                    console.log(`‚úÖ [LUNO] Scan successful! Found ${result.data.opportunities.length} opportunities`);
                    alert(`‚úÖ Scan Complete!\n\n` +
                          `‚Ä¢ Path Sets Scanned: ${result.data.pathSetsScanned}\n` +
                          `‚Ä¢ Total Paths: ${result.data.totalPathsScanned}\n` +
                          `‚Ä¢ Opportunities Found: ${result.data.opportunities.length}\n\n` +
                          `${result.data.message || 'Full implementation coming soon!'}`);
                } else {
                    console.error('‚ùå [LUNO] Scan failed:', result.message);
                    alert(`‚ùå Scan Failed: ${result.message || 'Unknown error'}`);
                }
            } catch (error) {
                console.error('‚ùå [LUNO] Scan error:', error);
                alert(`‚ùå Scan Error: ${error.message}`);
            }
        }

        // View Luno Path Details - Custom Modal
        function viewLunoPathDetails() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
                backdrop-filter: blur(5px);
            `;

            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
                padding: 30px;
                border-radius: 15px;
                max-width: 900px;
                max-height: 80vh;
                overflow-y: auto;
                box-shadow: 0 20px 60px rgba(0, 212, 255, 0.3);
                border: 2px solid #00d4ff;
            `;

            modalContent.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <h2 style="color: #00d4ff; margin: 0; font-size: 1.8rem;">
                        üìã LUNO Triangular Arbitrage Paths
                    </h2>
                    <button onclick="this.closest('[style*=\\'position: fixed\\']').remove()"
                            style="background: rgba(255,0,0,0.2); border: 1px solid #ff4444; color: #ff4444;
                                   padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 1.2rem;">
                        ‚úï
                    </button>
                </div>

                <div style="background: rgba(0,212,255,0.1); padding: 15px; border-radius: 10px; margin-bottom: 20px; border-left: 4px solid #00d4ff;">
                    <p style="margin: 0; color: #b8c6db; font-size: 0.95rem;">
                        üí° <strong style="color: #00d4ff;">24 Total Paths</strong> across 6 sets (4 paths per set - matching VALR structure).
                        All paths start and end with ZAR or USDT (fundable currencies).
                    </p>
                </div>

                <!-- SET 1: ETH FOCUS (4 paths) -->
                <div style="background: rgba(0,212,255,0.05); padding: 20px; border-radius: 12px; margin-bottom: 15px; border: 1px solid rgba(0,212,255,0.3);">
                    <h3 style="color: #00d4ff; margin-top: 0; font-size: 1.3rem;">
                        üî∑ SET 1: ETH Focus (4 paths)
                    </h3>
                    <p style="color: #b8c6db; font-size: 0.9rem; margin-bottom: 15px;">Ethereum-focused triangular paths</p>
                    <div style="display: grid; gap: 8px; font-family: monospace; font-size: 0.9rem;">
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            1. <span style="color: #00ff88;">ZAR ‚Üí XBT ‚Üí ETH ‚Üí ZAR</span>
                        </div>
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            2. <span style="color: #00ff88;">ZAR ‚Üí ETH ‚Üí XBT ‚Üí ZAR</span>
                        </div>
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            3. <span style="color: #00ff88;">USDT ‚Üí XBT ‚Üí ETH ‚Üí USDT</span>
                        </div>
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            4. <span style="color: #00ff88;">USDT ‚Üí ETH ‚Üí XBT ‚Üí USDT</span>
                        </div>
                    </div>
                </div>

                <!-- SET 2: SOL FOCUS (4 paths) -->
                <div style="background: rgba(0,212,255,0.05); padding: 20px; border-radius: 12px; margin-bottom: 15px; border: 1px solid rgba(0,212,255,0.3);">
                    <h3 style="color: #00d4ff; margin-top: 0; font-size: 1.3rem;">
                        üî∑ SET 2: SOL Focus (4 paths)
                    </h3>
                    <p style="color: #b8c6db; font-size: 0.9rem; margin-bottom: 15px;">Solana-focused triangular paths</p>
                    <div style="display: grid; gap: 8px; font-family: monospace; font-size: 0.9rem;">
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            1. <span style="color: #00ff88;">ZAR ‚Üí XBT ‚Üí SOL ‚Üí ZAR</span>
                        </div>
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            2. <span style="color: #00ff88;">ZAR ‚Üí SOL ‚Üí XBT ‚Üí ZAR</span>
                        </div>
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            3. <span style="color: #00ff88;">USDT ‚Üí XBT ‚Üí SOL ‚Üí USDT</span>
                        </div>
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            4. <span style="color: #00ff88;">USDT ‚Üí SOL ‚Üí XBT ‚Üí USDT</span>
                        </div>
                    </div>
                </div>

                <!-- SET 3: XRP FOCUS (4 paths) -->
                <div style="background: rgba(0,212,255,0.05); padding: 20px; border-radius: 12px; margin-bottom: 15px; border: 1px solid rgba(0,212,255,0.3);">
                    <h3 style="color: #00d4ff; margin-top: 0; font-size: 1.3rem;">
                        üî∑ SET 3: XRP Focus (4 paths)
                    </h3>
                    <p style="color: #b8c6db; font-size: 0.9rem; margin-bottom: 15px;">Ripple-focused triangular paths</p>
                    <div style="display: grid; gap: 8px; font-family: monospace; font-size: 0.9rem;">
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            1. <span style="color: #00ff88;">ZAR ‚Üí XBT ‚Üí XRP ‚Üí ZAR</span>
                        </div>
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            2. <span style="color: #00ff88;">ZAR ‚Üí XRP ‚Üí XBT ‚Üí ZAR</span>
                        </div>
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            3. <span style="color: #00ff88;">USDT ‚Üí XBT ‚Üí XRP ‚Üí USDT</span>
                        </div>
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            4. <span style="color: #00ff88;">USDT ‚Üí XRP ‚Üí XBT ‚Üí USDT</span>
                        </div>
                    </div>
                </div>

                <!-- SET 4: USDT BRIDGE (4 paths) -->
                <div style="background: rgba(0,212,255,0.05); padding: 20px; border-radius: 12px; margin-bottom: 15px; border: 1px solid rgba(0,212,255,0.3);">
                    <h3 style="color: #00d4ff; margin-top: 0; font-size: 1.3rem;">
                        üî∑ SET 4: USDT Bridge (4 paths)
                    </h3>
                    <p style="color: #b8c6db; font-size: 0.9rem; margin-bottom: 15px;">ZAR paths via USDT intermediary</p>
                    <div style="display: grid; gap: 8px; font-family: monospace; font-size: 0.9rem;">
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            1. <span style="color: #00ff88;">ZAR ‚Üí USDT ‚Üí XBT ‚Üí ZAR</span>
                        </div>
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            2. <span style="color: #00ff88;">ZAR ‚Üí USDT ‚Üí ETH ‚Üí ZAR</span>
                        </div>
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            3. <span style="color: #00ff88;">ZAR ‚Üí USDT ‚Üí SOL ‚Üí ZAR</span>
                        </div>
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            4. <span style="color: #00ff88;">ZAR ‚Üí USDT ‚Üí XRP ‚Üí ZAR</span>
                        </div>
                    </div>
                </div>

                <!-- SET 5: ALTCOINS 1 (4 paths) -->
                <div style="background: rgba(0,212,255,0.05); padding: 20px; border-radius: 12px; margin-bottom: 15px; border: 1px solid rgba(0,212,255,0.3);">
                    <h3 style="color: #00d4ff; margin-top: 0; font-size: 1.3rem;">
                        üî∑ SET 5: Altcoins 1 - ADA/DOT (4 paths)
                    </h3>
                    <p style="color: #b8c6db; font-size: 0.9rem; margin-bottom: 15px;">Cardano and Polkadot paths</p>
                    <div style="display: grid; gap: 8px; font-family: monospace; font-size: 0.9rem;">
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            1. <span style="color: #00ff88;">ZAR ‚Üí XBT ‚Üí ADA ‚Üí ZAR</span>
                        </div>
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            2. <span style="color: #00ff88;">ZAR ‚Üí ADA ‚Üí XBT ‚Üí ZAR</span>
                        </div>
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            3. <span style="color: #00ff88;">ZAR ‚Üí XBT ‚Üí DOT ‚Üí ZAR</span>
                        </div>
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            4. <span style="color: #00ff88;">ZAR ‚Üí DOT ‚Üí XBT ‚Üí ZAR</span>
                        </div>
                    </div>
                </div>

                <!-- SET 6: ALTCOINS 2 (4 paths) -->
                <div style="background: rgba(0,212,255,0.05); padding: 20px; border-radius: 12px; margin-bottom: 15px; border: 1px solid rgba(0,212,255,0.3);">
                    <h3 style="color: #00d4ff; margin-top: 0; font-size: 1.3rem;">
                        üî∑ SET 6: Altcoins 2 - AVAX/LTC (4 paths)
                    </h3>
                    <p style="color: #b8c6db; font-size: 0.9rem; margin-bottom: 15px;">Avalanche and Litecoin paths</p>
                    <div style="display: grid; gap: 8px; font-family: monospace; font-size: 0.9rem;">
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            1. <span style="color: #00ff88;">ZAR ‚Üí XBT ‚Üí AVAX ‚Üí ZAR</span>
                        </div>
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            2. <span style="color: #00ff88;">ZAR ‚Üí AVAX ‚Üí XBT ‚Üí ZAR</span>
                        </div>
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            3. <span style="color: #00ff88;">ZAR ‚Üí XBT ‚Üí LTC ‚Üí ZAR</span>
                        </div>
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            4. <span style="color: #00ff88;">ZAR ‚Üí LTC ‚Üí XBT ‚Üí ZAR</span>
                        </div>
                    </div>
                </div>
            `;

            modal.appendChild(modalContent);
            document.body.appendChild(modal);

            // Close on background click
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // Clear Luno Triangular History
        async function clearLunoTriangularHistory() {
            console.log('üóëÔ∏è [LUNO] Clear history requested');
            if (!confirm('‚ö†Ô∏è Clear all Luno triangular trade history?\n\nThis action cannot be undone.')) {
                console.log('‚ùå [LUNO] Clear history cancelled by user');
                return;
            }

            try {
                console.log('üì° [LUNO] Sending delete request to backend...');
                const response = await fetch('/api/v1/trading/luno/triangular/history', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const result = await response.json();
                console.log('‚úÖ [LUNO] Delete response received:', result);

                if (result.success) {
                    console.log('‚úÖ [LUNO] History cleared, resetting UI stats...');
                    // Reset stats display
                    document.getElementById('lunoTotalTrades').textContent = '0';
                    document.getElementById('lunoSuccessfulTrades').textContent = '0';
                    document.getElementById('lunoSuccessRate').textContent = '0%';
                    document.getElementById('lunoTotalProfit').textContent = '$0.00';
                    document.getElementById('lunoBestPath').textContent = '-';
                    document.getElementById('lunoLastScan').textContent = 'Never';

                    // Clear recent trades display
                    document.getElementById('lunoRecentTrades').innerHTML =
                        '<div style="text-align: center; color: #888; padding: 20px;">No triangular trades yet. Enable live trading to start.</div>';

                    alert('‚úÖ History cleared successfully!');
                } else {
                    console.error('‚ùå [LUNO] Failed to clear history:', result.message);
                    alert(`‚ùå Failed to clear history: ${result.message || 'Unknown error'}`);
                }
            } catch (error) {
                console.error('‚ùå [LUNO] Clear history error:', error);
                alert(`‚ùå Error: ${error.message}`);
            }
        }

        // Save Luno settings to localStorage
        function saveLunoTriangularSettings() {
            console.log('üíæ [LUNO] Saving settings to localStorage...');
            const settings = {
                maxTrade: document.getElementById('lunoMaxTrade').value,
                portfolioPercent: document.getElementById('lunoPortfolioPercent').value,
                profitThreshold: document.getElementById('lunoProfitThreshold').value
            };

            // Save path set states (6 sets for Luno)
            for (let i = 1; i <= 6; i++) {
                const checkbox = document.getElementById(`lunoSet${i}Enabled`);
                if (checkbox) {
                    settings[`set${i}Enabled`] = checkbox.checked;
                }
            }

            localStorage.setItem('lunoTriangularSettings', JSON.stringify(settings));
            console.log('‚úÖ [LUNO] Settings saved:', settings);
        }

        // Load Luno settings from localStorage
        function loadLunoTriangularSettings() {
            console.log('üíæ [LUNO] Loading settings from localStorage...');
            const savedSettings = localStorage.getItem('lunoTriangularSettings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                console.log('‚úÖ [LUNO] Settings loaded:', settings);

                if (settings.maxTrade) document.getElementById('lunoMaxTrade').value = settings.maxTrade;
                if (settings.portfolioPercent) document.getElementById('lunoPortfolioPercent').value = settings.portfolioPercent;
                if (settings.profitThreshold) document.getElementById('lunoProfitThreshold').value = settings.profitThreshold;

                // Load path set states (7 sets)
                for (let i = 1; i <= 7; i++) {
                    const checkbox = document.getElementById(`lunoSet${i}Enabled`);
                    if (checkbox && settings[`set${i}Enabled`] !== undefined) {
                        checkbox.checked = settings[`set${i}Enabled`];
                    }
                }
            } else {
                console.log('‚ÑπÔ∏è [LUNO] No saved settings found, using defaults');
            }
        }

        // Auto-save Luno settings when changed
        document.addEventListener('DOMContentLoaded', function() {
            // Add event listeners for Luno settings auto-save
            const lunoInputs = document.querySelectorAll('#lunoMaxTrade, #lunoPortfolioPercent, #lunoProfitThreshold');
            lunoInputs.forEach(input => {
                input.addEventListener('change', saveLunoTriangularSettings);
            });

            // Add event listeners for Luno checkboxes (6 sets)
            for (let i = 1; i <= 6; i++) {
                const checkbox = document.getElementById(`lunoSet${i}Enabled`);
                if (checkbox) {
                    checkbox.addEventListener('change', saveLunoTriangularSettings);
                }
            }
        });

        // ============================================================================
        // CHAINEX TRIANGULAR ARBITRAGE JAVASCRIPT
        // ============================================================================

        // Toggle for ChainEX Triangular trading
        document.getElementById('chainexTriangularEnabled').addEventListener('click', function() {
            console.log('üîÑ [CHAINEX] Toggle clicked');
            this.classList.toggle('active');
            const status = document.getElementById('chainexTriangularStatus');

            if (this.classList.contains('active')) {
                console.log('‚úÖ [CHAINEX] Live trading enabled');
                status.textContent = 'ON';
                status.style.color = '#ff9800';
                localStorage.setItem('chainexTriangularEnabled', 'true');
            } else {
                console.log('‚ùå [CHAINEX] Live trading disabled');
                status.textContent = 'OFF';
                status.style.color = '#ff6b6b';
                localStorage.setItem('chainexTriangularEnabled', 'false');
            }
        });

        // Load saved ChainEX toggle state on page load
        document.addEventListener('DOMContentLoaded', function() {
            const chainexEnabled = localStorage.getItem('chainexTriangularEnabled') === 'true';
            const toggle = document.getElementById('chainexTriangularEnabled');
            const status = document.getElementById('chainexTriangularStatus');

            if (chainexEnabled) {
                toggle.classList.add('active');
                status.textContent = 'ON';
                status.style.color = '#ff9800';
            }

            // Load ChainEX settings
            loadChainExTriangularSettings();
        });

        // Test ChainEX Triangular Connection
        async function testChainExTriangularConnection() {
            console.log('üîç [CHAINEX] Testing connection...');
            try {
                // Get credentials from localStorage (saved from strategy-api-setup.html)
                const apiKey = localStorage.getItem('chainex_triangular_api');
                const apiSecret = localStorage.getItem('chainex_triangular_secret');
                console.log('üîë [CHAINEX] API credentials retrieved from localStorage');

                if (!apiKey || !apiSecret) {
                    console.warn('‚ö†Ô∏è [CHAINEX] Missing API credentials');
                    alert('‚ùå Please set up your ChainEX API credentials first in the Strategy API Setup page.');
                    return;
                }

                // Show loading message
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = '‚è≥ Testing...';
                btn.disabled = true;

                // Call backend test-connection route
                console.log('üì° [CHAINEX] Sending test connection request to backend...');
                const response = await fetch('/api/v1/trading/chainex/triangular/test-connection', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        apiKey: apiKey,
                        apiSecret: apiSecret
                    })
                });

                const result = await response.json();
                console.log('‚úÖ [CHAINEX] Test connection response received:', result);

                btn.textContent = originalText;
                btn.disabled = false;

                if (result.success) {
                    console.log('‚úÖ [CHAINEX] Connection successful!', result.data);
                    alert(`‚úÖ ChainEX Connection Successful!\n\n` +
                          `‚Ä¢ Authenticated: ${result.data.authenticated ? 'Yes' : 'No'}\n` +
                          `‚Ä¢ Available Pairs: ${result.data.availablePairs}\n` +
                          `‚Ä¢ Required Pairs: ${result.data.requiredPairs}\n` +
                          `‚Ä¢ Missing Pairs: ${result.data.missingPairs.length}\n` +
                          `‚Ä¢ Triangular Ready: ${result.data.triangularReady ? 'Yes' : 'No'}`);
                } else {
                    console.error('‚ùå [CHAINEX] Connection failed:', result.message);
                    alert(`‚ùå Connection Failed: ${result.message || 'Unknown error'}`);
                }
            } catch (error) {
                console.error('‚ùå [CHAINEX] Connection error:', error);
                alert(`‚ùå Connection Error: ${error.message}`);
            }
        }

        // Scan ChainEX Triangular Paths
        async function scanChainExTriangularPaths() {
            console.log('üîç [CHAINEX] Starting path scan...');
            try {
                const apiKey = localStorage.getItem('chainex_triangular_api');
                const apiSecret = localStorage.getItem('chainex_triangular_secret');

                if (!apiKey || !apiSecret) {
                    console.warn('‚ö†Ô∏è [CHAINEX] Missing API credentials');
                    alert('‚ùå Please set up your ChainEX API credentials first.');
                    return;
                }

                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = '‚è≥ Scanning...';
                btn.disabled = true;

                // Get enabled path sets
                const enabledSets = [];
                for (let i = 1; i <= 6; i++) {
                    const checkbox = document.getElementById(`chainexSet${i}Enabled`);
                    if (checkbox && checkbox.checked) {
                        enabledSets.push(i);
                    }
                }
                console.log('üìä [CHAINEX] Enabled path sets:', enabledSets);

                console.log('üì° [CHAINEX] Sending scan request to backend...');
                const response = await fetch('/api/v1/trading/chainex/triangular/scan', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        apiKey: apiKey,
                        apiSecret: apiSecret,
                        paths: enabledSets.length > 0 ? enabledSets : 'all'
                    })
                });

                const result = await response.json();
                console.log('‚úÖ [CHAINEX] Scan response received:', result);

                btn.textContent = originalText;
                btn.disabled = false;

                if (result.success) {
                    document.getElementById('chainexLastScan').textContent = new Date().toLocaleTimeString();
                    console.log(`‚úÖ [CHAINEX] Scan successful! Found ${result.data.opportunities.length} opportunities`);

                    let message = `‚úÖ Scan Complete!\n\n`;
                    message += `‚Ä¢ Paths Scanned: ${result.data.scannedPaths}\n`;
                    message += `‚Ä¢ Opportunities Found: ${result.data.opportunities.length}\n\n`;

                    if (result.data.opportunities.length > 0) {
                        message += `Top 3 Opportunities:\n`;
                        result.data.opportunities.slice(0, 3).forEach((opp, i) => {
                            message += `${i + 1}. ${opp.sequence}\n`;
                            message += `   Profit: ${opp.profitPercent.toFixed(2)}% (R ${opp.profitZar.toFixed(2)})\n`;
                        });
                    } else {
                        message += `No profitable opportunities found at this time.`;
                    }

                    alert(message);
                } else {
                    console.error('‚ùå [CHAINEX] Scan failed:', result.message);
                    alert(`‚ùå Scan Failed: ${result.message || 'Unknown error'}`);
                }
            } catch (error) {
                console.error('‚ùå [CHAINEX] Scan error:', error);
                alert(`‚ùå Scan Error: ${error.message}`);
            }
        }

        // View ChainEX Path Details - Custom Modal
        function viewChainExPathDetails() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
                backdrop-filter: blur(5px);
            `;

            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
                padding: 30px;
                border-radius: 15px;
                max-width: 900px;
                max-height: 80vh;
                overflow-y: auto;
                box-shadow: 0 20px 60px rgba(0, 212, 255, 0.3);
                border: 2px solid #00d4ff;
            `;

            modalContent.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <h2 style="color: #00d4ff; margin: 0; font-size: 1.8rem;">
                        üìã CHAINEX Triangular Arbitrage Paths
                    </h2>
                    <button onclick="this.closest('[style*=\\'position: fixed\\']').remove()"
                            style="background: rgba(255,0,0,0.2); border: 1px solid #ff4444; color: #ff4444;
                                   padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 1.2rem;">
                        ‚úï
                    </button>
                </div>

                <div style="background: rgba(0,212,255,0.1); padding: 15px; border-radius: 10px; margin-bottom: 20px; border-left: 4px solid #00d4ff;">
                    <p style="margin: 0; color: #b8c6db; font-size: 0.95rem;">
                        üí° <strong style="color: #00d4ff;">22 Total Paths</strong> across 5 sets.
                        üáøüá¶ South African exchange - ZAR based paths.
                    </p>
                </div>

                <!-- SET 1: Essential BTC Bridge (6 paths) -->
                <div style="background: rgba(0,212,255,0.05); padding: 20px; border-radius: 12px; margin-bottom: 15px; border: 1px solid rgba(0,212,255,0.3);">
                    <h3 style="color: #00d4ff; margin-top: 0; font-size: 1.3rem;">
                        üî∑ SET 1: Essential BTC Bridge (6 paths) ‚úÖ DEFAULT
                    </h3>
                    <p style="color: #b8c6db; font-size: 0.9rem; margin-bottom: 15px;">Bitcoin-focused triangular paths</p>
                    <div style="display: grid; gap: 8px; font-family: monospace; font-size: 0.9rem;">
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            1. <span style="color: #00ff88;">ZAR ‚Üí BTC ‚Üí ETH ‚Üí ZAR</span>
                        </div>
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            2. <span style="color: #00ff88;">ZAR ‚Üí BTC ‚Üí XRP ‚Üí ZAR</span>
                        </div>
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            3. <span style="color: #00ff88;">ZAR ‚Üí BTC ‚Üí LTC ‚Üí ZAR</span>
                        </div>
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            4. <span style="color: #00ff88;">ZAR ‚Üí BTC ‚Üí DOGE ‚Üí ZAR</span>
                        </div>
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            5. <span style="color: #00ff88;">ZAR ‚Üí BTC ‚Üí ADA ‚Üí ZAR</span>
                        </div>
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            6. <span style="color: #00ff88;">ZAR ‚Üí BTC ‚Üí SOL ‚Üí ZAR</span>
                        </div>
                    </div>
                </div>

                <!-- SET 2: ETH Secondary Bridge (5 paths) -->
                <div style="background: rgba(0,212,255,0.05); padding: 20px; border-radius: 12px; margin-bottom: 15px; border: 1px solid rgba(0,212,255,0.3);">
                    <h3 style="color: #00d4ff; margin-top: 0; font-size: 1.3rem;">
                        üî∑ SET 2: ETH Secondary Bridge (5 paths) ‚úÖ DEFAULT
                    </h3>
                    <p style="color: #b8c6db; font-size: 0.9rem; margin-bottom: 15px;">Ethereum-focused triangular paths</p>
                    <div style="display: grid; gap: 8px; font-family: monospace; font-size: 0.9rem;">
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            1. <span style="color: #00ff88;">ZAR ‚Üí ETH ‚Üí BTC ‚Üí ZAR</span>
                        </div>
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            2. <span style="color: #00ff88;">ZAR ‚Üí ETH ‚Üí SOL ‚Üí ZAR</span>
                        </div>
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            3. <span style="color: #00ff88;">ZAR ‚Üí ETH ‚Üí ADA ‚Üí ZAR</span>
                        </div>
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            4. <span style="color: #00ff88;">ZAR ‚Üí ETH ‚Üí DOT ‚Üí ZAR</span>
                        </div>
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            5. <span style="color: #00ff88;">ZAR ‚Üí ETH ‚Üí LINK ‚Üí ZAR</span>
                        </div>
                    </div>
                </div>

                <!-- SET 3: USDT Bridge (5 paths) -->
                <div style="background: rgba(0,212,255,0.05); padding: 20px; border-radius: 12px; margin-bottom: 15px; border: 1px solid rgba(0,212,255,0.3);">
                    <h3 style="color: #00d4ff; margin-top: 0; font-size: 1.3rem;">
                        üî∑ SET 3: USDT Bridge (5 paths)
                    </h3>
                    <p style="color: #b8c6db; font-size: 0.9rem; margin-bottom: 15px;">ZAR paths via USDT intermediary</p>
                    <div style="display: grid; gap: 8px; font-family: monospace; font-size: 0.9rem;">
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            1. <span style="color: #00ff88;">ZAR ‚Üí USDT ‚Üí BTC ‚Üí ZAR</span>
                        </div>
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            2. <span style="color: #00ff88;">ZAR ‚Üí USDT ‚Üí ETH ‚Üí ZAR</span>
                        </div>
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            3. <span style="color: #00ff88;">ZAR ‚Üí USDT ‚Üí XRP ‚Üí ZAR</span>
                        </div>
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            4. <span style="color: #00ff88;">ZAR ‚Üí USDT ‚Üí SOL ‚Üí ZAR</span>
                        </div>
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            5. <span style="color: #00ff88;">ZAR ‚Üí USDT ‚Üí ADA ‚Üí ZAR</span>
                        </div>
                    </div>
                </div>

                <!-- SET 4: SOL Bridge (3 paths) -->
                <div style="background: rgba(0,212,255,0.05); padding: 20px; border-radius: 12px; margin-bottom: 15px; border: 1px solid rgba(0,212,255,0.3);">
                    <h3 style="color: #00d4ff; margin-top: 0; font-size: 1.3rem;">
                        üî∑ SET 4: SOL Bridge (3 paths)
                    </h3>
                    <p style="color: #b8c6db; font-size: 0.9rem; margin-bottom: 15px;">Solana-focused triangular paths</p>
                    <div style="display: grid; gap: 8px; font-family: monospace; font-size: 0.9rem;">
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            1. <span style="color: #00ff88;">ZAR ‚Üí SOL ‚Üí BTC ‚Üí ZAR</span>
                        </div>
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            2. <span style="color: #00ff88;">ZAR ‚Üí SOL ‚Üí ETH ‚Üí ZAR</span>
                        </div>
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            3. <span style="color: #00ff88;">ZAR ‚Üí SOL ‚Üí XRP ‚Üí ZAR</span>
                        </div>
                    </div>
                </div>

                <!-- SET 5: Altcoin Extended (3 paths) -->
                <div style="background: rgba(0,212,255,0.05); padding: 20px; border-radius: 12px; margin-bottom: 15px; border: 1px solid rgba(0,212,255,0.3);">
                    <h3 style="color: #00d4ff; margin-top: 0; font-size: 1.3rem;">
                        üî∑ SET 5: Altcoin Extended (3 paths)
                    </h3>
                    <p style="color: #b8c6db; font-size: 0.9rem; margin-bottom: 15px;">Additional altcoin paths</p>
                    <div style="display: grid; gap: 8px; font-family: monospace; font-size: 0.9rem;">
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            1. <span style="color: #00ff88;">ZAR ‚Üí ADA ‚Üí BTC ‚Üí ZAR</span>
                        </div>
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            2. <span style="color: #00ff88;">ZAR ‚Üí DOGE ‚Üí BTC ‚Üí ZAR</span>
                        </div>
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            3. <span style="color: #00ff88;">ZAR ‚Üí DOT ‚Üí ETH ‚Üí ZAR</span>
                        </div>
                    </div>
                </div>

                <div style="background: rgba(255,152,0,0.1); padding: 15px; border-radius: 10px; margin-top: 20px; border-left: 4px solid #ff9800;">
                    <p style="margin: 0; color: #b8c6db; font-size: 0.9rem;">
                        üìù <strong style="color: #ff9800;">Note:</strong> These paths are currently ZAR-only.
                        ChainEX should also support USDT as a fundable currency (matching VALR/Luno pattern of 6 sets √ó 4 paths = 24 total).
                    </p>
                </div>
            `;

            modal.appendChild(modalContent);
            document.body.appendChild(modal);

            // Close on background click
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });

            console.log('üìã [CHAINEX] Path details modal displayed');
        }

        // Clear ChainEX Triangular History
        async function clearChainExTriangularHistory() {
            console.log('üóëÔ∏è [CHAINEX] Clear history requested');
            if (!confirm('‚ö†Ô∏è Clear all ChainEX triangular trade history?\n\nThis action cannot be undone.')) {
                console.log('‚ùå [CHAINEX] Clear history cancelled by user');
                return;
            }

            try {
                console.log('üì° [CHAINEX] Sending delete request to backend...');
                const response = await fetch('/api/v1/trading/chainex/triangular/history', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const result = await response.json();
                console.log('‚úÖ [CHAINEX] Delete response received:', result);

                if (result.success) {
                    console.log('‚úÖ [CHAINEX] History cleared, resetting UI stats...');
                    // Reset stats display
                    document.getElementById('chainexTotalTrades').textContent = '0';
                    document.getElementById('chainexSuccessfulTrades').textContent = '0';
                    document.getElementById('chainexSuccessRate').textContent = '0%';
                    document.getElementById('chainexTotalProfit').textContent = 'R 0.00';
                    document.getElementById('chainexBestPath').textContent = '-';
                    document.getElementById('chainexLastScan').textContent = 'Never';

                    // Clear recent trades display
                    document.getElementById('chainexRecentTrades').innerHTML =
                        '<div style="text-align: center; color: #888; padding: 20px;">No triangular trades yet. Enable live trading to start.</div>';

                    alert(`‚úÖ History cleared successfully!\n\nDeleted ${result.data.deletedCount} records.`);
                } else {
                    console.error('‚ùå [CHAINEX] Failed to clear history:', result.message);
                    alert(`‚ùå Failed to clear history: ${result.message || 'Unknown error'}`);
                }
            } catch (error) {
                console.error('‚ùå [CHAINEX] Clear history error:', error);
                alert(`‚ùå Error: ${error.message}`);
            }
        }

        // Switch ChainEX tabs
        function switchChainExTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.chainex-tab-content').forEach(content => {
                content.style.display = 'none';
            });

            // Remove active class from all buttons and reset styling
            document.querySelectorAll('.chainex-tab-btn').forEach(btn => {
                btn.style.background = 'rgba(255,255,255,0.03)';
                btn.style.borderColor = 'transparent';
                btn.style.color = '#888';
                btn.classList.remove('active');
            });

            // Show selected tab content
            if (tabName === 'trades') {
                document.getElementById('chainexTabTrades').style.display = 'block';
            } else if (tabName === 'balance') {
                document.getElementById('chainexTabBalance').style.display = 'block';
            } else if (tabName === 'alerts') {
                document.getElementById('chainexTabAlerts').style.display = 'block';
            }

            // Highlight active button with enhanced styling
            const activeButton = document.querySelector(`.chainex-tab-btn[data-tab="${tabName}"]`);
            if (activeButton) {
                activeButton.style.background = 'rgba(255,152,0,0.15)';
                activeButton.style.borderColor = '#ff9800';
                activeButton.style.color = '#ff9800';
                activeButton.classList.add('active');
            }

            console.log(`üìë [CHAINEX] Switched to ${tabName} tab`);
        }

        // Reset ChainEX Starting Balance
        function resetChainExStartingBalance() {
            if (!confirm('‚ö†Ô∏è Reset ChainEX starting balance to current balance?\n\nThis will recalculate profit/loss from this point forward.')) {
                console.log('‚ùå [CHAINEX] Reset starting balance cancelled');
                return;
            }

            // Get current balances
            const currentZAR = document.getElementById('chainexCurrentZAR').textContent;
            const currentUSDT = document.getElementById('chainexCurrentUSDT').textContent;

            // Set as starting balances
            document.getElementById('chainexStartingZAR').textContent = currentZAR;
            document.getElementById('chainexStartingUSDT').textContent = currentUSDT;

            // Reset change to zero
            document.getElementById('chainexChangeZAR').textContent = '+R 0.00 (+0%)';
            document.getElementById('chainexChangeZAR').style.color = '#888';
            document.getElementById('chainexChangeUSDT').textContent = '+$0.00 (+0%)';
            document.getElementById('chainexChangeUSDT').style.color = '#888';

            // Save to localStorage
            localStorage.setItem('chainexStartingZAR', currentZAR);
            localStorage.setItem('chainexStartingUSDT', currentUSDT);

            // Update timestamp
            document.getElementById('chainexBalanceLastUpdate').textContent = new Date().toLocaleString();

            console.log('‚úÖ [CHAINEX] Starting balance reset successfully');
            alert('‚úÖ Starting balance reset successfully!');
        }

        // Clear ChainEX Alerts
        function clearChainExAlerts() {
            const alertsList = document.getElementById('chainexAlertsList');
            alertsList.innerHTML = '<div style="text-align: center; color: #888; padding: 20px;">No alerts. Worker running smoothly. ‚úÖ</div>';

            // Reset badge
            const badge = document.getElementById('chainexAlertBadge');
            badge.style.display = 'none';
            badge.textContent = '0';

            console.log('üóëÔ∏è [CHAINEX] Alerts cleared');
        }

        // Save ChainEX settings to localStorage
        function saveChainExTriangularSettings() {
            console.log('üíæ [CHAINEX] Saving settings to localStorage...');
            const settings = {
                maxTrade: document.getElementById('chainexMaxTrade').value,
                portfolioPercent: document.getElementById('chainexPortfolioPercent').value,
                profitThreshold: document.getElementById('chainexProfitThreshold').value
            };

            // Save path set states (6 sets for ChainEX)
            for (let i = 1; i <= 6; i++) {
                const checkbox = document.getElementById(`chainexSet${i}Enabled`);
                if (checkbox) {
                    settings[`set${i}Enabled`] = checkbox.checked;
                }
            }

            localStorage.setItem('chainexTriangularSettings', JSON.stringify(settings));
            console.log('‚úÖ [CHAINEX] Settings saved:', settings);
        }

        // Load ChainEX settings from localStorage
        function loadChainExTriangularSettings() {
            console.log('üíæ [CHAINEX] Loading settings from localStorage...');
            const savedSettings = localStorage.getItem('chainexTriangularSettings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                console.log('‚úÖ [CHAINEX] Settings loaded:', settings);

                if (settings.maxTrade) document.getElementById('chainexMaxTrade').value = settings.maxTrade;
                if (settings.portfolioPercent) document.getElementById('chainexPortfolioPercent').value = settings.portfolioPercent;
                if (settings.profitThreshold) document.getElementById('chainexProfitThreshold').value = settings.profitThreshold;

                // Load path set states (10 sets)
                for (let i = 1; i <= 10; i++) {
                    const checkbox = document.getElementById(`chainexSet${i}Enabled`);
                    if (checkbox && settings[`set${i}Enabled`] !== undefined) {
                        checkbox.checked = settings[`set${i}Enabled`];
                    }
                }
            } else {
                console.log('‚ÑπÔ∏è [CHAINEX] No saved settings found, using defaults');
            }
        }

        // Auto-save ChainEX settings when changed
        document.addEventListener('DOMContentLoaded', function() {
            // Add event listeners for ChainEX settings auto-save
            const chainexInputs = document.querySelectorAll('#chainexMaxTrade, #chainexPortfolioPercent, #chainexProfitThreshold');
            chainexInputs.forEach(input => {
                input.addEventListener('change', saveChainExTriangularSettings);
            });

            // Add event listeners for ChainEX checkboxes (6 sets)
            for (let i = 1; i <= 6; i++) {
                const checkbox = document.getElementById(`chainexSet${i}Enabled`);
                if (checkbox) {
                    checkbox.addEventListener('change', saveChainExTriangularSettings);
                }
            }
        });

        // ============================================================================
        // KRAKEN TRIANGULAR ARBITRAGE JAVASCRIPT
        // ============================================================================

        // Worker stats tracking
        let krakenWorkerStats = {
            totalScans: 0,
            totalOpportunities: 0,
            totalTrades: 0,
            successfulTrades: 0,
            totalProfit: 0,
            bestPath: null,
            bestProfit: 0
        };

        // Balance tracking (USD, USDT, USDC)
        let krakenBalanceTracking = {
            startingUSD: null,
            startingUSDT: null,
            startingUSDC: null,
            currentUSD: 0,
            currentUSDT: 0,
            currentUSDC: 0
        };

        // Alerts tracking
        let krakenAlerts = [];
        let krakenWorkerInterval = null;

        // Initialize Kraken balance on page load
        async function initializeKrakenBalance(apiKey, apiSecret) {
            try {
                // Fetch current balance from Kraken
                const response = await fetch('/api/v1/trading/kraken/balance', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ apiKey, apiSecret })
                });

                const result = await response.json();
                console.log('üí∞ [KRAKEN Balance] API Response:', result);

                if (result.success && result.data && result.data.balances) {
                    const balances = result.data.balances;
                    const currentUSD = balances.USD ? parseFloat(balances.USD) : 0;
                    const currentUSDT = balances.USDT ? parseFloat(balances.USDT) : 0;
                    const currentUSDC = balances.USDC ? parseFloat(balances.USDC) : 0;

                    // Check if starting balance is already set
                    const stored = localStorage.getItem('krakenStartingBalance');
                    if (stored) {
                        const parsed = JSON.parse(stored);
                        krakenBalanceTracking.startingUSD = parsed.usd;
                        krakenBalanceTracking.startingUSDT = parsed.usdt;
                        krakenBalanceTracking.startingUSDC = parsed.usdc;
                    } else {
                        // First time - set current as starting
                        krakenBalanceTracking.startingUSD = currentUSD;
                        krakenBalanceTracking.startingUSDT = currentUSDT;
                        krakenBalanceTracking.startingUSDC = currentUSDC;
                        localStorage.setItem('krakenStartingBalance', JSON.stringify({
                            usd: currentUSD,
                            usdt: currentUSDT,
                            usdc: currentUSDC
                        }));
                    }

                    krakenBalanceTracking.currentUSD = currentUSD;
                    krakenBalanceTracking.currentUSDT = currentUSDT;
                    krakenBalanceTracking.currentUSDC = currentUSDC;

                    updateKrakenBalanceDisplay();
                    console.log('‚úÖ [KRAKEN Balance] Initialized:', krakenBalanceTracking);
                }
            } catch (error) {
                console.error('‚ùå [KRAKEN Balance] Failed to initialize:', error);
            }
        }

        // Update Kraken balance
        async function updateKrakenBalance(apiKey, apiSecret) {
            try {
                const response = await fetch('/api/v1/trading/kraken/balance', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ apiKey, apiSecret })
                });

                const result = await response.json();

                if (result.success && result.data && result.data.balances) {
                    const balances = result.data.balances;
                    krakenBalanceTracking.currentUSD = balances.USD ? parseFloat(balances.USD) : 0;
                    krakenBalanceTracking.currentUSDT = balances.USDT ? parseFloat(balances.USDT) : 0;
                    krakenBalanceTracking.currentUSDC = balances.USDC ? parseFloat(balances.USDC) : 0;

                    updateKrakenBalanceDisplay();
                }
            } catch (error) {
                console.error('‚ùå [KRAKEN Balance] Update failed:', error);
            }
        }

        // Update Kraken balance display
        function updateKrakenBalanceDisplay() {
            // Update starting balances
            document.getElementById('krakenStartingUSD').textContent = `$${krakenBalanceTracking.startingUSD?.toFixed(2) || '0.00'}`;
            document.getElementById('krakenStartingUSDT').textContent = `$${krakenBalanceTracking.startingUSDT?.toFixed(2) || '0.00'}`;
            document.getElementById('krakenStartingUSDC').textContent = `$${krakenBalanceTracking.startingUSDC?.toFixed(2) || '0.00'}`;

            // Update current balances
            document.getElementById('krakenCurrentUSD').textContent = `$${krakenBalanceTracking.currentUSD.toFixed(2)}`;
            document.getElementById('krakenCurrentUSDT').textContent = `$${krakenBalanceTracking.currentUSDT.toFixed(2)}`;
            document.getElementById('krakenCurrentUSDC').textContent = `$${krakenBalanceTracking.currentUSDC.toFixed(2)}`;

            // Calculate and display changes for USD
            if (krakenBalanceTracking.startingUSD) {
                const usdChange = krakenBalanceTracking.currentUSD - krakenBalanceTracking.startingUSD;
                const usdChangePercent = (usdChange / krakenBalanceTracking.startingUSD * 100).toFixed(2);
                const usdColor = usdChange >= 0 ? '#00ff00' : '#ff4444';
                const usdSign = usdChange >= 0 ? '+' : '';
                document.getElementById('krakenChangeUSD').innerHTML = `<span style="color: ${usdColor}">${usdSign}$${usdChange.toFixed(2)} (${usdSign}${usdChangePercent}%)</span>`;
            }

            // Calculate and display changes for USDT
            if (krakenBalanceTracking.startingUSDT) {
                const usdtChange = krakenBalanceTracking.currentUSDT - krakenBalanceTracking.startingUSDT;
                const usdtChangePercent = (usdtChange / krakenBalanceTracking.startingUSDT * 100).toFixed(2);
                const usdtColor = usdtChange >= 0 ? '#00ff00' : '#ff4444';
                const usdtSign = usdtChange >= 0 ? '+' : '';
                document.getElementById('krakenChangeUSDT').innerHTML = `<span style="color: ${usdtColor}">${usdtSign}$${usdtChange.toFixed(2)} (${usdtSign}${usdtChangePercent}%)</span>`;
            }

            // Calculate and display changes for USDC
            if (krakenBalanceTracking.startingUSDC) {
                const usdcChange = krakenBalanceTracking.currentUSDC - krakenBalanceTracking.startingUSDC;
                const usdcChangePercent = (usdcChange / krakenBalanceTracking.startingUSDC * 100).toFixed(2);
                const usdcColor = usdcChange >= 0 ? '#00ff00' : '#ff4444';
                const usdcSign = usdcChange >= 0 ? '+' : '';
                document.getElementById('krakenChangeUSDC').innerHTML = `<span style="color: ${usdcColor}">${usdcSign}$${usdcChange.toFixed(2)} (${usdcSign}${usdcChangePercent}%)</span>`;
            }

            // Update last updated time
            document.getElementById('krakenBalanceLastUpdate').textContent = new Date().toLocaleTimeString();
        }

        // Start Kraken automated worker
        async function startKrakenWorker() {
            console.log('üöÄ [KRAKEN Worker] Starting automated scanning...');

            const apiKey = localStorage.getItem('kraken_triangular_api');
            const apiSecret = localStorage.getItem('kraken_triangular_secret');

            if (!apiKey || !apiSecret) {
                console.error('‚ùå [KRAKEN Worker] Missing credentials');
                return;
            }

            // Initialize balance tracking
            await initializeKrakenBalance(apiKey, apiSecret);

            // Scan every 30 seconds (Kraken has stricter rate limits)
            krakenWorkerInterval = setInterval(async () => {
                try {
                    console.log('üîç [KRAKEN Worker] Scanning for opportunities...');

                    // Get enabled sets
                    const enabledSets = [];
                    for (let i = 1; i <= 10; i++) {
                        const checkbox = document.getElementById(`krakenSet${i}Enabled`);
                        if (checkbox && checkbox.checked) {
                            enabledSets.push(i);
                        }
                    }

                    if (enabledSets.length === 0) {
                        console.warn('‚ö†Ô∏è [KRAKEN Worker] No path sets enabled');
                        return;
                    }

                    // Scan for opportunities
                    const response = await fetch('/api/v1/trading/kraken/triangular/scan', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            apiKey,
                            apiSecret,
                            enabledSets,
                            minProfitPercent: parseFloat(document.getElementById('krakenProfitThreshold')?.value) || 0.5,
                            startAmount: parseFloat(document.getElementById('krakenMaxTrade')?.value) || 1000
                        })
                    });

                    const result = await response.json();

                    if (result.success && result.data) {
                        krakenWorkerStats.totalScans++;
                        const opps = result.data.opportunities || [];
                        krakenWorkerStats.totalOpportunities += opps.length;

                        console.log(`‚úÖ [KRAKEN Worker] Scan complete: ${opps.length} opportunities found`);

                        // Update balance
                        await updateKrakenBalance(apiKey, apiSecret);
                    }
                } catch (error) {
                    console.error('‚ùå [KRAKEN Worker] Scan error:', error);
                }
            }, 30000); // 30 seconds

            console.log('‚úÖ [KRAKEN Worker] Started (scanning every 30 seconds)');
        }

        // Stop Kraken automated worker
        function stopKrakenWorker() {
            if (krakenWorkerInterval) {
                clearInterval(krakenWorkerInterval);
                krakenWorkerInterval = null;
                console.log('üõë [KRAKEN Worker] Stopped');
            }
        }

        // Toggle for Kraken Triangular trading
        document.getElementById('krakenTriangularEnabled').addEventListener('click', async function() {
            console.log('üîÑ [KRAKEN] Toggle clicked');

            const willBeActive = !this.classList.contains('active');
            const status = document.getElementById('krakenTriangularStatus');

            if (willBeActive) {
                // Check if credentials are configured before enabling
                const apiKey = localStorage.getItem('kraken_triangular_api');
                const apiSecret = localStorage.getItem('kraken_triangular_secret');

                if (!apiKey || !apiSecret) {
                    alert('‚ö†Ô∏è Please configure Kraken API credentials in Strategic API Configuration first!');
                    return; // Don't toggle
                }

                // Check if at least one path set is selected
                let hasSelectedPaths = false;
                for (let i = 1; i <= 10; i++) {
                    const checkbox = document.getElementById(`krakenSet${i}Enabled`);
                    if (checkbox && checkbox.checked) {
                        hasSelectedPaths = true;
                        break;
                    }
                }

                if (!hasSelectedPaths) {
                    alert('‚ö†Ô∏è Please select at least one path set before enabling live trading!');
                    return; // Don't toggle
                }

                console.log('‚úÖ [KRAKEN] Live trading enabled');
                this.classList.add('active');
                status.textContent = 'ON';
                status.style.color = '#9966ff';
                localStorage.setItem('krakenTriangularEnabled', 'true');

                // Start automated worker
                await startKrakenWorker();

                console.log('‚úÖ KRAKEN automated trading started! Worker scanning every 30 seconds.');
            } else {
                console.log('‚ùå [KRAKEN] Live trading disabled');

                // Stop automated worker
                stopKrakenWorker();

                this.classList.remove('active');
                status.textContent = 'OFF';
                status.style.color = '#ff6b6b';
                localStorage.setItem('krakenTriangularEnabled', 'false');
                console.log('KRAKEN automated trading stopped');
            }
        });

        // Load saved Kraken toggle state on page load
        document.addEventListener('DOMContentLoaded', async function() {
            const krakenEnabled = localStorage.getItem('krakenTriangularEnabled') === 'true';
            const toggle = document.getElementById('krakenTriangularEnabled');
            const status = document.getElementById('krakenTriangularStatus');

            // Initialize balance display if credentials exist (regardless of worker state)
            const apiKey = localStorage.getItem('kraken_triangular_api');
            const apiSecret = localStorage.getItem('kraken_triangular_secret');

            if (apiKey && apiSecret) {
                console.log('üí∞ [KRAKEN Balance] Fetching balance on page load...');
                await initializeKrakenBalance(apiKey, apiSecret);
            }

            if (krakenEnabled) {
                toggle.classList.add('active');
                status.textContent = 'ON';
                status.style.color = '#9966ff';

                // Auto-start worker if toggle was left ON
                if (apiKey && apiSecret) {
                    console.log('üîÑ [KRAKEN] Auto-starting worker from saved state...');
                    await startKrakenWorker();
                }
            }

            // Load Kraken settings
            loadKrakenTriangularSettings();
        });

        // Test Kraken Triangular Connection
        async function testKrakenTriangularConnection() {
            console.log('üîç [KRAKEN] Testing connection...');
            try {
                // Get credentials from localStorage (saved from strategy-api-setup.html)
                const apiKey = localStorage.getItem('kraken_triangular_api');
                const apiSecret = localStorage.getItem('kraken_triangular_secret');
                console.log('üîë [KRAKEN] API credentials retrieved from localStorage');

                if (!apiKey || !apiSecret) {
                    console.warn('‚ö†Ô∏è [KRAKEN] Missing API credentials');
                    alert('‚ùå Please set up your Kraken API credentials first in the Strategy API Setup page.');
                    return;
                }

                // Show loading message
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = '‚è≥ Testing...';
                btn.disabled = true;

                // Call backend test-connection route
                console.log('üì° [KRAKEN] Sending test connection request to backend...');
                const response = await fetch('/api/v1/trading/kraken/triangular/test-connection', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        apiKey: apiKey,
                        apiSecret: apiSecret
                    })
                });

                const result = await response.json();
                console.log('‚úÖ [KRAKEN] Test connection response received:', result);

                btn.textContent = originalText;
                btn.disabled = false;

                if (result.success) {
                    console.log('‚úÖ [KRAKEN] Connection successful!', result.data);
                    alert(`‚úÖ Kraken Connection Successful!\n\n` +
                          `‚Ä¢ Authenticated: ${result.data.authenticated ? 'Yes' : 'No'}\n` +
                          `‚Ä¢ Balance Access: ${result.data.balanceAccess ? 'Yes' : 'No'}\n` +
                          `‚Ä¢ Available Pairs: ${result.data.availablePairs}\n` +
                          `‚Ä¢ Required Pairs: ${result.data.requiredPairs}\n` +
                          `‚Ä¢ Triangular Ready: ${result.data.triangularReady ? 'Yes' : 'No'}`);
                } else {
                    console.error('‚ùå [KRAKEN] Connection failed:', result.message);
                    alert(`‚ùå Connection Failed: ${result.message || 'Unknown error'}`);
                }
            } catch (error) {
                console.error('‚ùå [KRAKEN] Connection error:', error);
                alert(`‚ùå Connection Error: ${error.message}`);
            }
        }

        // Scan Kraken Triangular Paths
        async function scanKrakenTriangularPaths() {
            console.log('üîç [KRAKEN] Starting path scan...');
            try {
                const apiKey = localStorage.getItem('kraken_triangular_api');
                const apiSecret = localStorage.getItem('kraken_triangular_secret');

                if (!apiKey || !apiSecret) {
                    console.warn('‚ö†Ô∏è [KRAKEN] Missing API credentials');
                    alert('‚ùå Please set up your Kraken API credentials first.');
                    return;
                }

                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = '‚è≥ Scanning...';
                btn.disabled = true;

                // Get enabled path sets
                const enabledSets = [];
                for (let i = 1; i <= 10; i++) {
                    const checkbox = document.getElementById(`krakenSet${i}Enabled`);
                    if (checkbox && checkbox.checked) {
                        enabledSets.push(i);
                    }
                }
                console.log('üìä [KRAKEN] Enabled path sets:', enabledSets);

                console.log('üì° [KRAKEN] Sending scan request to backend...');
                const response = await fetch('/api/v1/trading/kraken/triangular/scan', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        apiKey: apiKey,
                        apiSecret: apiSecret,
                        paths: enabledSets.length > 0 ? enabledSets : 'all'
                    })
                });

                const result = await response.json();
                console.log('‚úÖ [KRAKEN] Scan response received:', result);

                btn.textContent = originalText;
                btn.disabled = false;

                if (result.success) {
                    document.getElementById('krakenLastScan').textContent = new Date().toLocaleTimeString();
                    console.log(`‚úÖ [KRAKEN] Scan successful! Found ${result.data.opportunities.length} opportunities`);

                    let message = `‚úÖ Scan Complete!\n\n`;
                    message += `‚Ä¢ Paths Scanned: ${result.data.scannedPaths}\n`;
                    message += `‚Ä¢ Path Sets: ${result.data.pathSetsScanned}\n`;
                    message += `‚Ä¢ Opportunities Found: ${result.data.opportunities.length}\n\n`;
                    message += `${result.data.message || 'Full scanning implementation coming soon!'}`;

                    alert(message);
                } else {
                    console.error('‚ùå [KRAKEN] Scan failed:', result.message);
                    alert(`‚ùå Scan Failed: ${result.message || 'Unknown error'}`);
                }
            } catch (error) {
                console.error('‚ùå [KRAKEN] Scan error:', error);
                alert(`‚ùå Scan Error: ${error.message}`);
            }
        }

        // View Kraken Path Details - Custom Modal
        function viewKrakenPathDetails() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
                backdrop-filter: blur(5px);
            `;

            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
                padding: 30px;
                border-radius: 15px;
                max-width: 900px;
                max-height: 80vh;
                overflow-y: auto;
                box-shadow: 0 20px 60px rgba(153,102,255, 0.3);
                border: 2px solid #9966ff;
            `;

            modalContent.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <h2 style="color: #9966ff; margin: 0; font-size: 1.8rem;">
                        üìã KRAKEN Triangular Arbitrage Paths
                    </h2>
                    <button onclick="this.closest('[style*=\\'position: fixed\\']').remove()"
                            style="background: rgba(255,0,0,0.2); border: 1px solid #ff4444; color: #ff4444;
                                   padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 1.2rem;">
                        ‚úï
                    </button>
                </div>

                <div style="background: rgba(153,102,255,0.1); padding: 15px; border-radius: 10px; margin-bottom: 20px; border-left: 4px solid #9966ff;">
                    <p style="margin: 0; color: #b8c6db; font-size: 0.95rem;">
                        üí° <strong style="color: #9966ff;">114 Total Paths</strong> across 10 sets.
                        üåç International exchange with USD/USDT/USDC support. Each altcoin has BTC+ETH bridges with forward/reverse paths.
                    </p>
                </div>

                <!-- SET 1: ETH Focus (6 paths) -->
                <div style="background: rgba(153,102,255,0.05); padding: 20px; border-radius: 12px; margin-bottom: 15px; border: 1px solid rgba(153,102,255,0.3);">
                    <h3 style="color: #9966ff; margin-top: 0; font-size: 1.3rem;">
                        üî∑ SET 1: ETH Focus (6 paths) ‚úÖ DEFAULT
                    </h3>
                    <p style="color: #b8c6db; font-size: 0.9rem; margin-bottom: 15px;">BTC bridge only (ETH is target)</p>
                    <div style="display: grid; gap: 8px; font-family: monospace; font-size: 0.9rem;">
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            1. <span style="color: #00ff88;">USD ‚Üí BTC ‚Üí ETH ‚Üí USD</span>
                        </div>
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            2. <span style="color: #00ff88;">USD ‚Üí ETH ‚Üí BTC ‚Üí USD</span>
                        </div>
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            3. <span style="color: #00ff88;">USDT ‚Üí BTC ‚Üí ETH ‚Üí USDT</span>
                        </div>
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            4. <span style="color: #00ff88;">USDT ‚Üí ETH ‚Üí BTC ‚Üí USDT</span>
                        </div>
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            5. <span style="color: #00ff88;">USDC ‚Üí BTC ‚Üí ETH ‚Üí USDC</span>
                        </div>
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            6. <span style="color: #00ff88;">USDC ‚Üí ETH ‚Üí BTC ‚Üí USDC</span>
                        </div>
                    </div>
                </div>

                <!-- SET 2: XRP Focus (12 paths) -->
                <div style="background: rgba(153,102,255,0.05); padding: 20px; border-radius: 12px; margin-bottom: 15px; border: 1px solid rgba(153,102,255,0.3);">
                    <h3 style="color: #9966ff; margin-top: 0; font-size: 1.3rem;">
                        üî∑ SET 2: XRP Focus (12 paths) ‚úÖ DEFAULT
                    </h3>
                    <p style="color: #b8c6db; font-size: 0.9rem; margin-bottom: 15px;">Ripple paths via BTC+ETH bridges</p>
                    <div style="display: grid; gap: 8px; font-family: monospace; font-size: 0.85rem;">
                        <div style="padding: 8px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            <strong style="color: #ffd700;">BTC Bridge:</strong>
                        </div>
                        <div style="padding: 8px; background: rgba(0,0,0,0.3); border-radius: 6px; margin-left: 15px;">
                            1. USD ‚Üí BTC ‚Üí XRP ‚Üí USD &nbsp;|&nbsp; 2. USD ‚Üí XRP ‚Üí BTC ‚Üí USD
                        </div>
                        <div style="padding: 8px; background: rgba(0,0,0,0.3); border-radius: 6px; margin-left: 15px;">
                            3. USDT ‚Üí BTC ‚Üí XRP ‚Üí USDT &nbsp;|&nbsp; 4. USDT ‚Üí XRP ‚Üí BTC ‚Üí USDT
                        </div>
                        <div style="padding: 8px; background: rgba(0,0,0,0.3); border-radius: 6px; margin-left: 15px;">
                            5. USDC ‚Üí BTC ‚Üí XRP ‚Üí USDC &nbsp;|&nbsp; 6. USDC ‚Üí XRP ‚Üí BTC ‚Üí USDC
                        </div>
                        <div style="padding: 8px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            <strong style="color: #ffd700;">ETH Bridge:</strong>
                        </div>
                        <div style="padding: 8px; background: rgba(0,0,0,0.3); border-radius: 6px; margin-left: 15px;">
                            7. USD ‚Üí ETH ‚Üí XRP ‚Üí USD &nbsp;|&nbsp; 8. USD ‚Üí XRP ‚Üí ETH ‚Üí USD
                        </div>
                        <div style="padding: 8px; background: rgba(0,0,0,0.3); border-radius: 6px; margin-left: 15px;">
                            9. USDT ‚Üí ETH ‚Üí XRP ‚Üí USDT &nbsp;|&nbsp; 10. USDT ‚Üí XRP ‚Üí ETH ‚Üí USDT
                        </div>
                        <div style="padding: 8px; background: rgba(0,0,0,0.3); border-radius: 6px; margin-left: 15px;">
                            11. USDC ‚Üí ETH ‚Üí XRP ‚Üí USDC &nbsp;|&nbsp; 12. USDC ‚Üí XRP ‚Üí ETH ‚Üí USDC
                        </div>
                    </div>
                </div>

                <!-- SET 3: SOL Focus (12 paths) -->
                <div style="background: rgba(153,102,255,0.05); padding: 20px; border-radius: 12px; margin-bottom: 15px; border: 1px solid rgba(153,102,255,0.3);">
                    <h3 style="color: #9966ff; margin-top: 0; font-size: 1.3rem;">
                        üî∑ SET 3: SOL Focus (12 paths) ‚úÖ DEFAULT
                    </h3>
                    <p style="color: #b8c6db; font-size: 0.9rem; margin-bottom: 15px;">Solana paths via BTC+ETH bridges</p>
                    <div style="display: grid; gap: 6px; font-family: monospace; font-size: 0.8rem;">
                        <div style="padding: 6px; background: rgba(0,0,0,0.3); border-radius: 4px;">
                            <strong style="color: #ffd700;">BTC:</strong> USD‚ÜíBTC‚ÜíSOL‚ÜíUSD | USD‚ÜíSOL‚ÜíBTC‚ÜíUSD | USDT‚ÜíBTC‚ÜíSOL‚ÜíUSDT | USDT‚ÜíSOL‚ÜíBTC‚ÜíUSDT | USDC‚ÜíBTC‚ÜíSOL‚ÜíUSDC | USDC‚ÜíSOL‚ÜíBTC‚ÜíUSDC
                        </div>
                        <div style="padding: 6px; background: rgba(0,0,0,0.3); border-radius: 4px;">
                            <strong style="color: #ffd700;">ETH:</strong> USD‚ÜíETH‚ÜíSOL‚ÜíUSD | USD‚ÜíSOL‚ÜíETH‚ÜíUSD | USDT‚ÜíETH‚ÜíSOL‚ÜíUSDT | USDT‚ÜíSOL‚ÜíETH‚ÜíUSDT | USDC‚ÜíETH‚ÜíSOL‚ÜíUSDC | USDC‚ÜíSOL‚ÜíETH‚ÜíUSDC
                        </div>
                    </div>
                </div>

                <!-- SET 4: ADA Focus (12 paths) -->
                <div style="background: rgba(153,102,255,0.05); padding: 20px; border-radius: 12px; margin-bottom: 15px; border: 1px solid rgba(153,102,255,0.3);">
                    <h3 style="color: #9966ff; margin-top: 0; font-size: 1.3rem;">
                        üî∑ SET 4: ADA Focus (12 paths)
                    </h3>
                    <p style="color: #b8c6db; font-size: 0.9rem; margin-bottom: 15px;">Cardano paths via BTC+ETH bridges</p>
                    <div style="display: grid; gap: 6px; font-family: monospace; font-size: 0.8rem;">
                        <div style="padding: 6px; background: rgba(0,0,0,0.3); border-radius: 4px;">
                            <strong style="color: #ffd700;">BTC:</strong> USD‚ÜíBTC‚ÜíADA‚ÜíUSD | USD‚ÜíADA‚ÜíBTC‚ÜíUSD | USDT‚ÜíBTC‚ÜíADA‚ÜíUSDT | USDT‚ÜíADA‚ÜíBTC‚ÜíUSDT | USDC‚ÜíBTC‚ÜíADA‚ÜíUSDC | USDC‚ÜíADA‚ÜíBTC‚ÜíUSDC
                        </div>
                        <div style="padding: 6px; background: rgba(0,0,0,0.3); border-radius: 4px;">
                            <strong style="color: #ffd700;">ETH:</strong> USD‚ÜíETH‚ÜíADA‚ÜíUSD | USD‚ÜíADA‚ÜíETH‚ÜíUSD | USDT‚ÜíETH‚ÜíADA‚ÜíUSDT | USDT‚ÜíADA‚ÜíETH‚ÜíUSDT | USDC‚ÜíETH‚ÜíADA‚ÜíUSDC | USDC‚ÜíADA‚ÜíETH‚ÜíUSDC
                        </div>
                    </div>
                </div>

                <!-- SET 5: DOT Focus (12 paths) -->
                <div style="background: rgba(153,102,255,0.05); padding: 20px; border-radius: 12px; margin-bottom: 15px; border: 1px solid rgba(153,102,255,0.3);">
                    <h3 style="color: #9966ff; margin-top: 0; font-size: 1.3rem;">
                        üî∑ SET 5: DOT Focus (12 paths)
                    </h3>
                    <p style="color: #b8c6db; font-size: 0.9rem; margin-bottom: 15px;">Polkadot paths via BTC+ETH bridges</p>
                    <div style="display: grid; gap: 6px; font-family: monospace; font-size: 0.8rem;">
                        <div style="padding: 6px; background: rgba(0,0,0,0.3); border-radius: 4px;">
                            <strong style="color: #ffd700;">BTC:</strong> USD‚ÜíBTC‚ÜíDOT‚ÜíUSD | USD‚ÜíDOT‚ÜíBTC‚ÜíUSD | USDT‚ÜíBTC‚ÜíDOT‚ÜíUSDT | USDT‚ÜíDOT‚ÜíBTC‚ÜíUSDT | USDC‚ÜíBTC‚ÜíDOT‚ÜíUSDC | USDC‚ÜíDOT‚ÜíBTC‚ÜíUSDC
                        </div>
                        <div style="padding: 6px; background: rgba(0,0,0,0.3); border-radius: 4px;">
                            <strong style="color: #ffd700;">ETH:</strong> USD‚ÜíETH‚ÜíDOT‚ÜíUSD | USD‚ÜíDOT‚ÜíETH‚ÜíUSD | USDT‚ÜíETH‚ÜíDOT‚ÜíUSDT | USDT‚ÜíDOT‚ÜíETH‚ÜíUSDT | USDC‚ÜíETH‚ÜíDOT‚ÜíUSDC | USDC‚ÜíDOT‚ÜíETH‚ÜíUSDC
                        </div>
                    </div>
                </div>

                <!-- SET 6: MATIC Focus (12 paths) -->
                <div style="background: rgba(153,102,255,0.05); padding: 20px; border-radius: 12px; margin-bottom: 15px; border: 1px solid rgba(153,102,255,0.3);">
                    <h3 style="color: #9966ff; margin-top: 0; font-size: 1.3rem;">
                        üî∑ SET 6: MATIC Focus (12 paths)
                    </h3>
                    <p style="color: #b8c6db; font-size: 0.9rem; margin-bottom: 15px;">Polygon paths via BTC+ETH bridges</p>
                    <div style="display: grid; gap: 6px; font-family: monospace; font-size: 0.8rem;">
                        <div style="padding: 6px; background: rgba(0,0,0,0.3); border-radius: 4px;">
                            <strong style="color: #ffd700;">BTC:</strong> USD‚ÜíBTC‚ÜíMATIC‚ÜíUSD | USD‚ÜíMATIC‚ÜíBTC‚ÜíUSD | USDT‚ÜíBTC‚ÜíMATIC‚ÜíUSDT | USDT‚ÜíMATIC‚ÜíBTC‚ÜíUSDT | USDC‚ÜíBTC‚ÜíMATIC‚ÜíUSDC | USDC‚ÜíMATIC‚ÜíBTC‚ÜíUSDC
                        </div>
                        <div style="padding: 6px; background: rgba(0,0,0,0.3); border-radius: 4px;">
                            <strong style="color: #ffd700;">ETH:</strong> USD‚ÜíETH‚ÜíMATIC‚ÜíUSD | USD‚ÜíMATIC‚ÜíETH‚ÜíUSD | USDT‚ÜíETH‚ÜíMATIC‚ÜíUSDT | USDT‚ÜíMATIC‚ÜíETH‚ÜíUSDT | USDC‚ÜíETH‚ÜíMATIC‚ÜíUSDC | USDC‚ÜíMATIC‚ÜíETH‚ÜíUSDC
                        </div>
                    </div>
                </div>

                <!-- SET 7: LINK Focus (12 paths) -->
                <div style="background: rgba(153,102,255,0.05); padding: 20px; border-radius: 12px; margin-bottom: 15px; border: 1px solid rgba(153,102,255,0.3);">
                    <h3 style="color: #9966ff; margin-top: 0; font-size: 1.3rem;">
                        üî∑ SET 7: LINK Focus (12 paths)
                    </h3>
                    <p style="color: #b8c6db; font-size: 0.9rem; margin-bottom: 15px;">Chainlink paths via BTC+ETH bridges</p>
                    <div style="display: grid; gap: 6px; font-family: monospace; font-size: 0.8rem;">
                        <div style="padding: 6px; background: rgba(0,0,0,0.3); border-radius: 4px;">
                            <strong style="color: #ffd700;">BTC:</strong> USD‚ÜíBTC‚ÜíLINK‚ÜíUSD | USD‚ÜíLINK‚ÜíBTC‚ÜíUSD | USDT‚ÜíBTC‚ÜíLINK‚ÜíUSDT | USDT‚ÜíLINK‚ÜíBTC‚ÜíUSDT | USDC‚ÜíBTC‚ÜíLINK‚ÜíUSDC | USDC‚ÜíLINK‚ÜíBTC‚ÜíUSDC
                        </div>
                        <div style="padding: 6px; background: rgba(0,0,0,0.3); border-radius: 4px;">
                            <strong style="color: #ffd700;">ETH:</strong> USD‚ÜíETH‚ÜíLINK‚ÜíUSD | USD‚ÜíLINK‚ÜíETH‚ÜíUSD | USDT‚ÜíETH‚ÜíLINK‚ÜíUSDT | USDT‚ÜíLINK‚ÜíETH‚ÜíUSDT | USDC‚ÜíETH‚ÜíLINK‚ÜíUSDC | USDC‚ÜíLINK‚ÜíETH‚ÜíUSDC
                        </div>
                    </div>
                </div>

                <!-- SET 8: LTC Focus (12 paths) -->
                <div style="background: rgba(153,102,255,0.05); padding: 20px; border-radius: 12px; margin-bottom: 15px; border: 1px solid rgba(153,102,255,0.3);">
                    <h3 style="color: #9966ff; margin-top: 0; font-size: 1.3rem;">
                        üî∑ SET 8: LTC Focus (12 paths)
                    </h3>
                    <p style="color: #b8c6db; font-size: 0.9rem; margin-bottom: 15px;">Litecoin paths via BTC+ETH bridges</p>
                    <div style="display: grid; gap: 6px; font-family: monospace; font-size: 0.8rem;">
                        <div style="padding: 6px; background: rgba(0,0,0,0.3); border-radius: 4px;">
                            <strong style="color: #ffd700;">BTC:</strong> USD‚ÜíBTC‚ÜíLTC‚ÜíUSD | USD‚ÜíLTC‚ÜíBTC‚ÜíUSD | USDT‚ÜíBTC‚ÜíLTC‚ÜíUSDT | USDT‚ÜíLTC‚ÜíBTC‚ÜíUSDT | USDC‚ÜíBTC‚ÜíLTC‚ÜíUSDC | USDC‚ÜíLTC‚ÜíBTC‚ÜíUSDC
                        </div>
                        <div style="padding: 6px; background: rgba(0,0,0,0.3); border-radius: 4px;">
                            <strong style="color: #ffd700;">ETH:</strong> USD‚ÜíETH‚ÜíLTC‚ÜíUSD | USD‚ÜíLTC‚ÜíETH‚ÜíUSD | USDT‚ÜíETH‚ÜíLTC‚ÜíUSDT | USDT‚ÜíLTC‚ÜíETH‚ÜíUSDT | USDC‚ÜíETH‚ÜíLTC‚ÜíUSDC | USDC‚ÜíLTC‚ÜíETH‚ÜíUSDC
                        </div>
                    </div>
                </div>

                <!-- SET 9: ATOM Focus (12 paths) -->
                <div style="background: rgba(153,102,255,0.05); padding: 20px; border-radius: 12px; margin-bottom: 15px; border: 1px solid rgba(153,102,255,0.3);">
                    <h3 style="color: #9966ff; margin-top: 0; font-size: 1.3rem;">
                        üî∑ SET 9: ATOM Focus (12 paths)
                    </h3>
                    <p style="color: #b8c6db; font-size: 0.9rem; margin-bottom: 15px;">Cosmos paths via BTC+ETH bridges</p>
                    <div style="display: grid; gap: 6px; font-family: monospace; font-size: 0.8rem;">
                        <div style="padding: 6px; background: rgba(0,0,0,0.3); border-radius: 4px;">
                            <strong style="color: #ffd700;">BTC:</strong> USD‚ÜíBTC‚ÜíATOM‚ÜíUSD | USD‚ÜíATOM‚ÜíBTC‚ÜíUSD | USDT‚ÜíBTC‚ÜíATOM‚ÜíUSDT | USDT‚ÜíATOM‚ÜíBTC‚ÜíUSDT | USDC‚ÜíBTC‚ÜíATOM‚ÜíUSDC | USDC‚ÜíATOM‚ÜíBTC‚ÜíUSDC
                        </div>
                        <div style="padding: 6px; background: rgba(0,0,0,0.3); border-radius: 4px;">
                            <strong style="color: #ffd700;">ETH:</strong> USD‚ÜíETH‚ÜíATOM‚ÜíUSD | USD‚ÜíATOM‚ÜíETH‚ÜíUSD | USDT‚ÜíETH‚ÜíATOM‚ÜíUSDT | USDT‚ÜíATOM‚ÜíETH‚ÜíUSDT | USDC‚ÜíETH‚ÜíATOM‚ÜíUSDC | USDC‚ÜíATOM‚ÜíETH‚ÜíUSDC
                        </div>
                    </div>
                </div>

                <!-- SET 10: AVAX Focus (12 paths) -->
                <div style="background: rgba(153,102,255,0.05); padding: 20px; border-radius: 12px; margin-bottom: 15px; border: 1px solid rgba(153,102,255,0.3);">
                    <h3 style="color: #9966ff; margin-top: 0; font-size: 1.3rem;">
                        üî∑ SET 10: AVAX Focus (12 paths)
                    </h3>
                    <p style="color: #b8c6db; font-size: 0.9rem; margin-bottom: 15px;">Avalanche paths via BTC+ETH bridges</p>
                    <div style="display: grid; gap: 6px; font-family: monospace; font-size: 0.8rem;">
                        <div style="padding: 6px; background: rgba(0,0,0,0.3); border-radius: 4px;">
                            <strong style="color: #ffd700;">BTC:</strong> USD‚ÜíBTC‚ÜíAVAX‚ÜíUSD | USD‚ÜíAVAX‚ÜíBTC‚ÜíUSD | USDT‚ÜíBTC‚ÜíAVAX‚ÜíUSDT | USDT‚ÜíAVAX‚ÜíBTC‚ÜíUSDT | USDC‚ÜíBTC‚ÜíAVAX‚ÜíUSDC | USDC‚ÜíAVAX‚ÜíBTC‚ÜíUSDC
                        </div>
                        <div style="padding: 6px; background: rgba(0,0,0,0.3); border-radius: 4px;">
                            <strong style="color: #ffd700;">ETH:</strong> USD‚ÜíETH‚ÜíAVAX‚ÜíUSD | USD‚ÜíAVAX‚ÜíETH‚ÜíUSD | USDT‚ÜíETH‚ÜíAVAX‚ÜíUSDT | USDT‚ÜíAVAX‚ÜíETH‚ÜíUSDT | USDC‚ÜíETH‚ÜíAVAX‚ÜíUSDC | USDC‚ÜíAVAX‚ÜíETH‚ÜíUSDC
                        </div>
                    </div>
                </div>

                <div style="background: rgba(0,212,255,0.1); padding: 15px; border-radius: 10px; margin-top: 20px; border-left: 4px solid #00d4ff;">
                    <p style="margin: 0; color: #b8c6db; font-size: 0.9rem;">
                        <strong style="color: #00d4ff;">üí° Path Pattern:</strong> Each SET (except ETH) has 12 paths:
                        <br>‚Ä¢ 6 via BTC bridge (3 currencies √ó 2 directions)
                        <br>‚Ä¢ 6 via ETH bridge (3 currencies √ó 2 directions)
                        <br>‚Ä¢ Covers all funding options: USD, USDT, USDC
                    </p>
                </div>
            `;

            modal.appendChild(modalContent);
            document.body.appendChild(modal);

            // Close on background click
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });

            console.log('üìã [KRAKEN] Path details modal displayed');
        }

        // Clear Kraken Triangular History
        async function clearKrakenTriangularHistory() {
            console.log('üóëÔ∏è [KRAKEN] Clear history requested');
            if (!confirm('‚ö†Ô∏è Clear all Kraken triangular trade history?\n\nThis action cannot be undone.')) {
                console.log('‚ùå [KRAKEN] Clear history cancelled by user');
                return;
            }

            try {
                console.log('üì° [KRAKEN] Sending delete request to backend...');
                const response = await fetch('/api/v1/trading/kraken/triangular/history', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const result = await response.json();
                console.log('‚úÖ [KRAKEN] Delete response received:', result);

                if (result.success) {
                    console.log('‚úÖ [KRAKEN] History cleared, resetting UI stats...');
                    // Reset stats display
                    document.getElementById('krakenTotalTrades').textContent = '0';
                    document.getElementById('krakenSuccessfulTrades').textContent = '0';
                    document.getElementById('krakenSuccessRate').textContent = '0%';
                    document.getElementById('krakenTotalProfit').textContent = '$0.00';
                    document.getElementById('krakenBestPath').textContent = '-';
                    document.getElementById('krakenLastScan').textContent = 'Never';

                    // Clear recent trades display
                    document.getElementById('krakenRecentTrades').innerHTML =
                        '<div style="text-align: center; color: #888; padding: 20px;">No triangular trades yet. Enable live trading to start.</div>';

                    alert(`‚úÖ History cleared successfully!\n\nDeleted ${result.data.deletedCount} records.`);
                } else {
                    console.error('‚ùå [KRAKEN] Failed to clear history:', result.message);
                    alert(`‚ùå Failed to clear history: ${result.message || 'Unknown error'}`);
                }
            } catch (error) {
                console.error('‚ùå [KRAKEN] Clear history error:', error);
                alert(`‚ùå Error: ${error.message}`);
            }
        }

        // Save Kraken settings to localStorage
        function saveKrakenTriangularSettings() {
            console.log('üíæ [KRAKEN] Saving settings to localStorage...');
            const settings = {
                maxTrade: document.getElementById('krakenMaxTrade').value,
                portfolioPercent: document.getElementById('krakenPortfolioPercent').value,
                profitThreshold: document.getElementById('krakenProfitThreshold').value
            };

            // Save path set states (10 sets for Kraken)
            for (let i = 1; i <= 10; i++) {
                const checkbox = document.getElementById(`krakenSet${i}Enabled`);
                if (checkbox) {
                    settings[`set${i}Enabled`] = checkbox.checked;
                }
            }

            localStorage.setItem('krakenTriangularSettings', JSON.stringify(settings));
            console.log('‚úÖ [KRAKEN] Settings saved:', settings);
        }

        // Load Kraken settings from localStorage
        function loadKrakenTriangularSettings() {
            console.log('üíæ [KRAKEN] Loading settings from localStorage...');
            const savedSettings = localStorage.getItem('krakenTriangularSettings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                console.log('‚úÖ [KRAKEN] Settings loaded:', settings);

                if (settings.maxTrade) document.getElementById('krakenMaxTrade').value = settings.maxTrade;
                if (settings.portfolioPercent) document.getElementById('krakenPortfolioPercent').value = settings.portfolioPercent;
                if (settings.profitThreshold) document.getElementById('krakenProfitThreshold').value = settings.profitThreshold;

                // Load path set states (10 sets)
                for (let i = 1; i <= 10; i++) {
                    const checkbox = document.getElementById(`krakenSet${i}Enabled`);
                    if (checkbox && settings[`set${i}Enabled`] !== undefined) {
                        checkbox.checked = settings[`set${i}Enabled`];
                    }
                }
            } else {
                console.log('‚ÑπÔ∏è [KRAKEN] No saved settings found, using defaults');
            }
        }

        // Auto-save Kraken settings when changed
        document.addEventListener('DOMContentLoaded', function() {
            // Add event listeners for Kraken settings auto-save
            const krakenInputs = document.querySelectorAll('#krakenMaxTrade, #krakenPortfolioPercent, #krakenProfitThreshold');
            krakenInputs.forEach(input => {
                input.addEventListener('change', saveKrakenTriangularSettings);
            });

            // Add event listeners for Kraken checkboxes (10 sets)
            for (let i = 1; i <= 10; i++) {
                const checkbox = document.getElementById(`krakenSet${i}Enabled`);
                if (checkbox) {
                    checkbox.addEventListener('change', saveKrakenTriangularSettings);
                }
            }
        });

        // ============================================================================
        // KRAKEN TAB SWITCHING & HELPER FUNCTIONS
        // ============================================================================

        /**
         * Switch between Kraken tabs (Trades, Balance, Alerts)
         */
        function switchKrakenTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.kraken-tab-content').forEach(tab => {
                tab.style.display = 'none';
            });

            // Remove active state from all buttons
            document.querySelectorAll('.kraken-tab-btn').forEach(btn => {
                btn.style.background = 'rgba(255,255,255,0.03)';
                btn.style.border = '1px solid transparent';
                btn.style.color = '#888';
            });

            // Show selected tab content
            const tabContent = document.getElementById(`krakenTab${tabName.charAt(0).toUpperCase() + tabName.slice(1)}`);
            if (tabContent) {
                tabContent.style.display = 'block';
            }

            // Activate selected button
            const activeBtn = document.querySelector(`.kraken-tab-btn[data-tab="${tabName}"]`);
            if (activeBtn) {
                activeBtn.style.background = 'rgba(153,102,255,0.15)';
                activeBtn.style.border = '1px solid #9966ff';
                activeBtn.style.color = '#9966ff';
            }

            console.log(`üîÑ [KRAKEN] Switched to ${tabName} tab`);
        }

        /**
         * Reset Kraken starting balance to current balance
         */
        function resetKrakenStartingBalance() {
            const confirm = window.confirm('Reset starting balance to current balance?\n\nThis will use the current balance as the new baseline for profit/loss tracking.');

            if (!confirm) return;

            // Get current balances
            const currentUSD = document.getElementById('krakenCurrentUSD').textContent;
            const currentUSDT = document.getElementById('krakenCurrentUSDT').textContent;
            const currentUSDC = document.getElementById('krakenCurrentUSDC').textContent;

            // Set as starting balances
            document.getElementById('krakenStartingUSD').textContent = currentUSD;
            document.getElementById('krakenStartingUSDT').textContent = currentUSDT;
            document.getElementById('krakenStartingUSDC').textContent = currentUSDC;

            // Reset change indicators
            document.getElementById('krakenChangeUSD').textContent = '+$0.00 (+0%)';
            document.getElementById('krakenChangeUSD').style.color = '#888';
            document.getElementById('krakenChangeUSDT').textContent = '+$0.00 (+0%)';
            document.getElementById('krakenChangeUSDT').style.color = '#888';
            document.getElementById('krakenChangeUSDC').textContent = '+$0.00 (+0%)';
            document.getElementById('krakenChangeUSDC').style.color = '#888';

            // Save to localStorage
            const balanceData = {
                startingUSD: currentUSD,
                startingUSDT: currentUSDT,
                startingUSDC: currentUSDC,
                resetTime: new Date().toISOString()
            };
            localStorage.setItem('krakenBalanceBaseline', JSON.stringify(balanceData));

            console.log('‚úÖ [KRAKEN] Starting balance reset', balanceData);

            // Show confirmation
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #9966ff 0%, #7744cc 100%);
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                z-index: 10000;
                font-weight: bold;
            `;
            notification.textContent = '‚úÖ Starting balance reset successfully';
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transition = 'opacity 0.5s';
                setTimeout(() => notification.remove(), 500);
            }, 2000);
        }

        /**
         * Clear all Kraken alerts
         */
        function clearKrakenAlerts() {
            const alertsList = document.getElementById('krakenAlertsList');
            alertsList.innerHTML = `
                <div style="text-align: center; color: #888; padding: 20px;">
                    No alerts. Worker running smoothly. ‚úÖ
                </div>
            `;

            // Reset badge
            const badge = document.getElementById('krakenAlertBadge');
            if (badge) {
                badge.style.display = 'none';
                badge.textContent = '0';
            }

            console.log('üßπ [KRAKEN] Alerts cleared');
        }

        // ============================================================================
        // BYBIT TRIANGULAR ARBITRAGE JAVASCRIPT
        // ============================================================================

        // Tab Switcher for Balance Tracker / Recent Trades
        function switchBybitTab(tab) {
            const balanceTab = document.getElementById('bybitBalanceTab');
            const tradesTab = document.getElementById('bybitTradesTab');
            const balanceContent = document.getElementById('bybitBalanceContent');
            const tradesContent = document.getElementById('bybitTradesContent');

            if (tab === 'balance') {
                // Activate Balance tab
                balanceTab.style.background = 'rgba(255,165,0,0.3)';
                balanceTab.style.color = '#FFA500';
                balanceTab.style.fontWeight = 'bold';
                tradesTab.style.background = 'rgba(255,255,255,0.05)';
                tradesTab.style.color = '#b8c6db';
                tradesTab.style.fontWeight = 'normal';

                balanceContent.style.display = 'block';
                tradesContent.style.display = 'none';
            } else {
                // Activate Trades tab
                tradesTab.style.background = 'rgba(255,165,0,0.3)';
                tradesTab.style.color = '#FFA500';
                tradesTab.style.fontWeight = 'bold';
                balanceTab.style.background = 'rgba(255,255,255,0.05)';
                balanceTab.style.color = '#b8c6db';
                balanceTab.style.fontWeight = 'normal';

                tradesContent.style.display = 'block';
                balanceContent.style.display = 'none';
            }
        }

        // Worker Infrastructure
        let bybitWorkerStats = {
            totalScans: 0,
            totalOpportunities: 0,
            totalTrades: 0,
            successfulTrades: 0,
            totalProfit: 0,
            bestPath: null,
            bestProfit: 0
        };

        let bybitBalanceTracking = {
            startingUSDT: null,
            currentUSDT: 0
        };

        let bybitWorkerInterval = null;
        let bybitWorkerRunning = false;

        // Binance Worker Variables
        let binanceWorkerStats = {
            totalScans: 0,
            totalOpportunities: 0,
            lastScanTime: null
        };
        let binanceWorkerInterval = null;
        let binanceWorkerRunning = false;
        let binanceBalanceTracking = {
            startingUSDT: null,
            currentUSDT: 0
        };

        // OKX Worker Variables
        let okxWorkerStats = {
            totalScans: 0,
            totalOpportunities: 0,
            lastScanTime: null
        };
        let okxWorkerInterval = null;
        let okxWorkerRunning = false;
        let okxBalanceTracking = {
            startingUSDT: null,
            currentUSDT: 0
        };

        // Initialize ByBit balance on page load or worker start
        async function initializeBybitBalance(apiKey, apiSecret) {
            try {
                console.log('üí∞ [BYBIT Balance] Initializing balance tracking...');

                // Fetch current balance from ByBit
                const response = await fetch('/api/v1/trading/bybit/balance', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ apiKey, apiSecret })
                });

                const result = await response.json();

                if (result.success && result.data && result.data.balances) {
                    const balances = result.data.balances;
                    bybitBalanceTracking.currentUSDT = parseFloat(balances.USDT || 0);

                    // Set starting balance if first time
                    const savedStarting = localStorage.getItem('bybitStartingUSDT');
                    if (!savedStarting) {
                        bybitBalanceTracking.startingUSDT = bybitBalanceTracking.currentUSDT;
                        localStorage.setItem('bybitStartingUSDT', bybitBalanceTracking.startingUSDT.toString());
                        console.log(`üí∞ [BYBIT Balance] Starting USDT set: $${bybitBalanceTracking.startingUSDT.toFixed(2)}`);
                    } else {
                        bybitBalanceTracking.startingUSDT = parseFloat(savedStarting);
                        console.log(`üí∞ [BYBIT Balance] Starting USDT loaded: $${bybitBalanceTracking.startingUSDT.toFixed(2)}`);
                    }

                    updateBybitBalanceDisplay();
                } else {
                    console.error('‚ùå [BYBIT Balance] Failed to fetch balance:', result);
                }
            } catch (error) {
                console.error('‚ùå [BYBIT Balance] Error initializing:', error);
            }
        }

        // Update ByBit balance
        async function updateBybitBalance(apiKey, apiSecret) {
            try {
                const response = await fetch('/api/v1/trading/bybit/balance', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ apiKey, apiSecret })
                });

                const result = await response.json();

                if (result.success && result.data && result.data.balances) {
                    const balances = result.data.balances;
                    bybitBalanceTracking.currentUSDT = parseFloat(balances.USDT || 0);
                    updateBybitBalanceDisplay();
                }
            } catch (error) {
                console.error('‚ùå [BYBIT Balance] Error updating:', error);
            }
        }

        // Update ByBit balance display
        function updateBybitBalanceDisplay() {
            const starting = bybitBalanceTracking.startingUSDT || 0;
            const current = bybitBalanceTracking.currentUSDT || 0;
            const change = current - starting;
            const changePercent = starting > 0 ? ((change / starting) * 100) : 0;

            // Update USDT display
            document.getElementById('bybitStartingUSDT').textContent = `$${starting.toFixed(2)}`;
            document.getElementById('bybitCurrentUSDT').textContent = `$${current.toFixed(2)}`;

            const changeColor = change >= 0 ? '#00ff88' : '#ff6b6b';
            const changeSign = change >= 0 ? '+' : '';
            document.getElementById('bybitChangeUSDT').innerHTML = `
                <span style="color: ${changeColor};">${changeSign}$${change.toFixed(2)} (${changeSign}${changePercent.toFixed(2)}%)</span>
            `;
        }

        // ============================================================
        // BINANCE TAB SWITCHING & BALANCE TRACKING
        // ============================================================

        // Switch between Binance tabs
        function switchBinanceTab(tab) {
            const balanceTab = document.getElementById('binanceBalanceTab');
            const tradesTab = document.getElementById('binanceTradesTab');
            const balanceContent = document.getElementById('binanceBalanceContent');
            const tradesContent = document.getElementById('binanceTradesContent');

            if (tab === 'balance') {
                // Activate Balance tab
                balanceTab.style.background = 'rgba(240,185,11,0.3)';
                balanceTab.style.color = '#F0B90B';
                balanceTab.style.fontWeight = 'bold';
                tradesTab.style.background = 'rgba(255,255,255,0.05)';
                tradesTab.style.color = '#b8c6db';
                tradesTab.style.fontWeight = 'normal';

                balanceContent.style.display = 'block';
                tradesContent.style.display = 'none';
            } else {
                // Activate Trades tab
                tradesTab.style.background = 'rgba(240,185,11,0.3)';
                tradesTab.style.color = '#F0B90B';
                tradesTab.style.fontWeight = 'bold';
                balanceTab.style.background = 'rgba(255,255,255,0.05)';
                balanceTab.style.color = '#b8c6db';
                balanceTab.style.fontWeight = 'normal';

                balanceContent.style.display = 'none';
                tradesContent.style.display = 'block';
            }
        }

        // Initialize Binance balance on page load or worker start
        async function initializeBinanceBalance(apiKey, apiSecret) {
            try {
                console.log('üí∞ [BINANCE Balance] Initializing balance tracking...');

                const response = await fetch('/api/v1/trading/binance/balance', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ apiKey, apiSecret })
                });

                const result = await response.json();

                if (result.success && result.data && result.data.balances) {
                    const balances = result.data.balances;
                    binanceBalanceTracking.currentUSDT = parseFloat(balances.USDT || 0);

                    // Set starting balance if first time
                    const savedStarting = localStorage.getItem('binanceStartingUSDT');
                    if (!savedStarting) {
                        binanceBalanceTracking.startingUSDT = binanceBalanceTracking.currentUSDT;
                        localStorage.setItem('binanceStartingUSDT', binanceBalanceTracking.startingUSDT.toString());
                        console.log(`üí∞ [BINANCE Balance] Starting USDT set: $${binanceBalanceTracking.startingUSDT.toFixed(2)}`);
                    } else {
                        binanceBalanceTracking.startingUSDT = parseFloat(savedStarting);
                        console.log(`üí∞ [BINANCE Balance] Starting USDT loaded: $${binanceBalanceTracking.startingUSDT.toFixed(2)}`);
                    }

                    updateBinanceBalanceDisplay();
                } else {
                    console.error('‚ùå [BINANCE Balance] Failed to fetch balance:', result);
                }
            } catch (error) {
                console.error('‚ùå [BINANCE Balance] Error initializing:', error);
            }
        }

        // Update Binance balance
        async function updateBinanceBalance(apiKey, apiSecret) {
            try {
                const response = await fetch('/api/v1/trading/binance/balance', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ apiKey, apiSecret })
                });

                const result = await response.json();

                if (result.success && result.data && result.data.balances) {
                    const balances = result.data.balances;
                    binanceBalanceTracking.currentUSDT = parseFloat(balances.USDT || 0);
                    updateBinanceBalanceDisplay();
                }
            } catch (error) {
                console.error('‚ùå [BINANCE Balance] Error updating:', error);
            }
        }

        // Update Binance balance display
        function updateBinanceBalanceDisplay() {
            const starting = binanceBalanceTracking.startingUSDT || 0;
            const current = binanceBalanceTracking.currentUSDT || 0;
            const change = current - starting;
            const changePercent = starting > 0 ? ((change / starting) * 100) : 0;

            // Update USDT display
            document.getElementById('binanceStartingUSDT').textContent = `$${starting.toFixed(2)}`;
            document.getElementById('binanceCurrentUSDT').textContent = `$${current.toFixed(2)}`;

            const changeColor = change >= 0 ? '#00ff88' : '#ff6b6b';
            const changeSign = change >= 0 ? '+' : '';
            document.getElementById('binanceChangeUSDT').innerHTML = `
                <span style="color: ${changeColor};">${changeSign}$${change.toFixed(2)} (${changeSign}${changePercent.toFixed(2)}%)</span>
            `;
        }

        // ============================================================
        // OKX TAB SWITCHING & BALANCE TRACKING
        // ============================================================

        // Switch between OKX tabs
        function switchOKXTab(tab) {
            const balanceTab = document.getElementById('okxBalanceTab');
            const tradesTab = document.getElementById('okxTradesTab');
            const balanceContent = document.getElementById('okxBalanceContent');
            const tradesContent = document.getElementById('okxTradesContent');

            if (tab === 'balance') {
                // Activate Balance tab
                balanceTab.style.background = 'rgba(0,166,255,0.3)';
                balanceTab.style.color = '#00A6FF';
                balanceTab.style.fontWeight = 'bold';
                tradesTab.style.background = 'rgba(255,255,255,0.05)';
                tradesTab.style.color = '#b8c6db';
                tradesTab.style.fontWeight = 'normal';

                balanceContent.style.display = 'block';
                tradesContent.style.display = 'none';
            } else {
                // Activate Trades tab
                tradesTab.style.background = 'rgba(0,166,255,0.3)';
                tradesTab.style.color = '#00A6FF';
                tradesTab.style.fontWeight = 'bold';
                balanceTab.style.background = 'rgba(255,255,255,0.05)';
                balanceTab.style.color = '#b8c6db';
                balanceTab.style.fontWeight = 'normal';

                balanceContent.style.display = 'none';
                tradesContent.style.display = 'block';
            }
        }

        // Initialize OKX balance on page load or worker start
        async function initializeOKXBalance(apiKey, apiSecret, passphrase) {
            try {
                console.log('üí∞ [OKX Balance] Initializing balance tracking...');

                const response = await fetch('/api/v1/trading/okx/balance', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ apiKey, apiSecret, passphrase })
                });

                const result = await response.json();

                if (result.success && result.data && result.data.balances) {
                    const balances = result.data.balances;
                    okxBalanceTracking.currentUSDT = parseFloat(balances.USDT || 0);

                    // Set starting balance if first time
                    const savedStarting = localStorage.getItem('okxStartingUSDT');
                    if (!savedStarting) {
                        okxBalanceTracking.startingUSDT = okxBalanceTracking.currentUSDT;
                        localStorage.setItem('okxStartingUSDT', okxBalanceTracking.startingUSDT.toString());
                        console.log(`üí∞ [OKX Balance] Starting USDT set: $${okxBalanceTracking.startingUSDT.toFixed(2)}`);
                    } else {
                        okxBalanceTracking.startingUSDT = parseFloat(savedStarting);
                        console.log(`üí∞ [OKX Balance] Starting USDT loaded: $${okxBalanceTracking.startingUSDT.toFixed(2)}`);
                    }

                    updateOKXBalanceDisplay();
                } else {
                    console.error('‚ùå [OKX Balance] Failed to fetch balance:', result);
                }
            } catch (error) {
                console.error('‚ùå [OKX Balance] Error initializing:', error);
            }
        }

        // Update OKX balance
        async function updateOKXBalance(apiKey, apiSecret, passphrase) {
            try {
                const response = await fetch('/api/v1/trading/okx/balance', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ apiKey, apiSecret, passphrase })
                });

                const result = await response.json();

                if (result.success && result.data && result.data.balances) {
                    const balances = result.data.balances;
                    okxBalanceTracking.currentUSDT = parseFloat(balances.USDT || 0);
                    updateOKXBalanceDisplay();
                }
            } catch (error) {
                console.error('‚ùå [OKX Balance] Error updating:', error);
            }
        }

        // Update OKX balance display
        function updateOKXBalanceDisplay() {
            const starting = okxBalanceTracking.startingUSDT || 0;
            const current = okxBalanceTracking.currentUSDT || 0;
            const change = current - starting;
            const changePercent = starting > 0 ? ((change / starting) * 100) : 0;

            // Update USDT display
            document.getElementById('okxStartingUSDT').textContent = `$${starting.toFixed(2)}`;
            document.getElementById('okxCurrentUSDT').textContent = `$${current.toFixed(2)}`;

            const changeColor = change >= 0 ? '#00ff88' : '#ff6b6b';
            const changeSign = change >= 0 ? '+' : '';
            document.getElementById('okxChangeUSDT').innerHTML = `
                <span style="color: ${changeColor};">${changeSign}$${change.toFixed(2)} (${changeSign}${changePercent.toFixed(2)}%)</span>
            `;
        }

        // Scan a single ByBit set
        async function scanBybitSet(apiKey, apiSecret, setNumber) {
            try {
                console.log(`üîç [BYBIT Worker] Scanning SET_${setNumber}...`);

                // Get risk settings from UI
                const maxTradeAmount = parseFloat(document.getElementById('bybitMaxTrade')?.value || 100);
                const profitThreshold = parseFloat(document.getElementById('bybitProfitThreshold')?.value || 0.5);
                const portfolioPercent = parseFloat(document.getElementById('bybitPortfolioPercent')?.value || 10);

                // Get current balance (from balance tracking)
                const currentBalance = bybitBalanceTracking.currentUSDT || 0;

                // Scan for opportunities for this specific set
                const response = await fetch('/api/v1/trading/bybit/triangular/scan', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        apiKey,
                        apiSecret,
                        paths: [setNumber],  // Scan only this set
                        maxTradeAmount: maxTradeAmount,
                        profitThreshold: profitThreshold,
                        portfolioPercent: portfolioPercent,
                        currentBalance: currentBalance
                    })
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error(`‚ùå [BYBIT Worker] SET_${setNumber} API error (${response.status}):`, errorText);
                    return;
                }

                const result = await response.json();

                if (result.success) {
                    const oppCount = result.data?.opportunities?.length || 0;
                    bybitWorkerStats.totalOpportunities += oppCount;

                    console.log(`‚úÖ [BYBIT Worker] SET_${setNumber} complete: ${oppCount} opportunities found`);

                    // Log portfolio calculation details
                    if (result.data?.portfolioCalculation) {
                        const calc = result.data.portfolioCalculation;
                        console.log(`üí∞ [BYBIT Portfolio] Balance: $${calc.balance}, ${calc.portfolioPercent}% = $${calc.portfolioAmount}, Cap: ${calc.appliedCap}, Can Trade: ${calc.canTrade}`);
                    }

                    // Display warnings (non-blocking)
                    if (result.data?.warnings && result.data.warnings.length > 0) {
                        result.data.warnings.forEach(warning => {
                            console.warn(`‚ö†Ô∏è [BYBIT Portfolio] ${warning}`);
                        });
                    }

                    if (oppCount > 0) {
                        console.log(`üí∞ [BYBIT Worker] SET_${setNumber} Opportunities:`, result.data.opportunities);
                    }
                } else {
                    console.warn(`‚ö†Ô∏è [BYBIT Worker] SET_${setNumber} unsuccessful:`, result.message || 'Unknown error');
                }

            } catch (error) {
                console.error(`‚ùå [BYBIT Worker] SET_${setNumber} scan error:`, error);
            }
        }

        // Sequential scanning cycle through all enabled sets
        async function performBybitSequentialScan(apiKey, apiSecret) {
            // Check if worker was stopped
            if (!bybitWorkerRunning) {
                console.log('‚èπÔ∏è [BYBIT Worker] Scan cycle aborted - worker stopped');
                return;
            }

            bybitWorkerStats.totalScans++;
            console.log(`\nüîÑ [BYBIT Worker] ‚ïê‚ïê‚ïê Scan Cycle #${bybitWorkerStats.totalScans} Starting ‚ïê‚ïê‚ïê`);

            // Get enabled path sets
            const enabledSets = [];
            for (let i = 1; i <= 5; i++) {
                const checkbox = document.getElementById(`bybitSet${i}Enabled`);
                if (checkbox && checkbox.checked) {
                    enabledSets.push(i);
                }
            }

            if (enabledSets.length === 0) {
                console.warn('‚ö†Ô∏è [BYBIT Worker] No path sets enabled');
                return;
            }

            console.log(`üìã [BYBIT Worker] Enabled sets: [${enabledSets.join(', ')}] - Scanning sequentially...`);

            // Scan each enabled set with 5-second delay between sets
            for (let i = 0; i < enabledSets.length; i++) {
                // Check if worker was stopped before each set
                if (!bybitWorkerRunning) {
                    console.log('‚èπÔ∏è [BYBIT Worker] Scan cycle aborted mid-cycle - worker stopped');
                    return;
                }

                const setNumber = enabledSets[i];
                await scanBybitSet(apiKey, apiSecret, setNumber);

                // Wait 5 seconds before next set (except after last set)
                if (i < enabledSets.length - 1) {
                    console.log(`‚è≥ [BYBIT Worker] Waiting 5 seconds before next set...`);
                    await new Promise(resolve => setTimeout(resolve, 5000));
                }
            }

            // Update balance after completing all sets
            await updateBybitBalance(apiKey, apiSecret);

            document.getElementById('bybitLastScan').textContent = new Date().toLocaleTimeString();
            console.log(`‚úÖ [BYBIT Worker] ‚ïê‚ïê‚ïê Scan Cycle #${bybitWorkerStats.totalScans} Complete ‚ïê‚ïê‚ïê\n`);
        }

        // Start ByBit automated worker (sequential scanning)
        async function startBybitWorker() {
            bybitWorkerRunning = true;  // Enable worker flag
            console.log('üîÑ [BYBIT Worker] Starting sequential scanning...');

            const apiKey = localStorage.getItem('bybit_triangular_api');
            const apiSecret = localStorage.getItem('bybit_triangular_secret');

            if (!apiKey || !apiSecret) {
                console.error('‚ùå [BYBIT Worker] Missing API credentials');
                return;
            }

            // Initialize balance tracking
            await initializeBybitBalance(apiKey, apiSecret);

            // Perform immediate first scan cycle
            console.log('üöÄ [BYBIT Worker] Performing immediate first scan cycle...');
            await performBybitSequentialScan(apiKey, apiSecret);

            // Continue scanning cycles every 30 seconds
            bybitWorkerInterval = setInterval(async () => {
                await performBybitSequentialScan(apiKey, apiSecret);
            }, 30000); // 30 seconds between cycles

            console.log('‚úÖ [BYBIT Worker] Sequential scanning started (cycles every 30s, 5s delay between sets)');
        }

        // Stop ByBit automated worker
        function stopBybitWorker() {
            bybitWorkerRunning = false;  // Disable worker flag to abort any running scan
            if (bybitWorkerInterval) {
                clearInterval(bybitWorkerInterval);
                bybitWorkerInterval = null;
                console.log('‚èπÔ∏è [BYBIT Worker] Automated scanning stopped');
            }
        }

        // Toggle for ByBit Triangular trading
        document.getElementById('bybitTriangularEnabled').addEventListener('click', async function() {
            console.log('üîÑ [BYBIT] Toggle clicked');

            const isCurrentlyActive = this.classList.contains('active');
            const status = document.getElementById('bybitTriangularStatus');

            if (!isCurrentlyActive) {
                // Enabling - validate credentials first
                const apiKey = localStorage.getItem('bybit_triangular_api');
                const apiSecret = localStorage.getItem('bybit_triangular_secret');

                if (!apiKey || !apiSecret) {
                    console.warn('‚ö†Ô∏è [BYBIT] Missing API credentials');
                    alert('‚ùå Please set up your ByBit API credentials first in the Strategy API Setup page.');
                    return;
                }

                // Validate at least one path set is enabled
                const enabledSets = [];
                for (let i = 1; i <= 5; i++) {
                    const checkbox = document.getElementById(`bybitSet${i}Enabled`);
                    if (checkbox && checkbox.checked) {
                        enabledSets.push(i);
                    }
                }

                if (enabledSets.length === 0) {
                    console.warn('‚ö†Ô∏è [BYBIT] No path sets enabled');
                    alert('‚ùå Please enable at least one path set before starting automated trading.');
                    return;
                }

                console.log('‚úÖ [BYBIT] Live trading enabled');
                this.classList.add('active');
                status.textContent = 'ON';
                status.style.color = '#FFA500';
                localStorage.setItem('bybitTriangularEnabled', 'true');

                // Start the worker
                await startBybitWorker();
            } else {
                // Disabling
                console.log('‚ùå [BYBIT] Live trading disabled');
                this.classList.remove('active');
                status.textContent = 'OFF';
                status.style.color = '#ff6b6b';
                localStorage.setItem('bybitTriangularEnabled', 'false');

                // Stop the worker
                stopBybitWorker();
            }
        });

        // Load saved ByBit toggle state on page load
        document.addEventListener('DOMContentLoaded', async function() {
            const bybitEnabled = localStorage.getItem('bybitTriangularEnabled') === 'true';
            const toggle = document.getElementById('bybitTriangularEnabled');
            const status = document.getElementById('bybitTriangularStatus');

            // Load ByBit settings first
            loadByBitTriangularSettings();

            // Initialize balance if credentials exist
            const apiKey = localStorage.getItem('bybit_triangular_api');
            const apiSecret = localStorage.getItem('bybit_triangular_secret');

            if (apiKey && apiSecret) {
                console.log('üí∞ [BYBIT] Initializing balance on page load...');
                await initializeBybitBalance(apiKey, apiSecret);
            }

            // Restore toggle state and auto-start worker if previously enabled
            if (bybitEnabled) {
                toggle.classList.add('active');
                status.textContent = 'ON';
                status.style.color = '#FFA500';

                // Auto-start worker if credentials exist and at least one path set is enabled
                if (apiKey && apiSecret) {
                    const enabledSets = [];
                    for (let i = 1; i <= 5; i++) {
                        const checkbox = document.getElementById(`bybitSet${i}Enabled`);
                        if (checkbox && checkbox.checked) {
                            enabledSets.push(i);
                        }
                    }

                    if (enabledSets.length > 0) {
                        console.log('üöÄ [BYBIT] Auto-starting worker from previous session...');
                        await startBybitWorker();
                    } else {
                        console.warn('‚ö†Ô∏è [BYBIT] Toggle was ON but no path sets enabled - not starting worker');
                    }
                }
            }
        });

        // Test ByBit Triangular Connection
        async function testByBitTriangularConnection() {
            console.log('üîç [BYBIT] Testing connection...');
            try {
                // Get credentials from localStorage (saved from strategy-api-setup.html)
                const apiKey = localStorage.getItem('bybit_triangular_api');
                const apiSecret = localStorage.getItem('bybit_triangular_secret');
                console.log('üîë [BYBIT] API credentials retrieved from localStorage');

                if (!apiKey || !apiSecret) {
                    console.warn('‚ö†Ô∏è [BYBIT] Missing API credentials');
                    alert('‚ùå Please set up your ByBit API credentials first in the Strategy API Setup page.');
                    return;
                }

                // Show loading message
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = '‚è≥ Testing...';
                btn.disabled = true;

                // Call backend test-connection route
                console.log('üì° [BYBIT] Sending test connection request to backend...');
                const response = await fetch('/api/v1/trading/bybit/triangular/test-connection', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        apiKey: apiKey,
                        apiSecret: apiSecret
                    })
                });

                const result = await response.json();
                console.log('‚úÖ [BYBIT] Test connection response received:', result);

                btn.textContent = originalText;
                btn.disabled = false;

                if (result.success) {
                    console.log('‚úÖ [BYBIT] Connection successful!', result.data);
                    alert(`‚úÖ ByBit Connection Successful!\n\n` +
                          `‚Ä¢ Authenticated: ${result.data.authenticated ? 'Yes' : 'No'}\n` +
                          `‚Ä¢ Balance Access: ${result.data.balanceAccess ? 'Yes' : 'No'}\n` +
                          `‚Ä¢ Available Pairs: ${result.data.availablePairs}\n` +
                          `‚Ä¢ Required Pairs: ${result.data.requiredPairs}\n` +
                          `‚Ä¢ Triangular Ready: ${result.data.triangularReady ? 'Yes' : 'No'}`);
                } else {
                    console.error('‚ùå [BYBIT] Connection failed:', result.message);
                    alert(`‚ùå Connection Failed: ${result.message || 'Unknown error'}`);
                }
            } catch (error) {
                console.error('‚ùå [BYBIT] Connection error:', error);
                alert(`‚ùå Connection Error: ${error.message}`);
            }
        }

        // Scan ByBit Triangular Paths
        async function scanByBitTriangularPaths() {
            console.log('üîç [BYBIT] Starting path scan...');
            try {
                const apiKey = localStorage.getItem('bybit_triangular_api');
                const apiSecret = localStorage.getItem('bybit_triangular_secret');

                if (!apiKey || !apiSecret) {
                    console.warn('‚ö†Ô∏è [BYBIT] Missing API credentials');
                    alert('‚ùå Please set up your ByBit API credentials first.');
                    return;
                }

                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = '‚è≥ Scanning...';
                btn.disabled = true;

                // Get enabled path sets
                const enabledSets = [];
                for (let i = 1; i <= 5; i++) {
                    const checkbox = document.getElementById(`bybitSet${i}Enabled`);
                    if (checkbox && checkbox.checked) {
                        enabledSets.push(i);
                    }
                }
                console.log('üìä [BYBIT] Enabled path sets:', enabledSets);

                console.log('üì° [BYBIT] Sending scan request to backend...');
                const response = await fetch('/api/v1/trading/bybit/triangular/scan', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        apiKey: apiKey,
                        apiSecret: apiSecret,
                        paths: enabledSets.length > 0 ? enabledSets : 'all'
                    })
                });

                const result = await response.json();
                console.log('‚úÖ [BYBIT] Scan response received:', result);

                btn.textContent = originalText;
                btn.disabled = false;

                if (result.success) {
                    document.getElementById('bybitLastScan').textContent = new Date().toLocaleTimeString();
                    console.log(`‚úÖ [BYBIT] Scan successful! Found ${result.data.opportunities.length} opportunities`);

                    let message = `‚úÖ Scan Complete!\n\n`;
                    message += `‚Ä¢ Paths Scanned: ${result.data.scannedPaths}\n`;
                    message += `‚Ä¢ Path Sets: ${result.data.pathSetsScanned}\n`;
                    message += `‚Ä¢ Opportunities Found: ${result.data.opportunities.length}\n\n`;
                    message += `${result.data.message || 'Full scanning implementation coming soon!'}`;

                    alert(message);
                } else {
                    console.error('‚ùå [BYBIT] Scan failed:', result.message);
                    alert(`‚ùå Scan Failed: ${result.message || 'Unknown error'}`);
                }
            } catch (error) {
                console.error('‚ùå [BYBIT] Scan error:', error);
                alert(`‚ùå Scan Error: ${error.message}`);
            }
        }

        // View ByBit Path Details
        // View ByBit Path Details (Modal)
        function viewByBitPathDetails() {
            console.log('üìã [BYBIT] Opening paths modal');

            // Create modal overlay
            const modal = document.createElement('div');
            modal.id = 'bybitPathsModal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.85);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                backdrop-filter: blur(5px);
            `;

            // Create modal content
            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
                border: 2px solid #FFA500;
                border-radius: 15px;
                padding: 30px;
                max-width: 900px;
                max-height: 85vh;
                overflow-y: auto;
                box-shadow: 0 10px 50px rgba(255,165,0,0.3);
                position: relative;
            `;

            modalContent.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid rgba(255,165,0,0.3); padding-bottom: 15px;">
                    <h2 style="color: #FFA500; margin: 0; font-size: 1.8rem;">üìã ByBit Triangular Arbitrage Paths</h2>
                    <button onclick="document.getElementById('bybitPathsModal').remove()" style="background: rgba(255,255,255,0.1); border: 1px solid #FFA500; color: #FFA500; padding: 8px 15px; border-radius: 8px; cursor: pointer; font-size: 1.2rem; font-weight: bold;">‚úï</button>
                </div>

                <div style="background: rgba(255,165,0,0.1); padding: 15px; border-radius: 10px; margin-bottom: 25px; border-left: 4px solid #FFA500;">
                    <p style="color: #b8c6db; margin: 0; font-size: 0.95rem;">
                        <strong style="color: #FFA500;">40 Pure 3-Leg Triangular Arbitrage Paths</strong> organized in 5 sets of 8 paths each.
                        <br><br>
                        üí° <strong>All paths include forward and reverse directions</strong> for bidirectional trading opportunities.
                        <br>
                        üåâ <strong>Bridge Currencies:</strong> BTC (Sets 1-3, 5) and ETH (Set 4)
                        <br>
                        üí∞ <strong>Base Currency:</strong> USDT (Tether) - Fund ByBit with USDT only
                    </p>
                </div>

                <!-- SET 1 -->
                <div style="background: rgba(255,215,0,0.1); padding: 20px; border-radius: 10px; margin-bottom: 20px; border-left: 4px solid #ffd700;">
                    <h3 style="color: #ffd700; margin: 0 0 15px 0;">SET 1: Major Coins - BTC Bridge (8 paths) ‚úÖ DEFAULT</h3>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; font-size: 0.9rem;">
                        <div style="color: #b8c6db;">1. USDT ‚Üí ETH ‚Üí BTC ‚Üí USDT</div>
                        <div style="color: #b8c6db;">2. USDT ‚Üí BTC ‚Üí ETH ‚Üí USDT</div>
                        <div style="color: #b8c6db;">3. USDT ‚Üí SOL ‚Üí BTC ‚Üí USDT</div>
                        <div style="color: #b8c6db;">4. USDT ‚Üí BTC ‚Üí SOL ‚Üí USDT</div>
                        <div style="color: #b8c6db;">5. USDT ‚Üí XRP ‚Üí BTC ‚Üí USDT</div>
                        <div style="color: #b8c6db;">6. USDT ‚Üí BTC ‚Üí XRP ‚Üí USDT</div>
                        <div style="color: #b8c6db;">7. USDT ‚Üí LTC ‚Üí BTC ‚Üí USDT</div>
                        <div style="color: #b8c6db;">8. USDT ‚Üí BTC ‚Üí LTC ‚Üí USDT</div>
                    </div>
                </div>

                <!-- SET 2 -->
                <div style="background: rgba(50,205,50,0.1); padding: 20px; border-radius: 10px; margin-bottom: 20px; border-left: 4px solid #32cd32;">
                    <h3 style="color: #32cd32; margin: 0 0 15px 0;">SET 2: Top Altcoins - BTC Bridge (8 paths) ‚úÖ DEFAULT</h3>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; font-size: 0.9rem;">
                        <div style="color: #b8c6db;">1. USDT ‚Üí ADA ‚Üí BTC ‚Üí USDT</div>
                        <div style="color: #b8c6db;">2. USDT ‚Üí BTC ‚Üí ADA ‚Üí USDT</div>
                        <div style="color: #b8c6db;">3. USDT ‚Üí DOT ‚Üí BTC ‚Üí USDT</div>
                        <div style="color: #b8c6db;">4. USDT ‚Üí BTC ‚Üí DOT ‚Üí USDT</div>
                        <div style="color: #b8c6db;">5. USDT ‚Üí MATIC ‚Üí BTC ‚Üí USDT</div>
                        <div style="color: #b8c6db;">6. USDT ‚Üí BTC ‚Üí MATIC ‚Üí USDT</div>
                        <div style="color: #b8c6db;">7. USDT ‚Üí AVAX ‚Üí BTC ‚Üí USDT</div>
                        <div style="color: #b8c6db;">8. USDT ‚Üí BTC ‚Üí AVAX ‚Üí USDT</div>
                    </div>
                </div>

                <!-- SET 3 -->
                <div style="background: rgba(0,212,255,0.1); padding: 20px; border-radius: 10px; margin-bottom: 20px; border-left: 4px solid #00d4ff;">
                    <h3 style="color: #00d4ff; margin: 0 0 15px 0;">SET 3: DeFi & Smart Contract - BTC Bridge (8 paths)</h3>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; font-size: 0.9rem;">
                        <div style="color: #b8c6db;">1. USDT ‚Üí LINK ‚Üí BTC ‚Üí USDT</div>
                        <div style="color: #b8c6db;">2. USDT ‚Üí BTC ‚Üí LINK ‚Üí USDT</div>
                        <div style="color: #b8c6db;">3. USDT ‚Üí UNI ‚Üí BTC ‚Üí USDT</div>
                        <div style="color: #b8c6db;">4. USDT ‚Üí BTC ‚Üí UNI ‚Üí USDT</div>
                        <div style="color: #b8c6db;">5. USDT ‚Üí ATOM ‚Üí BTC ‚Üí USDT</div>
                        <div style="color: #b8c6db;">6. USDT ‚Üí BTC ‚Üí ATOM ‚Üí USDT</div>
                        <div style="color: #b8c6db;">7. USDT ‚Üí ALGO ‚Üí BTC ‚Üí USDT</div>
                        <div style="color: #b8c6db;">8. USDT ‚Üí BTC ‚Üí ALGO ‚Üí USDT</div>
                    </div>
                </div>

                <!-- SET 4 -->
                <div style="background: rgba(255,105,180,0.1); padding: 20px; border-radius: 10px; margin-bottom: 20px; border-left: 4px solid #ff69b4;">
                    <h3 style="color: #ff69b4; margin: 0 0 15px 0;">SET 4: Major Coins - ETH Bridge (8 paths)</h3>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; font-size: 0.9rem;">
                        <div style="color: #b8c6db;">1. USDT ‚Üí ETH ‚Üí SOL ‚Üí USDT</div>
                        <div style="color: #b8c6db;">2. USDT ‚Üí SOL ‚Üí ETH ‚Üí USDT</div>
                        <div style="color: #b8c6db;">3. USDT ‚Üí ETH ‚Üí ADA ‚Üí USDT</div>
                        <div style="color: #b8c6db;">4. USDT ‚Üí ADA ‚Üí ETH ‚Üí USDT</div>
                        <div style="color: #b8c6db;">5. USDT ‚Üí ETH ‚Üí DOT ‚Üí USDT</div>
                        <div style="color: #b8c6db;">6. USDT ‚Üí DOT ‚Üí ETH ‚Üí USDT</div>
                        <div style="color: #b8c6db;">7. USDT ‚Üí ETH ‚Üí MATIC ‚Üí USDT</div>
                        <div style="color: #b8c6db;">8. USDT ‚Üí MATIC ‚Üí ETH ‚Üí USDT</div>
                    </div>
                </div>

                <!-- SET 5 -->
                <div style="background: rgba(119,136,153,0.1); padding: 20px; border-radius: 10px; margin-bottom: 20px; border-left: 4px solid #778899;">
                    <h3 style="color: #778899; margin: 0 0 15px 0;">SET 5: Extended Coverage - BTC Bridge (8 paths)</h3>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; font-size: 0.9rem;">
                        <div style="color: #b8c6db;">1. USDT ‚Üí XLM ‚Üí BTC ‚Üí USDT</div>
                        <div style="color: #b8c6db;">2. USDT ‚Üí BTC ‚Üí XLM ‚Üí USDT</div>
                        <div style="color: #b8c6db;">3. USDT ‚Üí DOGE ‚Üí BTC ‚Üí USDT</div>
                        <div style="color: #b8c6db;">4. USDT ‚Üí BTC ‚Üí DOGE ‚Üí USDT</div>
                        <div style="color: #b8c6db;">5. USDT ‚Üí FIL ‚Üí BTC ‚Üí USDT</div>
                        <div style="color: #b8c6db;">6. USDT ‚Üí BTC ‚Üí FIL ‚Üí USDT</div>
                        <div style="color: #b8c6db;">7. USDT ‚Üí NEAR ‚Üí BTC ‚Üí USDT</div>
                        <div style="color: #b8c6db;">8. USDT ‚Üí BTC ‚Üí NEAR ‚Üí USDT</div>
                    </div>
                </div>

                <div style="background: rgba(255,165,0,0.15); padding: 15px; border-radius: 10px; text-align: center; margin-top: 20px;">
                    <p style="color: #FFA500; margin: 0; font-size: 0.95rem; font-weight: 500;">
                        üí° <strong>Total: 40 paths</strong> | All 3-leg pure triangular arbitrage | No 2-leg or 4-leg paths
                    </p>
                </div>
            `;

            modal.appendChild(modalContent);
            document.body.appendChild(modal);

            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });

            console.log('‚úÖ [BYBIT] Paths modal displayed');
        }

        // Clear ByBit Triangular History
        async function clearByBitTriangularHistory() {
            console.log('üóëÔ∏è [BYBIT] Clear history requested');
            if (!confirm('‚ö†Ô∏è Clear all ByBit triangular trade history?\n\nThis action cannot be undone.')) {
                console.log('‚ùå [BYBIT] Clear history cancelled by user');
                return;
            }

            try {
                console.log('üì° [BYBIT] Sending delete request to backend...');
                const response = await fetch('/api/v1/trading/bybit/triangular/history', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const result = await response.json();
                console.log('‚úÖ [BYBIT] Delete response received:', result);

                if (result.success) {
                    console.log('‚úÖ [BYBIT] History cleared, resetting UI stats...');
                    // Reset stats display
                    document.getElementById('bybitTotalTrades').textContent = '0';
                    document.getElementById('bybitSuccessfulTrades').textContent = '0';
                    document.getElementById('bybitSuccessRate').textContent = '0%';
                    document.getElementById('bybitTotalProfit').textContent = '$0.00';
                    document.getElementById('bybitBestPath').textContent = '-';
                    document.getElementById('bybitLastScan').textContent = 'Never';

                    // Clear recent trades display
                    document.getElementById('bybitRecentTrades').innerHTML =
                        '<div style="text-align: center; color: #888; padding: 20px;">No triangular trades yet. Enable live trading to start.</div>';

                    alert(`‚úÖ History cleared successfully!\n\nDeleted ${result.data.deletedCount} records.`);
                } else {
                    console.error('‚ùå [BYBIT] Failed to clear history:', result.message);
                    alert(`‚ùå Failed to clear history: ${result.message || 'Unknown error'}`);
                }
            } catch (error) {
                console.error('‚ùå [BYBIT] Clear history error:', error);
                alert(`‚ùå Error: ${error.message}`);
            }
        }

        // Save ByBit settings to localStorage
        function saveByBitTriangularSettings() {
            console.log('üíæ [BYBIT] Saving settings to localStorage...');
            const settings = {
                maxTrade: document.getElementById('bybitMaxTrade').value,
                portfolioPercent: document.getElementById('bybitPortfolioPercent').value,
                profitThreshold: document.getElementById('bybitProfitThreshold').value
            };

            // Save path set states (5 sets for ByBit)
            for (let i = 1; i <= 5; i++) {
                const checkbox = document.getElementById(`bybitSet${i}Enabled`);
                if (checkbox) {
                    settings[`set${i}Enabled`] = checkbox.checked;
                }
            }

            localStorage.setItem('bybitTriangularSettings', JSON.stringify(settings));
            console.log('‚úÖ [BYBIT] Settings saved:', settings);
        }

        // Load ByBit settings from localStorage
        function loadByBitTriangularSettings() {
            console.log('üíæ [BYBIT] Loading settings from localStorage...');
            const savedSettings = localStorage.getItem('bybitTriangularSettings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                console.log('‚úÖ [BYBIT] Settings loaded:', settings);

                if (settings.maxTrade) document.getElementById('bybitMaxTrade').value = settings.maxTrade;
                if (settings.portfolioPercent) document.getElementById('bybitPortfolioPercent').value = settings.portfolioPercent;
                if (settings.profitThreshold) document.getElementById('bybitProfitThreshold').value = settings.profitThreshold;

                // Load path set states (5 sets)
                for (let i = 1; i <= 5; i++) {
                    const checkbox = document.getElementById(`bybitSet${i}Enabled`);
                    if (checkbox && settings[`set${i}Enabled`] !== undefined) {
                        checkbox.checked = settings[`set${i}Enabled`];
                    }
                }
            } else {
                console.log('‚ÑπÔ∏è [BYBIT] No saved settings found, using defaults');
            }
        }

        // Auto-save ByBit settings when changed
        document.addEventListener('DOMContentLoaded', function() {
            // Add event listeners for ByBit settings auto-save
            const bybitInputs = document.querySelectorAll('#bybitMaxTrade, #bybitPortfolioPercent, #bybitProfitThreshold');
            bybitInputs.forEach(input => {
                input.addEventListener('change', saveByBitTriangularSettings);
            });

            // Add event listeners for ByBit checkboxes (5 sets)
            for (let i = 1; i <= 5; i++) {
                const checkbox = document.getElementById(`bybitSet${i}Enabled`);
                if (checkbox) {
                    checkbox.addEventListener('change', saveByBitTriangularSettings);
                }
            }
        });

        // ========================================================================
        // BINANCE TRIANGULAR ARBITRAGE FUNCTIONS
        // ========================================================================

        // Scan a single Binance path set
        async function scanBinanceSet(apiKey, apiSecret, setNumber) {
            console.log(`üìä [BINANCE Worker] Scanning SET ${setNumber}...`);

            // Get risk settings from UI
            const maxTradeAmount = parseFloat(document.getElementById('binanceMaxTrade')?.value || 100);
            const profitThreshold = parseFloat(document.getElementById('binanceProfitThreshold')?.value || 0.5);
            const portfolioPercent = parseFloat(document.getElementById('binancePortfolioPercent')?.value || 10);

            // Get current balance (from balance tracking)
            const currentBalance = binanceBalanceTracking.currentUSDT || 0;

            try {
                const response = await fetch(`${API_BASE}/trading/binance/triangular/scan`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        apiKey,
                        apiSecret,
                        paths: [setNumber],  // Scan only this set
                        maxTradeAmount: maxTradeAmount,
                        profitThreshold: profitThreshold,
                        portfolioPercent: portfolioPercent,
                        currentBalance: currentBalance
                    })
                });

                const result = await response.json();

                if (result.success && result.data) {
                    const opps = result.data.opportunities || [];
                    binanceWorkerStats.totalOpportunities += opps.length;

                    // Log portfolio calculation details
                    if (result.data?.portfolioCalculation) {
                        const calc = result.data.portfolioCalculation;
                        console.log(`üí∞ [BINANCE Portfolio] Balance: $${calc.balance}, ${calc.portfolioPercent}% = $${calc.portfolioAmount}, Cap: ${calc.appliedCap}, Can Trade: ${calc.canTrade}`);
                    }

                    // Display warnings (non-blocking)
                    if (result.data?.warnings && result.data.warnings.length > 0) {
                        result.data.warnings.forEach(warning => {
                            console.warn(`‚ö†Ô∏è [BINANCE Portfolio] ${warning}`);
                        });
                    }

                    if (opps.length > 0) {
                        console.log(`üí∞ [BINANCE Worker] SET ${setNumber}: Found ${opps.length} opportunities`);
                        opps.forEach((opp, idx) => {
                            console.log(`   ${idx + 1}. ${opp.path?.id || 'Unknown'}: +${opp.profitPercentage?.toFixed(2)}%`);
                        });
                    } else {
                        console.log(`‚ÑπÔ∏è [BINANCE Worker] SET ${setNumber}: No opportunities found`);
                    }
                } else {
                    console.warn(`‚ö†Ô∏è [BINANCE Worker] SET ${setNumber}: Scan failed -`, result.message);
                }
            } catch (error) {
                console.error(`‚ùå [BINANCE Worker] SET ${setNumber} scan error:`, error.message);
            }
        }

        // Perform sequential scan cycle (scan each enabled set with delays)
        async function performBinanceSequentialScan(apiKey, apiSecret) {
            // Check if worker was stopped
            if (!binanceWorkerRunning) {
                console.log('‚èπÔ∏è [BINANCE Worker] Scan cycle aborted - worker stopped');
                return;
            }

            binanceWorkerStats.totalScans++;
            console.log(`\nüîÑ [BINANCE Worker] ‚ïê‚ïê‚ïê Scan Cycle #${binanceWorkerStats.totalScans} Starting ‚ïê‚ïê‚ïê`);

            // Get enabled path sets
            const enabledSets = [];
            for (let i = 1; i <= 5; i++) {
                const checkbox = document.getElementById(`binanceSet${i}Enabled`);
                if (checkbox && checkbox.checked) {
                    enabledSets.push(i);
                }
            }

            if (enabledSets.length === 0) {
                console.warn('‚ö†Ô∏è [BINANCE Worker] No path sets enabled');
                return;
            }

            console.log(`üìã [BINANCE Worker] Enabled sets: [${enabledSets.join(', ')}] - Scanning sequentially...`);

            // Scan each enabled set with 5-second delay between sets
            for (let i = 0; i < enabledSets.length; i++) {
                // Check if worker was stopped before each set
                if (!binanceWorkerRunning) {
                    console.log('‚èπÔ∏è [BINANCE Worker] Scan cycle aborted mid-cycle - worker stopped');
                    return;
                }

                const setNumber = enabledSets[i];
                await scanBinanceSet(apiKey, apiSecret, setNumber);

                // Wait 5 seconds before next set (except after last set)
                if (i < enabledSets.length - 1) {
                    console.log(`‚è≥ [BINANCE Worker] Waiting 5 seconds before next set...`);
                    await new Promise(resolve => setTimeout(resolve, 5000));
                }
            }

            binanceWorkerStats.lastScanTime = new Date();
            const lastScanElement = document.getElementById('binanceLastScan');
            if (lastScanElement) {
                lastScanElement.textContent = binanceWorkerStats.lastScanTime.toLocaleTimeString();
            }

            // Update balance after scan cycle
            await updateBinanceBalance(apiKey, apiSecret);

            console.log(`‚úÖ [BINANCE Worker] ‚ïê‚ïê‚ïê Scan Cycle #${binanceWorkerStats.totalScans} Complete ‚ïê‚ïê‚ïê\n`);
        }

        // Start Binance automated worker (sequential scanning)
        async function startBinanceWorker() {
            binanceWorkerRunning = true;  // Enable worker flag
            console.log('üîÑ [BINANCE Worker] Starting sequential scanning...');

            const apiKey = localStorage.getItem('binance_triangular_api');
            const apiSecret = localStorage.getItem('binance_triangular_secret');

            if (!apiKey || !apiSecret) {
                console.error('‚ùå [BINANCE Worker] Missing API credentials');
                return;
            }

            // Initialize balance tracking
            console.log('üí∞ [BINANCE Worker] Initializing balance tracking...');
            await initializeBinanceBalance(apiKey, apiSecret);

            // Perform immediate first scan cycle
            console.log('üöÄ [BINANCE Worker] Performing immediate first scan cycle...');
            await performBinanceSequentialScan(apiKey, apiSecret);

            // Continue scanning cycles every 30 seconds
            binanceWorkerInterval = setInterval(async () => {
                await performBinanceSequentialScan(apiKey, apiSecret);
            }, 30000); // 30 seconds between cycles

            console.log('‚úÖ [BINANCE Worker] Sequential scanning started (cycles every 30s, 5s delay between sets)');
        }

        // Stop Binance automated worker
        function stopBinanceWorker() {
            binanceWorkerRunning = false;  // Disable worker flag to abort any running scan
            if (binanceWorkerInterval) {
                clearInterval(binanceWorkerInterval);
                binanceWorkerInterval = null;
                console.log('‚èπÔ∏è [BINANCE Worker] Automated scanning stopped');
            }
        }

        // Binance Toggle Event Listener (Updated with worker)
        document.getElementById('binanceTriangularEnabled').addEventListener('click', async function() {
            console.log('üîÑ [BINANCE] Toggle clicked');

            const isCurrentlyActive = this.classList.contains('active');
            const status = document.getElementById('binanceTriangularStatus');

            if (!isCurrentlyActive) {
                // Enabling - validate credentials first
                const apiKey = localStorage.getItem('binance_triangular_api');
                const apiSecret = localStorage.getItem('binance_triangular_secret');

                if (!apiKey || !apiSecret) {
                    console.warn('‚ö†Ô∏è [BINANCE] Missing API credentials');
                    alert('‚ùå Please set up your Binance API credentials first in the Strategy API Setup page.');
                    return;
                }

                // Validate at least one path set is enabled
                const enabledSets = [];
                for (let i = 1; i <= 5; i++) {
                    const checkbox = document.getElementById(`binanceSet${i}Enabled`);
                    if (checkbox && checkbox.checked) {
                        enabledSets.push(i);
                    }
                }

                if (enabledSets.length === 0) {
                    console.warn('‚ö†Ô∏è [BINANCE] No path sets enabled');
                    alert('‚ùå Please enable at least one path set before starting automated scanning.');
                    return;
                }

                console.log('‚úÖ [BINANCE] Automated scanning enabled');
                this.classList.add('active');
                status.textContent = 'ON';
                status.style.color = '#F0B90B';
                localStorage.setItem('binanceTriangularEnabled', 'true');

                // Start the worker
                await startBinanceWorker();
            } else {
                // Disabling
                console.log('‚ùå [BINANCE] Automated scanning disabled');
                this.classList.remove('active');
                status.textContent = 'OFF';
                status.style.color = '#ff6b6b';
                localStorage.setItem('binanceTriangularEnabled', 'false');

                // Stop the worker
                stopBinanceWorker();
            }
        });

        // Test Binance Connection
        async function testBinanceTriangularConnection() {
            console.log('üîç [BINANCE] Testing connection...');
            const apiKey = localStorage.getItem('binance_triangular_api');
            const apiSecret = localStorage.getItem('binance_triangular_secret');

            if (!apiKey || !apiSecret) {
                alert('‚ùå Please enter your Binance API credentials first and save settings.');
                console.log('‚ö†Ô∏è [BINANCE] API credentials missing');
                return;
            }

            try {
                console.log('üì° [BINANCE] Sending test connection request to backend...');
                const response = await fetch('/api/v1/trading/binance/triangular/test-connection', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    },
                    body: JSON.stringify({
                        apiKey: apiKey,
                        apiSecret: apiSecret
                    })
                });

                const result = await response.json();
                console.log('‚úÖ [BINANCE] Test connection response received:', result);

                if (result.success) {
                    alert(`‚úÖ Binance Connection Successful!\n\n` +
                          `‚Ä¢ Authenticated: ${result.data.authenticated ? 'Yes' : 'No'}\n` +
                          `‚Ä¢ Balance Access: ${result.data.balanceAccess ? 'Yes' : 'No'}\n` +
                          `‚Ä¢ Market Data Access: ${result.data.marketDataAccess ? 'Yes' : 'No'}\n` +
                          `‚Ä¢ Available Pairs: ${result.data.availablePairs}\n` +
                          `‚Ä¢ Triangular Ready: ${result.data.triangularReady ? 'Yes' : 'No'}\n` +
                          `‚Ä¢ Sample Price: ${result.data.samplePrice}`);
                } else {
                    alert(`‚ùå Binance Connection Failed\n\n${result.message}`);
                    console.error('‚ùå [BINANCE] Connection test failed:', result);
                }
            } catch (error) {
                console.error('‚ùå [BINANCE] Connection test error:', error);
                alert(`‚ùå Connection Error: ${error.message}`);
            }
        }

        // Scan Binance Triangular Paths
        async function scanBinanceTriangularPaths() {
            console.log('üîç [BINANCE] Starting path scan...');
            const apiKey = localStorage.getItem('binance_triangular_api');
            const apiSecret = localStorage.getItem('binance_triangular_secret');

            if (!apiKey || !apiSecret) {
                alert('‚ùå Please enter your Binance API credentials first and save settings.');
                console.log('‚ö†Ô∏è [BINANCE] API credentials missing');
                return;
            }

            // Gather enabled sets
            const enabledSets = [];
            for (let i = 1; i <= 5; i++) {
                const checkbox = document.getElementById(`binanceSet${i}Enabled`);
                if (checkbox && checkbox.checked) {
                    enabledSets.push(i);
                }
            }

            console.log('üìä [BINANCE] Enabled path sets:', enabledSets);

            const profitThreshold = parseFloat(document.getElementById('binanceProfitThreshold').value) || 0.5;
            console.log('üìà [BINANCE] Profit threshold:', profitThreshold, '%');

            try {
                console.log('üì° [BINANCE] Sending scan request to backend...');
                const response = await fetch('/api/v1/trading/binance/triangular/scan', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    },
                    body: JSON.stringify({
                        apiKey: apiKey,
                        apiSecret: apiSecret,
                        enabledSets: enabledSets,
                        profitThreshold: profitThreshold
                    })
                });

                const result = await response.json();
                console.log('‚úÖ [BINANCE] Scan response received:', result);

                if (result.success) {
                    const feedDiv = document.getElementById('binanceLiveFeed');
                    const timestamp = new Date().toLocaleTimeString();

                    let feedMessage = `<div style="color: #F0B90B; margin-bottom: 8px;">[${timestamp}] Scan Complete</div>`;
                    feedMessage += `<div style="color: #b8c6db;">‚Ä¢ Scanned: ${result.data.scannedPaths} paths</div>`;
                    feedMessage += `<div style="color: #b8c6db;">‚Ä¢ Opportunities: ${result.data.opportunities.length}</div>`;
                    feedMessage += `<div style="color: #888; margin-top: 4px; font-size: 0.8rem;">${result.data.message}</div>`;

                    feedDiv.innerHTML = feedMessage + feedDiv.innerHTML;

                    if (result.data.opportunities.length > 0) {
                        alert(`üéØ Found ${result.data.opportunities.length} Binance arbitrage opportunities!`);
                    } else {
                        alert(`‚úÖ Scan complete. No opportunities above ${profitThreshold}% threshold found.`);
                    }
                } else {
                    alert(`‚ùå Scan Failed\n\n${result.message}`);
                    console.error('‚ùå [BINANCE] Scan failed:', result);
                }
            } catch (error) {
                console.error('‚ùå [BINANCE] Scan error:', error);
                alert(`‚ùå Scan Error: ${error.message}`);
            }
        }

        // View Binance Path Details
        function viewBinancePathDetails() {
            // Create modal overlay
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
                backdrop-filter: blur(5px);
            `;

            // Create modal content
            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
                border: 2px solid #F0B90B;
                border-radius: 15px;
                padding: 30px;
                max-width: 800px;
                max-height: 85vh;
                overflow-y: auto;
                box-shadow: 0 10px 50px rgba(240, 185, 11, 0.3);
                color: #fff;
                font-family: 'Courier New', monospace;
            `;

            modalContent.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid #F0B90B; padding-bottom: 15px;">
                    <h2 style="margin: 0; color: #F0B90B; font-size: 24px;">üìã BINANCE Triangular Arbitrage Paths</h2>
                    <button id="closeModal" style="background: #ff4444; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 18px;">‚úï</button>
                </div>

                <div style="line-height: 1.8; font-size: 14px;">
                    <div style="background: rgba(240, 185, 11, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <strong style="color: #F0B90B;">üìä SET 1: Major BTC Bridge (8 paths) ‚úÖ DEFAULT</strong><br>
                        1. USDT ‚Üí ETH ‚Üí BTC ‚Üí USDT<br>
                        2. USDT ‚Üí BTC ‚Üí ETH ‚Üí USDT (reverse)<br>
                        3. USDT ‚Üí SOL ‚Üí BTC ‚Üí USDT<br>
                        4. USDT ‚Üí BTC ‚Üí SOL ‚Üí USDT (reverse)<br>
                        5. USDT ‚Üí XRP ‚Üí BTC ‚Üí USDT<br>
                        6. USDT ‚Üí BTC ‚Üí XRP ‚Üí USDT (reverse)<br>
                        7. USDT ‚Üí LTC ‚Üí BTC ‚Üí USDT<br>
                        8. USDT ‚Üí BTC ‚Üí LTC ‚Üí USDT (reverse)
                    </div>

                    <div style="background: rgba(240, 185, 11, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <strong style="color: #F0B90B;">üìä SET 2: Altcoins BTC Bridge (8 paths) ‚úÖ DEFAULT</strong><br>
                        1. USDT ‚Üí ADA ‚Üí BTC ‚Üí USDT<br>
                        2. USDT ‚Üí BTC ‚Üí ADA ‚Üí USDT (reverse)<br>
                        3. USDT ‚Üí DOT ‚Üí BTC ‚Üí USDT<br>
                        4. USDT ‚Üí BTC ‚Üí DOT ‚Üí USDT (reverse)<br>
                        5. USDT ‚Üí MATIC ‚Üí BTC ‚Üí USDT<br>
                        6. USDT ‚Üí BTC ‚Üí MATIC ‚Üí USDT (reverse)<br>
                        7. USDT ‚Üí AVAX ‚Üí BTC ‚Üí USDT<br>
                        8. USDT ‚Üí BTC ‚Üí AVAX ‚Üí USDT (reverse)
                    </div>

                    <div style="background: rgba(240, 185, 11, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <strong style="color: #F0B90B;">üìä SET 3: DeFi BTC Bridge (6 paths)</strong><br>
                        1. USDT ‚Üí LINK ‚Üí BTC ‚Üí USDT<br>
                        2. USDT ‚Üí BTC ‚Üí LINK ‚Üí USDT (reverse)<br>
                        3. USDT ‚Üí UNI ‚Üí BTC ‚Üí USDT<br>
                        4. USDT ‚Üí BTC ‚Üí UNI ‚Üí USDT (reverse)<br>
                        5. USDT ‚Üí ATOM ‚Üí BTC ‚Üí USDT<br>
                        6. USDT ‚Üí BTC ‚Üí ATOM ‚Üí USDT (reverse)
                    </div>

                    <div style="background: rgba(240, 185, 11, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <strong style="color: #F0B90B;">üìä SET 4: ETH/BNB Bridge (varies)</strong><br>
                        Various paths using ETH and BNB as bridge currencies
                    </div>

                    <div style="background: rgba(240, 185, 11, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <strong style="color: #F0B90B;">üìä SET 5: Multi-Bridge (varies)</strong><br>
                        Extended paths with multiple bridge currencies
                    </div>

                    <div style="background: rgba(0, 136, 255, 0.1); padding: 20px; border-radius: 8px; border-left: 4px solid #0088ff; margin-top: 20px;">
                        <strong style="color: #0088ff;">üìå Summary</strong><br>
                        üí° TOTAL: 24+ paths (simplified USDT-focused)<br>
                        üåâ BRIDGE: BTC, ETH, BNB<br>
                        üîÑ PATTERN: USDT-only funding, bidirectional paths<br>
                        üåç GLOBAL: World's largest crypto exchange<br>
                        ‚úÖ OPTIMIZED: High liquidity major coins only<br>
                        üîê AUTH: API Key + Secret
                    </div>
                </div>
            `;

            modal.appendChild(modalContent);
            document.body.appendChild(modal);

            // Close modal on click outside or close button
            modal.addEventListener('click', function(e) {
                if (e.target === modal || e.target.id === 'closeModal') {
                    document.body.removeChild(modal);
                }
            });

            console.log('üìã [BINANCE] Path details modal displayed');
        }

        // Clear Binance Trade History
        async function clearBinanceTriangularHistory() {
            console.log('üóëÔ∏è [BINANCE] Clearing trade history...');

            if (!confirm('‚ö†Ô∏è Are you sure you want to clear all Binance triangular trade history?')) {
                console.log('‚ùå [BINANCE] History clear cancelled by user');
                return;
            }

            try {
                console.log('üì° [BINANCE] Sending delete history request to backend...');
                const response = await fetch('/api/v1/trading/binance/triangular/history', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    }
                });

                const result = await response.json();
                console.log('‚úÖ [BINANCE] Delete history response received:', result);

                if (result.success) {
                    alert(`‚úÖ Cleared ${result.data.deletedCount} Binance trades from history`);
                    document.getElementById('binanceLiveFeed').innerHTML = '<div style="color: #888;">Trade history cleared. Waiting for scan results...</div>';
                } else {
                    alert(`‚ùå Failed to clear history\n\n${result.message}`);
                    console.error('‚ùå [BINANCE] Clear history failed:', result);
                }
            } catch (error) {
                console.error('‚ùå [BINANCE] Clear history error:', error);
                alert(`‚ùå Error: ${error.message}`);
            }
        }

        // Save Binance Triangular Settings
        function saveBinanceTriangularSettings() {
            console.log('üíæ [BINANCE] Saving settings to localStorage...');

            const maxTrade = document.getElementById('binanceMaxTrade').value;
            const portfolioPercent = document.getElementById('binancePortfolioPercent').value;
            const profitThreshold = document.getElementById('binanceProfitThreshold').value;

            // Save settings
            const settings = {
                maxTrade: maxTrade,
                portfolioPercent: portfolioPercent,
                profitThreshold: profitThreshold
            };

            // Save path set preferences
            for (let i = 1; i <= 5; i++) {
                const checkbox = document.getElementById(`binanceSet${i}Enabled`);
                if (checkbox) {
                    settings[`set${i}Enabled`] = checkbox.checked;
                }
            }

            localStorage.setItem('binanceTriangularSettings', JSON.stringify(settings));
            console.log('‚úÖ [BINANCE] Settings saved:', settings);
        }

        // Load Binance Triangular Settings
        function loadBinanceTriangularSettings() {
            console.log('üì• [BINANCE] Loading settings from localStorage...');

            // Load settings
            const settingsJson = localStorage.getItem('binanceTriangularSettings');
            if (settingsJson) {
                try {
                    const settings = JSON.parse(settingsJson);
                    console.log('‚úÖ [BINANCE] Settings loaded:', settings);

                    if (settings.maxTrade) document.getElementById('binanceMaxTrade').value = settings.maxTrade;
                    if (settings.portfolioPercent) document.getElementById('binancePortfolioPercent').value = settings.portfolioPercent;
                    if (settings.profitThreshold) document.getElementById('binanceProfitThreshold').value = settings.profitThreshold;

                    // Load path set preferences
                    for (let i = 1; i <= 5; i++) {
                        const checkbox = document.getElementById(`binanceSet${i}Enabled`);
                        if (checkbox && settings.hasOwnProperty(`set${i}Enabled`)) {
                            checkbox.checked = settings[`set${i}Enabled`];
                        }
                    }
                } catch (error) {
                    console.error('‚ùå [BINANCE] Failed to parse settings:', error);
                }
            }

            // Load toggle state
            const toggleEnabled = localStorage.getItem('binanceTriangularEnabled') === 'true';
            const toggle = document.getElementById('binanceTriangularEnabled');
            const status = document.getElementById('binanceTriangularStatus');

            if (toggleEnabled) {
                toggle.classList.add('active');
                status.textContent = 'ON';
                status.style.color = '#F0B90B';
                console.log('‚úÖ [BINANCE] Live trading enabled (from localStorage)');
            } else {
                console.log('‚ÑπÔ∏è [BINANCE] Live trading disabled (from localStorage)');
            }
        }

        // Initialize Binance settings on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ [BINANCE] Initializing triangular arbitrage settings...');
            loadBinanceTriangularSettings();

            // Add event listeners for Binance inputs (auto-save)
            const binanceInputs = document.querySelectorAll('#binanceMaxTrade, #binancePortfolioPercent, #binanceProfitThreshold');
            binanceInputs.forEach(input => {
                input.addEventListener('change', saveBinanceTriangularSettings);
            });

            // Add event listeners for Binance checkboxes (5 sets)
            for (let i = 1; i <= 5; i++) {
                const checkbox = document.getElementById(`binanceSet${i}Enabled`);
                if (checkbox) {
                    checkbox.addEventListener('change', saveBinanceTriangularSettings);
                }
            }
        });

        // ========================================================================
        // OKX TRIANGULAR ARBITRAGE FUNCTIONS
        // ========================================================================

        // ============================================================
        // OKX SEQUENTIAL WORKER FUNCTIONS
        // ============================================================

        // Scan a single OKX set
        async function scanOKXSet(apiKey, apiSecret, passphrase, setNumber) {
            try {
                console.log(`üîç [OKX Worker] Scanning SET_${setNumber}...`);

                // Get risk settings from UI
                const maxTradeAmount = parseFloat(document.getElementById('okxMaxTrade')?.value || 100);
                const profitThreshold = parseFloat(document.getElementById('okxProfitThreshold')?.value || 0.5);
                const portfolioPercent = parseFloat(document.getElementById('okxPortfolioPercent')?.value || 10);

                // Get current balance (from balance tracking)
                const currentBalance = okxBalanceTracking.currentUSDT || 0;

                // Scan for opportunities for this specific set
                const response = await fetch('/api/v1/trading/okx/triangular/scan', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        apiKey,
                        apiSecret,
                        passphrase,
                        enabledSets: [setNumber],  // Scan only this set
                        maxTradeAmount: maxTradeAmount,
                        profitThreshold: profitThreshold,
                        portfolioPercent: portfolioPercent,
                        currentBalance: currentBalance
                    })
                });

                const result = await response.json();

                if (result.success && result.data && result.data.opportunities) {
                    const opportunities = result.data.opportunities;
                    console.log(`‚úÖ [OKX Worker] SET_${setNumber} scanned: ${opportunities.length} opportunities found`);

                    // Log portfolio calculation details
                    if (result.data?.portfolioCalculation) {
                        const calc = result.data.portfolioCalculation;
                        console.log(`üí∞ [OKX Portfolio] Balance: $${calc.balance}, ${calc.portfolioPercent}% = $${calc.portfolioAmount}, Cap: ${calc.appliedCap}, Can Trade: ${calc.canTrade}`);
                    }

                    // Display warnings (non-blocking)
                    if (result.data?.warnings && result.data.warnings.length > 0) {
                        result.data.warnings.forEach(warning => {
                            console.warn(`‚ö†Ô∏è [OKX Portfolio] ${warning}`);
                        });
                    }

                    if (opportunities.length > 0) {
                        okxWorkerStats.totalOpportunities += opportunities.length;

                        // Display top opportunity in live feed
                        const liveFeed = document.getElementById('okxLiveFeed');
                        if (liveFeed && opportunities[0]) {
                            const opp = opportunities[0];
                            const oppDiv = document.createElement('div');
                            oppDiv.style.cssText = 'padding: 8px; background: rgba(0,166,255,0.1); border-left: 3px solid #00ff88; margin-bottom: 8px; border-radius: 4px;';
                            oppDiv.innerHTML = `
                                <div style="color: #00ff88; font-weight: bold;">SET ${setNumber}: +${opp.profitPercentage.toFixed(3)}%</div>
                                <div style="color: #b8c6db; font-size: 0.85rem;">${opp.path.sequence}</div>
                                <div style="color: #888; font-size: 0.75rem;">${new Date().toLocaleTimeString()}</div>
                            `;
                            liveFeed.insertBefore(oppDiv, liveFeed.firstChild);

                            // Keep only last 10 entries
                            while (liveFeed.children.length > 10) {
                                liveFeed.removeChild(liveFeed.lastChild);
                            }
                        }
                    }
                } else {
                    console.warn(`‚ö†Ô∏è [OKX Worker] SET_${setNumber} scan returned no data`);
                }

            } catch (error) {
                console.error(`‚ùå [OKX Worker] Error scanning SET_${setNumber}:`, error);
            }
        }

        // Perform sequential scan of enabled sets with delays
        async function performOKXSequentialScan(apiKey, apiSecret, passphrase) {
            // Check if worker was stopped
            if (!okxWorkerRunning) {
                console.log('‚èπÔ∏è [OKX Worker] Scan cycle aborted - worker stopped');
                return;
            }

            okxWorkerStats.totalScans++;
            console.log(`\nüîÑ [OKX Worker] ‚ïê‚ïê‚ïê Scan Cycle #${okxWorkerStats.totalScans} Starting ‚ïê‚ïê‚ïê`);

            // Get enabled path sets
            const enabledSets = [];
            for (let i = 1; i <= 5; i++) {
                const checkbox = document.getElementById(`okxSet${i}Enabled`);
                if (checkbox && checkbox.checked) {
                    enabledSets.push(i);
                }
            }

            if (enabledSets.length === 0) {
                console.warn('‚ö†Ô∏è [OKX Worker] No path sets enabled');
                return;
            }

            console.log(`üìã [OKX Worker] Enabled sets: [${enabledSets.join(', ')}] - Scanning sequentially...`);

            // Scan each enabled set with 5-second delay between sets
            for (let i = 0; i < enabledSets.length; i++) {
                // Check if worker was stopped before each set
                if (!okxWorkerRunning) {
                    console.log('‚èπÔ∏è [OKX Worker] Scan cycle aborted mid-cycle - worker stopped');
                    return;
                }

                const setNumber = enabledSets[i];
                await scanOKXSet(apiKey, apiSecret, passphrase, setNumber);

                // Wait 5 seconds before next set (except after last set)
                if (i < enabledSets.length - 1) {
                    console.log(`‚è≥ [OKX Worker] Waiting 5 seconds before next set...`);
                    await new Promise(resolve => setTimeout(resolve, 5000));
                }
            }

            okxWorkerStats.lastScanTime = new Date();
            const lastScanElement = document.getElementById('okxLastScan');
            if (lastScanElement) {
                lastScanElement.textContent = okxWorkerStats.lastScanTime.toLocaleTimeString();
            }

            // Update balance after scan cycle
            await updateOKXBalance(apiKey, apiSecret, passphrase);

            console.log(`‚úÖ [OKX Worker] ‚ïê‚ïê‚ïê Scan Cycle #${okxWorkerStats.totalScans} Complete ‚ïê‚ïê‚ïê\n`);
        }

        // Start OKX automated worker (sequential scanning)
        async function startOKXWorker() {
            okxWorkerRunning = true;  // Enable worker flag
            console.log('üîÑ [OKX Worker] Starting sequential scanning...');

            const apiKey = localStorage.getItem('okx_triangular_api');
            const apiSecret = localStorage.getItem('okx_triangular_secret');
            const passphrase = localStorage.getItem('okx_triangular_passphrase');

            if (!apiKey || !apiSecret || !passphrase) {
                console.error('‚ùå [OKX Worker] Missing API credentials');
                return;
            }

            // Initialize balance tracking
            console.log('üí∞ [OKX Worker] Initializing balance tracking...');
            await initializeOKXBalance(apiKey, apiSecret, passphrase);

            // Perform immediate first scan cycle
            console.log('üöÄ [OKX Worker] Performing immediate first scan cycle...');
            await performOKXSequentialScan(apiKey, apiSecret, passphrase);

            // Continue scanning cycles every 30 seconds
            okxWorkerInterval = setInterval(async () => {
                await performOKXSequentialScan(apiKey, apiSecret, passphrase);
            }, 30000); // 30 seconds between cycles

            console.log('‚úÖ [OKX Worker] Sequential scanning started (cycles every 30s, 5s delay between sets)');
        }

        // Stop OKX automated worker
        function stopOKXWorker() {
            okxWorkerRunning = false;  // Disable worker flag to abort any running scan
            if (okxWorkerInterval) {
                clearInterval(okxWorkerInterval);
                okxWorkerInterval = null;
                console.log('‚èπÔ∏è [OKX Worker] Automated scanning stopped');
            }
        }

        // OKX Toggle Event Listener (Updated with worker)
        document.getElementById('okxTriangularEnabled').addEventListener('click', async function() {
            console.log('üîÑ [OKX] Toggle clicked');

            const isCurrentlyActive = this.classList.contains('active');
            const status = document.getElementById('okxTriangularStatus');

            if (!isCurrentlyActive) {
                // Enabling - validate credentials first
                const apiKey = localStorage.getItem('okx_triangular_api');
                const apiSecret = localStorage.getItem('okx_triangular_secret');
                const passphrase = localStorage.getItem('okx_triangular_passphrase');

                if (!apiKey || !apiSecret || !passphrase) {
                    console.warn('‚ö†Ô∏è [OKX] Missing API credentials');
                    alert('‚ùå Please set up your OKX API credentials first (API Key, Secret, and Passphrase) in the Strategy API Setup page.');
                    return;
                }

                // Validate that at least one path set is enabled
                const enabledSets = [];
                for (let i = 1; i <= 5; i++) {
                    const checkbox = document.getElementById(`okxSet${i}Enabled`);
                    if (checkbox && checkbox.checked) {
                        enabledSets.push(i);
                    }
                }

                if (enabledSets.length === 0) {
                    console.warn('‚ö†Ô∏è [OKX] No path sets enabled');
                    alert('‚ùå Please enable at least one path set before activating the scanner.');
                    return;
                }

                console.log('‚úÖ [OKX] Automated scanning enabled');
                this.classList.add('active');
                status.textContent = 'ON';
                status.style.color = '#00A6FF';
                localStorage.setItem('okxTriangularEnabled', 'true');

                // Start the worker
                await startOKXWorker();
            } else {
                // Disabling
                console.log('‚ùå [OKX] Automated scanning disabled');
                this.classList.remove('active');
                status.textContent = 'OFF';
                status.style.color = '#ff6b6b';
                localStorage.setItem('okxTriangularEnabled', 'false');

                // Stop the worker
                stopOKXWorker();
            }
        });

        // Test OKX Connection
        async function testOKXTriangularConnection() {
            console.log('üîç [OKX] Testing connection...');
            const apiKey = localStorage.getItem('okx_triangular_api');
            const apiSecret = localStorage.getItem('okx_triangular_secret');
            const passphrase = localStorage.getItem('okx_triangular_passphrase');

            if (!apiKey || !apiSecret || !passphrase) {
                alert('‚ùå Please configure your OKX API credentials in platform settings first.');
                console.log('‚ö†Ô∏è [OKX] API credentials missing');
                return;
            }

            try {
                console.log('üì° [OKX] Sending test connection request to backend...');
                const response = await fetch('/api/v1/trading/okx/triangular/test-connection', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    },
                    body: JSON.stringify({
                        apiKey: apiKey,
                        apiSecret: apiSecret,
                        passphrase: passphrase
                    })
                });

                const result = await response.json();
                console.log('‚úÖ [OKX] Test connection response received:', result);

                if (result.success) {
                    alert(`‚úÖ OKX Connection Successful!\n\n` +
                          `‚Ä¢ Authenticated: ${result.data.authenticated ? 'Yes' : 'No'}\n` +
                          `‚Ä¢ Balance Access: ${result.data.balanceAccess ? 'Yes' : 'No'}\n` +
                          `‚Ä¢ Market Data Access: ${result.data.marketDataAccess ? 'Yes' : 'No'}\n` +
                          `‚Ä¢ Available Pairs: ${result.data.availablePairs}\n` +
                          `‚Ä¢ Triangular Ready: ${result.data.triangularReady ? 'Yes' : 'No'}\n` +
                          `‚Ä¢ Sample Price: ${result.data.samplePrice}`);
                } else {
                    alert(`‚ùå OKX Connection Failed\n\n${result.message}`);
                    console.error('‚ùå [OKX] Connection test failed:', result);
                }
            } catch (error) {
                console.error('‚ùå [OKX] Connection test error:', error);
                alert(`‚ùå Connection Error: ${error.message}`);
            }
        }

        // Scan OKX Triangular Paths
        async function scanOKXTriangularPaths() {
            console.log('üîç [OKX] Starting path scan...');
            const apiKey = localStorage.getItem('okx_triangular_api');
            const apiSecret = localStorage.getItem('okx_triangular_secret');
            const passphrase = localStorage.getItem('okx_triangular_passphrase');

            if (!apiKey || !apiSecret || !passphrase) {
                alert('‚ùå Please configure your OKX API credentials in platform settings first.');
                console.log('‚ö†Ô∏è [OKX] API credentials missing');
                return;
            }

            // Gather enabled sets
            const enabledSets = [];
            for (let i = 1; i <= 5; i++) {
                const checkbox = document.getElementById(`okxSet${i}Enabled`);
                if (checkbox && checkbox.checked) {
                    enabledSets.push(i);
                }
            }

            console.log('üìä [OKX] Enabled path sets:', enabledSets);

            const profitThreshold = parseFloat(document.getElementById('okxProfitThreshold').value) || 0.5;
            console.log('üìà [OKX] Profit threshold:', profitThreshold, '%');

            try {
                console.log('üì° [OKX] Sending scan request to backend...');
                const response = await fetch('/api/v1/trading/okx/triangular/scan', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    },
                    body: JSON.stringify({
                        apiKey: apiKey,
                        apiSecret: apiSecret,
                        passphrase: passphrase,
                        enabledSets: enabledSets,
                        profitThreshold: profitThreshold
                    })
                });

                const result = await response.json();
                console.log('‚úÖ [OKX] Scan response received:', result);

                if (result.success) {
                    const feedDiv = document.getElementById('okxLiveFeed');
                    const timestamp = new Date().toLocaleTimeString();

                    let feedMessage = `<div style="color: #00A6FF; margin-bottom: 8px;">[${timestamp}] Scan Complete</div>`;
                    feedMessage += `<div style="color: #b8c6db;">‚Ä¢ Scanned: ${result.data.scannedPaths} paths</div>`;
                    feedMessage += `<div style="color: #b8c6db;">‚Ä¢ Opportunities: ${result.data.opportunities.length}</div>`;
                    feedMessage += `<div style="color: #888; margin-top: 4px; font-size: 0.8rem;">${result.data.message}</div>`;

                    feedDiv.innerHTML = feedMessage + feedDiv.innerHTML;

                    if (result.data.opportunities.length > 0) {
                        alert(`üéØ Found ${result.data.opportunities.length} OKX arbitrage opportunities!`);
                    } else {
                        alert(`‚úÖ Scan complete. No opportunities above ${profitThreshold}% threshold found.`);
                    }
                } else {
                    alert(`‚ùå Scan Failed\n\n${result.message}`);
                    console.error('‚ùå [OKX] Scan failed:', result);
                }
            } catch (error) {
                console.error('‚ùå [OKX] Scan error:', error);
                alert(`‚ùå Scan Error: ${error.message}`);
            }
        }

        // View OKX Path Details
        function viewOKXPathDetails() {
            console.log('üìã [OKX] Displaying path details modal...');

            // Create modal overlay
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                backdrop-filter: blur(5px);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
                padding: 20px;
                box-sizing: border-box;
            `;

            // Create modal content
            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: linear-gradient(135deg, #1a1a2e 0%, #0a0a14 100%);
                border: 2px solid #00A6FF;
                border-radius: 15px;
                padding: 30px;
                max-width: 800px;
                max-height: 85vh;
                overflow-y: auto;
                box-shadow: 0 10px 50px rgba(0, 166, 255, 0.3);
            `;

            modalContent.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <h2 style="color: #00A6FF; margin: 0; font-size: 1.8rem;">üìã OKX Triangular Arbitrage Paths</h2>
                    <button id="closeModal" style="background: none; border: none; color: #ff6b6b; font-size: 2rem; cursor: pointer; padding: 0; line-height: 1;">&times;</button>
                </div>

                <div style="background: rgba(0,166,255,0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #00A6FF;">
                    <div style="color: #00A6FF; font-weight: bold; margin-bottom: 8px;">üìä Overview</div>
                    <div style="color: #b8c6db;">üí° Total: <strong style="color: #00A6FF;">32 paths</strong> (31 three-leg + 1 four-leg)</div>
                    <div style="color: #b8c6db;">üåâ Bridge: <strong style="color: #00A6FF;">USDT</strong> (Tether)</div>
                    <div style="color: #b8c6db;">üåç Exchange: <strong style="color: #00A6FF;">OKX</strong> (Major derivatives platform)</div>
                    <div style="color: #b8c6db;">üîê Auth: <strong style="color: #00A6FF;">API Key + Secret + Passphrase</strong></div>
                </div>

                <div style="background: rgba(255,215,0,0.05); padding: 20px; border-radius: 10px; margin-bottom: 15px; border: 1px solid rgba(255,215,0,0.3);">
                    <strong style="color: #ffd700; font-size: 1.1rem;">SET 1: Major ETH Bridge</strong>
                    <span style="color: #32cd32; font-size: 0.9rem; margin-left: 10px;">‚úÖ DEFAULT (7 paths)</span>
                    <div style="color: #b8c6db; margin-top: 12px; line-height: 1.8;">
                        1. USDT ‚Üí BTC ‚Üí ETH ‚Üí USDT<br>
                        2. USDT ‚Üí SOL ‚Üí ETH ‚Üí USDT<br>
                        3. USDT ‚Üí XRP ‚Üí ETH ‚Üí USDT<br>
                        4. USDT ‚Üí ADA ‚Üí ETH ‚Üí USDT<br>
                        5. USDT ‚Üí DOT ‚Üí ETH ‚Üí USDT<br>
                        6. USDT ‚Üí MATIC ‚Üí ETH ‚Üí USDT<br>
                        7. USDT ‚Üí LINK ‚Üí ETH ‚Üí USDT
                    </div>
                </div>

                <div style="background: rgba(50,205,50,0.05); padding: 20px; border-radius: 10px; margin-bottom: 15px; border: 1px solid rgba(50,205,50,0.3);">
                    <strong style="color: #32cd32; font-size: 1.1rem;">SET 2: Mid-Cap BTC Bridge</strong>
                    <span style="color: #32cd32; font-size: 0.9rem; margin-left: 10px;">‚úÖ DEFAULT (7 paths)</span>
                    <div style="color: #b8c6db; margin-top: 12px; line-height: 1.8;">
                        1. USDT ‚Üí ETH ‚Üí BTC ‚Üí USDT<br>
                        2. USDT ‚Üí SOL ‚Üí BTC ‚Üí USDT<br>
                        3. USDT ‚Üí AVAX ‚Üí BTC ‚Üí USDT<br>
                        4. USDT ‚Üí ATOM ‚Üí BTC ‚Üí USDT<br>
                        5. USDT ‚Üí LTC ‚Üí BTC ‚Üí USDT<br>
                        6. USDT ‚Üí UNI ‚Üí BTC ‚Üí USDT<br>
                        7. USDT ‚Üí FIL ‚Üí BTC ‚Üí USDT
                    </div>
                </div>

                <div style="background: rgba(0,212,255,0.05); padding: 20px; border-radius: 10px; margin-bottom: 15px; border: 1px solid rgba(0,212,255,0.3);">
                    <strong style="color: #00d4ff; font-size: 1.1rem;">SET 3: OKB Native Bridge</strong>
                    <span style="color: #888; font-size: 0.9rem; margin-left: 10px;">(6 paths)</span>
                    <div style="color: #b8c6db; margin-top: 12px; line-height: 1.8;">
                        1. USDT ‚Üí BTC ‚Üí OKB ‚Üí USDT<br>
                        2. USDT ‚Üí ETH ‚Üí OKB ‚Üí USDT<br>
                        3. USDT ‚Üí SOL ‚Üí OKB ‚Üí USDT<br>
                        4. USDT ‚Üí XRP ‚Üí OKB ‚Üí USDT<br>
                        5. USDT ‚Üí ADA ‚Üí OKB ‚Üí USDT<br>
                        6. USDT ‚Üí DOT ‚Üí OKB ‚Üí USDT
                    </div>
                </div>

                <div style="background: rgba(255,105,180,0.05); padding: 20px; border-radius: 10px; margin-bottom: 15px; border: 1px solid rgba(255,105,180,0.3);">
                    <strong style="color: #ff69b4; font-size: 1.1rem;">SET 4: High Volatility</strong>
                    <span style="color: #888; font-size: 0.9rem; margin-left: 10px;">(6 paths)</span>
                    <div style="color: #b8c6db; margin-top: 12px; line-height: 1.8;">
                        1. USDT ‚Üí DOGE ‚Üí ETH ‚Üí USDT<br>
                        2. USDT ‚Üí SHIB ‚Üí ETH ‚Üí USDT<br>
                        3. USDT ‚Üí PEPE ‚Üí ETH ‚Üí USDT<br>
                        4. USDT ‚Üí NEAR ‚Üí BTC ‚Üí USDT<br>
                        5. USDT ‚Üí APT ‚Üí BTC ‚Üí USDT<br>
                        6. USDT ‚Üí FTM ‚Üí BTC ‚Üí USDT
                    </div>
                </div>

                <div style="background: rgba(255,140,0,0.05); padding: 20px; border-radius: 10px; border: 1px solid rgba(255,140,0,0.3);">
                    <strong style="color: #ff8c00; font-size: 1.1rem;">SET 5: Extended Multi-Bridge</strong>
                    <span style="color: #888; font-size: 0.9rem; margin-left: 10px;">(6 paths)</span>
                    <div style="color: #b8c6db; margin-top: 12px; line-height: 1.8;">
                        1. USDT ‚Üí BTC ‚Üí ETH ‚Üí SOL ‚Üí USDT <span style="color: #ff8c00;">(4-leg)</span><br>
                        2. USDT ‚Üí ETH ‚Üí SOL ‚Üí USDT<br>
                        3. USDT ‚Üí SOL ‚Üí ETH ‚Üí USDT (reverse)<br>
                        4. USDT ‚Üí BTC ‚Üí SOL ‚Üí USDT<br>
                        5. USDT ‚Üí OKB ‚Üí ETH ‚Üí USDT <span style="color: #00A6FF;">(Native)</span><br>
                        6. USDT ‚Üí OKB ‚Üí BTC ‚Üí USDT <span style="color: #00A6FF;">(Native)</span>
                    </div>
                </div>
            `;

            modal.appendChild(modalContent);
            document.body.appendChild(modal);

            // Close modal on click outside or close button
            modal.addEventListener('click', function(e) {
                if (e.target === modal || e.target.id === 'closeModal') {
                    document.body.removeChild(modal);
                    console.log('üìã [OKX] Path details modal closed');
                }
            });

            console.log('‚úÖ [OKX] Path details modal displayed');
        }

        // Clear OKX Trade History
        async function clearOKXTriangularHistory() {
            console.log('üóëÔ∏è [OKX] Clearing trade history...');

            if (!confirm('‚ö†Ô∏è Are you sure you want to clear all OKX triangular trade history?')) {
                console.log('‚ùå [OKX] History clear cancelled by user');
                return;
            }

            try {
                console.log('üì° [OKX] Sending delete history request to backend...');
                const response = await fetch('/api/v1/trading/okx/triangular/history', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    }
                });

                const result = await response.json();
                console.log('‚úÖ [OKX] Delete history response received:', result);

                if (result.success) {
                    alert(`‚úÖ Cleared ${result.data.deletedCount} OKX trades from history`);
                    document.getElementById('okxLiveFeed').innerHTML = '<div style="color: #888;">Trade history cleared. Waiting for scan results...</div>';
                } else {
                    alert(`‚ùå Failed to clear history\n\n${result.message}`);
                    console.error('‚ùå [OKX] Clear history failed:', result);
                }
            } catch (error) {
                console.error('‚ùå [OKX] Clear history error:', error);
                alert(`‚ùå Error: ${error.message}`);
            }
        }

        // Save OKX Triangular Settings
        function saveOKXTriangularSettings() {
            console.log('üíæ [OKX] Saving settings to localStorage...');

            const maxTrade = document.getElementById('okxMaxTrade').value;
            const portfolioPercent = document.getElementById('okxPortfolioPercent').value;
            const profitThreshold = document.getElementById('okxProfitThreshold').value;

            // Save settings
            const settings = {
                maxTrade: maxTrade,
                portfolioPercent: portfolioPercent,
                profitThreshold: profitThreshold
            };

            // Save path set preferences
            for (let i = 1; i <= 5; i++) {
                const checkbox = document.getElementById(`okxSet${i}Enabled`);
                if (checkbox) {
                    settings[`set${i}Enabled`] = checkbox.checked;
                }
            }

            localStorage.setItem('okxTriangularSettings', JSON.stringify(settings));
            console.log('‚úÖ [OKX] Settings saved:', settings);
        }

        // Load OKX Triangular Settings
        function loadOKXTriangularSettings() {
            console.log('üì• [OKX] Loading settings from localStorage...');

            // Load settings
            const settingsJson = localStorage.getItem('okxTriangularSettings');
            if (settingsJson) {
                try {
                    const settings = JSON.parse(settingsJson);
                    console.log('‚úÖ [OKX] Settings loaded:', settings);

                    if (settings.maxTrade) document.getElementById('okxMaxTrade').value = settings.maxTrade;
                    if (settings.portfolioPercent) document.getElementById('okxPortfolioPercent').value = settings.portfolioPercent;
                    if (settings.profitThreshold) document.getElementById('okxProfitThreshold').value = settings.profitThreshold;

                    // Load path set preferences
                    for (let i = 1; i <= 5; i++) {
                        const checkbox = document.getElementById(`okxSet${i}Enabled`);
                        if (checkbox && settings.hasOwnProperty(`set${i}Enabled`)) {
                            checkbox.checked = settings[`set${i}Enabled`];
                        }
                    }
                } catch (error) {
                    console.error('‚ùå [OKX] Failed to parse settings:', error);
                }
            }

            // Load toggle state
            const toggleEnabled = localStorage.getItem('okxTriangularEnabled') === 'true';
            const toggle = document.getElementById('okxTriangularEnabled');
            const status = document.getElementById('okxTriangularStatus');

            if (toggleEnabled) {
                toggle.classList.add('active');
                status.textContent = 'ON';
                status.style.color = '#00A6FF';
                console.log('‚úÖ [OKX] Live trading enabled (from localStorage)');
            } else {
                console.log('‚ÑπÔ∏è [OKX] Live trading disabled (from localStorage)');
            }
        }

        // ============================================================================
        // KUCOIN TRIANGULAR ARBITRAGE FUNCTIONS
        // ============================================================================

        function toggleKuCoinTriangular() {
            const toggle = document.getElementById('kucoinTriangularEnabled');
            const status = document.getElementById('kucoinTriangularStatus');
            const isActive = toggle.classList.toggle('active');

            if (isActive) {
                status.textContent = 'ON';
                status.style.color = '#00D092';
                localStorage.setItem('kucoinTriangularEnabled', 'true');
                console.log('‚úÖ [KUCOIN] Live triangular trading enabled');
            } else {
                status.textContent = 'OFF';
                status.style.color = '#ff6b6b';
                localStorage.setItem('kucoinTriangularEnabled', 'false');
                console.log('‚è∏Ô∏è [KUCOIN] Live triangular trading disabled');
            }
        }

        async function testKuCoinTriangularConnection() {
            console.log('üîç [KUCOIN] Testing connection...');

            const apiKey = localStorage.getItem('kucoin_triangular_api');
            const apiSecret = localStorage.getItem('kucoin_triangular_secret');
            const passphrase = localStorage.getItem('kucoin_triangular_passphrase');

            if (!apiKey || !apiSecret || !passphrase) {
                alert('‚ùå Please configure your KuCoin API credentials in platform settings first.');
                return;
            }

            try {
                const response = await fetch('/api/v1/trading/kucoin/triangular/test-connection', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    },
                    body: JSON.stringify({ apiKey, apiSecret, passphrase })
                });

                const data = await response.json();

                if (data.success) {
                    alert(`‚úÖ KuCoin Connection Successful!\n\nAccount Type: ${data.accountType}\nTimestamp: ${new Date(data.timestamp).toLocaleString()}`);
                    console.log('‚úÖ [KUCOIN] Connection test passed:', data);
                } else {
                    alert(`‚ùå Connection Failed: ${data.message}`);
                    console.error('‚ùå [KUCOIN] Connection test failed:', data);
                }
            } catch (error) {
                console.error('‚ùå [KUCOIN] Connection test error:', error);
                alert('‚ùå Connection test failed. Check console for details.');
            }
        }

        async function scanKuCoinTriangularPaths() {
            console.log('üîç [KUCOIN] Starting scan for triangular arbitrage opportunities...');

            const apiKey = localStorage.getItem('kucoin_triangular_api');
            const apiSecret = localStorage.getItem('kucoin_triangular_secret');
            const passphrase = localStorage.getItem('kucoin_triangular_passphrase');

            if (!apiKey || !apiSecret || !passphrase) {
                alert('‚ùå Please configure your KuCoin API credentials in platform settings first.');
                return;
            }

            const maxTradeAmount = parseFloat(document.getElementById('kucoinMaxTrade').value);
            const profitThreshold = parseFloat(document.getElementById('kucoinProfitThreshold').value);

            const enabledSets = {
                SET_1_ESSENTIAL_ETH_BRIDGE: document.getElementById('kucoinSet1Enabled').checked,
                SET_2_MIDCAP_BTC_BRIDGE: document.getElementById('kucoinSet2Enabled').checked,
                SET_3_KCS_NATIVE_BRIDGE: document.getElementById('kucoinSet3Enabled').checked,
                SET_4_HIGH_VOLATILITY: document.getElementById('kucoinSet4Enabled').checked,
                SET_5_EXTENDED_MULTIBRIDGE: document.getElementById('kucoinSet5Enabled').checked
            };

            try {
                const response = await fetch('/api/v1/trading/kucoin/triangular/scan', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    },
                    body: JSON.stringify({
                        apiKey,
                        apiSecret,
                        passphrase,
                        maxTradeAmount,
                        profitThreshold,
                        enabledSets
                    })
                });

                const data = await response.json();

                if (data.success) {
                    console.log(`‚úÖ [KUCOIN] Scan complete: ${data.profitableCount} opportunities found`);

                    const container = document.getElementById('kucoinOpportunities');

                    if (data.opportunities.length === 0) {
                        container.innerHTML = `
                            <p style="color: #888; text-align: center; padding: 20px;">
                                No profitable opportunities found above ${profitThreshold}% threshold.<br>
                                Try lowering the profit threshold or enabling more path sets.
                            </p>
                        `;
                    } else {
                        let html = '<div style="display: flex; flex-direction: column; gap: 15px;">';

                        data.opportunities.slice(0, 10).forEach((opp, index) => {
                            html += `
                                <div style="background: rgba(0,208,146,0.1); padding: 15px; border-radius: 8px; border-left: 4px solid #00D092;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                        <strong style="color: #00D092;">${opp.description}</strong>
                                        <span style="background: #00D092; color: white; padding: 4px 12px; border-radius: 12px; font-weight: 600;">
                                            +${opp.profitPercent}%
                                        </span>
                                    </div>
                                    <div style="font-size: 0.9rem; color: #b8c6db;">
                                        <div>Path: ${opp.path.join(' ‚Üí ')}</div>
                                        <div>Initial: $${opp.initialAmount} USDT ‚Üí Final: $${opp.finalAmount.toFixed(2)} USDT</div>
                                        <div>Profit: $${opp.profitAmount.toFixed(2)} USDT</div>
                                        <div style="font-size: 0.8rem; color: #888; margin-top: 5px;">${opp.pathId}</div>
                                    </div>
                                </div>
                            `;
                        });

                        if (data.opportunities.length > 10) {
                            html += `<p style="text-align: center; color: #888; font-size: 0.9rem;">Showing top 10 of ${data.opportunities.length} opportunities</p>`;
                        }

                        html += '</div>';
                        container.innerHTML = html;
                    }

                    alert(`‚úÖ Scan Complete!\n\nTotal Scanned: ${data.totalScanned} paths\nProfitable: ${data.profitableCount} opportunities\nBest: ${data.opportunities[0]?.profitPercent || 0}%`);
                } else {
                    alert(`‚ùå Scan Failed: ${data.message}`);
                    console.error('‚ùå [KUCOIN] Scan failed:', data);
                }
            } catch (error) {
                console.error('‚ùå [KUCOIN] Scan error:', error);
                alert('‚ùå Scan failed. Check console for details.');
            }
        }

        function viewKuCoinPathDetails() {
            console.log('üìã [KUCOIN] Viewing all triangular path details...');

            const pathDetails = `
üìã KUCOIN Triangular Arbitrage Paths (32 Total)

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
SET 1: ESSENTIAL ETH BRIDGE (7 paths) ‚úì
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí ETH ‚Üí BTC ‚Üí USDT
2. USDT ‚Üí ETH ‚Üí SOL ‚Üí USDT
3. USDT ‚Üí ETH ‚Üí XRP ‚Üí USDT
4. USDT ‚Üí ETH ‚Üí ADA ‚Üí USDT
5. USDT ‚Üí ETH ‚Üí DOT ‚Üí USDT
6. USDT ‚Üí ETH ‚Üí MATIC ‚Üí USDT
7. USDT ‚Üí ETH ‚Üí LINK ‚Üí USDT

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
SET 2: MIDCAP BTC BRIDGE (7 paths) ‚úì
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí BTC ‚Üí ETH ‚Üí USDT
2. USDT ‚Üí BTC ‚Üí SOL ‚Üí USDT
3. USDT ‚Üí BTC ‚Üí AVAX ‚Üí USDT
4. USDT ‚Üí BTC ‚Üí ATOM ‚Üí USDT
5. USDT ‚Üí BTC ‚Üí LTC ‚Üí USDT
6. USDT ‚Üí BTC ‚Üí UNI ‚Üí USDT
7. USDT ‚Üí BTC ‚Üí FIL ‚Üí USDT

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
SET 3: KCS NATIVE BRIDGE (6 paths)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí KCS ‚Üí BTC ‚Üí USDT
2. USDT ‚Üí KCS ‚Üí ETH ‚Üí USDT
3. USDT ‚Üí KCS ‚Üí SOL ‚Üí USDT
4. USDT ‚Üí KCS ‚Üí XRP ‚Üí USDT
5. USDT ‚Üí KCS ‚Üí ADA ‚Üí USDT
6. USDT ‚Üí KCS ‚Üí DOT ‚Üí USDT

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
SET 4: HIGH VOLATILITY (6 paths)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí DOGE ‚Üí BTC ‚Üí USDT (Meme)
2. USDT ‚Üí SHIB ‚Üí ETH ‚Üí USDT (Meme)
3. USDT ‚Üí PEPE ‚Üí ETH ‚Üí USDT (Meme)
4. USDT ‚Üí NEAR ‚Üí BTC ‚Üí USDT (Layer1)
5. USDT ‚Üí APT ‚Üí ETH ‚Üí USDT (Layer1)
6. USDT ‚Üí FTM ‚Üí BTC ‚Üí USDT (DeFi)

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
SET 5: EXTENDED MULTIBRIDGE (6 paths)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí BNB ‚Üí ETH ‚Üí USDT
2. USDT ‚Üí TRX ‚Üí BTC ‚Üí USDT
3. USDT ‚Üí ALGO ‚Üí ETH ‚Üí USDT
4. USDT ‚Üí VET ‚Üí BTC ‚Üí USDT
5. USDT ‚Üí HBAR ‚Üí ETH ‚Üí USDT
6. USDT ‚Üí BTC ‚Üí ETH ‚Üí SOL ‚Üí USDT (4-leg)

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üí° TIP: Sets 1-2 are enabled by default (14 paths)
‚ö° Enable Sets 3-5 for more opportunities (18 additional paths)
            `.trim();

            alert(pathDetails);
            console.log(pathDetails);
        }

        async function clearKuCoinTriangularHistory() {
            if (!confirm('‚ö†Ô∏è Are you sure you want to clear ALL KuCoin triangular trade history? This cannot be undone.')) {
                return;
            }

            try {
                const response = await fetch('/api/v1/trading/kucoin/triangular/history', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    }
                });

                const data = await response.json();

                if (data.success) {
                    alert(`‚úÖ ${data.message}`);
                    console.log('‚úÖ [KUCOIN] History cleared:', data);
                } else {
                    alert(`‚ùå Failed to clear history: ${data.message}`);
                }
            } catch (error) {
                console.error('‚ùå [KUCOIN] Clear history error:', error);
                alert('‚ùå Failed to clear history. Check console for details.');
            }
        }

        function saveKuCoinTriangularSettings() {
            console.log('üíæ [KUCOIN] Saving settings to localStorage...');

            const maxTrade = document.getElementById('kucoinMaxTrade').value;
            const portfolioPercent = document.getElementById('kucoinPortfolioPercent').value;
            const profitThreshold = document.getElementById('kucoinProfitThreshold').value;

            const settings = {
                maxTrade: maxTrade,
                portfolioPercent: portfolioPercent,
                profitThreshold: profitThreshold,
                set1Enabled: document.getElementById('kucoinSet1Enabled').checked,
                set2Enabled: document.getElementById('kucoinSet2Enabled').checked,
                set3Enabled: document.getElementById('kucoinSet3Enabled').checked,
                set4Enabled: document.getElementById('kucoinSet4Enabled').checked,
                set5Enabled: document.getElementById('kucoinSet5Enabled').checked
            };

            localStorage.setItem('kucoinTriangularSettings', JSON.stringify(settings));
            console.log('‚úÖ [KUCOIN] Settings saved:', settings);
        }

        function loadKuCoinTriangularSettings() {
            console.log('üì• [KUCOIN] Loading settings from localStorage...');

            // Load settings
            const settingsJson = localStorage.getItem('kucoinTriangularSettings');
            if (settingsJson) {
                try {
                    const settings = JSON.parse(settingsJson);
                    console.log('‚úÖ [KUCOIN] Settings loaded:', settings);

                    if (settings.maxTrade) document.getElementById('kucoinMaxTrade').value = settings.maxTrade;
                    if (settings.portfolioPercent) document.getElementById('kucoinPortfolioPercent').value = settings.portfolioPercent;
                    if (settings.profitThreshold) document.getElementById('kucoinProfitThreshold').value = settings.profitThreshold;

                    // Load path set preferences
                    for (let i = 1; i <= 5; i++) {
                        const checkbox = document.getElementById(`kucoinSet${i}Enabled`);
                        if (checkbox && settings.hasOwnProperty(`set${i}Enabled`)) {
                            checkbox.checked = settings[`set${i}Enabled`];
                        }
                    }
                } catch (error) {
                    console.error('‚ùå [KUCOIN] Failed to parse settings:', error);
                }
            }

            // Load toggle state
            const toggleEnabled = localStorage.getItem('kucoinTriangularEnabled') === 'true';
            const toggle = document.getElementById('kucoinTriangularEnabled');
            const status = document.getElementById('kucoinTriangularStatus');

            if (toggleEnabled) {
                toggle.classList.add('active');
                status.textContent = 'ON';
                status.style.color = '#00D092';
                console.log('‚úÖ [KUCOIN] Live trading enabled (from localStorage)');
            } else {
                console.log('‚ÑπÔ∏è [KUCOIN] Live trading disabled (from localStorage)');
            }
        }

        // Initialize OKX settings on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ [OKX] Initializing triangular arbitrage settings...');
            loadOKXTriangularSettings();

            // Add event listeners for OKX inputs (auto-save)
            const okxInputs = document.querySelectorAll('#okxMaxTrade, #okxPortfolioPercent, #okxProfitThreshold');
            okxInputs.forEach(input => {
                input.addEventListener('change', saveOKXTriangularSettings);
            });

            // Add event listeners for OKX checkboxes (5 sets)
            for (let i = 1; i <= 5; i++) {
                const checkbox = document.getElementById(`okxSet${i}Enabled`);
                if (checkbox) {
                    checkbox.addEventListener('change', saveOKXTriangularSettings);
                }
            }
        });

        // Initialize KuCoin settings on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ [KUCOIN] Initializing triangular arbitrage settings...');
            loadKuCoinTriangularSettings();

            // Add event listeners for KuCoin inputs (auto-save)
            const kucoinInputs = document.querySelectorAll('#kucoinMaxTrade, #kucoinPortfolioPercent, #kucoinProfitThreshold');
            kucoinInputs.forEach(input => {
                input.addEventListener('change', saveKuCoinTriangularSettings);
            });

            // Add event listeners for KuCoin checkboxes (5 sets)
            for (let i = 1; i <= 5; i++) {
                const checkbox = document.getElementById(`kucoinSet${i}Enabled`);
                if (checkbox) {
                    checkbox.addEventListener('change', saveKuCoinTriangularSettings);
                }
            }
        });

        // ============================================================================
        // COINBASE TRIANGULAR ARBITRAGE FUNCTIONS
        // ============================================================================

        function toggleCoinbaseTriangular() {
            const toggle = document.getElementById('coinbaseTriangularEnabled');
            const status = document.getElementById('coinbaseTriangularStatus');
            const isActive = toggle.classList.toggle('active');

            if (isActive) {
                status.textContent = 'ON';
                status.style.color = '#0052FF';
                localStorage.setItem('coinbaseTriangularEnabled', 'true');
                console.log('‚úÖ [COINBASE] Live triangular trading enabled');
            } else {
                status.textContent = 'OFF';
                status.style.color = '#ff6b6b';
                localStorage.setItem('coinbaseTriangularEnabled', 'false');
                console.log('‚è∏Ô∏è [COINBASE] Live triangular trading disabled');
            }
        }

        async function testCoinbaseTriangularConnection() {
            console.log('üîç [COINBASE] Testing connection...');

            const apiKey = localStorage.getItem('coinbase_triangular_api');
            const apiSecret = localStorage.getItem('coinbase_triangular_secret');

            if (!apiKey || !apiSecret) {
                alert('‚ùå Please configure your Coinbase API credentials (EC Private Key) in platform settings first.');
                return;
            }

            try {
                const response = await fetch('/api/v1/trading/coinbase/triangular/test-connection', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    },
                    body: JSON.stringify({ apiKey, apiSecret })
                });

                const data = await response.json();

                if (data.success) {
                    alert(`‚úÖ Coinbase Connection Successful!\n\nAccounts: ${data.accountsCount}\nTimestamp: ${new Date(data.timestamp).toLocaleString()}`);
                    console.log('‚úÖ [COINBASE] Connection test passed:', data);
                } else {
                    alert(`‚ùå Connection Failed: ${data.message}`);
                    console.error('‚ùå [COINBASE] Connection test failed:', data);
                }
            } catch (error) {
                console.error('‚ùå [COINBASE] Connection test error:', error);
                alert('‚ùå Connection test failed. Check console for details.');
            }
        }

        async function scanCoinbaseTriangularPaths() {
            console.log('üîç [COINBASE] Starting scan for triangular arbitrage opportunities...');

            const apiKey = localStorage.getItem('coinbase_triangular_api');
            const apiSecret = localStorage.getItem('coinbase_triangular_secret');

            if (!apiKey || !apiSecret) {
                alert('‚ùå Please configure your Coinbase API credentials in platform settings first.');
                return;
            }

            const maxTradeAmount = parseFloat(document.getElementById('coinbaseMaxTrade').value);
            const profitThreshold = parseFloat(document.getElementById('coinbaseProfitThreshold').value);

            const enabledSets = {
                SET_1_ESSENTIAL_ETH_BRIDGE: document.getElementById('coinbaseSet1Enabled').checked,
                SET_2_MIDCAP_BTC_BRIDGE: document.getElementById('coinbaseSet2Enabled').checked,
                SET_3_DEFI_NATIVE: document.getElementById('coinbaseSet3Enabled').checked,
                SET_4_HIGH_VOLATILITY: document.getElementById('coinbaseSet4Enabled').checked,
                SET_5_EXTENDED_MULTIBRIDGE: document.getElementById('coinbaseSet5Enabled').checked
            };

            try {
                const response = await fetch('/api/v1/trading/coinbase/triangular/scan', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    },
                    body: JSON.stringify({
                        apiKey,
                        apiSecret,
                        maxTradeAmount,
                        profitThreshold,
                        enabledSets
                    })
                });

                const data = await response.json();

                if (data.success) {
                    console.log(`‚úÖ [COINBASE] Scan complete: ${data.profitableCount} opportunities found`);

                    const container = document.getElementById('coinbaseOpportunities');

                    if (data.opportunities.length === 0) {
                        container.innerHTML = `
                            <p style="color: #888; text-align: center; padding: 20px;">
                                No profitable opportunities found above ${profitThreshold}% threshold.<br>
                                Try lowering the profit threshold or enabling more path sets.
                            </p>
                        `;
                    } else {
                        let html = '<div style="display: flex; flex-direction: column; gap: 15px;">';

                        data.opportunities.slice(0, 10).forEach((opp, index) => {
                            html += `
                                <div style="background: rgba(0,82,255,0.1); padding: 15px; border-radius: 8px; border-left: 4px solid #0052FF;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                        <strong style="color: #0052FF;">${opp.description}</strong>
                                        <span style="background: #0052FF; color: white; padding: 4px 12px; border-radius: 12px; font-weight: 600;">
                                            +${opp.profitPercent}%
                                        </span>
                                    </div>
                                    <div style="font-size: 0.9rem; color: #b8c6db;">
                                        <div>Path: ${opp.path.join(' ‚Üí ')}</div>
                                        <div>Initial: $${opp.initialAmount} USDC ‚Üí Final: $${opp.finalAmount.toFixed(2)} USDC</div>
                                        <div>Profit: $${opp.profitAmount.toFixed(2)} USDC</div>
                                        <div style="font-size: 0.8rem; color: #888; margin-top: 5px;">${opp.pathId}</div>
                                    </div>
                                </div>
                            `;
                        });

                        if (data.opportunities.length > 10) {
                            html += `<p style="text-align: center; color: #888; font-size: 0.9rem;">Showing top 10 of ${data.opportunities.length} opportunities</p>`;
                        }

                        html += '</div>';
                        container.innerHTML = html;
                    }

                    alert(`‚úÖ Scan Complete!\n\nTotal Scanned: ${data.totalScanned} paths\nProfitable: ${data.profitableCount} opportunities\nBest: ${data.opportunities[0]?.profitPercent || 0}%\n\nFunding: USDC`);
                } else {
                    alert(`‚ùå Scan Failed: ${data.message}`);
                    console.error('‚ùå [COINBASE] Scan failed:', data);
                }
            } catch (error) {
                console.error('‚ùå [COINBASE] Scan error:', error);
                alert('‚ùå Scan failed. Check console for details.');
            }
        }

        function viewCoinbasePathDetails() {
            console.log('üìã [COINBASE] Viewing all triangular path details...');

            const pathDetails = `
üìã COINBASE Triangular Arbitrage Paths (32 Total) - USDC BRIDGE

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
SET 1: ESSENTIAL ETH BRIDGE (7 paths) ‚úì
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDC ‚Üí ETH ‚Üí BTC ‚Üí USDC
2. USDC ‚Üí ETH ‚Üí SOL ‚Üí USDC
3. USDC ‚Üí ETH ‚Üí XRP ‚Üí USDC
4. USDC ‚Üí ETH ‚Üí ADA ‚Üí USDC
5. USDC ‚Üí ETH ‚Üí DOT ‚Üí USDC
6. USDC ‚Üí ETH ‚Üí MATIC ‚Üí USDC
7. USDC ‚Üí ETH ‚Üí LINK ‚Üí USDC

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
SET 2: MIDCAP BTC BRIDGE (7 paths) ‚úì
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDC ‚Üí BTC ‚Üí ETH ‚Üí USDC
2. USDC ‚Üí BTC ‚Üí SOL ‚Üí USDC
3. USDC ‚Üí BTC ‚Üí AVAX ‚Üí USDC
4. USDC ‚Üí BTC ‚Üí ATOM ‚Üí USDC
5. USDC ‚Üí BTC ‚Üí LTC ‚Üí USDC
6. USDC ‚Üí BTC ‚Üí UNI ‚Üí USDC
7. USDC ‚Üí BTC ‚Üí ALGO ‚Üí USDC

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
SET 3: DEFI NATIVE (6 paths)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDC ‚Üí AAVE ‚Üí ETH ‚Üí USDC (DeFi)
2. USDC ‚Üí COMP ‚Üí ETH ‚Üí USDC (DeFi)
3. USDC ‚Üí MKR ‚Üí ETH ‚Üí USDC (DeFi)
4. USDC ‚Üí SNX ‚Üí ETH ‚Üí USDC (DeFi)
5. USDC ‚Üí CRV ‚Üí ETH ‚Üí USDC (DeFi)
6. USDC ‚Üí SUSHI ‚Üí ETH ‚Üí USDC (DeFi)

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
SET 4: HIGH VOLATILITY (6 paths)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDC ‚Üí DOGE ‚Üí BTC ‚Üí USDC (Meme)
2. USDC ‚Üí SHIB ‚Üí ETH ‚Üí USDC (Meme)
3. USDC ‚Üí APE ‚Üí ETH ‚Üí USDC (Gaming)
4. USDC ‚Üí GALA ‚Üí BTC ‚Üí USDC (Gaming)
5. USDC ‚Üí SAND ‚Üí ETH ‚Üí USDC (Gaming)
6. USDC ‚Üí MANA ‚Üí ETH ‚Üí USDC (Gaming)

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
SET 5: EXTENDED MULTIBRIDGE (6 paths)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDC ‚Üí FIL ‚Üí BTC ‚Üí USDC
2. USDC ‚Üí GRT ‚Üí ETH ‚Üí USDC
3. USDC ‚Üí ICP ‚Üí BTC ‚Üí USDC
4. USDC ‚Üí CHZ ‚Üí ETH ‚Üí USDC
5. USDC ‚Üí ENJ ‚Üí BTC ‚Üí USDC
6. USDC ‚Üí BTC ‚Üí ETH ‚Üí SOL ‚Üí USDC (4-leg)

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üí° TIP: Sets 1-2 are enabled by default (14 paths)
‚ö° Enable Sets 3-5 for more opportunities (18 additional paths)
üíµ FUNDING: USDC (237 USDC pairs available)
            `.trim();

            alert(pathDetails);
            console.log(pathDetails);
        }

        async function clearCoinbaseTriangularHistory() {
            if (!confirm('‚ö†Ô∏è Are you sure you want to clear ALL Coinbase triangular trade history? This cannot be undone.')) {
                return;
            }

            try {
                const response = await fetch('/api/v1/trading/coinbase/triangular/history', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    }
                });

                const data = await response.json();

                if (data.success) {
                    alert(`‚úÖ ${data.message}`);
                    console.log('‚úÖ [COINBASE] History cleared:', data);
                } else {
                    alert(`‚ùå Failed to clear history: ${data.message}`);
                }
            } catch (error) {
                console.error('‚ùå [COINBASE] Clear history error:', error);
                alert('‚ùå Failed to clear history. Check console for details.');
            }
        }

        function saveCoinbaseTriangularSettings() {
            console.log('üíæ [COINBASE] Saving settings to localStorage...');

            const maxTrade = document.getElementById('coinbaseMaxTrade').value;
            const portfolioPercent = document.getElementById('coinbasePortfolioPercent').value;
            const profitThreshold = document.getElementById('coinbaseProfitThreshold').value;

            const settings = {
                maxTrade: maxTrade,
                portfolioPercent: portfolioPercent,
                profitThreshold: profitThreshold,
                set1Enabled: document.getElementById('coinbaseSet1Enabled').checked,
                set2Enabled: document.getElementById('coinbaseSet2Enabled').checked,
                set3Enabled: document.getElementById('coinbaseSet3Enabled').checked,
                set4Enabled: document.getElementById('coinbaseSet4Enabled').checked,
                set5Enabled: document.getElementById('coinbaseSet5Enabled').checked
            };

            localStorage.setItem('coinbaseTriangularSettings', JSON.stringify(settings));
            console.log('‚úÖ [COINBASE] Settings saved:', settings);
        }

        function loadCoinbaseTriangularSettings() {
            console.log('üì• [COINBASE] Loading settings from localStorage...');

            // Load settings
            const settingsJson = localStorage.getItem('coinbaseTriangularSettings');
            if (settingsJson) {
                try {
                    const settings = JSON.parse(settingsJson);
                    console.log('‚úÖ [COINBASE] Settings loaded:', settings);

                    if (settings.maxTrade) document.getElementById('coinbaseMaxTrade').value = settings.maxTrade;
                    if (settings.portfolioPercent) document.getElementById('coinbasePortfolioPercent').value = settings.portfolioPercent;
                    if (settings.profitThreshold) document.getElementById('coinbaseProfitThreshold').value = settings.profitThreshold;

                    // Load path set preferences
                    for (let i = 1; i <= 5; i++) {
                        const checkbox = document.getElementById(`coinbaseSet${i}Enabled`);
                        if (checkbox && settings.hasOwnProperty(`set${i}Enabled`)) {
                            checkbox.checked = settings[`set${i}Enabled`];
                        }
                    }
                } catch (error) {
                    console.error('‚ùå [COINBASE] Failed to parse settings:', error);
                }
            }

            // Load toggle state
            const toggleEnabled = localStorage.getItem('coinbaseTriangularEnabled') === 'true';
            const toggle = document.getElementById('coinbaseTriangularEnabled');
            const status = document.getElementById('coinbaseTriangularStatus');

            if (toggleEnabled) {
                toggle.classList.add('active');
                status.textContent = 'ON';
                status.style.color = '#0052FF';
                console.log('‚úÖ [COINBASE] Live trading enabled (from localStorage)');
            } else {
                console.log('‚ÑπÔ∏è [COINBASE] Live trading disabled (from localStorage)');
            }
        }

        // Initialize Coinbase settings on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ [COINBASE] Initializing triangular arbitrage settings...');
            loadCoinbaseTriangularSettings();

            // Add event listeners for Coinbase inputs (auto-save)
            const coinbaseInputs = document.querySelectorAll('#coinbaseMaxTrade, #coinbasePortfolioPercent, #coinbaseProfitThreshold');
            coinbaseInputs.forEach(input => {
                input.addEventListener('change', saveCoinbaseTriangularSettings);
            });

            // Add event listeners for Coinbase checkboxes (5 sets)
            for (let i = 1; i <= 5; i++) {
                const checkbox = document.getElementById(`coinbaseSet${i}Enabled`);
                if (checkbox) {
                    checkbox.addEventListener('change', saveCoinbaseTriangularSettings);
                }
            }
        });

        // ============================================================================
        // HUOBI (HTX) TRIANGULAR ARBITRAGE FUNCTIONS
        // ============================================================================

        function toggleHuobiTriangular() {
            const toggle = document.getElementById('huobiTriangularEnabled');
            const status = document.getElementById('huobiTriangularStatus');
            const isActive = toggle.classList.toggle('active');

            if (isActive) {
                status.textContent = 'ON';
                status.style.color = '#2D6CF8';
                localStorage.setItem('huobiTriangularEnabled', 'true');
                console.log('‚úÖ [HUOBI] Live triangular trading enabled');
            } else {
                status.textContent = 'OFF';
                status.style.color = '#ff6b6b';
                localStorage.setItem('huobiTriangularEnabled', 'false');
                console.log('‚è∏Ô∏è [HUOBI] Live triangular trading disabled');
            }
        }

        async function testHuobiTriangularConnection() {
            console.log('üîç [HUOBI] Testing connection...');

            const apiKey = localStorage.getItem('huobi_triangular_api');
            const apiSecret = localStorage.getItem('huobi_triangular_secret');

            if (!apiKey || !apiSecret) {
                alert('‚ùå Please configure your Huobi API credentials in platform settings first.');
                return;
            }

            try {
                const response = await fetch('/api/v1/trading/huobi/triangular/test-connection', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    },
                    body: JSON.stringify({ apiKey, apiSecret })
                });

                const data = await response.json();

                if (data.success) {
                    alert(`‚úÖ Huobi Connection Successful!\n\nAccounts: ${data.accountsCount}\nTimestamp: ${new Date(data.timestamp).toLocaleString()}`);
                    console.log('‚úÖ [HUOBI] Connection test passed:', data);
                } else {
                    alert(`‚ùå Connection Failed: ${data.message}`);
                    console.error('‚ùå [HUOBI] Connection test failed:', data);
                }
            } catch (error) {
                console.error('‚ùå [HUOBI] Connection test error:', error);
                alert('‚ùå Connection test failed. Check console for details.');
            }
        }

        async function scanHuobiTriangularPaths() {
            console.log('üîç [HUOBI] Starting scan for triangular arbitrage opportunities...');

            const apiKey = localStorage.getItem('huobi_triangular_api');
            const apiSecret = localStorage.getItem('huobi_triangular_secret');

            if (!apiKey || !apiSecret) {
                alert('‚ùå Please configure your Huobi API credentials in platform settings first.');
                return;
            }

            const maxTradeAmount = parseFloat(document.getElementById('huobiMaxTrade').value);
            const profitThreshold = parseFloat(document.getElementById('huobiProfitThreshold').value);

            const enabledSets = {
                SET_1_ESSENTIAL_ETH_BRIDGE: document.getElementById('huobiSet1Enabled').checked,
                SET_2_MIDCAP_BTC_BRIDGE: document.getElementById('huobiSet2Enabled').checked,
                SET_3_HT_NATIVE_BRIDGE: document.getElementById('huobiSet3Enabled').checked,
                SET_4_HIGH_VOLATILITY: document.getElementById('huobiSet4Enabled').checked,
                SET_5_EXTENDED_MULTIBRIDGE: document.getElementById('huobiSet5Enabled').checked
            };

            try {
                const response = await fetch('/api/v1/trading/huobi/triangular/scan', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    },
                    body: JSON.stringify({
                        apiKey,
                        apiSecret,
                        maxTradeAmount,
                        profitThreshold,
                        enabledSets
                    })
                });

                const data = await response.json();

                if (data.success) {
                    console.log(`‚úÖ [HUOBI] Scan complete: ${data.profitableCount} opportunities found`);

                    const container = document.getElementById('huobiOpportunities');

                    if (data.opportunities.length === 0) {
                        container.innerHTML = `
                            <p style="color: #888; text-align: center; padding: 20px;">
                                No profitable opportunities found above ${profitThreshold}% threshold.<br>
                                Try lowering the profit threshold or enabling more path sets.
                            </p>
                        `;
                    } else {
                        let html = '<div style="display: flex; flex-direction: column; gap: 15px;">';

                        data.opportunities.slice(0, 10).forEach((opp, index) => {
                            html += `
                                <div style="background: rgba(45,108,248,0.1); padding: 15px; border-radius: 8px; border-left: 4px solid #2D6CF8;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                        <strong style="color: #2D6CF8;">${opp.description}</strong>
                                        <span style="background: #2D6CF8; color: white; padding: 4px 12px; border-radius: 12px; font-weight: 600;">
                                            +${opp.profitPercent}%
                                        </span>
                                    </div>
                                    <div style="font-size: 0.9rem; color: #b8c6db;">
                                        <div>Path: ${opp.path.join(' ‚Üí ')}</div>
                                        <div>Initial: $${opp.initialAmount} USDT ‚Üí Final: $${opp.finalAmount.toFixed(2)} USDT</div>
                                        <div>Profit: $${opp.profitAmount.toFixed(2)} USDT</div>
                                        <div style="font-size: 0.8rem; color: #888; margin-top: 5px;">${opp.pathId}</div>
                                    </div>
                                </div>
                            `;
                        });

                        if (data.opportunities.length > 10) {
                            html += `<p style="text-align: center; color: #888; font-size: 0.9rem;">Showing top 10 of ${data.opportunities.length} opportunities</p>`;
                        }

                        html += '</div>';
                        container.innerHTML = html;
                    }

                    alert(`‚úÖ Scan Complete!\n\nTotal Scanned: ${data.totalScanned} paths\nProfitable: ${data.profitableCount} opportunities\nBest: ${data.opportunities[0]?.profitPercent || 0}%`);
                } else {
                    alert(`‚ùå Scan Failed: ${data.message}`);
                    console.error('‚ùå [HUOBI] Scan failed:', data);
                }
            } catch (error) {
                console.error('‚ùå [HUOBI] Scan error:', error);
                alert('‚ùå Scan failed. Check console for details.');
            }
        }

        function viewHuobiPathDetails() {
            console.log('üìã [HUOBI] Viewing all triangular path details...');

            const pathDetails = `
üìã HUOBI (HTX) Triangular Arbitrage Paths (32 Total)

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
SET 1: ESSENTIAL ETH BRIDGE (7 paths) ‚úì
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí ETH ‚Üí BTC ‚Üí USDT
2. USDT ‚Üí ETH ‚Üí SOL ‚Üí USDT
3. USDT ‚Üí ETH ‚Üí XRP ‚Üí USDT
4. USDT ‚Üí ETH ‚Üí TRX ‚Üí USDT
5. USDT ‚Üí ETH ‚Üí DOT ‚Üí USDT
6. USDT ‚Üí ETH ‚Üí MATIC ‚Üí USDT
7. USDT ‚Üí ETH ‚Üí LINK ‚Üí USDT

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
SET 2: MIDCAP BTC BRIDGE (7 paths) ‚úì
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí BTC ‚Üí ETH ‚Üí USDT
2. USDT ‚Üí BTC ‚Üí XRP ‚Üí USDT
3. USDT ‚Üí BTC ‚Üí LTC ‚Üí USDT
4. USDT ‚Üí BTC ‚Üí BCH ‚Üí USDT
5. USDT ‚Üí BTC ‚Üí ADA ‚Üí USDT
6. USDT ‚Üí BTC ‚Üí AVAX ‚Üí USDT
7. USDT ‚Üí BTC ‚Üí UNI ‚Üí USDT

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
SET 3: HT NATIVE BRIDGE (6 paths)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí HT ‚Üí BTC ‚Üí USDT (Native)
2. USDT ‚Üí HT ‚Üí ETH ‚Üí USDT (Native)
3. USDT ‚Üí HT ‚Üí XRP ‚Üí USDT (Native)
4. USDT ‚Üí HT ‚Üí TRX ‚Üí USDT (Native)
5. USDT ‚Üí HT ‚Üí DOT ‚Üí USDT (Native)
6. USDT ‚Üí HT ‚Üí SOL ‚Üí USDT (Native)

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
SET 4: HIGH VOLATILITY (6 paths)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí DOGE ‚Üí BTC ‚Üí USDT (Meme)
2. USDT ‚Üí SHIB ‚Üí ETH ‚Üí USDT (Meme)
3. USDT ‚Üí APE ‚Üí ETH ‚Üí USDT (NFT)
4. USDT ‚Üí NEAR ‚Üí BTC ‚Üí USDT (Layer1)
5. USDT ‚Üí APT ‚Üí ETH ‚Üí USDT (Layer1)
6. USDT ‚Üí FTM ‚Üí BTC ‚Üí USDT (DeFi)

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
SET 5: EXTENDED MULTIBRIDGE (6 paths)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí FIL ‚Üí BTC ‚Üí USDT
2. USDT ‚Üí ATOM ‚Üí ETH ‚Üí USDT
3. USDT ‚Üí ICP ‚Üí BTC ‚Üí USDT
4. USDT ‚Üí ALGO ‚Üí ETH ‚Üí USDT
5. USDT ‚Üí ETC ‚Üí BTC ‚Üí USDT
6. USDT ‚Üí BTC ‚Üí ETH ‚Üí XRP ‚Üí USDT (4-leg)

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üí° TIP: Sets 1-2 are enabled by default (14 paths)
‚ö° Enable Sets 3-5 for more opportunities (18 additional paths)
            `.trim();

            alert(pathDetails);
            console.log(pathDetails);
        }

        async function clearHuobiTriangularHistory() {
            if (!confirm('‚ö†Ô∏è Are you sure you want to clear ALL Huobi triangular trade history? This cannot be undone.')) {
                return;
            }

            try {
                const response = await fetch('/api/v1/trading/huobi/triangular/history', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    }
                });

                const data = await response.json();

                if (data.success) {
                    alert(`‚úÖ ${data.message}`);
                    console.log('‚úÖ [HUOBI] History cleared:', data);
                } else {
                    alert(`‚ùå Failed to clear history: ${data.message}`);
                }
            } catch (error) {
                console.error('‚ùå [HUOBI] Clear history error:', error);
                alert('‚ùå Failed to clear history. Check console for details.');
            }
        }

        function saveHuobiTriangularSettings() {
            console.log('üíæ [HUOBI] Saving settings to localStorage...');

            const maxTrade = document.getElementById('huobiMaxTrade').value;
            const portfolioPercent = document.getElementById('huobiPortfolioPercent').value;
            const profitThreshold = document.getElementById('huobiProfitThreshold').value;

            const settings = {
                maxTrade: maxTrade,
                portfolioPercent: portfolioPercent,
                profitThreshold: profitThreshold,
                set1Enabled: document.getElementById('huobiSet1Enabled').checked,
                set2Enabled: document.getElementById('huobiSet2Enabled').checked,
                set3Enabled: document.getElementById('huobiSet3Enabled').checked,
                set4Enabled: document.getElementById('huobiSet4Enabled').checked,
                set5Enabled: document.getElementById('huobiSet5Enabled').checked
            };

            localStorage.setItem('huobiTriangularSettings', JSON.stringify(settings));
            console.log('‚úÖ [HUOBI] Settings saved:', settings);
        }

        function loadHuobiTriangularSettings() {
            console.log('üì• [HUOBI] Loading settings from localStorage...');

            const settingsJson = localStorage.getItem('huobiTriangularSettings');
            if (settingsJson) {
                try {
                    const settings = JSON.parse(settingsJson);
                    console.log('‚úÖ [HUOBI] Settings loaded:', settings);

                    if (settings.maxTrade) document.getElementById('huobiMaxTrade').value = settings.maxTrade;
                    if (settings.portfolioPercent) document.getElementById('huobiPortfolioPercent').value = settings.portfolioPercent;
                    if (settings.profitThreshold) document.getElementById('huobiProfitThreshold').value = settings.profitThreshold;

                    for (let i = 1; i <= 5; i++) {
                        const checkbox = document.getElementById(`huobiSet${i}Enabled`);
                        if (checkbox && settings.hasOwnProperty(`set${i}Enabled`)) {
                            checkbox.checked = settings[`set${i}Enabled`];
                        }
                    }
                } catch (error) {
                    console.error('‚ùå [HUOBI] Failed to parse settings:', error);
                }
            }

            const toggleEnabled = localStorage.getItem('huobiTriangularEnabled') === 'true';
            const toggle = document.getElementById('huobiTriangularEnabled');
            const status = document.getElementById('huobiTriangularStatus');

            if (toggleEnabled) {
                toggle.classList.add('active');
                status.textContent = 'ON';
                status.style.color = '#2D6CF8';
                console.log('‚úÖ [HUOBI] Live trading enabled (from localStorage)');
            } else {
                console.log('‚ÑπÔ∏è [HUOBI] Live trading disabled (from localStorage)');
            }
        }

        // Initialize Huobi settings on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ [HUOBI] Initializing triangular arbitrage settings...');
            loadHuobiTriangularSettings();

            const huobiInputs = document.querySelectorAll('#huobiMaxTrade, #huobiPortfolioPercent, #huobiProfitThreshold');
            huobiInputs.forEach(input => {
                input.addEventListener('change', saveHuobiTriangularSettings);
            });

            for (let i = 1; i <= 5; i++) {
                const checkbox = document.getElementById(`huobiSet${i}Enabled`);
                if (checkbox) {
                    checkbox.addEventListener('change', saveHuobiTriangularSettings);
                }
            }
        });

        // ============================================================================
        // GATE.IO TRIANGULAR ARBITRAGE JAVASCRIPT FUNCTIONS
        // ============================================================================

        // 1. Test Gate.io Connection
        async function testGateioTriangularConnection() {
            try {
                const apiKey = localStorage.getItem('gateio_triangular_api');
                const apiSecret = localStorage.getItem('gateio_triangular_secret');

                if (!apiKey || !apiSecret) {
                    alert('‚ùå Gate.io API credentials not found!\n\nPlease set your API credentials on the SETUP page first.');
                    return;
                }

                document.getElementById('gateioStatusText').textContent = 'Testing connection...';
                document.getElementById('gateioStatusIndicator').style.background = '#FFA500';

                const response = await fetch('/api/v1/trading/gateio/triangular/test-connection', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    },
                    body: JSON.stringify({ apiKey, apiSecret })
                });

                const result = await response.json();

                if (result.success) {
                    document.getElementById('gateioStatusIndicator').style.background = '#17C784';
                    document.getElementById('gateioStatusText').textContent = `Connected | ${result.balances.USDT} USDT`;
                    alert(`‚úÖ Gate.io Connection Successful!\n\nUSDT Balance: ${result.balances.USDT}`);
                } else {
                    throw new Error(result.message);
                }
            } catch (error) {
                console.error('Gate.io connection error:', error);
                document.getElementById('gateioStatusIndicator').style.background = '#FF4444';
                document.getElementById('gateioStatusText').textContent = 'Connection Failed';
                alert(`‚ùå Gate.io Connection Failed\n\n${error.message}`);
            }
        }

        // 2. View Gate.io Path Details
        function viewGateioPathDetails() {
            const pathDetails = `
üìã GATE.IO Triangular Arbitrage Paths (32 Total)

üåø SET 1: Essential ETH Bridge (7 paths) ‚úÖ ENABLED BY DEFAULT
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí ETH ‚Üí BTC ‚Üí USDT (ETH_USDT, BTC_ETH, BTC_USDT)
2. USDT ‚Üí ETH ‚Üí SOL ‚Üí USDT (ETH_USDT, SOL_ETH, SOL_USDT)
3. USDT ‚Üí ETH ‚Üí XRP ‚Üí USDT (ETH_USDT, XRP_ETH, XRP_USDT)
4. USDT ‚Üí ETH ‚Üí ADA ‚Üí USDT (ETH_USDT, ADA_ETH, ADA_USDT)
5. USDT ‚Üí ETH ‚Üí MATIC ‚Üí USDT (ETH_USDT, MATIC_ETH, MATIC_USDT)
6. USDT ‚Üí ETH ‚Üí LINK ‚Üí USDT (ETH_USDT, LINK_ETH, LINK_USDT)
7. USDT ‚Üí ETH ‚Üí AVAX ‚Üí USDT (ETH_USDT, AVAX_ETH, AVAX_USDT)

üî∑ SET 2: Mid-Cap BTC Bridge (7 paths) ‚úÖ ENABLED BY DEFAULT
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí BTC ‚Üí ETH ‚Üí USDT (BTC_USDT, ETH_BTC, ETH_USDT)
2. USDT ‚Üí BTC ‚Üí SOL ‚Üí USDT (BTC_USDT, SOL_BTC, SOL_USDT)
3. USDT ‚Üí BTC ‚Üí LTC ‚Üí USDT (BTC_USDT, LTC_BTC, LTC_USDT)
4. USDT ‚Üí BTC ‚Üí DOT ‚Üí USDT (BTC_USDT, DOT_BTC, DOT_USDT)
5. USDT ‚Üí BTC ‚Üí ATOM ‚Üí USDT (BTC_USDT, ATOM_BTC, ATOM_USDT)
6. USDT ‚Üí BTC ‚Üí UNI ‚Üí USDT (BTC_USDT, UNI_BTC, UNI_USDT)
7. USDT ‚Üí BTC ‚Üí BCH ‚Üí USDT (BTC_USDT, BCH_BTC, BCH_USDT)

üåø SET 3: GT Native Bridge (6 paths) - Gate Token
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí GT ‚Üí BTC ‚Üí USDT (GT_USDT, BTC_GT, BTC_USDT)
2. USDT ‚Üí GT ‚Üí ETH ‚Üí USDT (GT_USDT, ETH_GT, ETH_USDT)
3. USDT ‚Üí GT ‚Üí SOL ‚Üí USDT (GT_USDT, SOL_GT, SOL_USDT)
4. USDT ‚Üí BTC ‚Üí GT ‚Üí USDT (BTC_USDT, GT_BTC, GT_USDT)
5. USDT ‚Üí ETH ‚Üí GT ‚Üí USDT (ETH_USDT, GT_ETH, GT_USDT)
6. USDT ‚Üí GT ‚Üí TRX ‚Üí USDT (GT_USDT, TRX_GT, TRX_USDT)

‚ö° SET 4: High Volatility (6 paths)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí DOGE ‚Üí BTC ‚Üí USDT (DOGE_USDT, BTC_DOGE, BTC_USDT)
2. USDT ‚Üí SHIB ‚Üí ETH ‚Üí USDT (SHIB_USDT, ETH_SHIB, ETH_USDT)
3. USDT ‚Üí FTM ‚Üí BTC ‚Üí USDT (FTM_USDT, BTC_FTM, BTC_USDT)
4. USDT ‚Üí SAND ‚Üí ETH ‚Üí USDT (SAND_USDT, ETH_SAND, ETH_USDT)
5. USDT ‚Üí MANA ‚Üí BTC ‚Üí USDT (MANA_USDT, BTC_MANA, BTC_USDT)
6. USDT ‚Üí APE ‚Üí ETH ‚Üí USDT (APE_USDT, ETH_APE, ETH_USDT)

üîÅ SET 5: Extended Multi-Bridge (6 paths)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí SOL ‚Üí ETH ‚Üí USDT (SOL_USDT, ETH_SOL, ETH_USDT)
2. USDT ‚Üí XRP ‚Üí BTC ‚Üí USDT (XRP_USDT, BTC_XRP, BTC_USDT)
3. USDT ‚Üí TRX ‚Üí BTC ‚Üí USDT (TRX_USDT, BTC_TRX, BTC_USDT)
4. USDT ‚Üí ADA ‚Üí BTC ‚Üí USDT (ADA_USDT, BTC_ADA, BTC_USDT)
5. USDT ‚Üí BTC ‚Üí ETH ‚Üí SOL ‚Üí USDT ‚≠ê 4-LEG (BTC_USDT, ETH_BTC, SOL_ETH, SOL_USDT)
6. USDT ‚Üí ETH ‚Üí BTC ‚Üí XRP ‚Üí USDT ‚≠ê 4-LEG (ETH_USDT, BTC_ETH, XRP_BTC, XRP_USDT)

üí° TOTAL: 32 paths (30 three-leg + 2 four-leg)
üåâ BRIDGE: USDT (3,800+ pairs available)
üåø NATIVE: GT (GateToken) for reduced fees
üîê AUTH: HMAC-SHA512 signature
üìä LIQUIDITY: $2.5B+ daily BTC/USDT volume
            `.trim();

            alert(pathDetails);
        }

        // 3. Save Gate.io Settings
        function saveGateioTriangularSettings() {
            const settings = {
                maxTrade: document.getElementById('gateioMaxTrade').value,
                portfolioPercent: document.getElementById('gateioPortfolioPercent').value,
                profitThreshold: document.getElementById('gateioProfitThreshold').value,
                set1Enabled: document.getElementById('gateioSet1Enabled').checked,
                set2Enabled: document.getElementById('gateioSet2Enabled').checked,
                set3Enabled: document.getElementById('gateioSet3Enabled').checked,
                set4Enabled: document.getElementById('gateioSet4Enabled').checked,
                set5Enabled: document.getElementById('gateioSet5Enabled').checked
            };

            localStorage.setItem('gateio_triangular_settings', JSON.stringify(settings));
            console.log('‚úÖ [GATE.IO] Settings saved:', settings);
        }

        // 4. Load Gate.io Settings
        function loadGateioTriangularSettings() {
            const saved = localStorage.getItem('gateio_triangular_settings');
            if (saved) {
                const settings = JSON.parse(saved);
                document.getElementById('gateioMaxTrade').value = settings.maxTrade || 100;
                document.getElementById('gateioPortfolioPercent').value = settings.portfolioPercent || 5;
                document.getElementById('gateioProfitThreshold').value = settings.profitThreshold || 0.3;
                document.getElementById('gateioSet1Enabled').checked = settings.set1Enabled !== false;
                document.getElementById('gateioSet2Enabled').checked = settings.set2Enabled !== false;
                document.getElementById('gateioSet3Enabled').checked = settings.set3Enabled === true;
                document.getElementById('gateioSet4Enabled').checked = settings.set4Enabled === true;
                document.getElementById('gateioSet5Enabled').checked = settings.set5Enabled === true;
                console.log('‚úÖ [GATE.IO] Settings loaded:', settings);
            }
        }

        // 5. Scan Gate.io Triangular Paths
        async function scanGateioTriangularPaths() {
            try {
                const apiKey = localStorage.getItem('gateio_triangular_api');
                const apiSecret = localStorage.getItem('gateio_triangular_secret');

                if (!apiKey || !apiSecret) {
                    alert('‚ùå Gate.io API credentials not found!\n\nPlease set your API credentials on the SETUP page first.');
                    return;
                }

                const maxTradeAmount = parseFloat(document.getElementById('gateioMaxTrade').value);
                const profitThreshold = parseFloat(document.getElementById('gateioProfitThreshold').value);

                const enabledSets = {
                    SET_1_ESSENTIAL_ETH_BRIDGE: document.getElementById('gateioSet1Enabled').checked,
                    SET_2_MIDCAP_BTC_BRIDGE: document.getElementById('gateioSet2Enabled').checked,
                    SET_3_GT_NATIVE_BRIDGE: document.getElementById('gateioSet3Enabled').checked,
                    SET_4_HIGH_VOLATILITY: document.getElementById('gateioSet4Enabled').checked,
                    SET_5_EXTENDED_MULTIBRIDGE: document.getElementById('gateioSet5Enabled').checked
                };

                document.getElementById('gateioScanStatus').innerHTML = 'üîç Scanning Gate.io triangular paths...';
                document.getElementById('gateioOpportunities').innerHTML = '<div style="text-align: center; padding: 20px;">‚è≥ Analyzing market data...</div>';

                const response = await fetch('/api/v1/trading/gateio/triangular/scan', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    },
                    body: JSON.stringify({
                        apiKey,
                        apiSecret,
                        maxTradeAmount,
                        profitThreshold,
                        enabledSets
                    })
                });

                const result = await response.json();

                if (result.success) {
                    document.getElementById('gateioScanStatus').innerHTML = `‚úÖ Scanned ${result.scanned} paths | Found ${result.opportunities.length} opportunities`;

                    if (result.opportunities.length === 0) {
                        document.getElementById('gateioOpportunities').innerHTML = `
                            <div style="text-align: center; padding: 30px; color: #888;">
                                <div style="font-size: 48px; margin-bottom: 15px;">üìä</div>
                                <div style="font-size: 16px; font-weight: 600; margin-bottom: 10px;">No Opportunities Found</div>
                                <div style="font-size: 14px;">Try lowering the profit threshold or enabling more path sets</div>
                            </div>
                        `;
                    } else {
                        let opportunitiesHtml = '<div style="display: grid; gap: 15px;">';

                        result.opportunities.forEach((opp, index) => {
                            const profitClass = parseFloat(opp.profitPercent) >= 1.0 ? '#17C784' : '#FFA500';

                            opportunitiesHtml += `
                                <div style="background: rgba(255,255,255,0.03); padding: 15px; border-radius: 10px; border-left: 4px solid ${profitClass};">
                                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                                        <div>
                                            <div style="color: ${profitClass}; font-weight: 600; font-size: 16px; margin-bottom: 5px;">
                                                ${opp.path}
                                            </div>
                                            <div style="color: #888; font-size: 13px;">${opp.description}</div>
                                        </div>
                                        <div style="text-align: right;">
                                            <div style="color: ${profitClass}; font-weight: 700; font-size: 20px;">+${opp.profitPercent}%</div>
                                            <div style="color: #888; font-size: 13px;">$${opp.profit} USDT</div>
                                        </div>
                                    </div>
                                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-top: 12px; padding-top: 12px; border-top: 1px solid rgba(255,255,255,0.1);">
                                        <div>
                                            <div style="color: #888; font-size: 11px;">Initial</div>
                                            <div style="color: white; font-weight: 600;">${opp.initialAmount} USDT</div>
                                        </div>
                                        <div>
                                            <div style="color: #888; font-size: 11px;">Final</div>
                                            <div style="color: white; font-weight: 600;">${opp.finalAmount} USDT</div>
                                        </div>
                                        <div>
                                            <div style="color: #888; font-size: 11px;">Pairs</div>
                                            <div style="color: white; font-size: 12px;">${opp.pairs.join(' ‚Üí ')}</div>
                                        </div>
                                    </div>
                                    <button onclick="executeGateioTriangularTrade('${opp.pathId}', true)" style="width: 100%; margin-top: 12px; padding: 8px; background: rgba(23,199,132,0.2); color: #17C784; border: 1px solid #17C784; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 13px;">
                                        üß™ DRY RUN TEST
                                    </button>
                                </div>
                            `;
                        });

                        opportunitiesHtml += '</div>';
                        document.getElementById('gateioOpportunities').innerHTML = opportunitiesHtml;
                    }
                } else {
                    throw new Error(result.message);
                }

            } catch (error) {
                console.error('Gate.io scan error:', error);
                document.getElementById('gateioScanStatus').innerHTML = '‚ùå Scan failed';
                document.getElementById('gateioOpportunities').innerHTML = `
                    <div style="text-align: center; padding: 20px; color: #FF4444;">
                        ‚ùå Error: ${error.message}
                    </div>
                `;
            }
        }

        // 6. Execute Gate.io Triangular Trade
        async function executeGateioTriangularTrade(pathId, dryRun = true) {
            try {
                const apiKey = localStorage.getItem('gateio_triangular_api');
                const apiSecret = localStorage.getItem('gateio_triangular_secret');

                if (!apiKey || !apiSecret) {
                    alert('‚ùå API credentials not found');
                    return;
                }

                const confirmed = confirm(`${dryRun ? 'üß™ DRY RUN' : '‚ö†Ô∏è LIVE EXECUTION'}\n\nExecute triangular arbitrage trade?\n\nPath ID: ${pathId}\n\nThis will ${dryRun ? 'simulate' : 'execute'} the trade.`);

                if (!confirmed) return;

                const response = await fetch('/api/v1/trading/gateio/triangular/execute', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    },
                    body: JSON.stringify({
                        apiKey,
                        apiSecret,
                        pathId,
                        dryRun
                    })
                });

                const result = await response.json();

                if (result.success) {
                    alert(`‚úÖ ${dryRun ? 'DRY RUN' : 'EXECUTION'} Successful!\n\n${result.message}`);
                } else {
                    throw new Error(result.message);
                }

            } catch (error) {
                console.error('Gate.io execution error:', error);
                alert(`‚ùå Execution Failed\n\n${error.message}`);
            }
        }

        // 7. Load Gate.io Trade History
        async function loadGateioTradeHistory() {
            try {
                const userId = localStorage.getItem('userId');
                if (!userId) return;

                const response = await fetch('/api/v1/trading/gateio/triangular/history', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    },
                    body: JSON.stringify({ userId, limit: 10 })
                });

                const result = await response.json();

                if (result.success && result.trades.length > 0) {
                    let historyHtml = '<div style="display: grid; gap: 10px;">';

                    result.trades.forEach(trade => {
                        const statusColor = trade.execution_status === 'completed' ? '#17C784' : '#FF4444';
                        const profitColor = parseFloat(trade.actual_profit_zar || 0) > 0 ? '#17C784' : '#FF4444';

                        historyHtml += `
                            <div style="background: rgba(255,255,255,0.03); padding: 12px; border-radius: 8px; border-left: 3px solid ${statusColor};">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                    <span style="color: white; font-weight: 600; font-size: 13px;">${trade.path_sequence}</span>
                                    <span style="color: ${profitColor}; font-weight: 600;">${trade.actual_profit_zar ? '+' + trade.actual_profit_zar : '‚Äî'} USDT</span>
                                </div>
                                <div style="color: #888; font-size: 12px;">${new Date(trade.created_at).toLocaleString()}</div>
                            </div>
                        `;
                    });

                    historyHtml += '</div>';
                    document.getElementById('gateioTradeHistory').innerHTML = historyHtml;
                }
            } catch (error) {
                console.error('Gate.io history error:', error);
            }
        }

        // Initialize Gate.io settings on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ [GATE.IO] Initializing triangular arbitrage settings...');
            loadGateioTriangularSettings();

            const gateioInputs = document.querySelectorAll('#gateioMaxTrade, #gateioPortfolioPercent, #gateioProfitThreshold');
            gateioInputs.forEach(input => {
                input.addEventListener('change', saveGateioTriangularSettings);
            });

            for (let i = 1; i <= 5; i++) {
                const checkbox = document.getElementById(`gateioSet${i}Enabled`);
                if (checkbox) {
                    checkbox.addEventListener('change', saveGateioTriangularSettings);
                }
            }
        });

        // ============================================================================
        // CRYPTO.COM TRIANGULAR ARBITRAGE JAVASCRIPT FUNCTIONS
        // ============================================================================

        // 1. Test Crypto.com Connection
        async function testCryptocomTriangularConnection() {
            try {
                const apiKey = localStorage.getItem('cryptocom_triangular_api');
                const apiSecret = localStorage.getItem('cryptocom_triangular_secret');

                if (!apiKey || !apiSecret) {
                    alert('‚ùå Crypto.com API credentials not found!\n\nPlease set your API credentials on the SETUP page first.');
                    return;
                }

                document.getElementById('cryptocomStatusText').textContent = 'Testing connection...';
                document.getElementById('cryptocomStatusIndicator').style.background = '#FFA500';

                const response = await fetch('/api/v1/trading/cryptocom/triangular/test-connection', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    },
                    body: JSON.stringify({ apiKey, apiSecret })
                });

                const result = await response.json();

                if (result.success) {
                    document.getElementById('cryptocomStatusIndicator').style.background = '#0066FF';
                    document.getElementById('cryptocomStatusText').textContent = `Connected | ${result.balances.USDT} USDT`;
                    alert(`‚úÖ Crypto.com Connection Successful!\n\nUSDT Balance: ${result.balances.USDT}`);
                } else {
                    throw new Error(result.message);
                }
            } catch (error) {
                console.error('Crypto.com connection error:', error);
                document.getElementById('cryptocomStatusIndicator').style.background = '#FF4444';
                document.getElementById('cryptocomStatusText').textContent = 'Connection Failed';
                alert(`‚ùå Crypto.com Connection Failed\n\n${error.message}`);
            }
        }

        // 2. View Crypto.com Path Details
        function viewCryptocomPathDetails() {
            const pathDetails = `
üìã CRYPTO.COM Triangular Arbitrage Paths (32 Total)

‚ú® SET 1: Essential ETH Bridge (7 paths) ‚úÖ ENABLED BY DEFAULT
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí ETH ‚Üí BTC ‚Üí USDT (ETH_USDT, BTC_ETH, BTC_USDT)
2. USDT ‚Üí ETH ‚Üí SOL ‚Üí USDT (ETH_USDT, SOL_ETH, SOL_USDT)
3. USDT ‚Üí ETH ‚Üí XRP ‚Üí USDT (ETH_USDT, XRP_ETH, XRP_USDT)
4. USDT ‚Üí ETH ‚Üí ADA ‚Üí USDT (ETH_USDT, ADA_ETH, ADA_USDT)
5. USDT ‚Üí ETH ‚Üí MATIC ‚Üí USDT (ETH_USDT, MATIC_ETH, MATIC_USDT)
6. USDT ‚Üí ETH ‚Üí DOT ‚Üí USDT (ETH_USDT, DOT_ETH, DOT_USDT)
7. USDT ‚Üí ETH ‚Üí AVAX ‚Üí USDT (ETH_USDT, AVAX_ETH, AVAX_USDT)

üî∑ SET 2: Mid-Cap BTC Bridge (7 paths) ‚úÖ ENABLED BY DEFAULT
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí BTC ‚Üí ETH ‚Üí USDT (BTC_USDT, ETH_BTC, ETH_USDT)
2. USDT ‚Üí BTC ‚Üí SOL ‚Üí USDT (BTC_USDT, SOL_BTC, SOL_USDT)
3. USDT ‚Üí BTC ‚Üí ADA ‚Üí USDT (BTC_USDT, ADA_BTC, ADA_USDT)
4. USDT ‚Üí BTC ‚Üí DOT ‚Üí USDT (BTC_USDT, DOT_BTC, DOT_USDT)
5. USDT ‚Üí BTC ‚Üí ATOM ‚Üí USDT (BTC_USDT, ATOM_BTC, ATOM_USDT)
6. USDT ‚Üí BTC ‚Üí LTC ‚Üí USDT (BTC_USDT, LTC_BTC, LTC_USDT)
7. USDT ‚Üí BTC ‚Üí XRP ‚Üí USDT (BTC_USDT, XRP_BTC, XRP_USDT)

üíé SET 3: CRO Native Bridge (6 paths) - Cronos Token
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí CRO ‚Üí BTC ‚Üí USDT (CRO_USDT, BTC_CRO, BTC_USDT)
2. USDT ‚Üí CRO ‚Üí ETH ‚Üí USDT (CRO_USDT, ETH_CRO, ETH_USDT)
3. USDT ‚Üí CRO ‚Üí SOL ‚Üí USDT (CRO_USDT, SOL_CRO, SOL_USDT)
4. USDT ‚Üí BTC ‚Üí CRO ‚Üí USDT (BTC_USDT, CRO_BTC, CRO_USDT)
5. USDT ‚Üí ETH ‚Üí CRO ‚Üí USDT (ETH_USDT, CRO_ETH, CRO_USDT)
6. USDT ‚Üí CRO ‚Üí MATIC ‚Üí USDT (CRO_USDT, MATIC_CRO, MATIC_USDT)

‚ö° SET 4: High Volatility (6 paths)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí DOGE ‚Üí BTC ‚Üí USDT (DOGE_USDT, BTC_DOGE, BTC_USDT)
2. USDT ‚Üí SHIB ‚Üí ETH ‚Üí USDT (SHIB_USDT, ETH_SHIB, ETH_USDT)
3. USDT ‚Üí MATIC ‚Üí BTC ‚Üí USDT (MATIC_USDT, BTC_MATIC, BTC_USDT)
4. USDT ‚Üí SOL ‚Üí ETH ‚Üí USDT (SOL_USDT, ETH_SOL, ETH_USDT)
5. USDT ‚Üí ADA ‚Üí BTC ‚Üí USDT (ADA_USDT, BTC_ADA, BTC_USDT)
6. USDT ‚Üí DOT ‚Üí ETH ‚Üí USDT (DOT_USDT, ETH_DOT, ETH_USDT)

üîÅ SET 5: Extended Multi-Bridge (6 paths)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí SOL ‚Üí BTC ‚Üí USDT (SOL_USDT, BTC_SOL, BTC_USDT)
2. USDT ‚Üí XRP ‚Üí ETH ‚Üí USDT (XRP_USDT, ETH_XRP, ETH_USDT)
3. USDT ‚Üí AVAX ‚Üí BTC ‚Üí USDT (AVAX_USDT, BTC_AVAX, BTC_USDT)
4. USDT ‚Üí ATOM ‚Üí ETH ‚Üí USDT (ATOM_USDT, ETH_ATOM, ETH_USDT)
5. USDT ‚Üí BTC ‚Üí ETH ‚Üí SOL ‚Üí USDT ‚≠ê 4-LEG (BTC_USDT, ETH_BTC, SOL_ETH, SOL_USDT)
6. USDT ‚Üí ETH ‚Üí BTC ‚Üí ADA ‚Üí USDT ‚≠ê 4-LEG (ETH_USDT, BTC_ETH, ADA_BTC, ADA_USDT)

üí° TOTAL: 32 paths (30 three-leg + 2 four-leg)
üåâ BRIDGE: USDT (250+ digital assets)
üíé NATIVE: CRO (Cronos) for reduced fees
üîê AUTH: HMAC-SHA256 signature
üìä EXCHANGE: API v1 (v2.1 deprecated July 2024)
            `.trim();

            alert(pathDetails);
        }

        // 3. Save Crypto.com Settings
        function saveCryptocomTriangularSettings() {
            const settings = {
                maxTrade: document.getElementById('cryptocomMaxTrade').value,
                portfolioPercent: document.getElementById('cryptocomPortfolioPercent').value,
                profitThreshold: document.getElementById('cryptocomProfitThreshold').value,
                set1Enabled: document.getElementById('cryptocomSet1Enabled').checked,
                set2Enabled: document.getElementById('cryptocomSet2Enabled').checked,
                set3Enabled: document.getElementById('cryptocomSet3Enabled').checked,
                set4Enabled: document.getElementById('cryptocomSet4Enabled').checked,
                set5Enabled: document.getElementById('cryptocomSet5Enabled').checked
            };

            localStorage.setItem('cryptocom_triangular_settings', JSON.stringify(settings));
            console.log('‚úÖ [CRYPTO.COM] Settings saved:', settings);
        }

        // 4. Load Crypto.com Settings
        function loadCryptocomTriangularSettings() {
            const saved = localStorage.getItem('cryptocom_triangular_settings');
            if (saved) {
                const settings = JSON.parse(saved);
                document.getElementById('cryptocomMaxTrade').value = settings.maxTrade || 100;
                document.getElementById('cryptocomPortfolioPercent').value = settings.portfolioPercent || 5;
                document.getElementById('cryptocomProfitThreshold').value = settings.profitThreshold || 0.3;
                document.getElementById('cryptocomSet1Enabled').checked = settings.set1Enabled !== false;
                document.getElementById('cryptocomSet2Enabled').checked = settings.set2Enabled !== false;
                document.getElementById('cryptocomSet3Enabled').checked = settings.set3Enabled === true;
                document.getElementById('cryptocomSet4Enabled').checked = settings.set4Enabled === true;
                document.getElementById('cryptocomSet5Enabled').checked = settings.set5Enabled === true;
                console.log('‚úÖ [CRYPTO.COM] Settings loaded:', settings);
            }
        }

        // 5. Scan Crypto.com Triangular Paths
        async function scanCryptocomTriangularPaths() {
            try {
                const apiKey = localStorage.getItem('cryptocom_triangular_api');
                const apiSecret = localStorage.getItem('cryptocom_triangular_secret');

                if (!apiKey || !apiSecret) {
                    alert('‚ùå Crypto.com API credentials not found!\n\nPlease set your API credentials on the SETUP page first.');
                    return;
                }

                const maxTradeAmount = parseFloat(document.getElementById('cryptocomMaxTrade').value);
                const profitThreshold = parseFloat(document.getElementById('cryptocomProfitThreshold').value);

                const enabledSets = {
                    SET_1_ESSENTIAL_ETH_BRIDGE: document.getElementById('cryptocomSet1Enabled').checked,
                    SET_2_MIDCAP_BTC_BRIDGE: document.getElementById('cryptocomSet2Enabled').checked,
                    SET_3_CRO_NATIVE_BRIDGE: document.getElementById('cryptocomSet3Enabled').checked,
                    SET_4_HIGH_VOLATILITY: document.getElementById('cryptocomSet4Enabled').checked,
                    SET_5_EXTENDED_MULTIBRIDGE: document.getElementById('cryptocomSet5Enabled').checked
                };

                document.getElementById('cryptocomScanStatus').innerHTML = 'üîç Scanning Crypto.com triangular paths...';
                document.getElementById('cryptocomOpportunities').innerHTML = '<div style="text-align: center; padding: 20px;">‚è≥ Analyzing market data...</div>';

                const response = await fetch('/api/v1/trading/cryptocom/triangular/scan', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    },
                    body: JSON.stringify({
                        apiKey,
                        apiSecret,
                        maxTradeAmount,
                        profitThreshold,
                        enabledSets
                    })
                });

                const result = await response.json();

                if (result.success) {
                    document.getElementById('cryptocomScanStatus').innerHTML = `‚úÖ Scanned ${result.scanned} paths | Found ${result.opportunities.length} opportunities`;

                    if (result.opportunities.length === 0) {
                        document.getElementById('cryptocomOpportunities').innerHTML = `
                            <div style="text-align: center; padding: 30px; color: #888;">
                                <div style="font-size: 48px; margin-bottom: 15px;">üìä</div>
                                <div style="font-size: 16px; font-weight: 600; margin-bottom: 10px;">No Opportunities Found</div>
                                <div style="font-size: 14px;">Try lowering the profit threshold or enabling more path sets</div>
                            </div>
                        `;
                    } else {
                        let opportunitiesHtml = '<div style="display: grid; gap: 15px;">';

                        result.opportunities.forEach((opp, index) => {
                            const profitClass = parseFloat(opp.profitPercent) >= 1.0 ? '#0066FF' : '#FFA500';

                            opportunitiesHtml += `
                                <div style="background: rgba(255,255,255,0.03); padding: 15px; border-radius: 10px; border-left: 4px solid ${profitClass};">
                                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                                        <div>
                                            <div style="color: ${profitClass}; font-weight: 600; font-size: 16px; margin-bottom: 5px;">
                                                ${opp.path}
                                            </div>
                                            <div style="color: #888; font-size: 13px;">${opp.description}</div>
                                        </div>
                                        <div style="text-align: right;">
                                            <div style="color: ${profitClass}; font-weight: 700; font-size: 20px;">+${opp.profitPercent}%</div>
                                            <div style="color: #888; font-size: 13px;">$${opp.profit} USDT</div>
                                        </div>
                                    </div>
                                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-top: 12px; padding-top: 12px; border-top: 1px solid rgba(255,255,255,0.1);">
                                        <div>
                                            <div style="color: #888; font-size: 11px;">Initial</div>
                                            <div style="color: white; font-weight: 600;">${opp.initialAmount} USDT</div>
                                        </div>
                                        <div>
                                            <div style="color: #888; font-size: 11px;">Final</div>
                                            <div style="color: white; font-weight: 600;">${opp.finalAmount} USDT</div>
                                        </div>
                                        <div>
                                            <div style="color: #888; font-size: 11px;">Pairs</div>
                                            <div style="color: white; font-size: 12px;">${opp.pairs.join(' ‚Üí ')}</div>
                                        </div>
                                    </div>
                                    <button onclick="executeCryptocomTriangularTrade('${opp.pathId}', true)" style="width: 100%; margin-top: 12px; padding: 8px; background: rgba(0,102,255,0.2); color: #0066FF; border: 1px solid #0066FF; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 13px;">
                                        üß™ DRY RUN TEST
                                    </button>
                                </div>
                            `;
                        });

                        opportunitiesHtml += '</div>';
                        document.getElementById('cryptocomOpportunities').innerHTML = opportunitiesHtml;
                    }
                } else {
                    throw new Error(result.message);
                }

            } catch (error) {
                console.error('Crypto.com scan error:', error);
                document.getElementById('cryptocomScanStatus').innerHTML = '‚ùå Scan failed';
                document.getElementById('cryptocomOpportunities').innerHTML = `
                    <div style="text-align: center; padding: 20px; color: #FF4444;">
                        ‚ùå Error: ${error.message}
                    </div>
                `;
            }
        }

        // 6. Execute Crypto.com Triangular Trade
        async function executeCryptocomTriangularTrade(pathId, dryRun = true) {
            try {
                const apiKey = localStorage.getItem('cryptocom_triangular_api');
                const apiSecret = localStorage.getItem('cryptocom_triangular_secret');

                if (!apiKey || !apiSecret) {
                    alert('‚ùå API credentials not found');
                    return;
                }

                const confirmed = confirm(`${dryRun ? 'üß™ DRY RUN' : '‚ö†Ô∏è LIVE EXECUTION'}\n\nExecute triangular arbitrage trade?\n\nPath ID: ${pathId}\n\nThis will ${dryRun ? 'simulate' : 'execute'} the trade.`);

                if (!confirmed) return;

                const response = await fetch('/api/v1/trading/cryptocom/triangular/execute', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    },
                    body: JSON.stringify({
                        apiKey,
                        apiSecret,
                        pathId,
                        dryRun
                    })
                });

                const result = await response.json();

                if (result.success) {
                    alert(`‚úÖ ${dryRun ? 'DRY RUN' : 'EXECUTION'} Successful!\n\n${result.message}`);
                } else {
                    throw new Error(result.message);
                }

            } catch (error) {
                console.error('Crypto.com execution error:', error);
                alert(`‚ùå Execution Failed\n\n${error.message}`);
            }
        }

        // 7. Load Crypto.com Trade History
        async function loadCryptocomTradeHistory() {
            try {
                const userId = localStorage.getItem('userId');
                if (!userId) return;

                const response = await fetch('/api/v1/trading/cryptocom/triangular/history', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    },
                    body: JSON.stringify({ userId, limit: 10 })
                });

                const result = await response.json();

                if (result.success && result.trades.length > 0) {
                    let historyHtml = '<div style="display: grid; gap: 10px;">';

                    result.trades.forEach(trade => {
                        const statusColor = trade.execution_status === 'completed' ? '#0066FF' : '#FF4444';
                        const profitColor = parseFloat(trade.actual_profit_zar || 0) > 0 ? '#0066FF' : '#FF4444';

                        historyHtml += `
                            <div style="background: rgba(255,255,255,0.03); padding: 12px; border-radius: 8px; border-left: 3px solid ${statusColor};">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                    <span style="color: white; font-weight: 600; font-size: 13px;">${trade.path_sequence}</span>
                                    <span style="color: ${profitColor}; font-weight: 600;">${trade.actual_profit_zar ? '+' + trade.actual_profit_zar : '‚Äî'} USDT</span>
                                </div>
                                <div style="color: #888; font-size: 12px;">${new Date(trade.created_at).toLocaleString()}</div>
                            </div>
                        `;
                    });

                    historyHtml += '</div>';
                    document.getElementById('cryptocomTradeHistory').innerHTML = historyHtml;
                }
            } catch (error) {
                console.error('Crypto.com history error:', error);
            }
        }

        // Initialize Crypto.com settings on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ [CRYPTO.COM] Initializing triangular arbitrage settings...');
            loadCryptocomTriangularSettings();

            const cryptocomInputs = document.querySelectorAll('#cryptocomMaxTrade, #cryptocomPortfolioPercent, #cryptocomProfitThreshold');
            cryptocomInputs.forEach(input => {
                input.addEventListener('change', saveCryptocomTriangularSettings);
            });

            for (let i = 1; i <= 5; i++) {
                const checkbox = document.getElementById(`cryptocomSet${i}Enabled`);
                if (checkbox) {
                    checkbox.addEventListener('change', saveCryptocomTriangularSettings);
                }
            }
        });

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // MEXC TRIANGULAR ARBITRAGE FUNCTIONS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        // 1. Test MEXC Connection
        async function testMexcTriangularConnection() {
            try {
                const apiKey = localStorage.getItem('mexc_triangular_api');
                const apiSecret = localStorage.getItem('mexc_triangular_secret');

                if (!apiKey || !apiSecret) {
                    alert('‚ùå MEXC API credentials not found!\n\nPlease set your API credentials on the SETUP page first.');
                    return;
                }

                document.getElementById('mexcStatusText').textContent = 'Testing connection...';
                document.getElementById('mexcStatusIndicator').style.background = '#FFA500';

                const response = await fetch('/api/v1/trading/mexc/triangular/test-connection', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    },
                    body: JSON.stringify({ apiKey, apiSecret })
                });

                const result = await response.json();

                if (result.success) {
                    document.getElementById('mexcStatusIndicator').style.background = '#FFA500';
                    document.getElementById('mexcStatusText').textContent = `Connected | ${result.balances.USDT} USDT`;
                    alert(`‚úÖ MEXC Connection Successful!\n\nUSDT Balance: ${result.balances.USDT}\nüíé MX Balance: ${result.balances.MX}\n\nüéâ 0% Trading Fees Active!`);
                } else {
                    throw new Error(result.message);
                }
            } catch (error) {
                console.error('MEXC connection error:', error);
                document.getElementById('mexcStatusIndicator').style.background = '#FF4444';
                document.getElementById('mexcStatusText').textContent = 'Connection Failed';
                alert(`‚ùå MEXC Connection Failed\n\n${error.message}`);
            }
        }

        // 2. View MEXC Path Details
        function viewMexcPathDetails() {
            const pathDetails = `
üìã MEXC Triangular Arbitrage Paths (32 Total)

‚ú® SET 1: Essential ETH Bridge (7 paths) ‚úÖ ENABLED BY DEFAULT
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí ETH ‚Üí BTC ‚Üí USDT (ETHUSDT, BTCETH, BTCUSDT)
2. USDT ‚Üí ETH ‚Üí SOL ‚Üí USDT (ETHUSDT, SOLETH, SOLUSDT)
3. USDT ‚Üí ETH ‚Üí XRP ‚Üí USDT (ETHUSDT, XRPETH, XRPUSDT)
4. USDT ‚Üí ETH ‚Üí ADA ‚Üí USDT (ETHUSDT, ADAETH, ADAUSDT)
5. USDT ‚Üí ETH ‚Üí MATIC ‚Üí USDT (ETHUSDT, MATICETH, MATICUSDT)
6. USDT ‚Üí ETH ‚Üí DOT ‚Üí USDT (ETHUSDT, DOTETH, DOTUSDT)
7. USDT ‚Üí ETH ‚Üí AVAX ‚Üí USDT (ETHUSDT, AVAXETH, AVAXUSDT)

üî∑ SET 2: Mid-Cap BTC Bridge (7 paths) ‚úÖ ENABLED BY DEFAULT
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí BTC ‚Üí ETH ‚Üí USDT (BTCUSDT, ETHBTC, ETHUSDT)
2. USDT ‚Üí BTC ‚Üí SOL ‚Üí USDT (BTCUSDT, SOLBTC, SOLUSDT)
3. USDT ‚Üí BTC ‚Üí ADA ‚Üí USDT (BTCUSDT, ADABTC, ADAUSDT)
4. USDT ‚Üí BTC ‚Üí DOT ‚Üí USDT (BTCUSDT, DOTBTC, DOTUSDT)
5. USDT ‚Üí BTC ‚Üí ATOM ‚Üí USDT (BTCUSDT, ATOMBTC, ATOMUSDT)
6. USDT ‚Üí BTC ‚Üí LTC ‚Üí USDT (BTCUSDT, LTCBTC, LTCUSDT)
7. USDT ‚Üí BTC ‚Üí XRP ‚Üí USDT (BTCUSDT, XRPBTC, XRPUSDT)

üü† SET 3: MX Native Bridge (6 paths) - MX Token (0% Fees!)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí MX ‚Üí BTC ‚Üí USDT (MXUSDT, BTCMX, BTCUSDT)
2. USDT ‚Üí MX ‚Üí ETH ‚Üí USDT (MXUSDT, ETHMX, ETHUSDT)
3. USDT ‚Üí MX ‚Üí SOL ‚Üí USDT (MXUSDT, SOLMX, SOLUSDT)
4. USDT ‚Üí BTC ‚Üí MX ‚Üí USDT (BTCUSDT, MXBTC, MXUSDT)
5. USDT ‚Üí ETH ‚Üí MX ‚Üí USDT (ETHUSDT, MXETH, MXUSDT)
6. USDT ‚Üí MX ‚Üí MATIC ‚Üí USDT (MXUSDT, MATICMX, MATICUSDT)

‚ö° SET 4: High Volatility (6 paths)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí DOGE ‚Üí BTC ‚Üí USDT (DOGEUSDT, BTCDOGE, BTCUSDT)
2. USDT ‚Üí SHIB ‚Üí ETH ‚Üí USDT (SHIBUSDT, ETHSHIB, ETHUSDT)
3. USDT ‚Üí MATIC ‚Üí BTC ‚Üí USDT (MATICUSDT, BTCMATIC, BTCUSDT)
4. USDT ‚Üí SOL ‚Üí ETH ‚Üí USDT (SOLUSDT, ETHSOL, ETHUSDT)
5. USDT ‚Üí ADA ‚Üí BTC ‚Üí USDT (ADAUSDT, BTCADA, BTCUSDT)
6. USDT ‚Üí DOT ‚Üí ETH ‚Üí USDT (DOTUSDT, ETHDOT, ETHUSDT)

üîÅ SET 5: Extended Multi-Bridge (6 paths)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí SOL ‚Üí BTC ‚Üí USDT (SOLUSDT, BTCSOL, BTCUSDT)
2. USDT ‚Üí XRP ‚Üí ETH ‚Üí USDT (XRPUSDT, ETHXRP, ETHUSDT)
3. USDT ‚Üí AVAX ‚Üí BTC ‚Üí USDT (AVAXUSDT, BTCAVAX, BTCUSDT)
4. USDT ‚Üí ATOM ‚Üí ETH ‚Üí USDT (ATOMUSDT, ETHATOM, ETHUSDT)
5. USDT ‚Üí BTC ‚Üí ETH ‚Üí SOL ‚Üí USDT ‚≠ê 4-LEG (BTCUSDT, ETHBTC, SOLETH, SOLUSDT)
6. USDT ‚Üí ETH ‚Üí BTC ‚Üí ADA ‚Üí USDT ‚≠ê 4-LEG (ETHUSDT, BTCETH, ADABTC, ADAUSDT)

üí° TOTAL: 32 paths (30 three-leg + 2 four-leg)
üåâ BRIDGE: USDT (2,908+ trading pairs)
üü† NATIVE: MX token for maximum opportunities
üîê AUTH: HMAC-SHA256 signature
üí∞ FEES: 0% trading fees on all pairs!
üìä EXCHANGE: MEXC Global (formerly MXC)
            `.trim();

            alert(pathDetails);
        }

        // 3. Save MEXC Settings
        function saveMexcTriangularSettings() {
            const settings = {
                maxTrade: document.getElementById('mexcMaxTrade').value,
                portfolioPercent: document.getElementById('mexcPortfolioPercent').value,
                profitThreshold: document.getElementById('mexcProfitThreshold').value,
                set1Enabled: document.getElementById('mexcSet1Enabled').checked,
                set2Enabled: document.getElementById('mexcSet2Enabled').checked,
                set3Enabled: document.getElementById('mexcSet3Enabled').checked,
                set4Enabled: document.getElementById('mexcSet4Enabled').checked,
                set5Enabled: document.getElementById('mexcSet5Enabled').checked
            };

            localStorage.setItem('mexc_triangular_settings', JSON.stringify(settings));
            console.log('‚úÖ [MEXC] Settings saved:', settings);
        }

        // 4. Load MEXC Settings
        function loadMexcTriangularSettings() {
            const saved = localStorage.getItem('mexc_triangular_settings');
            if (saved) {
                const settings = JSON.parse(saved);
                document.getElementById('mexcMaxTrade').value = settings.maxTrade || 100;
                document.getElementById('mexcPortfolioPercent').value = settings.portfolioPercent || 5;
                document.getElementById('mexcProfitThreshold').value = settings.profitThreshold || 0.3;
                document.getElementById('mexcSet1Enabled').checked = settings.set1Enabled !== false;
                document.getElementById('mexcSet2Enabled').checked = settings.set2Enabled !== false;
                document.getElementById('mexcSet3Enabled').checked = settings.set3Enabled === true;
                document.getElementById('mexcSet4Enabled').checked = settings.set4Enabled === true;
                document.getElementById('mexcSet5Enabled').checked = settings.set5Enabled === true;
                console.log('‚úÖ [MEXC] Settings loaded:', settings);
            }
        }

        // 5. Scan MEXC Triangular Paths
        async function scanMexcTriangularPaths() {
            try {
                const apiKey = localStorage.getItem('mexc_triangular_api');
                const apiSecret = localStorage.getItem('mexc_triangular_secret');

                if (!apiKey || !apiSecret) {
                    alert('‚ùå MEXC API credentials not found!\n\nPlease set your API credentials on the SETUP page first.');
                    return;
                }

                const maxTradeAmount = parseFloat(document.getElementById('mexcMaxTrade').value);
                const profitThreshold = parseFloat(document.getElementById('mexcProfitThreshold').value);

                const enabledSets = {
                    SET_1_ESSENTIAL_ETH_BRIDGE: document.getElementById('mexcSet1Enabled').checked,
                    SET_2_MIDCAP_BTC_BRIDGE: document.getElementById('mexcSet2Enabled').checked,
                    SET_3_MX_NATIVE_BRIDGE: document.getElementById('mexcSet3Enabled').checked,
                    SET_4_HIGH_VOLATILITY: document.getElementById('mexcSet4Enabled').checked,
                    SET_5_EXTENDED_MULTIBRIDGE: document.getElementById('mexcSet5Enabled').checked
                };

                document.getElementById('mexcScanStatus').textContent = 'üîç Scanning MEXC paths...';
                document.getElementById('mexcOpportunities').innerHTML = '<div style="text-align: center; padding: 20px; color: #FFA500;">‚è≥ Analyzing 2,908+ pairs...</div>';

                const response = await fetch('/api/v1/trading/mexc/triangular/scan', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    },
                    body: JSON.stringify({ apiKey, apiSecret, maxTradeAmount, profitThreshold, enabledSets })
                });

                const result = await response.json();

                if (result.success && result.opportunities.length > 0) {
                    document.getElementById('mexcScanStatus').textContent = `‚úÖ Found ${result.opportunities.length} opportunities`;

                    let oppsHtml = '<div style="display: grid; gap: 15px;">';
                    result.opportunities.forEach(opp => {
                        const profitColor = parseFloat(opp.profitPercent) >= 1 ? '#00ff88' : '#FFA500';
                        const riskColor = opp.risk === 'EXECUTE' ? '#00ff88' : opp.risk === 'CAUTIOUS' ? '#FFA500' : '#FF4444';

                        oppsHtml += `
                            <div style="background: rgba(255,165,0,0.1); padding: 15px; border-radius: 10px; border-left: 4px solid ${profitColor};">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                    <span style="color: white; font-weight: 600; font-size: 15px;">${opp.path.join(' ‚Üí ')}</span>
                                    <span style="color: ${profitColor}; font-weight: 700; font-size: 16px;">+${opp.profitPercent}%</span>
                                </div>
                                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 10px; font-size: 13px;">
                                    <div><span style="color: #888;">Expected:</span> <span style="color: white;">${opp.expectedProfitZAR} USDT</span></div>
                                    <div><span style="color: #888;">Risk:</span> <span style="color: ${riskColor};">${opp.risk}</span></div>
                                    <div><span style="color: #888;">Slippage:</span> <span style="color: white;">${opp.estimatedSlippage}%</span></div>
                                </div>
                                <div style="margin-top: 12px; display: flex; gap: 8px;">
                                    <button onclick='executeMexcTriangularTrade(${JSON.stringify(opp)})' style="flex: 1; padding: 8px; background: #FFA500; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 13px;">
                                        ‚ö° EXECUTE
                                    </button>
                                    <button onclick='alert("Path: ${opp.pairs.join(" ‚Üí ")}")' style="flex: 1; padding: 8px; background: rgba(255,165,0,0.2); color: #FFA500; border: 1px solid #FFA500; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 13px;">
                                        üìä Details
                                    </button>
                                </div>
                            </div>
                        `;
                    });
                    oppsHtml += '</div>';

                    document.getElementById('mexcOpportunities').innerHTML = oppsHtml;
                } else {
                    document.getElementById('mexcScanStatus').textContent = '‚ùå No profitable opportunities found';
                    document.getElementById('mexcOpportunities').innerHTML = '<div style="text-align: center; padding: 20px; color: #888;">No opportunities above profit threshold. Try lowering threshold or enabling more path sets.</div>';
                }
            } catch (error) {
                console.error('MEXC scan error:', error);
                document.getElementById('mexcScanStatus').textContent = '‚ùå Scan failed';
                document.getElementById('mexcOpportunities').innerHTML = `<div style="color: #FF4444; padding: 20px; text-align: center;">Error: ${error.message}</div>`;
            }
        }

        // 6. Execute MEXC Triangular Trade
        async function executeMexcTriangularTrade(opportunity) {
            try {
                const confirmation = confirm(`üü† EXECUTE MEXC TRIANGULAR TRADE\n\nPath: ${opportunity.path.join(' ‚Üí ')}\nExpected Profit: ${opportunity.profitPercent}% (+${opportunity.expectedProfitZAR} USDT)\nRisk: ${opportunity.risk}\n\n‚ö†Ô∏è This will execute a real trade on MEXC.\nContinue?`);

                if (!confirmation) {
                    return;
                }

                const apiKey = localStorage.getItem('mexc_triangular_api');
                const apiSecret = localStorage.getItem('mexc_triangular_secret');
                const userId = localStorage.getItem('userId');

                const response = await fetch('/api/v1/trading/mexc/triangular/execute', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    },
                    body: JSON.stringify({
                        apiKey,
                        apiSecret,
                        userId,
                        opportunity,
                        dryRun: false
                    })
                });

                const result = await response.json();

                if (result.success) {
                    alert(`‚úÖ MEXC Trade Executed!\n\nPath: ${opportunity.path.join(' ‚Üí ')}\nActual Profit: ${result.actualProfitZAR} USDT (${result.actualProfitPercent}%)\nExecution Time: ${result.executionTime}ms\n\nTrade ID: ${result.tradeId}`);
                    loadMexcTradeHistory();
                    scanMexcTriangularPaths(); // Refresh opportunities
                } else {
                    throw new Error(result.message);
                }
            } catch (error) {
                console.error('MEXC execution error:', error);
                alert(`‚ùå MEXC Trade Failed\n\n${error.message}`);
            }
        }

        // 7. Load MEXC Trade History
        async function loadMexcTradeHistory() {
            try {
                const userId = localStorage.getItem('userId');
                if (!userId) return;

                const response = await fetch('/api/v1/trading/mexc/triangular/history', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    },
                    body: JSON.stringify({ userId, limit: 10 })
                });

                const result = await response.json();

                if (result.success && result.trades.length > 0) {
                    let historyHtml = '<div style="display: grid; gap: 10px;">';

                    result.trades.forEach(trade => {
                        const statusColor = trade.execution_status === 'completed' ? '#FFA500' : '#FF4444';
                        const profitColor = parseFloat(trade.actual_profit_zar || 0) > 0 ? '#00ff88' : '#FF4444';

                        historyHtml += `
                            <div style="background: rgba(255,255,255,0.03); padding: 12px; border-radius: 8px; border-left: 3px solid ${statusColor};">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                    <span style="color: white; font-weight: 600; font-size: 13px;">${trade.path_sequence}</span>
                                    <span style="color: ${profitColor}; font-weight: 600;">${trade.actual_profit_zar ? '+' + trade.actual_profit_zar : '‚Äî'} USDT</span>
                                </div>
                                <div style="color: #888; font-size: 12px;">${new Date(trade.created_at).toLocaleString()}</div>
                            </div>
                        `;
                    });

                    historyHtml += '</div>';
                    document.getElementById('mexcTradeHistory').innerHTML = historyHtml;
                }
            } catch (error) {
                console.error('MEXC history error:', error);
            }
        }

        // Initialize MEXC settings on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üü† [MEXC] Initializing triangular arbitrage settings...');
            loadMexcTriangularSettings();

            const mexcInputs = document.querySelectorAll('#mexcMaxTrade, #mexcPortfolioPercent, #mexcProfitThreshold');
            mexcInputs.forEach(input => {
                input.addEventListener('change', saveMexcTriangularSettings);
            });

            for (let i = 1; i <= 5; i++) {
                const checkbox = document.getElementById(`mexcSet${i}Enabled`);
                if (checkbox) {
                    checkbox.addEventListener('change', saveMexcTriangularSettings);
                }
            }
        });

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // XT TRIANGULAR ARBITRAGE FUNCTIONS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        // 1. Test XT Connection
        async function testXtTriangularConnection() {
            try {
                const apiKey = localStorage.getItem('xt_triangular_api');
                const apiSecret = localStorage.getItem('xt_triangular_secret');

                if (!apiKey || !apiSecret) {
                    alert('‚ùå XT API credentials not found!\n\nPlease set your API credentials on the SETUP page first.');
                    return;
                }

                document.getElementById('xtStatusText').textContent = 'Testing connection...';
                document.getElementById('xtStatusIndicator').style.background = '#0096FF';

                const response = await fetch('/api/v1/trading/xt/triangular/test-connection', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    },
                    body: JSON.stringify({ apiKey, apiSecret })
                });

                const result = await response.json();

                if (result.success) {
                    document.getElementById('xtStatusIndicator').style.background = '#0096FF';
                    document.getElementById('xtStatusText').textContent = `Connected | ${result.balances.USDT} USDT`;
                    alert(`‚úÖ XT Connection Successful!\n\nUSDT Balance: ${result.balances.USDT}\nBTC Balance: ${result.balances.BTC}\nüöÄ XT Balance: ${result.balances.XT}\n\n‚ú® 7.8M Global Users`);
                } else {
                    throw new Error(result.message);
                }
            } catch (error) {
                console.error('XT connection error:', error);
                document.getElementById('xtStatusIndicator').style.background = '#FF4444';
                document.getElementById('xtStatusText').textContent = 'Connection Failed';
                alert(`‚ùå XT Connection Failed\n\n${error.message}`);
            }
        }

        // 2. View XT Path Details
        function viewXtPathDetails() {
            const pathDetails = `
üìã XT.COM Triangular Arbitrage Paths (32 Total)

‚ú® SET 1: Essential ETH Bridge (7 paths) ‚úÖ ENABLED BY DEFAULT
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí ETH ‚Üí BTC ‚Üí USDT (eth_usdt, btc_eth, btc_usdt)
2. USDT ‚Üí ETH ‚Üí SOL ‚Üí USDT (eth_usdt, sol_eth, sol_usdt)
3. USDT ‚Üí ETH ‚Üí XRP ‚Üí USDT (eth_usdt, xrp_eth, xrp_usdt)
4. USDT ‚Üí ETH ‚Üí ADA ‚Üí USDT (eth_usdt, ada_eth, ada_usdt)
5. USDT ‚Üí ETH ‚Üí MATIC ‚Üí USDT (eth_usdt, matic_eth, matic_usdt)
6. USDT ‚Üí ETH ‚Üí DOT ‚Üí USDT (eth_usdt, dot_eth, dot_usdt)
7. USDT ‚Üí ETH ‚Üí AVAX ‚Üí USDT (eth_usdt, avax_eth, avax_usdt)

üî∑ SET 2: Mid-Cap BTC Bridge (7 paths) ‚úÖ ENABLED BY DEFAULT
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí BTC ‚Üí ETH ‚Üí USDT (btc_usdt, eth_btc, eth_usdt)
2. USDT ‚Üí BTC ‚Üí SOL ‚Üí USDT (btc_usdt, sol_btc, sol_usdt)
3. USDT ‚Üí BTC ‚Üí ADA ‚Üí USDT (btc_usdt, ada_btc, ada_usdt)
4. USDT ‚Üí BTC ‚Üí DOT ‚Üí USDT (btc_usdt, dot_btc, dot_usdt)
5. USDT ‚Üí BTC ‚Üí ATOM ‚Üí USDT (btc_usdt, atom_btc, atom_usdt)
6. USDT ‚Üí BTC ‚Üí LTC ‚Üí USDT (btc_usdt, ltc_btc, ltc_usdt)
7. USDT ‚Üí BTC ‚Üí XRP ‚Üí USDT (btc_usdt, xrp_btc, xrp_usdt)

üöÄ SET 3: XT Native Bridge (6 paths) - XT Token
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí XT ‚Üí BTC ‚Üí USDT (xt_usdt, btc_xt, btc_usdt)
2. USDT ‚Üí XT ‚Üí ETH ‚Üí USDT (xt_usdt, eth_xt, eth_usdt)
3. USDT ‚Üí XT ‚Üí SOL ‚Üí USDT (xt_usdt, sol_xt, sol_usdt)
4. USDT ‚Üí BTC ‚Üí XT ‚Üí USDT (btc_usdt, xt_btc, xt_usdt)
5. USDT ‚Üí ETH ‚Üí XT ‚Üí USDT (eth_usdt, xt_eth, xt_usdt)
6. USDT ‚Üí XT ‚Üí MATIC ‚Üí USDT (xt_usdt, matic_xt, matic_usdt)

‚ö° SET 4: High Volatility (6 paths)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí DOGE ‚Üí BTC ‚Üí USDT (doge_usdt, btc_doge, btc_usdt)
2. USDT ‚Üí SHIB ‚Üí ETH ‚Üí USDT (shib_usdt, eth_shib, eth_usdt)
3. USDT ‚Üí MATIC ‚Üí BTC ‚Üí USDT (matic_usdt, btc_matic, btc_usdt)
4. USDT ‚Üí SOL ‚Üí ETH ‚Üí USDT (sol_usdt, eth_sol, eth_usdt)
5. USDT ‚Üí ADA ‚Üí BTC ‚Üí USDT (ada_usdt, btc_ada, btc_usdt)
6. USDT ‚Üí DOT ‚Üí ETH ‚Üí USDT (dot_usdt, eth_dot, eth_usdt)

üîÅ SET 5: Extended Multi-Bridge (6 paths)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí SOL ‚Üí BTC ‚Üí USDT (sol_usdt, btc_sol, btc_usdt)
2. USDT ‚Üí XRP ‚Üí ETH ‚Üí USDT (xrp_usdt, eth_xrp, eth_usdt)
3. USDT ‚Üí AVAX ‚Üí BTC ‚Üí USDT (avax_usdt, btc_avax, btc_usdt)
4. USDT ‚Üí ATOM ‚Üí ETH ‚Üí USDT (atom_usdt, eth_atom, eth_usdt)
5. USDT ‚Üí BTC ‚Üí ETH ‚Üí SOL ‚Üí USDT ‚≠ê 4-LEG (btc_usdt, eth_btc, sol_eth, sol_usdt)
6. USDT ‚Üí ETH ‚Üí BTC ‚Üí ADA ‚Üí USDT ‚≠ê 4-LEG (eth_usdt, btc_eth, ada_btc, ada_usdt)

üí° TOTAL: 32 paths (30 three-leg + 2 four-leg)
üåâ BRIDGE: USDT (1,000+ trading pairs)
üöÄ NATIVE: XT token for fee optimization
üîê AUTH: HMAC-SHA256 signature with custom headers
üìä EXCHANGE: XT.COM (7.8M users globally)
            `.trim();

            alert(pathDetails);
        }

        // 3. Save XT Settings
        function saveXtTriangularSettings() {
            const settings = {
                maxTrade: document.getElementById('xtMaxTrade').value,
                portfolioPercent: document.getElementById('xtPortfolioPercent').value,
                profitThreshold: document.getElementById('xtProfitThreshold').value,
                set1Enabled: document.getElementById('xtSet1Enabled').checked,
                set2Enabled: document.getElementById('xtSet2Enabled').checked,
                set3Enabled: document.getElementById('xtSet3Enabled').checked,
                set4Enabled: document.getElementById('xtSet4Enabled').checked,
                set5Enabled: document.getElementById('xtSet5Enabled').checked
            };

            localStorage.setItem('xt_triangular_settings', JSON.stringify(settings));
            console.log('‚úÖ [XT] Settings saved:', settings);
        }

        // 4. Load XT Settings
        function loadXtTriangularSettings() {
            const saved = localStorage.getItem('xt_triangular_settings');
            if (saved) {
                const settings = JSON.parse(saved);
                document.getElementById('xtMaxTrade').value = settings.maxTrade || 100;
                document.getElementById('xtPortfolioPercent').value = settings.portfolioPercent || 5;
                document.getElementById('xtProfitThreshold').value = settings.profitThreshold || 0.3;
                document.getElementById('xtSet1Enabled').checked = settings.set1Enabled !== false;
                document.getElementById('xtSet2Enabled').checked = settings.set2Enabled !== false;
                document.getElementById('xtSet3Enabled').checked = settings.set3Enabled === true;
                document.getElementById('xtSet4Enabled').checked = settings.set4Enabled === true;
                document.getElementById('xtSet5Enabled').checked = settings.set5Enabled === true;
                console.log('‚úÖ [XT] Settings loaded:', settings);
            }
        }

        // 5. Scan XT Triangular Paths
        async function scanXtTriangularPaths() {
            try {
                const apiKey = localStorage.getItem('xt_triangular_api');
                const apiSecret = localStorage.getItem('xt_triangular_secret');

                if (!apiKey || !apiSecret) {
                    alert('‚ùå XT API credentials not found!\n\nPlease set your API credentials on the SETUP page first.');
                    return;
                }

                const maxTradeAmount = parseFloat(document.getElementById('xtMaxTrade').value);
                const profitThreshold = parseFloat(document.getElementById('xtProfitThreshold').value);

                const enabledSets = {
                    SET_1_ESSENTIAL_ETH_BRIDGE: document.getElementById('xtSet1Enabled').checked,
                    SET_2_MIDCAP_BTC_BRIDGE: document.getElementById('xtSet2Enabled').checked,
                    SET_3_XT_NATIVE_BRIDGE: document.getElementById('xtSet3Enabled').checked,
                    SET_4_HIGH_VOLATILITY: document.getElementById('xtSet4Enabled').checked,
                    SET_5_EXTENDED_MULTIBRIDGE: document.getElementById('xtSet5Enabled').checked
                };

                document.getElementById('xtScanStatus').textContent = 'üîç Scanning XT paths...';
                document.getElementById('xtOpportunities').innerHTML = '<div style="text-align: center; padding: 20px; color: #0096FF;">‚è≥ Analyzing 1,000+ pairs...</div>';

                const response = await fetch('/api/v1/trading/xt/triangular/scan', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    },
                    body: JSON.stringify({ apiKey, apiSecret, maxTradeAmount, profitThreshold, enabledSets })
                });

                const result = await response.json();

                if (result.success && result.opportunities.length > 0) {
                    document.getElementById('xtScanStatus').textContent = `‚úÖ Found ${result.opportunities.length} opportunities`;

                    let oppsHtml = '<div style="display: grid; gap: 15px;">';
                    result.opportunities.forEach(opp => {
                        const profitColor = parseFloat(opp.profitPercent) >= 1 ? '#00ff88' : '#0096FF';
                        const riskColor = opp.risk === 'EXECUTE' ? '#00ff88' : opp.risk === 'CAUTIOUS' ? '#0096FF' : '#FF4444';

                        oppsHtml += `
                            <div style="background: rgba(0,150,255,0.1); padding: 15px; border-radius: 10px; border-left: 4px solid ${profitColor};">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                    <span style="color: white; font-weight: 600; font-size: 15px;">${opp.path.join(' ‚Üí ')}</span>
                                    <span style="color: ${profitColor}; font-weight: 700; font-size: 16px;">+${opp.profitPercent}%</span>
                                </div>
                                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 10px; font-size: 13px;">
                                    <div><span style="color: #888;">Expected:</span> <span style="color: white;">${opp.expectedProfitZAR} USDT</span></div>
                                    <div><span style="color: #888;">Risk:</span> <span style="color: ${riskColor};">${opp.risk}</span></div>
                                    <div><span style="color: #888;">Slippage:</span> <span style="color: white;">${opp.estimatedSlippage}%</span></div>
                                </div>
                                <div style="margin-top: 12px; display: flex; gap: 8px;">
                                    <button onclick='executeXtTriangularTrade(${JSON.stringify(opp)})' style="flex: 1; padding: 8px; background: #0096FF; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 13px;">
                                        ‚ö° EXECUTE
                                    </button>
                                    <button onclick='alert("Path: ${opp.pairs.join(" ‚Üí ")}")' style="flex: 1; padding: 8px; background: rgba(0,150,255,0.2); color: #0096FF; border: 1px solid #0096FF; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 13px;">
                                        üìä Details
                                    </button>
                                </div>
                            </div>
                        `;
                    });
                    oppsHtml += '</div>';

                    document.getElementById('xtOpportunities').innerHTML = oppsHtml;
                } else {
                    document.getElementById('xtScanStatus').textContent = '‚ùå No profitable opportunities found';
                    document.getElementById('xtOpportunities').innerHTML = '<div style="text-align: center; padding: 20px; color: #888;">No opportunities above profit threshold. Try lowering threshold or enabling more path sets.</div>';
                }
            } catch (error) {
                console.error('XT scan error:', error);
                document.getElementById('xtScanStatus').textContent = '‚ùå Scan failed';
                document.getElementById('xtOpportunities').innerHTML = `<div style="color: #FF4444; padding: 20px; text-align: center;">Error: ${error.message}</div>`;
            }
        }

        // 6. Execute XT Triangular Trade
        async function executeXtTriangularTrade(opportunity) {
            try {
                const confirmation = confirm(`üöÄ EXECUTE XT TRIANGULAR TRADE\n\nPath: ${opportunity.path.join(' ‚Üí ')}\nExpected Profit: ${opportunity.profitPercent}% (+${opportunity.expectedProfitZAR} USDT)\nRisk: ${opportunity.risk}\n\n‚ö†Ô∏è This will execute a real trade on XT.\nContinue?`);

                if (!confirmation) {
                    return;
                }

                const apiKey = localStorage.getItem('xt_triangular_api');
                const apiSecret = localStorage.getItem('xt_triangular_secret');
                const userId = localStorage.getItem('userId');

                const response = await fetch('/api/v1/trading/xt/triangular/execute', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    },
                    body: JSON.stringify({
                        apiKey,
                        apiSecret,
                        userId,
                        opportunity,
                        dryRun: false
                    })
                });

                const result = await response.json();

                if (result.success) {
                    alert(`‚úÖ XT Trade Executed!\n\nPath: ${opportunity.path.join(' ‚Üí ')}\nActual Profit: ${result.actualProfitZAR} USDT (${result.actualProfitPercent}%)\nExecution Time: ${result.executionTime}ms\n\nTrade ID: ${result.tradeId}`);
                    loadXtTradeHistory();
                    scanXtTriangularPaths(); // Refresh opportunities
                } else {
                    throw new Error(result.message);
                }
            } catch (error) {
                console.error('XT execution error:', error);
                alert(`‚ùå XT Trade Failed\n\n${error.message}`);
            }
        }

        // 7. Load XT Trade History
        async function loadXtTradeHistory() {
            try {
                const userId = localStorage.getItem('userId');
                if (!userId) return;

                const response = await fetch('/api/v1/trading/xt/triangular/history', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    },
                    body: JSON.stringify({ userId, limit: 10 })
                });

                const result = await response.json();

                if (result.success && result.trades.length > 0) {
                    let historyHtml = '<div style="display: grid; gap: 10px;">';

                    result.trades.forEach(trade => {
                        const statusColor = trade.execution_status === 'completed' ? '#0096FF' : '#FF4444';
                        const profitColor = parseFloat(trade.actual_profit_zar || 0) > 0 ? '#00ff88' : '#FF4444';

                        historyHtml += `
                            <div style="background: rgba(255,255,255,0.03); padding: 12px; border-radius: 8px; border-left: 3px solid ${statusColor};">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                    <span style="color: white; font-weight: 600; font-size: 13px;">${trade.path_sequence}</span>
                                    <span style="color: ${profitColor}; font-weight: 600;">${trade.actual_profit_zar ? '+' + trade.actual_profit_zar : '‚Äî'} USDT</span>
                                </div>
                                <div style="color: #888; font-size: 12px;">${new Date(trade.created_at).toLocaleString()}</div>
                            </div>
                        `;
                    });

                    historyHtml += '</div>';
                    document.getElementById('xtTradeHistory').innerHTML = historyHtml;
                }
            } catch (error) {
                console.error('XT history error:', error);
            }
        }

        // Initialize XT settings on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ [XT] Initializing triangular arbitrage settings...');
            loadXtTriangularSettings();

            const xtInputs = document.querySelectorAll('#xtMaxTrade, #xtPortfolioPercent, #xtProfitThreshold');
            xtInputs.forEach(input => {
                input.addEventListener('change', saveXtTriangularSettings);
            });

            for (let i = 1; i <= 5; i++) {
                const checkbox = document.getElementById(`xtSet${i}Enabled`);
                if (checkbox) {
                    checkbox.addEventListener('change', saveXtTriangularSettings);
                }
            }
        });

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // ASCENDEX TRIANGULAR ARBITRAGE FUNCTIONS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        // 1. Test AscendEX Connection
        async function testAscendexTriangularConnection() {
            try {
                const apiKey = localStorage.getItem('ascendex_triangular_api');
                const apiSecret = localStorage.getItem('ascendex_triangular_secret');

                if (!apiKey || !apiSecret) {
                    alert('‚ùå AscendEX API credentials not found!\n\nPlease set your API credentials on the SETUP page first.');
                    return;
                }

                document.getElementById('ascendexStatusText').textContent = 'Testing connection...';
                document.getElementById('ascendexStatusIndicator').style.background = '#8A2BE2';

                const response = await fetch('/api/v1/trading/ascendex/triangular/test-connection', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    },
                    body: JSON.stringify({ apiKey, apiSecret })
                });

                const result = await response.json();

                if (result.success) {
                    document.getElementById('ascendexStatusIndicator').style.background = '#8A2BE2';
                    document.getElementById('ascendexStatusText').textContent = `Connected | ${result.balances.USDT} USDT`;
                    alert(`‚úÖ AscendEX Connection Successful!\n\nUSDT Balance: ${result.balances.USDT}\nBTC Balance: ${result.balances.BTC}\nüíé ASD Balance: ${result.balances.ASD}\n\nAccount Group: ${result.accountGroup}`);
                } else {
                    throw new Error(result.message);
                }
            } catch (error) {
                console.error('AscendEX connection error:', error);
                document.getElementById('ascendexStatusIndicator').style.background = '#FF4444';
                document.getElementById('ascendexStatusText').textContent = 'Connection Failed';
                alert(`‚ùå AscendEX Connection Failed\n\n${error.message}`);
            }
        }

        // 2. View AscendEX Path Details
        function viewAscendexPathDetails() {
            const pathDetails = `
üìã AscendEX Triangular Arbitrage Paths (32 Total)

‚ú® SET 1: Essential ETH Bridge (7 paths) ‚úÖ ENABLED BY DEFAULT
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí ETH ‚Üí BTC ‚Üí USDT (ETH/USDT, BTC/ETH, BTC/USDT)
2. USDT ‚Üí ETH ‚Üí SOL ‚Üí USDT (ETH/USDT, SOL/ETH, SOL/USDT)
3. USDT ‚Üí ETH ‚Üí XRP ‚Üí USDT (ETH/USDT, XRP/ETH, XRP/USDT)
4. USDT ‚Üí ETH ‚Üí ADA ‚Üí USDT (ETH/USDT, ADA/ETH, ADA/USDT)
5. USDT ‚Üí ETH ‚Üí MATIC ‚Üí USDT (ETH/USDT, MATIC/ETH, MATIC/USDT)
6. USDT ‚Üí ETH ‚Üí DOT ‚Üí USDT (ETH/USDT, DOT/ETH, DOT/USDT)
7. USDT ‚Üí ETH ‚Üí AVAX ‚Üí USDT (ETH/USDT, AVAX/ETH, AVAX/USDT)

üî∑ SET 2: Mid-Cap BTC Bridge (7 paths) ‚úÖ ENABLED BY DEFAULT
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí BTC ‚Üí ETH ‚Üí USDT (BTC/USDT, ETH/BTC, ETH/USDT)
2. USDT ‚Üí BTC ‚Üí SOL ‚Üí USDT (BTC/USDT, SOL/BTC, SOL/USDT)
3. USDT ‚Üí BTC ‚Üí ADA ‚Üí USDT (BTC/USDT, ADA/BTC, ADA/USDT)
4. USDT ‚Üí BTC ‚Üí DOT ‚Üí USDT (BTC/USDT, DOT/BTC, DOT/USDT)
5. USDT ‚Üí BTC ‚Üí ATOM ‚Üí USDT (BTC/USDT, ATOM/BTC, ATOM/USDT)
6. USDT ‚Üí BTC ‚Üí LTC ‚Üí USDT (BTC/USDT, LTC/BTC, LTC/USDT)
7. USDT ‚Üí BTC ‚Üí XRP ‚Üí USDT (BTC/USDT, XRP/BTC, XRP/USDT)

üíé SET 3: ASD Native Bridge (6 paths) - AscendEX Token (Fee Discounts!)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí ASD ‚Üí BTC ‚Üí USDT (ASD/USDT, BTC/ASD, BTC/USDT)
2. USDT ‚Üí ASD ‚Üí ETH ‚Üí USDT (ASD/USDT, ETH/ASD, ETH/USDT)
3. USDT ‚Üí ASD ‚Üí SOL ‚Üí USDT (ASD/USDT, SOL/ASD, SOL/USDT)
4. USDT ‚Üí BTC ‚Üí ASD ‚Üí USDT (BTC/USDT, ASD/BTC, ASD/USDT)
5. USDT ‚Üí ETH ‚Üí ASD ‚Üí USDT (ETH/USDT, ASD/ETH, ASD/USDT)
6. USDT ‚Üí ASD ‚Üí MATIC ‚Üí USDT (ASD/USDT, MATIC/ASD, MATIC/USDT)

‚ö° SET 4: High Volatility (6 paths)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí DOGE ‚Üí BTC ‚Üí USDT (DOGE/USDT, BTC/DOGE, BTC/USDT)
2. USDT ‚Üí SHIB ‚Üí ETH ‚Üí USDT (SHIB/USDT, ETH/SHIB, ETH/USDT)
3. USDT ‚Üí MATIC ‚Üí BTC ‚Üí USDT (MATIC/USDT, BTC/MATIC, BTC/USDT)
4. USDT ‚Üí SOL ‚Üí ETH ‚Üí USDT (SOL/USDT, ETH/SOL, ETH/USDT)
5. USDT ‚Üí ADA ‚Üí BTC ‚Üí USDT (ADA/USDT, BTC/ADA, BTC/USDT)
6. USDT ‚Üí DOT ‚Üí ETH ‚Üí USDT (DOT/USDT, ETH/DOT, ETH/USDT)

üîÅ SET 5: Extended Multi-Bridge (6 paths)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí SOL ‚Üí BTC ‚Üí USDT (SOL/USDT, BTC/SOL, BTC/USDT)
2. USDT ‚Üí XRP ‚Üí ETH ‚Üí USDT (XRP/USDT, ETH/XRP, ETH/USDT)
3. USDT ‚Üí AVAX ‚Üí BTC ‚Üí USDT (AVAX/USDT, BTC/AVAX, BTC/USDT)
4. USDT ‚Üí ATOM ‚Üí ETH ‚Üí USDT (ATOM/USDT, ETH/ATOM, ETH/USDT)
5. USDT ‚Üí BTC ‚Üí ETH ‚Üí SOL ‚Üí USDT ‚≠ê 4-LEG (BTC/USDT, ETH/BTC, SOL/ETH, SOL/USDT)
6. USDT ‚Üí ETH ‚Üí BTC ‚Üí ADA ‚Üí USDT ‚≠ê 4-LEG (ETH/USDT, BTC/ETH, ADA/BTC, ADA/USDT)

üí° TOTAL: 32 paths (30 three-leg + 2 four-leg)
üåâ BRIDGE: USDT (450+ trading pairs)
üíé NATIVE: ASD token for fee discounts
üîê AUTH: HMAC-SHA256 with account-group routing
üìä EXCHANGE: AscendEX (formerly BitMax)
            `.trim();

            alert(pathDetails);
        }

        // 3. Save AscendEX Settings
        function saveAscendexTriangularSettings() {
            const settings = {
                maxTrade: document.getElementById('ascendexMaxTrade').value,
                portfolioPercent: document.getElementById('ascendexPortfolioPercent').value,
                profitThreshold: document.getElementById('ascendexProfitThreshold').value,
                set1Enabled: document.getElementById('ascendexSet1Enabled').checked,
                set2Enabled: document.getElementById('ascendexSet2Enabled').checked,
                set3Enabled: document.getElementById('ascendexSet3Enabled').checked,
                set4Enabled: document.getElementById('ascendexSet4Enabled').checked,
                set5Enabled: document.getElementById('ascendexSet5Enabled').checked
            };

            localStorage.setItem('ascendex_triangular_settings', JSON.stringify(settings));
            console.log('‚úÖ [ASCENDEX] Settings saved:', settings);
        }

        // 4. Load AscendEX Settings
        function loadAscendexTriangularSettings() {
            const saved = localStorage.getItem('ascendex_triangular_settings');
            if (saved) {
                const settings = JSON.parse(saved);
                document.getElementById('ascendexMaxTrade').value = settings.maxTrade || 100;
                document.getElementById('ascendexPortfolioPercent').value = settings.portfolioPercent || 5;
                document.getElementById('ascendexProfitThreshold').value = settings.profitThreshold || 0.3;
                document.getElementById('ascendexSet1Enabled').checked = settings.set1Enabled !== false;
                document.getElementById('ascendexSet2Enabled').checked = settings.set2Enabled !== false;
                document.getElementById('ascendexSet3Enabled').checked = settings.set3Enabled === true;
                document.getElementById('ascendexSet4Enabled').checked = settings.set4Enabled === true;
                document.getElementById('ascendexSet5Enabled').checked = settings.set5Enabled === true;
                console.log('‚úÖ [ASCENDEX] Settings loaded:', settings);
            }
        }

        // 5. Scan AscendEX Triangular Paths
        async function scanAscendexTriangularPaths() {
            try {
                const apiKey = localStorage.getItem('ascendex_triangular_api');
                const apiSecret = localStorage.getItem('ascendex_triangular_secret');

                if (!apiKey || !apiSecret) {
                    alert('‚ùå AscendEX API credentials not found!\n\nPlease set your API credentials on the SETUP page first.');
                    return;
                }

                const maxTradeAmount = parseFloat(document.getElementById('ascendexMaxTrade').value);
                const profitThreshold = parseFloat(document.getElementById('ascendexProfitThreshold').value);

                const enabledSets = {
                    SET_1_ESSENTIAL_ETH_BRIDGE: document.getElementById('ascendexSet1Enabled').checked,
                    SET_2_MIDCAP_BTC_BRIDGE: document.getElementById('ascendexSet2Enabled').checked,
                    SET_3_ASD_NATIVE_BRIDGE: document.getElementById('ascendexSet3Enabled').checked,
                    SET_4_HIGH_VOLATILITY: document.getElementById('ascendexSet4Enabled').checked,
                    SET_5_EXTENDED_MULTIBRIDGE: document.getElementById('ascendexSet5Enabled').checked
                };

                document.getElementById('ascendexScanStatus').textContent = 'üîç Scanning AscendEX paths...';
                document.getElementById('ascendexOpportunities').innerHTML = '<div style="text-align: center; padding: 20px; color: #8A2BE2;">‚è≥ Analyzing 450+ pairs...</div>';

                const response = await fetch('/api/v1/trading/ascendex/triangular/scan', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    },
                    body: JSON.stringify({ apiKey, apiSecret, maxTradeAmount, profitThreshold, enabledSets })
                });

                const result = await response.json();

                if (result.success && result.opportunities.length > 0) {
                    document.getElementById('ascendexScanStatus').textContent = `‚úÖ Found ${result.opportunities.length} opportunities`;

                    let oppsHtml = '<div style="display: grid; gap: 15px;">';
                    result.opportunities.forEach(opp => {
                        const profitColor = parseFloat(opp.profitPercent) >= 1 ? '#00ff88' : '#8A2BE2';
                        const riskColor = opp.risk === 'EXECUTE' ? '#00ff88' : opp.risk === 'CAUTIOUS' ? '#8A2BE2' : '#FF4444';

                        oppsHtml += `
                            <div style="background: rgba(138,43,226,0.1); padding: 15px; border-radius: 10px; border-left: 4px solid ${profitColor};">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                    <span style="color: white; font-weight: 600; font-size: 15px;">${opp.path.join(' ‚Üí ')}</span>
                                    <span style="color: ${profitColor}; font-weight: 700; font-size: 16px;">+${opp.profitPercent}%</span>
                                </div>
                                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 10px; font-size: 13px;">
                                    <div><span style="color: #888;">Expected:</span> <span style="color: white;">${opp.expectedProfitZAR} USDT</span></div>
                                    <div><span style="color: #888;">Risk:</span> <span style="color: ${riskColor};">${opp.risk}</span></div>
                                    <div><span style="color: #888;">Slippage:</span> <span style="color: white;">${opp.estimatedSlippage}%</span></div>
                                </div>
                                <div style="margin-top: 12px; display: flex; gap: 8px;">
                                    <button onclick='executeAscendexTriangularTrade(${JSON.stringify(opp)})' style="flex: 1; padding: 8px; background: #8A2BE2; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 13px;">
                                        ‚ö° EXECUTE
                                    </button>
                                    <button onclick='alert("Path: ${opp.pairs.join(" ‚Üí ")}")' style="flex: 1; padding: 8px; background: rgba(138,43,226,0.2); color: #8A2BE2; border: 1px solid #8A2BE2; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 13px;">
                                        üìä Details
                                    </button>
                                </div>
                            </div>
                        `;
                    });
                    oppsHtml += '</div>';

                    document.getElementById('ascendexOpportunities').innerHTML = oppsHtml;
                } else {
                    document.getElementById('ascendexScanStatus').textContent = '‚ùå No profitable opportunities found';
                    document.getElementById('ascendexOpportunities').innerHTML = '<div style="text-align: center; padding: 20px; color: #888;">No opportunities above profit threshold. Try lowering threshold or enabling more path sets.</div>';
                }
            } catch (error) {
                console.error('AscendEX scan error:', error);
                document.getElementById('ascendexScanStatus').textContent = '‚ùå Scan failed';
                document.getElementById('ascendexOpportunities').innerHTML = `<div style="color: #FF4444; padding: 20px; text-align: center;">Error: ${error.message}</div>`;
            }
        }

        // 6. Execute AscendEX Triangular Trade
        async function executeAscendexTriangularTrade(opportunity) {
            try {
                const confirmation = confirm(`üíé EXECUTE ASCENDEX TRIANGULAR TRADE\n\nPath: ${opportunity.path.join(' ‚Üí ')}\nExpected Profit: ${opportunity.profitPercent}% (+${opportunity.expectedProfitZAR} USDT)\nRisk: ${opportunity.risk}\n\n‚ö†Ô∏è This will execute a real trade on AscendEX.\nContinue?`);

                if (!confirmation) {
                    return;
                }

                const apiKey = localStorage.getItem('ascendex_triangular_api');
                const apiSecret = localStorage.getItem('ascendex_triangular_secret');
                const userId = localStorage.getItem('userId');

                const response = await fetch('/api/v1/trading/ascendex/triangular/execute', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    },
                    body: JSON.stringify({
                        apiKey,
                        apiSecret,
                        userId,
                        opportunity,
                        dryRun: false
                    })
                });

                const result = await response.json();

                if (result.success) {
                    alert(`‚úÖ AscendEX Trade Executed!\n\nPath: ${opportunity.path.join(' ‚Üí ')}\nActual Profit: ${result.actualProfitZAR} USDT (${result.actualProfitPercent}%)\nExecution Time: ${result.executionTime}ms\n\nTrade ID: ${result.tradeId}`);
                    loadAscendexTradeHistory();
                    scanAscendexTriangularPaths(); // Refresh opportunities
                } else {
                    throw new Error(result.message);
                }
            } catch (error) {
                console.error('AscendEX execution error:', error);
                alert(`‚ùå AscendEX Trade Failed\n\n${error.message}`);
            }
        }

        // 7. Load AscendEX Trade History
        async function loadAscendexTradeHistory() {
            try {
                const userId = localStorage.getItem('userId');
                if (!userId) return;

                const response = await fetch('/api/v1/trading/ascendex/triangular/history', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    },
                    body: JSON.stringify({ userId, limit: 10 })
                });

                const result = await response.json();

                if (result.success && result.trades.length > 0) {
                    let historyHtml = '<div style="display: grid; gap: 10px;">';

                    result.trades.forEach(trade => {
                        const statusColor = trade.execution_status === 'completed' ? '#8A2BE2' : '#FF4444';
                        const profitColor = parseFloat(trade.actual_profit_zar || 0) > 0 ? '#00ff88' : '#FF4444';

                        historyHtml += `
                            <div style="background: rgba(255,255,255,0.03); padding: 12px; border-radius: 8px; border-left: 3px solid ${statusColor};">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                    <span style="color: white; font-weight: 600; font-size: 13px;">${trade.path_sequence}</span>
                                    <span style="color: ${profitColor}; font-weight: 600;">${trade.actual_profit_zar ? '+' + trade.actual_profit_zar : '‚Äî'} USDT</span>
                                </div>
                                <div style="color: #888; font-size: 12px;">${new Date(trade.created_at).toLocaleString()}</div>
                            </div>
                        `;
                    });

                    historyHtml += '</div>';
                    document.getElementById('ascendexTradeHistory').innerHTML = historyHtml;
                }
            } catch (error) {
                console.error('AscendEX history error:', error);
            }
        }

        // Initialize AscendEX settings on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üíé [ASCENDEX] Initializing triangular arbitrage settings...');
            loadAscendexTriangularSettings();

            const ascendexInputs = document.querySelectorAll('#ascendexMaxTrade, #ascendexPortfolioPercent, #ascendexProfitThreshold');
            ascendexInputs.forEach(input => {
                input.addEventListener('change', saveAscendexTriangularSettings);
            });

            for (let i = 1; i <= 5; i++) {
                const checkbox = document.getElementById(`ascendexSet${i}Enabled`);
                if (checkbox) {
                    checkbox.addEventListener('change', saveAscendexTriangularSettings);
                }
            }
        });

        // ============================================================================
        // BINGX TRIANGULAR ARBITRAGE FUNCTIONS
        // ============================================================================

        // Test BingX Connection
        async function testBingXTriangularConnection() {
            const apiKey = localStorage.getItem('bingx_api') || '';
            const apiSecret = localStorage.getItem('bingx_secret') || '';
            const statusIndicator = document.getElementById('bingxStatusIndicator');
            const statusText = document.getElementById('bingxStatusText');

            if (!apiKey || !apiSecret) {
                statusIndicator.style.background = '#FF4444';
                statusText.textContent = 'No API credentials configured';
                statusText.style.color = '#FF4444';
                return;
            }

            statusIndicator.style.background = '#FFD700';
            statusText.textContent = 'Testing connection...';
            statusText.style.color = '#FFD700';

            try {
                const response = await fetch('/api/v1/trading/bingx/triangular/test-connection', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ apiKey, apiSecret })
                });

                const result = await response.json();

                if (result.success) {
                    statusIndicator.style.background = '#00ff88';
                    statusText.textContent = `Connected | ${result.data.balances.length} assets`;
                    statusText.style.color = '#00ff88';
                    saveBingXTriangularSettings();
                } else {
                    statusIndicator.style.background = '#FF4444';
                    statusText.textContent = 'Connection failed';
                    statusText.style.color = '#FF4444';
                }
            } catch (error) {
                statusIndicator.style.background = '#FF4444';
                statusText.textContent = 'Connection error';
                statusText.style.color = '#FF4444';
            }
        }

        // View BingX Path Details
        function viewBingXPathDetails() {
            const pathDetails = `
üìã BINGX Triangular Arbitrage Paths (32 Total)

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
SET 1: Essential ETH Bridge (7 paths) ‚úÖ DEFAULT
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí ETH ‚Üí BTC ‚Üí USDT
2. USDT ‚Üí ETH ‚Üí SOL ‚Üí USDT
3. USDT ‚Üí ETH ‚Üí XRP ‚Üí USDT
4. USDT ‚Üí ETH ‚Üí ADA ‚Üí USDT
5. USDT ‚Üí ETH ‚Üí DOT ‚Üí USDT
6. USDT ‚Üí ETH ‚Üí MATIC ‚Üí USDT
7. USDT ‚Üí ETH ‚Üí LINK ‚Üí USDT

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
SET 2: Mid-Cap BTC Bridge (7 paths) ‚úÖ DEFAULT
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí BTC ‚Üí ETH ‚Üí USDT
2. USDT ‚Üí BTC ‚Üí SOL ‚Üí USDT
3. USDT ‚Üí BTC ‚Üí AVAX ‚Üí USDT
4. USDT ‚Üí BTC ‚Üí ATOM ‚Üí USDT
5. USDT ‚Üí BTC ‚Üí LTC ‚Üí USDT
6. USDT ‚Üí BTC ‚Üí UNI ‚Üí USDT
7. USDT ‚Üí BTC ‚Üí FIL ‚Üí USDT

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
SET 3: SOL High-Liquidity (6 paths)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí SOL ‚Üí BTC ‚Üí USDT
2. USDT ‚Üí SOL ‚Üí ETH ‚Üí USDT
3. USDT ‚Üí SOL ‚Üí XRP ‚Üí USDT
4. USDT ‚Üí SOL ‚Üí ADA ‚Üí USDT
5. USDT ‚Üí SOL ‚Üí DOT ‚Üí USDT
6. USDT ‚Üí SOL ‚Üí AVAX ‚Üí USDT

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
SET 4: High Volatility (6 paths)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí DOGE ‚Üí BTC ‚Üí USDT
2. USDT ‚Üí SHIB ‚Üí ETH ‚Üí USDT
3. USDT ‚Üí PEPE ‚Üí ETH ‚Üí USDT
4. USDT ‚Üí NEAR ‚Üí BTC ‚Üí USDT
5. USDT ‚Üí APT ‚Üí ETH ‚Üí USDT
6. USDT ‚Üí FTM ‚Üí BTC ‚Üí USDT

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
SET 5: Extended Multi-Bridge (6 paths)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí TRX ‚Üí BTC ‚Üí USDT
2. USDT ‚Üí ALGO ‚Üí ETH ‚Üí USDT
3. USDT ‚Üí VET ‚Üí BTC ‚Üí USDT
4. USDT ‚Üí HBAR ‚Üí ETH ‚Üí USDT
5. USDT ‚Üí SAND ‚Üí ETH ‚Üí USDT
6. USDT ‚Üí BTC ‚Üí ETH ‚Üí SOL ‚Üí USDT (4-leg)

üí° TOTAL: 32 paths (31 three-leg + 1 four-leg)
üåâ BRIDGE: USDT (Tether)
üåç GLOBAL: Derivatives and spot exchange
üîê AUTH: API Key + Secret
            `.trim();

            alert(pathDetails);
            console.log('üìã [BINGX] Path details displayed:', pathDetails);
        }

        // Save BingX Settings
        function saveBingXTriangularSettings() {
            const settings = {
                maxTrade: document.getElementById('bingxMaxTrade').value,
                portfolioPercent: document.getElementById('bingxPortfolioPercent').value,
                profitThreshold: document.getElementById('bingxProfitThreshold').value,
                set1Enabled: document.getElementById('bingxSet1Enabled').checked,
                set2Enabled: document.getElementById('bingxSet2Enabled').checked,
                set3Enabled: document.getElementById('bingxSet3Enabled').checked,
                set4Enabled: document.getElementById('bingxSet4Enabled').checked,
                set5Enabled: document.getElementById('bingxSet5Enabled').checked
            };

            localStorage.setItem('bingx_triangular_settings', JSON.stringify(settings));
            console.log('üåä [BINGX] Settings saved:', settings);
        }

        // Load BingX Settings
        function loadBingXTriangularSettings() {
            const savedSettings = localStorage.getItem('bingx_triangular_settings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                document.getElementById('bingxMaxTrade').value = settings.maxTrade || 100;
                document.getElementById('bingxPortfolioPercent').value = settings.portfolioPercent || 5;
                document.getElementById('bingxProfitThreshold').value = settings.profitThreshold || 0.3;
                document.getElementById('bingxSet1Enabled').checked = settings.set1Enabled !== false;
                document.getElementById('bingxSet2Enabled').checked = settings.set2Enabled !== false;
                document.getElementById('bingxSet3Enabled').checked = settings.set3Enabled || false;
                document.getElementById('bingxSet4Enabled').checked = settings.set4Enabled || false;
                document.getElementById('bingxSet5Enabled').checked = settings.set5Enabled || false;
            }
        }

        // Scan BingX Triangular Opportunities
        async function scanBingXTriangularPaths() {
            const apiKey = localStorage.getItem('bingx_api') || '';
            const apiSecret = localStorage.getItem('bingx_secret') || '';
            const minProfitPercent = parseFloat(document.getElementById('bingxProfitThreshold').value);
            const scanStatus = document.getElementById('bingxScanStatus');
            const opportunitiesDiv = document.getElementById('bingxOpportunities');

            if (!apiKey || !apiSecret) {
                opportunitiesDiv.innerHTML = '<div style="color: #FF4444;">‚ö†Ô∏è No API credentials configured. Please connect BingX on the Exchange Connections page.</div>';
                return;
            }

            scanStatus.innerHTML = '<span style="color: #FFD700;">üîç Scanning 32 paths...</span>';
            opportunitiesDiv.innerHTML = '<div style="color: #888;">Scanning in progress...</div>';

            try {
                const response = await fetch('/api/v1/trading/bingx/triangular/scan', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ apiKey, apiSecret, minProfitPercent })
                });

                const result = await response.json();

                if (result.success) {
                    scanStatus.innerHTML = `<span style="color: #00ff88;">‚úÖ Scan complete | ${result.opportunities.length} opportunities</span>`;

                    if (result.opportunities.length > 0) {
                        let oppHtml = '<div style="display: grid; gap: 10px; max-height: 500px; overflow-y: auto;">';

                        result.opportunities.forEach(opp => {
                            oppHtml += `
                                <div style="background: rgba(0,191,255,0.1); padding: 15px; border-radius: 8px; border-left: 3px solid #00BFFF;">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                        <span style="color: white; font-weight: 600;">${opp.description}</span>
                                        <span style="color: #00ff88; font-weight: 600;">+${opp.profitPercent}%</span>
                                    </div>
                                    <div style="color: #aaa; font-size: 13px; margin-bottom: 5px;">${opp.path.join(' ‚Üí ')}</div>
                                    <div style="color: #00BFFF; font-size: 12px;">Est. Profit: $${opp.estimatedProfit} USDT</div>
                                    <button onclick='executeBingXTriangularTrade(${JSON.stringify(opp)})' style="margin-top: 10px; padding: 8px 16px; background: #00BFFF; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px;">Execute Trade</button>
                                </div>
                            `;
                        });

                        oppHtml += '</div>';
                        opportunitiesDiv.innerHTML = oppHtml;
                    } else {
                        opportunitiesDiv.innerHTML = '<div style="color: #FFD700;">üìä No profitable opportunities found at current profit threshold (>=' + minProfitPercent + '%)</div>';
                    }
                } else {
                    scanStatus.innerHTML = '<span style="color: #FF4444;">‚ùå Scan failed</span>';
                    opportunitiesDiv.innerHTML = `<div style="color: #FF4444;">${result.message}</div>`;
                }
            } catch (error) {
                scanStatus.innerHTML = '<span style="color: #FF4444;">‚ùå Scan error</span>';
                opportunitiesDiv.innerHTML = `<div style="color: #FF4444;">Error: ${error.message}</div>`;
            }
        }

        // Execute BingX Triangular Trade
        async function executeBingXTriangularTrade(opportunity) {
            const apiKey = localStorage.getItem('bingx_api') || '';
            const apiSecret = localStorage.getItem('bingx_secret') || '';
            const maxTrade = parseFloat(document.getElementById('bingxMaxTrade').value);
            const scanStatus = document.getElementById('bingxScanStatus');

            if (!confirm(`Execute BingX triangular trade?\nPath: ${opportunity.path.join(' ‚Üí ')}\nEstimated Profit: +${opportunity.profitPercent}%\nAmount: $${maxTrade} USDT`)) {
                return;
            }

            scanStatus.innerHTML = '<span style="color: #00BFFF;">‚ö° Executing trade...</span>';

            try {
                const response = await fetch('/api/v1/trading/bingx/triangular/execute', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ apiKey, apiSecret, opportunity, investmentAmount: maxTrade })
                });

                const result = await response.json();

                if (result.success) {
                    scanStatus.innerHTML = `<span style="color: #00ff88;">‚úÖ Trade executed | Profit: +$${result.execution.profit.toFixed(2)} USDT</span>`;
                    loadBingXTradeHistory();
                    // Re-scan after trade
                    setTimeout(() => scanBingXTriangularPaths(), 2000);
                } else {
                    scanStatus.innerHTML = `<span style="color: #FF4444;">‚ùå Execution failed</span>`;
                }
            } catch (error) {
                scanStatus.innerHTML = `<span style="color: #FF4444;">‚ùå Error: ${error.message}</span>`;
            }
        }

        // Load BingX Trade History
        async function loadBingXTradeHistory() {
            try {
                const userId = localStorage.getItem('userId');
                if (!userId) return;

                const response = await fetch('/api/v1/trading/bingx/triangular/history', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    },
                    body: JSON.stringify({ userId, limit: 10 })
                });

                const result = await response.json();

                if (result.success && result.trades.length > 0) {
                    let historyHtml = '<div style="display: grid; gap: 10px;">';

                    result.trades.forEach(trade => {
                        const statusColor = trade.execution_status === 'completed' ? '#00BFFF' : '#FF4444';
                        const profitColor = parseFloat(trade.actual_profit_zar || 0) > 0 ? '#00ff88' : '#FF4444';

                        historyHtml += `
                            <div style="background: rgba(255,255,255,0.03); padding: 12px; border-radius: 8px; border-left: 3px solid ${statusColor};">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                    <span style="color: white; font-weight: 600; font-size: 13px;">${trade.path_sequence}</span>
                                    <span style="color: ${profitColor}; font-weight: 600;">${trade.actual_profit_zar ? '+' + trade.actual_profit_zar : '‚Äî'} USDT</span>
                                </div>
                                <div style="color: #888; font-size: 12px;">${new Date(trade.created_at).toLocaleString()}</div>
                            </div>
                        `;
                    });

                    historyHtml += '</div>';
                    document.getElementById('bingxTradeHistory').innerHTML = historyHtml;
                }
            } catch (error) {
                console.error('BingX history error:', error);
            }
        }

        // Initialize BingX settings on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üåä [BINGX] Initializing triangular arbitrage settings...');
            loadBingXTriangularSettings();

            const bingxInputs = document.querySelectorAll('#bingxMaxTrade, #bingxPortfolioPercent, #bingxProfitThreshold');
            bingxInputs.forEach(input => {
                input.addEventListener('change', saveBingXTriangularSettings);
            });

            for (let i = 1; i <= 5; i++) {
                const checkbox = document.getElementById(`bingxSet${i}Enabled`);
                if (checkbox) {
                    checkbox.addEventListener('change', saveBingXTriangularSettings);
                }
            }
        });

        // ============================================================================
        // BITGET TRIANGULAR ARBITRAGE FUNCTIONS
        // ============================================================================

        // Test Bitget Connection
        async function testBitgetTriangularConnection() {
            const apiKey = localStorage.getItem('bitget_api') || '';
            const apiSecret = localStorage.getItem('bitget_secret') || '';
            const passphrase = localStorage.getItem('bitget_passphrase') || '';
            const statusIndicator = document.getElementById('bitgetStatusIndicator');
            const statusText = document.getElementById('bitgetStatusText');

            if (!apiKey || !apiSecret || !passphrase) {
                statusIndicator.style.background = '#FF4444';
                statusText.textContent = 'No API credentials configured';
                statusText.style.color = '#FF4444';
                alert('‚ö†Ô∏è Please configure your Bitget API credentials (including passphrase) on the Exchange Connections page first.');
                return;
            }

            statusIndicator.style.background = '#FFA500';
            statusText.textContent = 'Testing connection...';
            statusText.style.color = '#FFA500';

            try {
                const response = await fetch('/api/v1/trading/bitget/triangular/test-connection', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ apiKey, apiSecret, passphrase })
                });

                const data = await response.json();

                if (data.success) {
                    statusIndicator.style.background = '#00FF00';
                    statusText.textContent = `‚úÖ Connected - ${data.data?.balances?.length || 0} assets`;
                    statusText.style.color = '#00FF00';
                } else {
                    statusIndicator.style.background = '#FF4444';
                    statusText.textContent = '‚ùå Connection Failed';
                    statusText.style.color = '#FF4444';
                    alert(`Connection failed: ${data.message}`);
                }
            } catch (error) {
                statusIndicator.style.background = '#FF4444';
                statusText.textContent = '‚ùå Connection Error';
                statusText.style.color = '#FF4444';
                alert(`Error: ${error.message}`);
            }
        }

        // View Bitget Path Details
        function viewBitgetPathDetails() {
            const pathDetails = `
üìã BITGET Triangular Arbitrage Paths (32 Total)

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
SET 1: Essential ETH Bridge (7 paths) ‚úÖ DEFAULT
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí ETH ‚Üí BTC ‚Üí USDT
2. USDT ‚Üí ETH ‚Üí SOL ‚Üí USDT
3. USDT ‚Üí ETH ‚Üí XRP ‚Üí USDT
4. USDT ‚Üí ETH ‚Üí ADA ‚Üí USDT
5. USDT ‚Üí ETH ‚Üí DOT ‚Üí USDT
6. USDT ‚Üí ETH ‚Üí MATIC ‚Üí USDT
7. USDT ‚Üí ETH ‚Üí LINK ‚Üí USDT

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
SET 2: Mid-Cap BTC Bridge (7 paths) ‚úÖ DEFAULT
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí BTC ‚Üí ETH ‚Üí USDT
2. USDT ‚Üí BTC ‚Üí SOL ‚Üí USDT
3. USDT ‚Üí BTC ‚Üí AVAX ‚Üí USDT
4. USDT ‚Üí BTC ‚Üí ATOM ‚Üí USDT
5. USDT ‚Üí BTC ‚Üí LTC ‚Üí USDT
6. USDT ‚Üí BTC ‚Üí UNI ‚Üí USDT
7. USDT ‚Üí BTC ‚Üí FIL ‚Üí USDT

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
SET 3: SOL High-Liquidity (6 paths)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí SOL ‚Üí BTC ‚Üí USDT
2. USDT ‚Üí SOL ‚Üí ETH ‚Üí USDT
3. USDT ‚Üí SOL ‚Üí XRP ‚Üí USDT
4. USDT ‚Üí SOL ‚Üí ADA ‚Üí USDT
5. USDT ‚Üí SOL ‚Üí DOT ‚Üí USDT
6. USDT ‚Üí SOL ‚Üí AVAX ‚Üí USDT

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
SET 4: High Volatility (6 paths)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí DOGE ‚Üí BTC ‚Üí USDT
2. USDT ‚Üí SHIB ‚Üí ETH ‚Üí USDT
3. USDT ‚Üí PEPE ‚Üí ETH ‚Üí USDT
4. USDT ‚Üí NEAR ‚Üí BTC ‚Üí USDT
5. USDT ‚Üí APT ‚Üí ETH ‚Üí USDT
6. USDT ‚Üí FTM ‚Üí BTC ‚Üí USDT

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
SET 5: Extended Multi-Bridge (6 paths)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí TRX ‚Üí BTC ‚Üí USDT
2. USDT ‚Üí ALGO ‚Üí ETH ‚Üí USDT
3. USDT ‚Üí VET ‚Üí BTC ‚Üí USDT
4. USDT ‚Üí HBAR ‚Üí ETH ‚Üí USDT
5. USDT ‚Üí BGB ‚Üí BTC ‚Üí USDT (Native token)
6. USDT ‚Üí BTC ‚Üí ETH ‚Üí SOL ‚Üí USDT (4-leg)

üí° TOTAL: 32 paths (31 three-leg + 1 four-leg)
üåâ BRIDGE: USDT (Tether)
üåç GLOBAL: Multi-asset derivatives platform
üîê AUTH: API Key + Secret + Passphrase
            `.trim();

            alert(pathDetails);
            console.log('üìã [BITGET] Path details displayed:', pathDetails);
        }

        // Scan Bitget Triangular Paths
        async function scanBitgetTriangularPaths() {
            const apiKey = localStorage.getItem('bitget_api') || '';
            const apiSecret = localStorage.getItem('bitget_secret') || '';
            const passphrase = localStorage.getItem('bitget_passphrase') || '';
            const minProfitPercent = parseFloat(document.getElementById('bitgetProfitThreshold').value);
            const scanStatus = document.getElementById('bitgetScanStatus');
            const opportunitiesDiv = document.getElementById('bitgetOpportunities');

            if (!apiKey || !apiSecret || !passphrase) {
                alert('‚ö†Ô∏è Please configure your Bitget API credentials (including passphrase) on the Exchange Connections page first.');
                return;
            }

            scanStatus.textContent = 'üîÑ Scanning 32 triangular paths...';
            scanStatus.style.color = '#FFA500';
            opportunitiesDiv.innerHTML = '<div style="text-align: center; color: #888; padding: 20px;">Scanning for opportunities...</div>';

            try {
                const enabledSets = [];
                for (let i = 1; i <= 5; i++) {
                    const checkbox = document.getElementById(`bitgetSet${i}Enabled`);
                    if (checkbox && checkbox.checked) {
                        enabledSets.push(`SET_${i}`);
                    }
                }

                const response = await fetch('/api/v1/trading/bitget/triangular/scan', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ apiKey, apiSecret, passphrase, minProfitPercent, enabledSets })
                });

                const data = await response.json();

                if (data.success) {
                    scanStatus.textContent = `‚úÖ Found ${data.opportunities.length} opportunities (scanned ${data.scannedPaths} paths)`;
                    scanStatus.style.color = '#00FF00';

                    if (data.opportunities.length > 0) {
                        let opportunitiesHtml = '<div style="display: grid; gap: 15px;">';

                        data.opportunities.forEach((opp, index) => {
                            const profitColor = parseFloat(opp.profitPercent) >= 0.5 ? '#00FF00' : '#FFA500';

                            opportunitiesHtml += `
                                <div style="padding: 15px; background: rgba(138,43,226,0.1); border-radius: 10px; border: 2px solid #8A2BE2;">
                                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                                        <div>
                                            <div style="color: #8A2BE2; font-weight: 600; margin-bottom: 5px;">${opp.id}</div>
                                            <div style="color: #ddd; margin-bottom: 5px;">${opp.description}</div>
                                            <div style="color: #888; font-size: 14px;">Path: ${opp.path.join(' ‚Üí ')}</div>
                                        </div>
                                        <div style="text-align: right;">
                                            <div style="color: ${profitColor}; font-size: 24px; font-weight: 700;">${opp.profitPercent}%</div>
                                            <div style="color: #888; font-size: 14px;">~$${opp.estimatedProfit} profit</div>
                                        </div>
                                    </div>
                                    <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #444;">
                                        <div style="color: #888; font-size: 12px; margin-bottom: 5px;">Pairs: ${opp.pairs.join(', ')}</div>
                                        <button onclick="executeBitgetTriangularTrade('${opp.id}')" style="width: 100%; padding: 8px; background: #8A2BE2; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; margin-top: 10px;">
                                            üíú Execute Trade
                                        </button>
                                    </div>
                                </div>
                            `;
                        });

                        opportunitiesHtml += '</div>';
                        opportunitiesDiv.innerHTML = opportunitiesHtml;
                    } else {
                        opportunitiesDiv.innerHTML = '<div style="text-align: center; color: #888; padding: 20px;">No profitable opportunities found. Try lowering the profit threshold.</div>';
                    }
                } else {
                    scanStatus.textContent = '‚ùå Scan failed';
                    scanStatus.style.color = '#FF4444';
                    opportunitiesDiv.innerHTML = `<div style="text-align: center; color: #FF4444; padding: 20px;">${data.message}</div>`;
                }
            } catch (error) {
                scanStatus.textContent = '‚ùå Scan error';
                scanStatus.style.color = '#FF4444';
                opportunitiesDiv.innerHTML = `<div style="text-align: center; color: #FF4444; padding: 20px;">Error: ${error.message}</div>`;
            }
        }

        // Execute Bitget Triangular Trade
        async function executeBitgetTriangularTrade(pathId) {
            const apiKey = localStorage.getItem('bitget_api') || '';
            const apiSecret = localStorage.getItem('bitget_secret') || '';
            const passphrase = localStorage.getItem('bitget_passphrase') || '';
            const maxTrade = parseFloat(document.getElementById('bitgetMaxTrade').value);
            const userId = localStorage.getItem('userId');

            if (!confirm(`‚ö†Ô∏è Execute triangular arbitrage trade?\n\nPath: ${pathId}\nAmount: ${maxTrade} USDT\n\nThis will execute real trades on Bitget.`)) {
                return;
            }

            try {
                const response = await fetch('/api/v1/trading/bitget/triangular/execute', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ apiKey, apiSecret, passphrase, pathId, amount: maxTrade, userId })
                });

                const data = await response.json();

                if (data.success) {
                    alert(`‚úÖ Trade executed successfully!\n\nProfit: $${data.execution.profit.toFixed(2)} (${data.execution.profitPercent.toFixed(3)}%)\nFinal Amount: ${data.execution.finalAmount.toFixed(2)} USDT`);

                    // Refresh opportunities and history
                    scanBitgetTriangularPaths();
                    loadBitgetTradeHistory();
                } else {
                    alert(`‚ùå Trade execution failed:\n\n${data.message}`);
                }
            } catch (error) {
                alert(`‚ùå Trade execution error:\n\n${error.message}`);
            }
        }

        // Save Bitget Settings
        function saveBitgetTriangularSettings() {
            const settings = {
                maxTrade: document.getElementById('bitgetMaxTrade').value,
                portfolioPercent: document.getElementById('bitgetPortfolioPercent').value,
                profitThreshold: document.getElementById('bitgetProfitThreshold').value,
                set1Enabled: document.getElementById('bitgetSet1Enabled').checked,
                set2Enabled: document.getElementById('bitgetSet2Enabled').checked,
                set3Enabled: document.getElementById('bitgetSet3Enabled').checked,
                set4Enabled: document.getElementById('bitgetSet4Enabled').checked,
                set5Enabled: document.getElementById('bitgetSet5Enabled').checked
            };
            localStorage.setItem('bitget_triangular_settings', JSON.stringify(settings));
            console.log('üíú [BITGET] Settings saved:', settings);
        }

        // Load Bitget Settings
        function loadBitgetTriangularSettings() {
            try {
                const saved = localStorage.getItem('bitget_triangular_settings');
                if (saved) {
                    const settings = JSON.parse(saved);

                    if (settings.maxTrade) document.getElementById('bitgetMaxTrade').value = settings.maxTrade;
                    if (settings.portfolioPercent) document.getElementById('bitgetPortfolioPercent').value = settings.portfolioPercent;
                    if (settings.profitThreshold) document.getElementById('bitgetProfitThreshold').value = settings.profitThreshold;

                    if (settings.set1Enabled !== undefined) document.getElementById('bitgetSet1Enabled').checked = settings.set1Enabled;
                    if (settings.set2Enabled !== undefined) document.getElementById('bitgetSet2Enabled').checked = settings.set2Enabled;
                    if (settings.set3Enabled !== undefined) document.getElementById('bitgetSet3Enabled').checked = settings.set3Enabled;
                    if (settings.set4Enabled !== undefined) document.getElementById('bitgetSet4Enabled').checked = settings.set4Enabled;
                    if (settings.set5Enabled !== undefined) document.getElementById('bitgetSet5Enabled').checked = settings.set5Enabled;

                    console.log('üíú [BITGET] Settings loaded:', settings);
                }
            } catch (error) {
                console.error('üíú [BITGET] Error loading settings:', error);
            }
        }

        // Load Bitget Trade History
        async function loadBitgetTradeHistory() {
            const userId = localStorage.getItem('userId');

            if (!userId) {
                return;
            }

            try {
                const response = await fetch('/api/v1/trading/bitget/triangular/history', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ userId, limit: 20 })
                });

                const data = await response.json();

                if (data.success && data.trades.length > 0) {
                    let historyHtml = '<div style="display: grid; gap: 10px;">';

                    data.trades.forEach(trade => {
                        const profitColor = trade.profit >= 0 ? '#00FF00' : '#FF4444';

                        historyHtml += `
                            <div style="padding: 12px; background: rgba(0,0,0,0.3); border-radius: 8px; border-left: 3px solid ${profitColor};">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <div style="color: #8A2BE2; font-weight: 600;">${trade.path_id}</div>
                                        <div style="color: #888; font-size: 12px;">${trade.path_description}</div>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="color: ${profitColor}; font-weight: 600;">${trade.profit_percent?.toFixed(3)}%</div>
                                        <div style="color: #888; font-size: 12px;">$${trade.profit?.toFixed(2)}</div>
                                    </div>
                                </div>
                                <div style="color: #888; font-size: 12px;">${new Date(trade.created_at).toLocaleString()}</div>
                            </div>
                        `;
                    });

                    historyHtml += '</div>';
                    document.getElementById('bitgetTradeHistory').innerHTML = historyHtml;
                }
            } catch (error) {
                console.error('Bitget history error:', error);
            }
        }

        // Initialize Bitget settings on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üíú [BITGET] Initializing triangular arbitrage settings...');
            loadBitgetTriangularSettings();

            const bitgetInputs = document.querySelectorAll('#bitgetMaxTrade, #bitgetPortfolioPercent, #bitgetProfitThreshold');
            bitgetInputs.forEach(input => {
                input.addEventListener('change', saveBitgetTriangularSettings);
            });

            for (let i = 1; i <= 5; i++) {
                const checkbox = document.getElementById(`bitgetSet${i}Enabled`);
                if (checkbox) {
                    checkbox.addEventListener('change', saveBitgetTriangularSettings);
                }
            }
        });

        // ============================================================================
        // BITMART TRIANGULAR ARBITRAGE FUNCTIONS
        // ============================================================================

        // Test Bitmart Connection
        async function testBitmartTriangularConnection() {
            const apiKey = localStorage.getItem('bitmart_api') || '';
            const apiSecret = localStorage.getItem('bitmart_secret') || '';
            const memo = localStorage.getItem('bitmart_memo') || '';
            const statusIndicator = document.getElementById('bitmartStatusIndicator');
            const statusText = document.getElementById('bitmartStatusText');

            if (!apiKey || !apiSecret || !memo) {
                statusIndicator.style.background = '#FF4444';
                statusText.textContent = 'No API credentials configured';
                statusText.style.color = '#FF4444';
                alert('‚ö†Ô∏è Please configure your Bitmart API credentials (including memo) on the Exchange Connections page first.');
                return;
            }

            statusIndicator.style.background = '#FFA500';
            statusText.textContent = 'Testing connection...';
            statusText.style.color = '#FFA500';

            try {
                const response = await fetch('/api/v1/trading/bitmart/triangular/test-connection', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ apiKey, apiSecret, memo })
                });

                const data = await response.json();

                if (data.success) {
                    statusIndicator.style.background = '#00FF00';
                    statusText.textContent = `‚úÖ Connected - ${data.data?.balances?.length || 0} assets`;
                    statusText.style.color = '#00FF00';
                } else {
                    statusIndicator.style.background = '#FF4444';
                    statusText.textContent = '‚ùå Connection Failed';
                    statusText.style.color = '#FF4444';
                    alert(`Connection failed: ${data.message}`);
                }
            } catch (error) {
                statusIndicator.style.background = '#FF4444';
                statusText.textContent = '‚ùå Connection Error';
                statusText.style.color = '#FF4444';
                alert(`Error: ${error.message}`);
            }
        }

        // View Bitmart Path Details
        function viewBitmartPathDetails() {
            const pathDetails = `
üìã BITMART Triangular Arbitrage Paths (30 Total)

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
SET 1: Essential ETH Bridge (7 paths) ‚úÖ DEFAULT
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí ETH ‚Üí BTC ‚Üí USDT
2. USDT ‚Üí ETH ‚Üí SOL ‚Üí USDT
3. USDT ‚Üí ETH ‚Üí XRP ‚Üí USDT
4. USDT ‚Üí ETH ‚Üí ADA ‚Üí USDT
5. USDT ‚Üí ETH ‚Üí DOT ‚Üí USDT
6. USDT ‚Üí ETH ‚Üí MATIC ‚Üí USDT
7. USDT ‚Üí ETH ‚Üí LINK ‚Üí USDT

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
SET 2: Mid-Cap BTC Bridge (7 paths) ‚úÖ DEFAULT
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí BTC ‚Üí ETH ‚Üí USDT
2. USDT ‚Üí BTC ‚Üí SOL ‚Üí USDT
3. USDT ‚Üí BTC ‚Üí AVAX ‚Üí USDT
4. USDT ‚Üí BTC ‚Üí ATOM ‚Üí USDT
5. USDT ‚Üí BTC ‚Üí LTC ‚Üí USDT
6. USDT ‚Üí BTC ‚Üí UNI ‚Üí USDT
7. USDT ‚Üí BTC ‚Üí FIL ‚Üí USDT

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
SET 3: SOL High-Liquidity (6 paths)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí SOL ‚Üí BTC ‚Üí USDT
2. USDT ‚Üí SOL ‚Üí ETH ‚Üí USDT
3. USDT ‚Üí SOL ‚Üí XRP ‚Üí USDT
4. USDT ‚Üí SOL ‚Üí ADA ‚Üí USDT
5. USDT ‚Üí SOL ‚Üí DOT ‚Üí USDT
6. USDT ‚Üí SOL ‚Üí AVAX ‚Üí USDT

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
SET 4: High Volatility (5 paths)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí DOGE ‚Üí BTC ‚Üí USDT
2. USDT ‚Üí SHIB ‚Üí ETH ‚Üí USDT
3. USDT ‚Üí NEAR ‚Üí BTC ‚Üí USDT
4. USDT ‚Üí APT ‚Üí ETH ‚Üí USDT
5. USDT ‚Üí FTM ‚Üí BTC ‚Üí USDT

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
SET 5: Extended Multi-Bridge (5 paths)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí TRX ‚Üí BTC ‚Üí USDT
2. USDT ‚Üí ALGO ‚Üí ETH ‚Üí USDT
3. USDT ‚Üí VET ‚Üí BTC ‚Üí USDT
4. USDT ‚Üí HBAR ‚Üí ETH ‚Üí USDT
5. USDT ‚Üí BMX ‚Üí BTC ‚Üí USDT (Native token)

üí° TOTAL: 30 paths (all 3-leg)
üåâ BRIDGE: USDT (Tether)
üåç GLOBAL: Spot trading platform
üîê AUTH: API Key + Secret + Memo
            `.trim();

            alert(pathDetails);
            console.log('üìã [BITMART] Path details displayed:', pathDetails);
        }

        // Scan Bitmart Triangular Paths
        async function scanBitmartTriangularPaths() {
            const apiKey = localStorage.getItem('bitmart_api') || '';
            const apiSecret = localStorage.getItem('bitmart_secret') || '';
            const memo = localStorage.getItem('bitmart_memo') || '';
            const minProfitPercent = parseFloat(document.getElementById('bitmartProfitThreshold').value);
            const scanStatus = document.getElementById('bitmartScanStatus');
            const opportunitiesDiv = document.getElementById('bitmartOpportunities');

            if (!apiKey || !apiSecret || !memo) {
                alert('‚ö†Ô∏è Please configure your Bitmart API credentials (including memo) on the Exchange Connections page first.');
                return;
            }

            scanStatus.textContent = 'üîÑ Scanning 32 triangular paths...';
            scanStatus.style.color = '#FFA500';
            opportunitiesDiv.innerHTML = '<div style="text-align: center; color: #888; padding: 20px;">Scanning for opportunities...</div>';

            try {
                const enabledSets = [];
                for (let i = 1; i <= 5; i++) {
                    const checkbox = document.getElementById(`bitmartSet${i}Enabled`);
                    if (checkbox && checkbox.checked) {
                        enabledSets.push(`SET_${i}`);
                    }
                }

                const response = await fetch('/api/v1/trading/bitmart/triangular/scan', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ apiKey, apiSecret, memo, minProfitPercent, enabledSets })
                });

                const data = await response.json();

                if (data.success) {
                    scanStatus.textContent = `‚úÖ Found ${data.opportunities.length} opportunities (scanned ${data.scannedPaths} paths)`;
                    scanStatus.style.color = '#00FF00';

                    if (data.opportunities.length > 0) {
                        let opportunitiesHtml = '<div style="display: grid; gap: 15px;">';

                        data.opportunities.forEach((opp, index) => {
                            const profitColor = parseFloat(opp.profitPercent) >= 0.5 ? '#00FF00' : '#FFA500';

                            opportunitiesHtml += `
                                <div style="padding: 15px; background: rgba(255,140,0,0.1); border-radius: 10px; border: 2px solid #FF8C00;">
                                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                                        <div>
                                            <div style="color: #FF8C00; font-weight: 600; margin-bottom: 5px;">${opp.id}</div>
                                            <div style="color: #ddd; margin-bottom: 5px;">${opp.description}</div>
                                            <div style="color: #888; font-size: 14px;">Path: ${opp.path.join(' ‚Üí ')}</div>
                                        </div>
                                        <div style="text-align: right;">
                                            <div style="color: ${profitColor}; font-size: 24px; font-weight: 700;">${opp.profitPercent}%</div>
                                            <div style="color: #888; font-size: 14px;">~$${opp.estimatedProfit} profit</div>
                                        </div>
                                    </div>
                                    <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #444;">
                                        <div style="color: #888; font-size: 12px; margin-bottom: 5px;">Pairs: ${opp.pairs.join(', ')}</div>
                                        <button onclick="executeBitmartTriangularTrade('${opp.id}')" style="width: 100%; padding: 8px; background: #FF8C00; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; margin-top: 10px;">
                                            üß° Execute Trade
                                        </button>
                                    </div>
                                </div>
                            `;
                        });

                        opportunitiesHtml += '</div>';
                        opportunitiesDiv.innerHTML = opportunitiesHtml;
                    } else {
                        opportunitiesDiv.innerHTML = '<div style="text-align: center; color: #888; padding: 20px;">No profitable opportunities found. Try lowering the profit threshold.</div>';
                    }
                } else {
                    scanStatus.textContent = '‚ùå Scan failed';
                    scanStatus.style.color = '#FF4444';
                    opportunitiesDiv.innerHTML = `<div style="text-align: center; color: #FF4444; padding: 20px;">${data.message}</div>`;
                }
            } catch (error) {
                scanStatus.textContent = '‚ùå Scan error';
                scanStatus.style.color = '#FF4444';
                opportunitiesDiv.innerHTML = `<div style="text-align: center; color: #FF4444; padding: 20px;">Error: ${error.message}</div>`;
            }
        }

        // Execute Bitmart Triangular Trade
        async function executeBitmartTriangularTrade(pathId) {
            const apiKey = localStorage.getItem('bitmart_api') || '';
            const apiSecret = localStorage.getItem('bitmart_secret') || '';
            const memo = localStorage.getItem('bitmart_memo') || '';
            const maxTrade = parseFloat(document.getElementById('bitmartMaxTrade').value);
            const userId = localStorage.getItem('userId');

            if (!confirm(`‚ö†Ô∏è Execute triangular arbitrage trade?\n\nPath: ${pathId}\nAmount: ${maxTrade} USDT\n\nThis will execute real trades on Bitmart.`)) {
                return;
            }

            try {
                const response = await fetch('/api/v1/trading/bitmart/triangular/execute', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ apiKey, apiSecret, memo, pathId, amount: maxTrade, userId })
                });

                const data = await response.json();

                if (data.success) {
                    alert(`‚úÖ Trade executed successfully!\n\nProfit: $${data.execution.profit.toFixed(2)} (${data.execution.profitPercent.toFixed(3)}%)\nFinal Amount: ${data.execution.finalAmount.toFixed(2)} USDT`);

                    // Refresh opportunities and history
                    scanBitmartTriangularPaths();
                    loadBitmartTradeHistory();
                } else {
                    alert(`‚ùå Trade execution failed:\n\n${data.message}`);
                }
            } catch (error) {
                alert(`‚ùå Trade execution error:\n\n${error.message}`);
            }
        }

        // Save Bitmart Settings
        function saveBitmartTriangularSettings() {
            const settings = {
                maxTrade: document.getElementById('bitmartMaxTrade').value,
                portfolioPercent: document.getElementById('bitmartPortfolioPercent').value,
                profitThreshold: document.getElementById('bitmartProfitThreshold').value,
                set1Enabled: document.getElementById('bitmartSet1Enabled').checked,
                set2Enabled: document.getElementById('bitmartSet2Enabled').checked,
                set3Enabled: document.getElementById('bitmartSet3Enabled').checked,
                set4Enabled: document.getElementById('bitmartSet4Enabled').checked,
                set5Enabled: document.getElementById('bitmartSet5Enabled').checked
            };
            localStorage.setItem('bitmart_triangular_settings', JSON.stringify(settings));
            console.log('üß° [BITMART] Settings saved:', settings);
        }

        // Load Bitmart Settings
        function loadBitmartTriangularSettings() {
            try {
                const saved = localStorage.getItem('bitmart_triangular_settings');
                if (saved) {
                    const settings = JSON.parse(saved);

                    if (settings.maxTrade) document.getElementById('bitmartMaxTrade').value = settings.maxTrade;
                    if (settings.portfolioPercent) document.getElementById('bitmartPortfolioPercent').value = settings.portfolioPercent;
                    if (settings.profitThreshold) document.getElementById('bitmartProfitThreshold').value = settings.profitThreshold;

                    if (settings.set1Enabled !== undefined) document.getElementById('bitmartSet1Enabled').checked = settings.set1Enabled;
                    if (settings.set2Enabled !== undefined) document.getElementById('bitmartSet2Enabled').checked = settings.set2Enabled;
                    if (settings.set3Enabled !== undefined) document.getElementById('bitmartSet3Enabled').checked = settings.set3Enabled;
                    if (settings.set4Enabled !== undefined) document.getElementById('bitmartSet4Enabled').checked = settings.set4Enabled;
                    if (settings.set5Enabled !== undefined) document.getElementById('bitmartSet5Enabled').checked = settings.set5Enabled;

                    console.log('üß° [BITMART] Settings loaded:', settings);
                }
            } catch (error) {
                console.error('üß° [BITMART] Error loading settings:', error);
            }
        }

        // Load Bitmart Trade History
        async function loadBitmartTradeHistory() {
            const userId = localStorage.getItem('userId');

            if (!userId) {
                return;
            }

            try {
                const response = await fetch('/api/v1/trading/bitmart/triangular/history', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ userId, limit: 20 })
                });

                const data = await response.json();

                if (data.success && data.trades.length > 0) {
                    let historyHtml = '<div style="display: grid; gap: 10px;">';

                    data.trades.forEach(trade => {
                        const profitColor = trade.profit >= 0 ? '#00FF00' : '#FF4444';

                        historyHtml += `
                            <div style="padding: 12px; background: rgba(0,0,0,0.3); border-radius: 8px; border-left: 3px solid ${profitColor};">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <div style="color: #FF8C00; font-weight: 600;">${trade.path_id}</div>
                                        <div style="color: #888; font-size: 12px;">${trade.path_description}</div>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="color: ${profitColor}; font-weight: 600;">${trade.profit_percent?.toFixed(3)}%</div>
                                        <div style="color: #888; font-size: 12px;">$${trade.profit?.toFixed(2)}</div>
                                    </div>
                                </div>
                                <div style="color: #888; font-size: 12px;">${new Date(trade.created_at).toLocaleString()}</div>
                            </div>
                        `;
                    });

                    historyHtml += '</div>';
                    document.getElementById('bitmartTradeHistory').innerHTML = historyHtml;
                }
            } catch (error) {
                console.error('Bitmart history error:', error);
            }
        }

        // Initialize Bitmart settings on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üß° [BITMART] Initializing triangular arbitrage settings...');
            loadBitmartTriangularSettings();

            const bitmartInputs = document.querySelectorAll('#bitmartMaxTrade, #bitmartPortfolioPercent, #bitmartProfitThreshold');
            bitmartInputs.forEach(input => {
                input.addEventListener('change', saveBitmartTriangularSettings);
            });

            for (let i = 1; i <= 5; i++) {
                const checkbox = document.getElementById(`bitmartSet${i}Enabled`);
                if (checkbox) {
                    checkbox.addEventListener('change', saveBitmartTriangularSettings);
                }
            }
        });

        // ============================================================================
        // BITRUE TRIANGULAR ARBITRAGE FUNCTIONS
        // ============================================================================

        // Test Bitrue Connection
        async function testBitrueTriangularConnection() {
            const apiKey = localStorage.getItem('bitrue_api') || '';
            const apiSecret = localStorage.getItem('bitrue_secret') || '';
            const statusIndicator = document.getElementById('bitrueStatusIndicator');
            const statusText = document.getElementById('bitrueStatusText');

            if (!apiKey || !apiSecret) {
                statusIndicator.style.background = '#FF4444';
                statusText.textContent = 'No API credentials configured';
                statusText.style.color = '#FF4444';
                alert('‚ö†Ô∏è Please configure your Bitrue API credentials on the Exchange Connections page first.');
                return;
            }

            statusIndicator.style.background = '#FFA500';
            statusText.textContent = 'Testing connection...';
            statusText.style.color = '#FFA500';

            try {
                const response = await fetch('/api/v1/trading/bitrue/triangular/test-connection', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ apiKey, apiSecret })
                });

                const data = await response.json();

                if (data.success) {
                    statusIndicator.style.background = '#00FF00';
                    statusText.textContent = `‚úÖ Connected - ${data.data?.balances?.length || 0} assets`;
                    statusText.style.color = '#00FF00';
                } else {
                    statusIndicator.style.background = '#FF4444';
                    statusText.textContent = '‚ùå Connection Failed';
                    statusText.style.color = '#FF4444';
                    alert(`Connection failed: ${data.message}`);
                }
            } catch (error) {
                statusIndicator.style.background = '#FF4444';
                statusText.textContent = '‚ùå Connection Error';
                statusText.style.color = '#FF4444';
                alert(`Error: ${error.message}`);
            }
        }

        // View Bitrue Path Details
        function viewBitruePathDetails() {
            const pathDetails = `
üìã BITRUE Triangular Arbitrage Paths (28 Total)

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
SET 1: Essential ETH Bridge (7 paths) ‚úÖ DEFAULT
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí ETH ‚Üí BTC ‚Üí USDT
2. USDT ‚Üí ETH ‚Üí SOL ‚Üí USDT
3. USDT ‚Üí ETH ‚Üí XRP ‚Üí USDT
4. USDT ‚Üí ETH ‚Üí ADA ‚Üí USDT
5. USDT ‚Üí ETH ‚Üí DOT ‚Üí USDT
6. USDT ‚Üí ETH ‚Üí MATIC ‚Üí USDT
7. USDT ‚Üí ETH ‚Üí LINK ‚Üí USDT

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
SET 2: Mid-Cap BTC Bridge (7 paths) ‚úÖ DEFAULT
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí BTC ‚Üí ETH ‚Üí USDT
2. USDT ‚Üí BTC ‚Üí SOL ‚Üí USDT
3. USDT ‚Üí BTC ‚Üí AVAX ‚Üí USDT
4. USDT ‚Üí BTC ‚Üí ATOM ‚Üí USDT
5. USDT ‚Üí BTC ‚Üí LTC ‚Üí USDT
6. USDT ‚Üí BTC ‚Üí UNI ‚Üí USDT
7. USDT ‚Üí BTC ‚Üí XRP ‚Üí USDT

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
SET 3: SOL High-Liquidity (5 paths)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí SOL ‚Üí BTC ‚Üí USDT
2. USDT ‚Üí SOL ‚Üí ETH ‚Üí USDT
3. USDT ‚Üí SOL ‚Üí XRP ‚Üí USDT
4. USDT ‚Üí SOL ‚Üí ADA ‚Üí USDT
5. USDT ‚Üí SOL ‚Üí DOT ‚Üí USDT

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
SET 4: High Volatility (5 paths)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí DOGE ‚Üí BTC ‚Üí USDT
2. USDT ‚Üí SHIB ‚Üí ETH ‚Üí USDT
3. USDT ‚Üí NEAR ‚Üí BTC ‚Üí USDT
4. USDT ‚Üí APT ‚Üí ETH ‚Üí USDT
5. USDT ‚Üí FTM ‚Üí BTC ‚Üí USDT

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
SET 5: Extended Multi-Bridge (4 paths)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí TRX ‚Üí BTC ‚Üí USDT
2. USDT ‚Üí ALGO ‚Üí ETH ‚Üí USDT
3. USDT ‚Üí VET ‚Üí BTC ‚Üí USDT
4. USDT ‚Üí BTR ‚Üí BTC ‚Üí USDT (Native token)

üí° TOTAL: 28 paths (all 3-leg)
üåâ BRIDGE: USDT (Tether)
üåç GLOBAL: Spot and staking platform
üîê AUTH: API Key + Secret
            `.trim();

            alert(pathDetails);
            console.log('üìã [BITRUE] Path details displayed:', pathDetails);
        }

        // Scan Bitrue Triangular Paths
        async function scanBitrueTriangularPaths() {
            const apiKey = localStorage.getItem('bitrue_api') || '';
            const apiSecret = localStorage.getItem('bitrue_secret') || '';
            const minProfitPercent = parseFloat(document.getElementById('bitrueProfitThreshold').value);
            const scanStatus = document.getElementById('bitrueScanStatus');
            const opportunitiesDiv = document.getElementById('bitrueOpportunities');

            if (!apiKey || !apiSecret) {
                alert('‚ö†Ô∏è Please configure your Bitrue API credentials on the Exchange Connections page first.');
                return;
            }

            scanStatus.textContent = 'üîÑ Scanning 32 triangular paths...';
            scanStatus.style.color = '#FFA500';
            opportunitiesDiv.innerHTML = '<div style="text-align: center; color: #888; padding: 20px;">Scanning for opportunities...</div>';

            try {
                const enabledSets = [];
                for (let i = 1; i <= 5; i++) {
                    const checkbox = document.getElementById(`bitrueSet${i}Enabled`);
                    if (checkbox && checkbox.checked) {
                        enabledSets.push(`SET_${i}`);
                    }
                }

                const response = await fetch('/api/v1/trading/bitrue/triangular/scan', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ apiKey, apiSecret, minProfitPercent, enabledSets })
                });

                const data = await response.json();

                if (data.success) {
                    scanStatus.textContent = `‚úÖ Found ${data.opportunities.length} opportunities (scanned ${data.scannedPaths} paths)`;
                    scanStatus.style.color = '#00FF00';

                    if (data.opportunities.length > 0) {
                        let opportunitiesHtml = '<div style="display: grid; gap: 15px;">';

                        data.opportunities.forEach((opp, index) => {
                            const profitColor = parseFloat(opp.profitPercent) >= 0.5 ? '#00FF00' : '#FFA500';

                            opportunitiesHtml += `
                                <div style="padding: 15px; background: rgba(34,197,94,0.1); border-radius: 10px; border: 2px solid #22C55E;">
                                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                                        <div>
                                            <div style="color: #22C55E; font-weight: 600; margin-bottom: 5px;">${opp.id}</div>
                                            <div style="color: #ddd; margin-bottom: 5px;">${opp.description}</div>
                                            <div style="color: #888; font-size: 14px;">Path: ${opp.path.join(' ‚Üí ')}</div>
                                        </div>
                                        <div style="text-align: right;">
                                            <div style="color: ${profitColor}; font-size: 24px; font-weight: 700;">${opp.profitPercent}%</div>
                                            <div style="color: #888; font-size: 14px;">~$${opp.estimatedProfit} profit</div>
                                        </div>
                                    </div>
                                    <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #444;">
                                        <div style="color: #888; font-size: 12px; margin-bottom: 5px;">Pairs: ${opp.pairs.join(', ')}</div>
                                        <button onclick="executeBitrueTriangularTrade('${opp.id}')" style="width: 100%; padding: 8px; background: #22C55E; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; margin-top: 10px;">
                                            üíö Execute Trade
                                        </button>
                                    </div>
                                </div>
                            `;
                        });

                        opportunitiesHtml += '</div>';
                        opportunitiesDiv.innerHTML = opportunitiesHtml;
                    } else {
                        opportunitiesDiv.innerHTML = '<div style="text-align: center; color: #888; padding: 20px;">No profitable opportunities found. Try lowering the profit threshold.</div>';
                    }
                } else {
                    scanStatus.textContent = '‚ùå Scan failed';
                    scanStatus.style.color = '#FF4444';
                    opportunitiesDiv.innerHTML = `<div style="text-align: center; color: #FF4444; padding: 20px;">${data.message}</div>`;
                }
            } catch (error) {
                scanStatus.textContent = '‚ùå Scan error';
                scanStatus.style.color = '#FF4444';
                opportunitiesDiv.innerHTML = `<div style="text-align: center; color: #FF4444; padding: 20px;">Error: ${error.message}</div>`;
            }
        }

        // Execute Bitrue Triangular Trade
        async function executeBitrueTriangularTrade(pathId) {
            const apiKey = localStorage.getItem('bitrue_api') || '';
            const apiSecret = localStorage.getItem('bitrue_secret') || '';
            const maxTrade = parseFloat(document.getElementById('bitrueMaxTrade').value);
            const userId = localStorage.getItem('userId');

            if (!confirm(`‚ö†Ô∏è Execute triangular arbitrage trade?\n\nPath: ${pathId}\nAmount: ${maxTrade} USDT\n\nThis will execute real trades on Bitrue.`)) {
                return;
            }

            try {
                const response = await fetch('/api/v1/trading/bitrue/triangular/execute', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ apiKey, apiSecret, pathId, amount: maxTrade, userId })
                });

                const data = await response.json();

                if (data.success) {
                    alert(`‚úÖ Trade executed successfully!\n\nProfit: $${data.execution.profit.toFixed(2)} (${data.execution.profitPercent.toFixed(3)}%)\nFinal Amount: ${data.execution.finalAmount.toFixed(2)} USDT`);

                    // Refresh opportunities and history
                    scanBitrueTriangularPaths();
                    loadBitrueTradeHistory();
                } else {
                    alert(`‚ùå Trade execution failed:\n\n${data.message}`);
                }
            } catch (error) {
                alert(`‚ùå Trade execution error:\n\n${error.message}`);
            }
        }

        // Save Bitrue Settings
        function saveBitrueTriangularSettings() {
            const settings = {
                maxTrade: document.getElementById('bitrueMaxTrade').value,
                portfolioPercent: document.getElementById('bitruePortfolioPercent').value,
                profitThreshold: document.getElementById('bitrueProfitThreshold').value,
                set1Enabled: document.getElementById('bitrueSet1Enabled').checked,
                set2Enabled: document.getElementById('bitrueSet2Enabled').checked,
                set3Enabled: document.getElementById('bitrueSet3Enabled').checked,
                set4Enabled: document.getElementById('bitrueSet4Enabled').checked,
                set5Enabled: document.getElementById('bitrueSet5Enabled').checked
            };
            localStorage.setItem('bitrue_triangular_settings', JSON.stringify(settings));
            console.log('üíö [BITRUE] Settings saved:', settings);
        }

        // Load Bitrue Settings
        function loadBitrueTriangularSettings() {
            try {
                const saved = localStorage.getItem('bitrue_triangular_settings');
                if (saved) {
                    const settings = JSON.parse(saved);

                    if (settings.maxTrade) document.getElementById('bitrueMaxTrade').value = settings.maxTrade;
                    if (settings.portfolioPercent) document.getElementById('bitruePortfolioPercent').value = settings.portfolioPercent;
                    if (settings.profitThreshold) document.getElementById('bitrueProfitThreshold').value = settings.profitThreshold;

                    if (settings.set1Enabled !== undefined) document.getElementById('bitrueSet1Enabled').checked = settings.set1Enabled;
                    if (settings.set2Enabled !== undefined) document.getElementById('bitrueSet2Enabled').checked = settings.set2Enabled;
                    if (settings.set3Enabled !== undefined) document.getElementById('bitrueSet3Enabled').checked = settings.set3Enabled;
                    if (settings.set4Enabled !== undefined) document.getElementById('bitrueSet4Enabled').checked = settings.set4Enabled;
                    if (settings.set5Enabled !== undefined) document.getElementById('bitrueSet5Enabled').checked = settings.set5Enabled;

                    console.log('üíö [BITRUE] Settings loaded:', settings);
                }
            } catch (error) {
                console.error('üíö [BITRUE] Error loading settings:', error);
            }
        }

        // Load Bitrue Trade History
        async function loadBitrueTradeHistory() {
            const userId = localStorage.getItem('userId');

            if (!userId) {
                return;
            }

            try {
                const response = await fetch('/api/v1/trading/bitrue/triangular/history', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ userId, limit: 20 })
                });

                const data = await response.json();

                if (data.success && data.trades.length > 0) {
                    let historyHtml = '<div style="display: grid; gap: 10px;">';

                    data.trades.forEach(trade => {
                        const profitColor = trade.profit >= 0 ? '#00FF00' : '#FF4444';

                        historyHtml += `
                            <div style="padding: 12px; background: rgba(0,0,0,0.3); border-radius: 8px; border-left: 3px solid ${profitColor};">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <div style="color: #22C55E; font-weight: 600;">${trade.path_id}</div>
                                        <div style="color: #888; font-size: 12px;">${trade.path_description}</div>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="color: ${profitColor}; font-weight: 600;">${trade.profit_percent?.toFixed(3)}%</div>
                                        <div style="color: #888; font-size: 12px;">$${trade.profit?.toFixed(2)}</div>
                                    </div>
                                </div>
                                <div style="color: #888; font-size: 12px;">${new Date(trade.created_at).toLocaleString()}</div>
                            </div>
                        `;
                    });

                    historyHtml += '</div>';
                    document.getElementById('bitrueTradeHistory').innerHTML = historyHtml;
                }
            } catch (error) {
                console.error('Bitrue history error:', error);
            }
        }

        // Initialize Bitrue settings on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üíö [BITRUE] Initializing triangular arbitrage settings...');
            loadBitrueTriangularSettings();

            const bitrueInputs = document.querySelectorAll('#bitrueMaxTrade, #bitruePortfolioPercent, #bitrueProfitThreshold');
            bitrueInputs.forEach(input => {
                input.addEventListener('change', saveBitrueTriangularSettings);
            });

            for (let i = 1; i <= 5; i++) {
                const checkbox = document.getElementById(`bitrueSet${i}Enabled`);
                if (checkbox) {
                    checkbox.addEventListener('change', saveBitrueTriangularSettings);
                }
            }
        });

        // ============================================================================
        // GEMINI TRIANGULAR ARBITRAGE FUNCTIONS
        // ============================================================================

        // Test Gemini Connection
        async function testGeminiTriangularConnection() {
            const apiKey = localStorage.getItem('gemini_api') || '';
            const apiSecret = localStorage.getItem('gemini_secret') || '';

            if (!apiKey || !apiSecret) {
                showNotification('Please set up Gemini API credentials in Settings first', 'error');
                return;
            }

            document.getElementById('geminiStatus').innerHTML = '<span style="color: #FFA500;">‚è≥ Testing connection...</span>';

            try {
                const response = await fetch(`${API_BASE}/trading/gemini/triangular/test-connection`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    body: JSON.stringify({ apiKey, apiSecret })
                });

                const data = await response.json();

                if (data.success) {
                    document.getElementById('geminiStatus').innerHTML = '<span style="color: #00FF00;">‚úÖ Connected</span>';
                    document.getElementById('geminiBalance').innerHTML = `USDT Balance: $${data.balance.available.toFixed(2)} / $${data.balance.total.toFixed(2)}`;
                    showNotification('Gemini connection successful!', 'success');

                    // Auto-load trade history
                    await loadGeminiTradeHistory();
                } else {
                    document.getElementById('geminiStatus').innerHTML = '<span style="color: #FF0000;">‚ùå Connection failed</span>';
                    showNotification(data.message || 'Gemini connection failed', 'error');
                }
            } catch (error) {
                console.error('Gemini connection error:', error);
                document.getElementById('geminiStatus').innerHTML = '<span style="color: #FF0000;">‚ùå Error</span>';
                showNotification('Network error during connection test', 'error');
            }
        }

        // Scan for Gemini Opportunities
        async function scanGeminiTriangular() {
            const apiKey = localStorage.getItem('gemini_api') || '';
            const apiSecret = localStorage.getItem('gemini_secret') || '';

            if (!apiKey || !apiSecret) {
                showNotification('Please set up Gemini API credentials and test connection first', 'error');
                return;
            }

            // Get selected sets
            const selectedSets = [];
            for (let i = 1; i <= 5; i++) {
                const checkbox = document.getElementById(`gemini_SET_${i}`);
                if (checkbox && checkbox.checked) {
                    selectedSets.push(`SET_${i}_${['BTC_ETH_DIRECT', 'DOGE_BRIDGE', 'LINK_BRIDGE', 'LTC_BRIDGE', 'SOL_BRIDGE'][i - 1]}`);
                }
            }

            if (selectedSets.length === 0) {
                showNotification('Please select at least one path set', 'error');
                return;
            }

            document.getElementById('geminiScanResults').innerHTML = '<span style="color: #FFA500;">‚è≥ Scanning for opportunities...</span>';
            document.getElementById('geminiOpportunities').innerHTML = '<div style="color: #888; text-align: center; padding: 20px;">Scanning...</div>';

            try {
                const response = await fetch(`${API_BASE}/trading/gemini/triangular/scan`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    body: JSON.stringify({
                        apiKey,
                        apiSecret,
                        selectedSets
                    })
                });

                const data = await response.json();

                if (data.success) {
                    const minProfit = parseFloat(document.getElementById('geminiMinProfit').value) || 0.5;
                    const filteredOpps = data.opportunities.filter(opp => opp.profitPercentage >= minProfit);

                    document.getElementById('geminiScanResults').innerHTML =
                        `<span style="color: #00FF00;">‚úÖ Scan complete: ${filteredOpps.length} opportunities found (${data.scannedPaths} paths scanned)</span>`;

                    if (filteredOpps.length === 0) {
                        document.getElementById('geminiOpportunities').innerHTML =
                            '<div style="color: #888; text-align: center; padding: 20px;">No profitable opportunities found above minimum profit threshold.</div>';
                        return;
                    }

                    // Display opportunities
                    let html = '';
                    filteredOpps.forEach((opp, index) => {
                        html += `
                            <div style="background: rgba(0,170,221,0.1); padding: 15px; border-radius: 10px; margin-bottom: 15px; border: 1px solid #00AADD;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                    <div>
                                        <span style="color: #00AADD; font-weight: bold;">${opp.pathId}</span>
                                        <span style="color: #888; margin-left: 10px; font-size: 12px;">${opp.description}</span>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="color: ${opp.profitPercentage >= 1 ? '#00FF00' : '#FFA500'}; font-weight: bold; font-size: 18px;">
                                            +${opp.profitPercentage.toFixed(2)}%
                                        </div>
                                        <div style="color: #888; font-size: 12px;">
                                            ~$${opp.estimatedProfit.toFixed(2)} profit
                                        </div>
                                    </div>
                                </div>
                                <div style="color: #888; font-size: 13px; margin-bottom: 10px;">
                                    Path: ${opp.path.join(' ‚Üí ')}
                                </div>
                                <div style="color: #666; font-size: 12px; margin-bottom: 10px;">
                                    Pairs: ${opp.pairs.join(', ')}
                                </div>
                                <button onclick='executeGeminiTriangular(${JSON.stringify(opp)})'
                                        style="width: 100%; padding: 10px; background: #00AADD; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;">
                                    ‚ö° Execute Trade
                                </button>
                            </div>
                        `;
                    });

                    document.getElementById('geminiOpportunities').innerHTML = html;
                    showNotification(`Found ${filteredOpps.length} opportunities!`, 'success');

                } else {
                    document.getElementById('geminiScanResults').innerHTML =
                        '<span style="color: #FF0000;">‚ùå Scan failed</span>';
                    document.getElementById('geminiOpportunities').innerHTML =
                        '<div style="color: #888; text-align: center; padding: 20px;">Scan failed. Please try again.</div>';
                    showNotification(data.message || 'Scan failed', 'error');
                }

            } catch (error) {
                console.error('Gemini scan error:', error);
                document.getElementById('geminiScanResults').innerHTML = '<span style="color: #FF0000;">‚ùå Error</span>';
                showNotification('Network error during scan', 'error');
            }
        }

        // Execute Gemini Triangular Trade
        async function executeGeminiTriangular(opportunity) {
            const apiKey = localStorage.getItem('gemini_api') || '';
            const apiSecret = localStorage.getItem('gemini_secret') || '';
            const maxInvestment = parseFloat(document.getElementById('geminiMaxInvestment').value) || 1000;

            if (!confirm(`Execute triangular arbitrage on Gemini?\n\nPath: ${opportunity.pathId}\nExpected Profit: ${opportunity.profitPercentage.toFixed(2)}%\nInvestment: $${maxInvestment}`)) {
                return;
            }

            showNotification('Executing Gemini triangular arbitrage...', 'info');

            try {
                const response = await fetch(`${API_BASE}/trading/gemini/triangular/execute`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    body: JSON.stringify({
                        apiKey,
                        apiSecret,
                        opportunity,
                        investmentAmount: maxInvestment
                    })
                });

                const data = await response.json();

                if (data.success) {
                    showNotification(`Trade executed! Profit: $${data.profit.toFixed(2)} (${data.profitPercentage}%)`, 'success');

                    // Refresh opportunities and history
                    await scanGeminiTriangular();
                    await loadGeminiTradeHistory();
                } else {
                    showNotification(data.message || 'Trade execution failed', 'error');
                }

            } catch (error) {
                console.error('Gemini execution error:', error);
                showNotification('Network error during trade execution', 'error');
            }
        }

        // View Gemini Path Details
        function viewGeminiPathDetails() {
            const pathDetails = `
üìã GEMINI Triangular Arbitrage Paths (10 Total)

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
SET 1: BTC-ETH Direct (2 paths) ‚úÖ DEFAULT
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USD ‚Üí BTC ‚Üí ETH ‚Üí USD
2. USD ‚Üí ETH ‚Üí BTC ‚Üí USD

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
SET 2: DOGE Bridge (2 paths) ‚úÖ DEFAULT
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USD ‚Üí DOGE ‚Üí BTC ‚Üí USD
2. USD ‚Üí DOGE ‚Üí ETH ‚Üí USD

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
SET 3: LINK Bridge (2 paths) ‚úÖ DEFAULT
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USD ‚Üí LINK ‚Üí BTC ‚Üí USD
2. USD ‚Üí LINK ‚Üí ETH ‚Üí USD

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
SET 4: LTC Bridge (2 paths) ‚úÖ DEFAULT
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USD ‚Üí LTC ‚Üí BTC ‚Üí USD
2. USD ‚Üí LTC ‚Üí ETH ‚Üí USD

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
SET 5: SOL Bridge (2 paths) ‚úÖ DEFAULT
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USD ‚Üí SOL ‚Üí BTC ‚Üí USD
2. USD ‚Üí SOL ‚Üí ETH ‚Üí USD

üí° TOTAL: 10 paths (all 3-leg)
üåâ BRIDGE: USD (US Dollar)
üá∫üá∏ REGIONAL: US-regulated exchange
üîê AUTH: API Key + Secret (institutional-grade)
            `.trim();

            alert(pathDetails);
            console.log('üìã [GEMINI] Path details displayed:', pathDetails);
        }

        // Save Gemini Settings
        function saveGeminiSettings() {
            const settings = {
                minProfit: document.getElementById('geminiMinProfit').value,
                maxInvestment: document.getElementById('geminiMaxInvestment').value,
                selectedSets: []
            };

            for (let i = 1; i <= 5; i++) {
                const checkbox = document.getElementById(`gemini_SET_${i}`);
                if (checkbox) {
                    settings.selectedSets.push({
                        id: i,
                        checked: checkbox.checked
                    });
                }
            }

            localStorage.setItem('gemini_triangular_settings', JSON.stringify(settings));
            showNotification('Gemini settings saved!', 'success');
        }

        // Load Gemini Settings
        function loadGeminiSettings() {
            const settings = JSON.parse(localStorage.getItem('gemini_triangular_settings') || '{}');

            if (settings.minProfit) {
                document.getElementById('geminiMinProfit').value = settings.minProfit;
            }

            if (settings.maxInvestment) {
                document.getElementById('geminiMaxInvestment').value = settings.maxInvestment;
            }

            if (settings.selectedSets) {
                settings.selectedSets.forEach(set => {
                    const checkbox = document.getElementById(`gemini_SET_${set.id}`);
                    if (checkbox) {
                        checkbox.checked = set.checked;
                    }
                });
            }

            showNotification('Gemini settings loaded!', 'success');
        }

        // Load Gemini Trade History
        async function loadGeminiTradeHistory() {
            try {
                const response = await fetch(`${API_BASE}/trading/gemini/triangular/history`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });

                const data = await response.json();

                if (data.success && data.trades && data.trades.length > 0) {
                    let html = '<div style="overflow-x: auto;"><table style="width: 100%; border-collapse: collapse; font-size: 13px;">';
                    html += '<thead><tr style="background: rgba(0,170,221,0.2);">';
                    html += '<th style="padding: 8px; text-align: left; color: #00AADD;">Date</th>';
                    html += '<th style="padding: 8px; text-align: left; color: #00AADD;">Path</th>';
                    html += '<th style="padding: 8px; text-align: right; color: #00AADD;">Investment</th>';
                    html += '<th style="padding: 8px; text-align: right; color: #00AADD;">Final</th>';
                    html += '<th style="padding: 8px; text-align: right; color: #00AADD;">Profit</th>';
                    html += '<th style="padding: 8px; text-align: center; color: #00AADD;">Status</th>';
                    html += '</tr></thead><tbody>';

                    data.trades.forEach(trade => {
                        const profit = parseFloat(trade.profit);
                        const profitPercent = ((profit / parseFloat(trade.investment_amount)) * 100).toFixed(2);
                        const profitColor = profit >= 0 ? '#00FF00' : '#FF0000';

                        html += `<tr style="border-bottom: 1px solid #333;">
                            <td style="padding: 8px; color: #888;">${new Date(trade.created_at).toLocaleString()}</td>
                            <td style="padding: 8px; color: #00AADD;">${trade.path_id}</td>
                            <td style="padding: 8px; text-align: right; color: #888;">$${parseFloat(trade.investment_amount).toFixed(2)}</td>
                            <td style="padding: 8px; text-align: right; color: #888;">$${parseFloat(trade.final_amount).toFixed(2)}</td>
                            <td style="padding: 8px; text-align: right; color: ${profitColor};">$${profit.toFixed(2)} (${profitPercent}%)</td>
                            <td style="padding: 8px; text-align: center;">
                                <span style="background: rgba(0,170,221,0.2); color: #00AADD; padding: 4px 8px; border-radius: 4px; font-size: 11px;">
                                    ${trade.status}
                                </span>
                            </td>
                        </tr>`;
                    });

                    html += '</tbody></table></div>';
                    document.getElementById('geminiTradeHistory').innerHTML = html;
                } else {
                    document.getElementById('geminiTradeHistory').innerHTML =
                        '<div style="color: #888; font-size: 14px;">No trade history available.</div>';
                }

            } catch (error) {
                console.error('Gemini history error:', error);
            }
        }

        // Auto-load Gemini settings on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadGeminiSettings();
        });

        // ============================================================================
        // COINCATCH TRIANGULAR ARBITRAGE FUNCTIONS (FINAL EXCHANGE - 21/21)
        // ============================================================================

        // Test Coincatch Connection
        async function testCoincatchTriangularConnection() {
            const apiKey = localStorage.getItem('coincatch_api') || '';
            const apiSecret = localStorage.getItem('coincatch_secret') || '';
            const passphrase = localStorage.getItem('coincatch_passphrase') || '';

            if (!apiKey || !apiSecret || !passphrase) {
                showNotification('Please set up Coincatch API credentials (including passphrase) in Settings first', 'error');
                return;
            }

            document.getElementById('coincatchStatus').innerHTML = '<span style="color: #FFA500;">‚è≥ Testing connection...</span>';

            try {
                const response = await fetch(`${API_BASE}/trading/coincatch/triangular/test-connection`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    body: JSON.stringify({ apiKey, apiSecret, passphrase })
                });

                const data = await response.json();

                if (data.success) {
                    document.getElementById('coincatchStatus').innerHTML = '<span style="color: #00FF00;">‚úÖ Connected</span>';
                    document.getElementById('coincatchBalance').innerHTML = `USDT Balance: $${data.balance.available.toFixed(2)} / $${data.balance.total.toFixed(2)}`;
                    showNotification('Coincatch connection successful!', 'success');

                    // Auto-load trade history
                    await loadCoincatchTradeHistory();
                } else {
                    document.getElementById('coincatchStatus').innerHTML = '<span style="color: #FF0000;">‚ùå Connection failed</span>';
                    showNotification(data.message || 'Coincatch connection failed', 'error');
                }
            } catch (error) {
                console.error('Coincatch connection error:', error);
                document.getElementById('coincatchStatus').innerHTML = '<span style="color: #FF0000;">‚ùå Error</span>';
                showNotification('Network error during connection test', 'error');
            }
        }

        // Scan for Coincatch Opportunities
        async function scanCoincatchTriangular() {
            const apiKey = localStorage.getItem('coincatch_api') || '';
            const apiSecret = localStorage.getItem('coincatch_secret') || '';
            const passphrase = localStorage.getItem('coincatch_passphrase') || '';

            if (!apiKey || !apiSecret || !passphrase) {
                showNotification('Please set up Coincatch API credentials and test connection first', 'error');
                return;
            }

            // Get selected sets
            const selectedSets = [];
            for (let i = 1; i <= 5; i++) {
                const checkbox = document.getElementById(`coincatch_SET_${i}`);
                if (checkbox && checkbox.checked) {
                    selectedSets.push(`SET_${i}_${['BTC_ETH_DIRECT', 'GMT_BTC_BRIDGE', 'MAJOR_4LEG', 'ALTCOIN_4LEG', 'EXTENDED_4LEG'][i - 1]}`);
                }
            }

            if (selectedSets.length === 0) {
                showNotification('Please select at least one path set', 'error');
                return;
            }

            document.getElementById('coincatchScanResults').innerHTML = '<span style="color: #FFA500;">‚è≥ Scanning for opportunities...</span>';
            document.getElementById('coincatchOpportunities').innerHTML = '<div style="color: #888; text-align: center; padding: 20px;">Scanning...</div>';

            try {
                const response = await fetch(`${API_BASE}/trading/coincatch/triangular/scan`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    body: JSON.stringify({
                        apiKey,
                        apiSecret,
                        passphrase,
                        selectedSets
                    })
                });

                const data = await response.json();

                if (data.success) {
                    const minProfit = parseFloat(document.getElementById('coincatchMinProfit').value) || 0.5;
                    const filteredOpps = data.opportunities.filter(opp => opp.profitPercentage >= minProfit);

                    document.getElementById('coincatchScanResults').innerHTML =
                        `<span style="color: #00FF00;">‚úÖ Scan complete: ${filteredOpps.length} opportunities found (${data.scannedPaths} paths scanned)</span>`;

                    if (filteredOpps.length === 0) {
                        document.getElementById('coincatchOpportunities').innerHTML =
                            '<div style="color: #888; text-align: center; padding: 20px;">No profitable opportunities found above minimum profit threshold.</div>';
                        return;
                    }

                    // Display opportunities
                    let html = '';
                    filteredOpps.forEach((opp, index) => {
                        html += `
                            <div style="background: rgba(255,87,34,0.1); padding: 15px; border-radius: 10px; margin-bottom: 15px; border: 1px solid #FF5722;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                    <div>
                                        <span style="color: #FF5722; font-weight: bold;">${opp.pathId}</span>
                                        <span style="color: #888; margin-left: 10px; font-size: 12px;">${opp.description}</span>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="color: ${opp.profitPercentage >= 1 ? '#00FF00' : '#FFA500'}; font-weight: bold; font-size: 18px;">
                                            +${opp.profitPercentage.toFixed(2)}%
                                        </div>
                                        <div style="color: #888; font-size: 12px;">
                                            ~$${opp.estimatedProfit.toFixed(2)} profit
                                        </div>
                                    </div>
                                </div>
                                <div style="color: #888; font-size: 13px; margin-bottom: 10px;">
                                    Path: ${opp.path.join(' ‚Üí ')}
                                </div>
                                <div style="color: #666; font-size: 12px; margin-bottom: 10px;">
                                    Pairs: ${opp.pairs.join(', ')}
                                </div>
                                <button onclick='executeCoincatchTriangular(${JSON.stringify(opp)})'
                                        style="width: 100%; padding: 10px; background: #FF5722; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;">
                                    ‚ö° Execute Trade
                                </button>
                            </div>
                        `;
                    });

                    document.getElementById('coincatchOpportunities').innerHTML = html;
                    showNotification(`Found ${filteredOpps.length} opportunities!`, 'success');

                } else {
                    document.getElementById('coincatchScanResults').innerHTML =
                        '<span style="color: #FF0000;">‚ùå Scan failed</span>';
                    document.getElementById('coincatchOpportunities').innerHTML =
                        '<div style="color: #888; text-align: center; padding: 20px;">Scan failed. Please try again.</div>';
                    showNotification(data.message || 'Scan failed', 'error');
                }

            } catch (error) {
                console.error('Coincatch scan error:', error);
                document.getElementById('coincatchScanResults').innerHTML = '<span style="color: #FF0000;">‚ùå Error</span>';
                showNotification('Network error during scan', 'error');
            }
        }

        // Execute Coincatch Triangular Trade
        async function executeCoincatchTriangular(opportunity) {
            const apiKey = localStorage.getItem('coincatch_api') || '';
            const apiSecret = localStorage.getItem('coincatch_secret') || '';
            const passphrase = localStorage.getItem('coincatch_passphrase') || '';
            const maxInvestment = parseFloat(document.getElementById('coincatchMaxInvestment').value) || 1000;

            if (!confirm(`Execute triangular arbitrage on Coincatch?\n\nPath: ${opportunity.pathId}\nExpected Profit: ${opportunity.profitPercentage.toFixed(2)}%\nInvestment: $${maxInvestment}`)) {
                return;
            }

            showNotification('Executing Coincatch triangular arbitrage...', 'info');

            try {
                const response = await fetch(`${API_BASE}/trading/coincatch/triangular/execute`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    body: JSON.stringify({
                        apiKey,
                        apiSecret,
                        passphrase,
                        opportunity,
                        investmentAmount: maxInvestment
                    })
                });

                const data = await response.json();

                if (data.success) {
                    showNotification(`Trade executed! Profit: $${data.profit.toFixed(2)} (${data.profitPercentage}%)`, 'success');

                    // Refresh opportunities and history
                    await scanCoincatchTriangular();
                    await loadCoincatchTradeHistory();
                } else {
                    showNotification(data.message || 'Trade execution failed', 'error');
                }

            } catch (error) {
                console.error('Coincatch execution error:', error);
                showNotification('Network error during trade execution', 'error');
            }
        }

        // View Coincatch Path Details
        function viewCoincatchPathDetails() {
            const pathDetails = `
üìã COINCATCH Triangular Arbitrage Paths (48 Total)

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
SET 1: Essential 3-Leg (10 paths) ‚úÖ DEFAULT
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí BTC ‚Üí ETH ‚Üí USDT
2. USDT ‚Üí ETH ‚Üí SOL ‚Üí USDT
3. USDT ‚Üí BTC ‚Üí SOL ‚Üí USDT
4. USDT ‚Üí ETH ‚Üí XRP ‚Üí USDT
5. USDT ‚Üí BTC ‚Üí XRP ‚Üí USDT
6. USDT ‚Üí ETH ‚Üí ADA ‚Üí USDT
7. USDT ‚Üí BTC ‚Üí ADA ‚Üí USDT
8. USDT ‚Üí SOL ‚Üí XRP ‚Üí USDT
9. USDT ‚Üí SOL ‚Üí ADA ‚Üí USDT
10. USDT ‚Üí XRP ‚Üí ADA ‚Üí USDT

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
SET 2: Mid-Cap 3-Leg (10 paths) ‚úÖ DEFAULT
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí DOT ‚Üí MATIC ‚Üí USDT
2. USDT ‚Üí LINK ‚Üí AVAX ‚Üí USDT
3. USDT ‚Üí ATOM ‚Üí UNI ‚Üí USDT
4. USDT ‚Üí LTC ‚Üí BCH ‚Üí USDT
5. USDT ‚Üí NEAR ‚Üí APT ‚Üí USDT
6. USDT ‚Üí DOT ‚Üí LINK ‚Üí USDT
7. USDT ‚Üí MATIC ‚Üí AVAX ‚Üí USDT
8. USDT ‚Üí ATOM ‚Üí DOT ‚Üí USDT
9. USDT ‚Üí UNI ‚Üí LINK ‚Üí USDT
10. USDT ‚Üí APT ‚Üí NEAR ‚Üí USDT

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
SET 3: Major 4-Leg (8 paths)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí BTC ‚Üí ETH ‚Üí SOL ‚Üí USDT
2. USDT ‚Üí BTC ‚Üí ETH ‚Üí XRP ‚Üí USDT
3. USDT ‚Üí BTC ‚Üí SOL ‚Üí XRP ‚Üí USDT
4. USDT ‚Üí ETH ‚Üí SOL ‚Üí ADA ‚Üí USDT
5. USDT ‚Üí BTC ‚Üí ETH ‚Üí ADA ‚Üí USDT
6. USDT ‚Üí ETH ‚Üí XRP ‚Üí ADA ‚Üí USDT
7. USDT ‚Üí BTC ‚Üí SOL ‚Üí ADA ‚Üí USDT
8. USDT ‚Üí SOL ‚Üí XRP ‚Üí ADA ‚Üí USDT

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
SET 4: Altcoin 4-Leg (10 paths)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí DOT ‚Üí MATIC ‚Üí LINK ‚Üí USDT
2. USDT ‚Üí LINK ‚Üí AVAX ‚Üí ATOM ‚Üí USDT
3. USDT ‚Üí ATOM ‚Üí UNI ‚Üí DOT ‚Üí USDT
4. USDT ‚Üí MATIC ‚Üí AVAX ‚Üí LINK ‚Üí USDT
5. USDT ‚Üí DOT ‚Üí LINK ‚Üí ATOM ‚Üí USDT
6. USDT ‚Üí AVAX ‚Üí UNI ‚Üí MATIC ‚Üí USDT
7. USDT ‚Üí LINK ‚Üí ATOM ‚Üí DOT ‚Üí USDT
8. USDT ‚Üí UNI ‚Üí MATIC ‚Üí AVAX ‚Üí USDT
9. USDT ‚Üí NEAR ‚Üí APT ‚Üí FTM ‚Üí USDT
10. USDT ‚Üí APT ‚Üí NEAR ‚Üí LTC ‚Üí USDT

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
SET 5: Extended 4-Leg (10 paths)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. USDT ‚Üí BTC ‚Üí ETH ‚Üí SOL ‚Üí XRP ‚Üí USDT (5-leg)
2. USDT ‚Üí DOGE ‚Üí SHIB ‚Üí PEPE ‚Üí USDT
3. USDT ‚Üí TRX ‚Üí ALGO ‚Üí VET ‚Üí USDT
4. USDT ‚Üí FTM ‚Üí SAND ‚Üí MANA ‚Üí USDT
5. USDT ‚Üí BTC ‚Üí DOT ‚Üí LINK ‚Üí USDT
6. USDT ‚Üí ETH ‚Üí MATIC ‚Üí AVAX ‚Üí USDT
7. USDT ‚Üí SOL ‚Üí ATOM ‚Üí UNI ‚Üí USDT
8. USDT ‚Üí XRP ‚Üí LTC ‚Üí BCH ‚Üí USDT
9. USDT ‚Üí ADA ‚Üí NEAR ‚Üí APT ‚Üí USDT
10. USDT ‚Üí BNB ‚Üí TRX ‚Üí ALGO ‚Üí USDT

üí° TOTAL: 48 paths (20 three-leg + 27 four-leg + 1 five-leg)
üåâ BRIDGE: USDT (Tether)
üåç GLOBAL: Advanced multi-leg arbitrage specialist
üîê AUTH: API Key + Secret
            `.trim();

            alert(pathDetails);
            console.log('üìã [COINCATCH] Path details displayed:', pathDetails);
        }

        // Save Coincatch Settings
        function saveCoincatchSettings() {
            const settings = {
                minProfit: document.getElementById('coincatchMinProfit').value,
                maxInvestment: document.getElementById('coincatchMaxInvestment').value,
                selectedSets: []
            };

            for (let i = 1; i <= 5; i++) {
                const checkbox = document.getElementById(`coincatch_SET_${i}`);
                if (checkbox) {
                    settings.selectedSets.push({
                        id: i,
                        checked: checkbox.checked
                    });
                }
            }

            localStorage.setItem('coincatch_triangular_settings', JSON.stringify(settings));
            showNotification('Coincatch settings saved!', 'success');
        }

        // Load Coincatch Settings
        function loadCoincatchSettings() {
            const settings = JSON.parse(localStorage.getItem('coincatch_triangular_settings') || '{}');

            if (settings.minProfit) {
                document.getElementById('coincatchMinProfit').value = settings.minProfit;
            }

            if (settings.maxInvestment) {
                document.getElementById('coincatchMaxInvestment').value = settings.maxInvestment;
            }

            if (settings.selectedSets) {
                settings.selectedSets.forEach(set => {
                    const checkbox = document.getElementById(`coincatch_SET_${set.id}`);
                    if (checkbox) {
                        checkbox.checked = set.checked;
                    }
                });
            }

            showNotification('Coincatch settings loaded!', 'success');
        }

        // Load Coincatch Trade History
        async function loadCoincatchTradeHistory() {
            try {
                const response = await fetch(`${API_BASE}/trading/coincatch/triangular/history`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });

                const data = await response.json();

                if (data.success && data.trades && data.trades.length > 0) {
                    let html = '<div style="overflow-x: auto;"><table style="width: 100%; border-collapse: collapse; font-size: 13px;">';
                    html += '<thead><tr style="background: rgba(255,87,34,0.2);">';
                    html += '<th style="padding: 8px; text-align: left; color: #FF5722;">Date</th>';
                    html += '<th style="padding: 8px; text-align: left; color: #FF5722;">Path</th>';
                    html += '<th style="padding: 8px; text-align: right; color: #FF5722;">Investment</th>';
                    html += '<th style="padding: 8px; text-align: right; color: #FF5722;">Final</th>';
                    html += '<th style="padding: 8px; text-align: right; color: #FF5722;">Profit</th>';
                    html += '<th style="padding: 8px; text-align: center; color: #FF5722;">Status</th>';
                    html += '</tr></thead><tbody>';

                    data.trades.forEach(trade => {
                        const profit = parseFloat(trade.profit);
                        const profitPercent = ((profit / parseFloat(trade.investment_amount)) * 100).toFixed(2);
                        const profitColor = profit >= 0 ? '#00FF00' : '#FF0000';

                        html += `<tr style="border-bottom: 1px solid #333;">
                            <td style="padding: 8px; color: #888;">${new Date(trade.created_at).toLocaleString()}</td>
                            <td style="padding: 8px; color: #FF5722;">${trade.path_id}</td>
                            <td style="padding: 8px; text-align: right; color: #888;">$${parseFloat(trade.investment_amount).toFixed(2)}</td>
                            <td style="padding: 8px; text-align: right; color: #888;">$${parseFloat(trade.final_amount).toFixed(2)}</td>
                            <td style="padding: 8px; text-align: right; color: ${profitColor};">$${profit.toFixed(2)} (${profitPercent}%)</td>
                            <td style="padding: 8px; text-align: center;">
                                <span style="background: rgba(255,87,34,0.2); color: #FF5722; padding: 4px 8px; border-radius: 4px; font-size: 11px;">
                                    ${trade.status}
                                </span>
                            </td>
                        </tr>`;
                    });

                    html += '</tbody></table></div>';
                    document.getElementById('coincatchTradeHistory').innerHTML = html;
                } else {
                    document.getElementById('coincatchTradeHistory').innerHTML =
                        '<div style="color: #888; font-size: 14px;">No trade history available.</div>';
                }

            } catch (error) {
                console.error('Coincatch history error:', error);
            }
        }

        // Auto-load Coincatch settings on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadCoincatchSettings();
        });
    </script>
</body>
</html>